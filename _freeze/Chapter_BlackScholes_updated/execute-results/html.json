{
  "hash": "82b51f54001e33da86f8ecf8b6b57104",
  "result": {
    "engine": "jupyter",
    "markdown": "\\newcommand{\\d}{\\,\\mathrm{d}}\n\\newcommand{\\e}{\\mathrm{e}}\n\\newcommand{\\E}{\\mathbb{E}}\n\n\n# The Black-Scholes Model {#sec-c:blackscholes_updated}\n\n::: {#9e0abdb6 .cell execution_count=1}\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<script type=\"text/javascript\" async src=\"https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_SVG\"></script>\n```\n:::\n:::\n\n\nIn the previous chapter, we developed a general framework for derivative pricing based on the absence of arbitrage. We saw how linear pricing leads to state prices, risk-neutral probabilities, and the fundamental pricing formula. We also introduced change of numeraire methods, which allow us to compute option values as expectations under different probability measures. In this chapter, we apply these principles to derive and analyze the celebrated Black-Scholes formula for European option pricing.\n\nA fundamental insight is that standard European options can be expressed as combinations of digital options. Understanding this connection provides both theoretical insight and practical computational advantages.\n\nThe Black-Scholes model assumes that the underlying asset pays a constant dividend yield $q$ and has price $S$ satisfying\n\n$$\\frac{\\mathrm{d}S}{S} = (\\mu - q) \\mathrm{d}t + \\sigma \\mathrm{d}B$$\n\nfor a Brownian motion $B$, where $\\sigma$ is assumed constant and $\\mu$ can be a quite general random process. We also assume a constant continuously-compounded risk-free rate $r$.\n\n## Digital Options as Building Blocks\n\nBefore deriving the Black-Scholes formula, we need to understand how standard options relate to digital options. A **digital option** (also called binary option) has a discontinuous payoff—it pays a fixed amount if a condition is met, zero otherwise.\n\n#### Two Types of Digitals\n\nConsider a call option with strike $K$ and maturity $T$. Its payoff $(S_T - K)^+$ can be decomposed as:\n\n$$(S_T - K)^+ = \\mathbf{1}_{\\{S_T > K\\}} S_T - K \\mathbf{1}_{\\{S_T > K\\}}$$\n\nThis reveals that a call option is the difference between two digital options:\n\n1. **Share digital**: Pays $S_T$ when $S_T > K$, zero otherwise\n2. **Cash digital**: Pays $K$ when $S_T > K$, zero otherwise\n\nSimilarly, a put option with payoff $(K - S_T)^+$ can be written as:\n\n$$(K - S_T)^+ = K \\mathbf{1}_{\\{S_T < K\\}} - \\mathbf{1}_{\\{S_T < K\\}} S_T$$\n\nThis is $K$ cash digitals minus share digitals, both paying when $S_T < K$.\n\n#### Why This Decomposition Matters\n\nThis decomposition is powerful because:\n\n1. **Computational efficiency**: Digital options have closed-form expressions involving only normal probabilities\n2. **Theoretical insight**: It connects discrete payoffs to continuous probability distributions\n3. **Risk management**: Greeks can be computed directly from the normal density function\n4. **Generalization**: The approach extends to exotic options and other underlying processes\n\n## Girsanov's Theorem in the Black-Scholes Model\n\nTo value digital options, we need to understand how probability measures change in continuous time. When we change probability measures, a process $B$ that was a Brownian motion cannot be expected to remain a Brownian motion under the new measure. However, Girsanov's Theorem tells us exactly how the drift changes.\n\nIn the Black-Scholes model, the dividend-reinvested stock price follows:\n\n$$\\mathrm{d}S_t = \\mu S_t \\mathrm{d}t + \\sigma S_t \\mathrm{d}B_t$$\n\nWe can rewrite this as:\n\n$$\\mathrm{d}S_t = r S_t \\mathrm{d}t + \\sigma S_t \\mathrm{d}\\left(B_t + \\frac{\\mu - r}{\\sigma}t\\right)$$\n\nDefine $\\kappa = \\frac{\\mu - r}{\\sigma}$, called the market price of risk or Sharpe ratio.\n\n::: Principle\n**Girsanov's Theorem**: Define the exponential martingale:\n\n$$Z_t = \\exp\\left(-\\frac{1}{2}\\kappa^2 t - \\kappa B_t\\right)$$\n\nSince $Z_T$ is lognormal, $\\mathbb{E}[Z_T] = 1$. Under the probability measure defined by:\n\n$$\\mathbb{E}^\\kappa[Y] = \\mathbb{E}[Z_T Y]$$\n\nfor any function $Y$ of $B_t$ ($0 \\leq t \\leq T$), the process $B_t^\\kappa = B_t + \\kappa t$ is a Brownian motion. Moreover, if $M_t$ is a martingale under the new measure, then $Z_t M_t$ is a martingale under the original measure.\n:::\n\nThis theorem tells us how to construct the risk-neutral measure from the original measure. Using Ito's lemma, we can verify that $Z_t \\frac{S_t}{R_t}$ is indeed a martingale:\n\n$$Z_t \\frac{S_t}{R_t} = S_0 \\exp\\left(-\\frac{1}{2}(\\sigma - \\kappa)^2 t + (\\sigma - \\kappa)B_t\\right)$$\n\nTherefore:\n\n$$\\mathbb{E}\\left[Z_t \\frac{S_t}{R_t}\\right] = S_0$$\n\n#### Stock as Numeraire\n\nWhen using the stock as numeraire, we need the process $\\frac{R_t}{S_t}$ to be a martingale. Following similar analysis with Girsanov's Theorem, we find that under the stock numeraire measure:\n\n$$\\mathrm{d}S_t = (r + \\sigma^2) S_t \\mathrm{d}t + \\sigma S_t \\mathrm{d}B_t^S$$\n\nwhere $B_t^S = B_t^R - \\sigma t$ is a Brownian motion under the stock numeraire measure.\n\n## Derivation of the Black-Scholes Formula\n\nNow we apply the valuation theory from Chapter 3 (Arbitrage Pricing) and the tail probability calculations from Chapter 2 (Geometric Brownian Motion) to derive the Black-Scholes formula.\n\n#### Cash Digital Options\n\nA cash digital option paying \\$1 when $S_T > K$ has value under the risk-neutral measure:\n\n$$e^{-r(T-t)} \\mathbb{E}_t^R[\\mathbf{1}_{\\{S_T > K\\}}] = e^{-r(T-t)} \\text{prob}^R(S_T > K)$$\n\nUnder the risk-neutral measure, the stock price follows:\n\n$$\\frac{\\mathrm{d}S}{S} = (r - q) \\mathrm{d}t + \\sigma \\mathrm{d}B^R$$\n\nThis means:\n\n$$\\mathrm{d}\\log S = \\left(r - q - \\frac{\\sigma^2}{2}\\right) \\mathrm{d}t + \\sigma \\mathrm{d}B^R$$\n\nFrom Chapter 2, we know this has the solution:\n\n$$S_T = S_t \\exp\\left(\\left(r - q - \\frac{\\sigma^2}{2}\\right)(T-t) + \\sigma B_{T-t}^R\\right)$$\n\nApplying the tail probability formula from @sec-tailprobs with $\\alpha = r - q - \\sigma^2/2$:\n\n$$\\text{prob}^R(S_T > K) = N(d_2)$$\n\nwhere:\n\n$$d_2 = \\frac{\\log(S_t/K) + (r - q - \\frac{\\sigma^2}{2})(T-t)}{\\sigma\\sqrt{T-t}}$$\n\n#### Share Digital Options\n\nFor the share digital paying $S_T \\mathbf{1}_{\\{S_T > K\\}}$, we use the stock as numeraire. From the change of numeraire theory in Chapter 3:\n\n$$\\text{Value} = S_t \\mathbb{E}_t^S[\\mathbf{1}_{\\{S_T > K\\}}] = S_t \\cdot \\text{prob}^S(S_T > K)$$\n\nUnder the stock numeraire measure:\n\n$$\\mathrm{d}\\log S = \\left(r - q + \\frac{\\sigma^2}{2}\\right) \\mathrm{d}t + \\sigma \\mathrm{d}B^S$$\n\nApplying the tail probability formula from @sec-tailprobs with $\\alpha = r - q + \\sigma^2/2$:\n\n$$\\text{prob}^S(S_T > K) = N(d_1)$$\n\nwhere:\n\n$$d_1 = \\frac{\\log(S_t/K) + (r - q + \\frac{\\sigma^2}{2})(T-t)}{\\sigma\\sqrt{T-t}} = d_2 + \\sigma\\sqrt{T-t}$$\n\n#### Combining the Results\n\nNow we can derive the Black-Scholes formula by combining our digital option results. A European call option has payoff:\n\n$$(S_T - K)^+ = \\mathbf{1}_{\\{S_T > K\\}} S_T - K \\mathbf{1}_{\\{S_T > K\\}}$$\n\nThe first term is a share digital worth $S_t \\cdot \\text{prob}^S(S_T > K) = S_t N(d_1)$.\n\nThe second term is $K$ cash digitals worth $K \\cdot e^{-r(T-t)} \\cdot \\text{prob}^R(S_T > K) = K e^{-r(T-t)} N(d_2)$.\n\nSince we need $e^{-q(T-t)}$ in front of the share digital to account for dividends, the call value is:\n\n#### The Black-Scholes Formula\n\nThis derivation shows how the fundamental arbitrage pricing theory leads directly to the Black-Scholes formula. The key steps were:\n\n1. **Linear pricing**: From Chapter 3, any security's value is a linear combination of Arrow securities (digitals)\n2. **Change of numeraire**: Different measures give different probabilities for the same event  \n3. **Tail probabilities**: From Chapter 2, we can compute $\\text{prob}(S_T > K)$ under any measure\n4. **Girsanov's Theorem**: Provides the mathematical foundation for changing measures\n\n::: Rule\nThe value of a European call option is:\n\n$$C(t, S_t) = e^{-q(T-t)} S_t N(d_1) - e^{-r(T-t)} K N(d_2)$$\n\nwhere $d_1$ and $d_2$ are defined above and $N(\\cdot)$ is the standard normal cumulative distribution function.\n:::\n\nFor a European put option:\n\n::: Rule\n$$P(t, S_t) = e^{-r(T-t)} K N(-d_2) - e^{-q(T-t)} S_t N(-d_1)$$\n:::\n\nThe call and put values satisfy put-call parity:\n\n$$e^{-r(T-t)} K + C(t, S_t) = e^{-q(T-t)} S_t + P(t, S_t)$$\n\n#### Interactive Black-Scholes Explorer\n\nThe following interactive tool allows you to explore how the Black-Scholes formula behaves as you vary the input parameters. You can see how option prices change with stock price, volatility, time to expiration, interest rates, and dividend yields.\n\n::: {#fig-bs-call-put} \n<iframe height=\"800\" width=\"100%\" src=\"https://black-scholes.koyeb.app/\"></iframe>\n\n**Black-Scholes Explorer.** This interactive calculator shows how call and put option prices vary with the underlying parameters. Notice how the option prices change smoothly with the stock price, and observe the effects of time decay and volatility on option values.\n:::\n\n## Replication and Delta Hedging\n\nThe arbitrage pricing principle requires that we can replicate option payoffs through dynamic trading. Following Merton's argument, we construct a portfolio holding $\\delta_t$ shares of stock and $\\alpha_t$ units of the risk-free asset, with value:\n\n$$W_t = \\alpha_t e^{rt} + \\delta_t S_t$$\n\nFor continuous trading with no cash inflows or outflows:\n\n$$\\mathrm{d}W_t = \\delta_t \\mathrm{d}S_t + \\delta_t q S_t \\mathrm{d}t + \\alpha_t r e^{rt} \\mathrm{d}t$$\n\nIf the option value is $C(t, S_t)$, then by Ito's lemma:\n\n$$\\mathrm{d}C = \\frac{\\partial C}{\\partial t} \\mathrm{d}t + \\frac{\\partial C}{\\partial S} \\mathrm{d}S + \\frac{1}{2} \\frac{\\partial^2 C}{\\partial S^2} \\sigma^2 S^2 \\mathrm{d}t$$\n\nMatching the stochastic terms requires:\n\n$$\\delta_t = \\frac{\\partial C}{\\partial S}$$\n\nThis is the option's delta—the number of shares needed to hedge the option. By no-arbitrage, $W_t = C(t, S_t)$, leading to the fundamental partial differential equation.\n\n## The Fundamental PDE\n\nAny European derivative with payoff $V(S_T)$ at maturity $T$ must satisfy:\n\n$$r V = \\frac{\\partial V}{\\partial t} + \\frac{\\partial V}{\\partial S}(r - q)S + \\frac{1}{2} \\frac{\\partial^2 V}{\\partial S^2} \\sigma^2 S^2$$\n\nwith boundary condition $V(S_T, T) = V(S_T)$.\n\nThis PDE has several important interpretations:\n\n1. **Risk-neutral expectation**: The solution is $V(t, S_t) = \\mathbb{E}_t^R[e^{-r(T-t)} V(S_T)]$\n2. **Replication**: The portfolio holds $\\frac{\\partial V}{\\partial S}$ shares and $V - \\frac{\\partial V}{\\partial S}S$ in cash\n3. **Hedging condition**: The drift term equals the risk-free return when perfectly hedged\n\nThe Black-Scholes formula satisfies this PDE with the appropriate boundary conditions for calls and puts.\n\n## Greeks\n\nThe sensitivities of option values to various inputs are called Greeks. From the Black-Scholes formula:\n\n#### Delta ($\\delta$)\nThe sensitivity to stock price changes:\n\n$$\\delta_{call} = e^{-q(T-t)} N(d_1)$$\n$$\\delta_{put} = -e^{-q(T-t)} N(-d_1)$$\n\n#### Gamma ($\\Gamma$)\nThe rate of change of delta:\n\n$$\\Gamma = \\frac{e^{-q(T-t)} n(d_1)}{S \\sigma \\sqrt{T-t}}$$\n\nwhere $n(\\cdot)$ is the standard normal density. Gamma is the same for calls and puts.\n\n#### Theta ($\\Theta$)\nThe time decay (using $\\partial/\\partial(-T)$ so positive theta means value increases as time passes):\n\n$$\\Theta_{call} = -\\frac{e^{-q(T-t)} S n(d_1) \\sigma}{2\\sqrt{T-t}} + q e^{-q(T-t)} S N(d_1) - r e^{-r(T-t)} K N(d_2)$$\n\n#### Vega ($\\mathcal{V}$)\nThe sensitivity to volatility:\n\n$$\\mathcal{V} = e^{-q(T-t)} S n(d_1) \\sqrt{T-t}$$\n\n#### Rho ($\\rho$)\nThe sensitivity to interest rates:\n\n$$\\rho_{call} = (T-t) e^{-r(T-t)} K N(d_2)$$\n\n#### Interactive Greeks Explorer\n\nThe Greeks measure how option prices change with respect to various parameters. The following interactive tool lets you visualize how the Greeks behave across different stock prices and parameter values.\n\n::: {#fig-bs-greeks} \n<iframe height=\"750\" width=\"100%\" src=\"https://greeks.koyeb.app/\"></iframe>\n\n**Black-Scholes Greeks Explorer.** This tool shows how delta, gamma, theta, vega, and rho vary with the stock price and other parameters. Pay particular attention to how gamma peaks near the strike price and how theta becomes more negative as expiration approaches.\n:::\n\n## Theta and Gamma in Delta Hedges\n\nThe relationship between theta and gamma provides deep insight into option hedging. Consider a delta-hedged portfolio (short call, long $\\delta$ shares). From the fundamental PDE and our Greeks:\n\n$$\\Theta + \\frac{1}{2} \\Gamma \\sigma^2 S^2 = r C - (r - q) S \\delta$$\n\nIn continuous time, the portfolio change is:\n\n$$-\\Theta \\mathrm{d}t - \\frac{1}{2} \\Gamma \\sigma^2 S^2 \\mathrm{d}t + q \\delta S \\mathrm{d}t + (C - \\delta S) r \\mathrm{d}t$$\n\nThese terms exactly cancel—the time decay and dividends received offset losses from being short gamma and interest payments. This perfect cancellation only holds with continuous rebalancing.\n\nWith discrete rebalancing, the hedge is imperfect. The portfolio is short gamma, meaning it loses money when the stock moves significantly between rebalances. This loss is approximately:\n\n$$\\frac{1}{2} \\Gamma (\\Delta S)^2$$\n\nwhere $\\Delta S$ is the stock price change. The hedging error increases with:\n- Larger gamma (near the strike at expiration)\n- Higher volatility\n- Longer time between rebalances\n\n#### Discretely Rebalanced Delta Hedges\n\nThe theoretical analysis above assumes continuous rebalancing, but in practice, hedging must be done at discrete intervals. This introduces hedging error that we can analyze through simulation.\n\n#### The Discrete Hedging Problem\n\nConsider a delta hedge that is rebalanced at discrete times $0 = t_0 < t_1 < \\cdots < t_N = T$ with $\\Delta t = T/N$. Between rebalancing dates, the hedge portfolio consists of:\n- Short position in the option\n- Long $\\delta_{t_i}$ shares of stock (where $\\delta_{t_i}$ is computed at the last rebalancing date)\n- Cash position to finance the hedge\n\nThe key insight from the analysis in @sec-s_deltahedging is that perfect continuous hedging relies on the relationship:\n\n$$-\\Theta \\,\\mathrm{d} t - \\frac{1}{2}\\Gamma \\sigma^2S^2\\,\\mathrm{d} t+ q \\delta S\\,\\mathrm{d} t+(C-\\delta S)r\\,\\mathrm{d} t = 0$$\n\nWith discrete rebalancing, this balance is disrupted. The portfolio gains and losses come from:\n\n1. **Time decay**: $-\\Theta \\Delta t$ (predictable, typically positive for short option)\n2. **Gamma exposure**: $-\\frac{1}{2}\\Gamma (\\Delta S)^2$ (stochastic losses when short gamma)\n3. **Interest and dividends**: Financing costs and dividend income\n4. **Delta drift**: Changes in delta between rebalancing dates\n\n#### Simulation of Discrete Hedging\n\nThe following code simulates the performance of discretely rebalanced delta hedges:\n\n::: {#41a77219 .cell execution_count=2}\n``` {.python .cell-code}\nimport numpy as np\nfrom scipy.stats import norm\n\ndef blackscholes(S0, K, r, q, sig, T, call = True):\n    '''Calculate option price using Black-Scholes formula.'''\n    d1 = (np.log(S0/K) + (r -q + sig**2/2) * T)/(sig*np.sqrt(T))\n    d2 = d1 - sig*np.sqrt(T)\n    if call:\n        return np.exp(-q*T)*S0 * norm.cdf(d1,0,1) - K * np.exp(-r * T) * norm.cdf(d2,0, 1)\n    else:\n        return np.exp(-q*T)*S0 * (-norm.cdf(-d1,0,1)) + K * np.exp(-r * T) * norm.cdf(-d2,0, 1)\n\ndef blackscholes_delta(S0, K, r, q, sig, T, call = True):\n    '''Calculate option delta using Black-Scholes formula.'''\n    d1 = (np.log(S0/K) + (r -q + sig**2/2) * T)/(sig*np.sqrt(T))\n    if call:\n        return np.exp(-q*T)*norm.cdf(d1,0,1)\n    else:\n        return np.exp(-q*T)*norm.cdf(-d1,0,1)\n\ndef simulated_delta_hedge_profit(S0, K, r, sigma, q, T, mu, M, N, pct):\n    \"\"\"\n    Simulate profits/losses from discretely rebalanced delta hedge\n    \n    Parameters:\n    S0: initial stock price\n    K: strike price  \n    r: risk-free rate\n    sigma: volatility\n    q: dividend yield\n    T: time to maturity\n    mu: expected stock return (actual, not risk-neutral)\n    M: number of simulations\n    N: number of rebalancing periods\n    pct: percentile to return\n    \"\"\"\n    dt = T / N\n    vol_dt = sigma * np.sqrt(dt)\n    drift = (mu - q - 0.5 * sigma**2) * dt\n    discount = np.exp(r * dt)\n    div_factor = np.exp(q * dt) - 1\n    \n    # Initial setup\n    call_0 = blackscholes(S0, K, r, q, sigma, T, True)\n    delta_0 = blackscholes_delta(S0, K, r, q, sigma, T, True)\n    cash_0 = call_0 - delta_0 * S0\n    \n    profits = np.zeros(M)\n    \n    np.random.seed(42)  # For reproducible results\n    \n    for i in range(M):\n        log_s = np.log(S0)\n        cash = cash_0\n        s = S0\n        delta = delta_0\n        \n        # Rebalancing loop\n        for j in range(1, N):\n            # Stock price evolution\n            log_s += drift + vol_dt * np.random.randn()\n            new_s = np.exp(log_s)\n            \n            # New delta for rebalancing\n            time_remaining = T - j * dt\n            new_delta = blackscholes_delta(new_s, K, r, q, sigma, time_remaining, True)\n            \n            # Update cash position: interest + dividends - rebalancing cost\n            cash = (discount * cash + \n                   delta * s * div_factor - \n                   (new_delta - delta) * new_s)\n            \n            s = new_s\n            delta = new_delta\n        \n        # Final period\n        log_s += drift + vol_dt * np.random.randn()\n        final_s = np.exp(log_s)\n        \n        # Final hedge value\n        final_hedge_value = (discount * cash + \n                           delta * s * div_factor + \n                           delta * final_s)\n        \n        # Profit = hedge value - option payoff\n        option_payoff = max(final_s - K, 0)\n        profits[i] = final_hedge_value - option_payoff\n    \n    return np.percentile(profits, pct * 100)\n\n# Example: Hedge a call option with discrete rebalancing\nS0 = 100      # Initial stock price\nK = 100       # Strike price (at-the-money)\nr = 0.05      # Risk-free rate\nsigma = 0.2   # Volatility\nq = 0.02      # Dividend yield\nT = 0.25      # 3 months to maturity\nmu = 0.12     # Expected stock return\n\nprint(\"Discrete Delta Hedging Analysis\")\nprint(\"==============================\")\nprint(f\"Parameters: S0={S0}, K={K}, r={r:.2f}, σ={sigma:.2f}, q={q:.2f}, T={T}\")\nprint(f\"Expected stock return μ={mu:.2f}\\\\n\")\n\n# Test different rebalancing frequencies\nrebalancing_frequencies = [4, 12, 52, 252]  # Weekly, monthly, daily, etc.\nM = 5000  # Number of simulations\n\nprint(\"Hedging Error Analysis (95th percentile of absolute profits):\")\nprint(\"Rebalancing Frequency | Periods | 95th Percentile Error\")\nprint(\"-\" * 55)\n\nfor N in rebalancing_frequencies:\n    # Get both tails of the distribution\n    p95 = simulated_delta_hedge_profit(S0, K, r, sigma, q, T, mu, M, N, 0.95)\n    p5 = simulated_delta_hedge_profit(S0, K, r, sigma, q, T, mu, M, N, 0.05)\n    \n    # Report the larger absolute error\n    max_error = max(abs(p95), abs(p5))\n    \n    freq_name = {4: \"Weekly\", 12: \"Monthly\", 52: \"Daily\", 252: \"Intraday\"}[N]\n    print(f\"{freq_name:<20} | {N:>7} | {max_error:>18.4f}\")\n\nprint(f\"\\\\nNote: Errors should decrease as rebalancing frequency increases.\")\nprint(f\"The Black-Scholes price is {blackscholes(S0, K, r, q, sigma, T, True):.4f}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nDiscrete Delta Hedging Analysis\n==============================\nParameters: S0=100, K=100, r=0.05, σ=0.20, q=0.02, T=0.25\nExpected stock return μ=0.12\\n\nHedging Error Analysis (95th percentile of absolute profits):\nRebalancing Frequency | Periods | 95th Percentile Error\n-------------------------------------------------------\nWeekly               |       4 |             2.8283\nMonthly              |      12 |             1.5545\nDaily                |      52 |             0.7934\nIntraday             |     252 |             0.3629\n\\nNote: Errors should decrease as rebalancing frequency increases.\nThe Black-Scholes price is 4.3359\n```\n:::\n:::\n\n\n#### Understanding Hedging Errors\n\nThe simulation results illustrate several key points about discrete hedging:\n\n1. **Gamma is the enemy**: When an option has high gamma (near expiration, near the strike), small stock moves between rebalances cause large hedging errors\n\n2. **Frequency matters**: More frequent rebalancing reduces hedging error, but with diminishing returns and higher transaction costs\n\n3. **Volatility creates error**: Higher realized volatility generally increases hedging errors for short gamma positions\n\n4. **The hedge is model-independent**: Notice that the expected stock return $\\mu$ affects the distribution of stock paths but not the systematic hedging error - this confirms the model-free nature of delta hedging\n\n#### Practical Implications\n\nIn practice, traders must balance:\n- **Hedging accuracy**: More frequent rebalancing reduces error\n- **Transaction costs**: Every rebalance incurs bid-ask spreads and commissions  \n- **Market impact**: Large hedging flows can move prices unfavorably\n\nThe discrete hedging analysis shows why options market makers require:\n- Sophisticated risk management systems for continuous monitoring\n- Careful consideration of gamma exposure, especially near expiration\n- Transaction cost models to optimize rebalancing frequency\n\n## Implied Volatilities\n\nWhile all other Black-Scholes inputs are observable, volatility must be estimated. Given an option's market price, we can invert the Black-Scholes formula to find the implied volatility—the $\\sigma$ that produces the observed price.\n\nImplied volatilities serve several purposes:\n\n1. **Price quotes**: Options are often quoted in terms of implied volatility\n2. **Relative value**: Comparing implied volatilities helps identify expensive or cheap options\n3. **Market views**: Implied volatilities reflect market expectations of future volatility\n\n#### The Volatility Smile\n\nIf the Black-Scholes model were perfect, all options with the same maturity would have the same implied volatility. In practice, plotting implied volatility against strike typically shows:\n\n- Higher implied volatilities for low strikes (out-of-the-money puts)\n- Lower implied volatilities near the at-the-money strike\n- Slightly increasing implied volatilities for high strikes\n\nThis \"volatility smile\" or \"smirk\" indicates that market prices reflect:\n- Fat tails: Higher probability of extreme moves than lognormal\n- Negative skewness: Larger probability of extreme downward moves\n\nThe smile has been particularly pronounced for equity index options since the 1987 crash, suggesting market participants price in crash risk.\n\n## Exercises\n\n#### Digital Options and Building Blocks\n\n::: {#exr-digital-pricing}\nConsider a cash digital option that pays $1 when $S_T > K$ and a share digital that pays $S_T$ when $S_T > K$. Using Black-Scholes parameters $S_0 = 100$, $K = 105$, $r = 5\\%$, $q = 2\\%$, $\\sigma = 20\\%$, $T = 0.25$:\n\na) Calculate the analytical values of both digital options using the formulas from the chapter\nb) Verify your results using Monte Carlo simulation with 100,000 paths\nc) Show that a call option can be decomposed as: $C = S_0 N(d_1) e^{-qT} - K N(d_2) e^{-rT}$\nd) Implement this decomposition and verify it matches the standard Black-Scholes formula\n:::\n\n::: {#exr-digital-delta}\nThe delta of a cash digital option that pays $1 when $S_T > K$ is:\n$$\\Delta_{\\text{digital}} = \\frac{e^{-rT} n(d_2)}{\\sigma S \\sqrt{T}}$$\n\nwhere $n(\\cdot)$ is the standard normal density.\n\na) Plot this delta against stock price for $S \\in [80, 120]$ with the parameters from the previous exercise\nb) Compare the magnitude of digital delta to call option delta near the strike\nc) Explain why delta hedging a short digital position near expiration and near the strike is problematic\nd) What happens to the digital delta as time to expiration approaches zero?\n:::\n\n#### Change of Numeraire and Girsanov's Theorem\n\n::: {#exr-measure-verification}\nUsing simulation, verify the change of numeraire formulas for digital options:\n\na) Under the risk-neutral measure, simulate $S_T$ following $dS/S = (r-q)dt + \\sigma dB^R$\nb) Under the stock numeraire measure, simulate $S_T$ following $dS/S = (r-q+\\sigma^2)dt + \\sigma dB^S$  \nc) Calculate $\\mathbb{E}^R[e^{-rT} \\mathbf{1}_{\\{S_T > K\\}}]$ and $S_0 \\mathbb{E}^S[\\mathbf{1}_{\\{S_T > K\\}}/S_T]$\nd) Verify both give the same digital option value up to simulation error\ne) Use 50,000 simulation paths and report the standard errors\n:::\n\n::: {#exr-girsanov-application}\nVerify the exponential martingale property in Girsanov's Theorem. With $\\kappa = (\\mu - r)/\\sigma$:\n\na) Simulate paths of $Z_t = \\exp(-\\frac{1}{2}\\kappa^2 t - \\kappa B_t)$ where $B_t$ is standard Brownian motion\nb) Verify that $\\mathbb{E}[Z_T] = 1$ for various values of $T$\nc) Show that $Z_t S_t/R_t$ is a martingale under the original measure\nd) Compare the distribution of $B_t + \\kappa t$ to standard Brownian motion under the new measure\n:::\n\n#### Black-Scholes Formula and Properties\n\n::: {#exr-bs-implementation}\nImplement the complete Black-Scholes formula with all Greeks:\n\na) Create a Python class `BlackScholesOption` that calculates price, delta, gamma, theta, vega, and rho\nb) Include both calls and puts with proper dividend yield handling\nc) Verify put-call parity: $C - P = S_0 e^{-qT} - K e^{-rT}$\nd) Test your implementation against the interactive Black-Scholes explorer values\n:::\n\n::: {#exr-bs-limits}\nAnalyze the limiting behavior of the Black-Scholes formula:\n\na) Show that as $T \\to 0$, the call value approaches $\\max(S_0 - K, 0)$\nb) Show that as $\\sigma \\to 0$, the formula approaches the deterministic payoff present value\nc) What happens to call and put values as $\\sigma \\to \\infty$? Explain intuitively.\nd) Analyze the behavior as $r \\to 0$ and as $r \\to \\infty$\n:::\n\n::: {#exr-volatility-impact}\nUsing the interactive Black-Scholes explorer or your own implementation:\n\na) For an at-the-money option, plot call value against volatility for $\\sigma \\in [0.1, 1.0]$\nb) Repeat for options that are 10% in-the-money and 10% out-of-the-money\nc) For which moneyness is the option price most sensitive to volatility changes?\nd) Explain this pattern in terms of the option's probability of finishing in-the-money\n:::\n\n#### Greeks and Risk Management\n\n::: {#exr-greeks-plots}\nCreate comprehensive plots of the Greeks using the interactive Greeks explorer as reference:\n\na) Plot delta, gamma, theta, vega, and rho against stock price for an at-the-money option\nb) Repeat for different times to expiration: 1 month, 3 months, 6 months, 1 year\nc) Identify where gamma is maximized and explain why this matters for hedging\nd) Show how theta changes as expiration approaches and explain the time decay acceleration\n:::\n\n::: {#exr-gamma-hedging}\nConsider delta and gamma hedging a short call option using the underlying and a put with the same strike and maturity:\n\na) Derive the positions in stock and put needed for a delta-gamma neutral portfolio\nb) Show that this hedge never needs adjustment (relate to put-call parity)\nc) Implement this strategy and compare hedging errors to delta-only hedging\nd) What are the practical limitations of this \"perfect\" hedge?\n:::\n\n::: {#exr-exotic-greeks}\nCalculate the Greeks for exotic payoffs:\n\na) For a derivative paying $S_T^2$, find the value, delta, and gamma using risk-neutral valuation\nb) For a derivative paying $\\log(S_T)$, repeat the calculation\nc) Verify both satisfy the fundamental PDE: $rV = \\frac{\\partial V}{\\partial t} + (r-q)S\\frac{\\partial V}{\\partial S} + \\frac{1}{2}\\sigma^2 S^2 \\frac{\\partial^2 V}{\\partial S^2}$\nd) Compare the hedging difficulty (gamma exposure) of these payoffs to standard options\n:::\n\n#### Discrete Hedging and Practical Implementation\n\n::: {#exr-discrete-hedging-analysis}\nExtend the discrete hedging simulation from the chapter:\n\na) Compare hedging errors for different rebalancing frequencies: daily, weekly, monthly\nb) Analyze how hedging errors scale with volatility and time to expiration  \nc) Study the impact of transaction costs: assume 0.1% bid-ask spread on each rebalance\nd) Find the optimal rebalancing frequency that minimizes total cost (hedging error + transaction costs)\n:::\n\n::: {#exr-portfolio-insurance}\nImplement synthetic portfolio insurance using the discrete hedging framework:\n\na) Create a protective put position ($\\max(K, S_T)$) using dynamic hedging\nb) The delta of the protective put is $1 + \\Delta_{\\text{put}} = N(d_1)$\nc) Compare the final portfolio values to buying an actual put option\nd) Analyze performance during high volatility periods vs. low volatility periods\n:::\n\n::: {#exr-gamma-scalping}\nAnalyze the gamma scalping strategy:\n\na) Show that a delta-hedged short option position has P&L approximately equal to $-\\frac{1}{2}\\Gamma(\\Delta S)^2$\nb) Simulate this P&L for different realized volatilities vs. implied volatility\nc) Demonstrate that selling options when implied volatility > realized volatility is profitable\nd) Account for the theta decay and show the complete P&L attribution\n:::\n\n#### Implied Volatility and Market Practice\n\n::: {#exr-implied-vol-calculation}\nImplement an implied volatility calculator:\n\na) Use numerical methods (bisection or Newton-Raphson) to invert the Black-Scholes formula\nb) Test with market-like option prices and verify convergence\nc) Handle edge cases: very deep ITM/OTM options, very short/long expirations\nd) Compare computational efficiency of different numerical methods\n:::\n\n::: {#exr-volatility-smile}\nAnalyze volatility smile patterns:\n\na) Using hypothetical option prices, construct a volatility smile curve\nb) Fit different smile models: quadratic, cubic, SVI (Stochastic Volatility Inspired)\nc) Analyze how the smile changes with time to expiration\nd) Explain the economic interpretation of smile skew and convexity\n:::\n\n::: {#exr-model-limitations}\nExplore Black-Scholes model limitations:\n\na) Generate stock paths with jumps (Merton jump-diffusion model) and price options using Black-Scholes\nb) Generate paths with stochastic volatility and analyze pricing errors\nc) Create scenarios where the model significantly misprices options\nd) Propose practical adjustments traders might make to account for these limitations\n:::\n\n#### Advanced Applications\n\n::: {#exr-dividend-timing}\nAnalyze the impact of discrete dividends on American call options:\n\na) Price a call option on a stock paying a discrete dividend before expiration\nb) Show when early exercise might be optimal (just before ex-dividend date)\nc) Compare American and European call values in this setting\nd) Implement the discrete dividend adjustment to the Black-Scholes formula\n:::\n\n::: {#exr-multi-asset-option}\nPrice an option on the maximum of two assets using change of numeraire:\n\na) For payoff $\\max(S_1(T), S_2(T), K)$, set up the Monte Carlo pricing framework\nb) Experiment with different correlation levels between the assets\nc) Compare this \"rainbow\" option value to individual options on each asset\nd) Analyze which asset should be used as numeraire for variance reduction\n:::\n\n## Summary\n\nThe Black-Scholes model combines the theoretical foundations of arbitrage pricing with practical implementation:\n\n1. **Change of numeraire**: Digital options under different measures give the formula\n2. **Replication**: Delta hedging shows how to replicate option payoffs\n3. **Fundamental PDE**: All derivatives satisfy the same partial differential equation\n4. **Greeks**: Sensitivities guide risk management and hedging\n5. **Market practice**: Implied volatilities reveal market expectations and model limitations\n\nThe model's elegance lies in showing that, under its assumptions, options can be perfectly hedged through dynamic trading. While real markets violate these assumptions, the Black-Scholes framework remains the foundation for understanding option pricing and hedging.\n\n",
    "supporting": [
      "Chapter_BlackScholes_updated_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n<script type=\"text/javascript\">\nwindow.PlotlyConfig = {MathJaxConfig: 'local'};\nif (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: \"STIX-Web\"}});}\nif (typeof require !== 'undefined') {\nrequire.undef(\"plotly\");\nrequirejs.config({\n    paths: {\n        'plotly': ['https://cdn.plot.ly/plotly-2.35.2.min']\n    }\n});\nrequire(['plotly'], function(Plotly) {\n    window._Plotly = Plotly;\n});\n}\n</script>\n\n"
      ]
    }
  }
}