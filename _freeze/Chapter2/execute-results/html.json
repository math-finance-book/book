{
  "hash": "04f7f683d2c6cd7f4ba085e32f57ff0c",
  "result": {
    "markdown": "# Continuous-Time Models {#sec-c_continuoustime}\n\n## From Discrete to Continuous Time {#sec_f_discrete}\nOur main point of departure is knowing how a given quantity evolves through time.  For example, $X(t)$ might denote how much wealth you have at time $t$.  Partition the interval $[0,T]$ into $N$ intervals of length $\\Delta t = \\frac{T}{N}$, in other words\n $$[0, \\Delta t = \\frac{T}{N}, 2 \\Delta t, ..., (N-1) \\Delta t, N \\Delta t =T].$$\n\nIf you invest your wealth $X((i-1)\\Delta t)$ at a fixed rate of interest $r \\Delta t$ over a period of length $\\Delta t=\\frac{T}{N}$, you will have $X((i-1)\\Delta t) (1+ r \\Delta t)$ at the end of the period; the change of your wealth from $(i-1)\\Delta t$ to $t = i\\Delta t$ is \n$$\\Delta X(t) = X(i \\Delta t)-X((i-1) \\Delta t)=(1+r \\Delta t) X((i-1) \\Delta t) - X(t)= r X(t) \\Delta t$$.  \n\nThe limiting form of this equation is \n\n$$d X(t) = r X(t) dt ~~~\\text{or} ~~~\\frac{d X(t)}{dt} = r X(t)$$ \n\nwhich is a differential equation.  Notice this can also be written as a sum \n\n$$X(N \\Delta t) =X(0)+ \\sum_{i=0}^N (X(i \\Delta t)-X((i-1)\\Delta t)) = X(0) + \\sum_{i=0}^{N} r X((i-1)\\Delta t) \\Delta t ; $$\n\nin the limit we get an integral equation\n\n$$X(T) = X(0) + \\int_0^T r X(t) dt.$$\n\n  The solution is $X(T) = X(0) e^{r T}$ which is easily verified by taking the derivative $\\frac{d}{dt}e^{r t} X(t) = r X(t)$ or by inserting the solution into the integral equation. This is also the limiting value of the discretely compunded interest as the number of compounding periods $n$ goes to infinity: \n\n$$X(T)=\\lim_{t \\rightarrow \\infty} \\left(1+r \\frac{T}{N}\\right)^{N}.$$ \n\nThis can be verified by taking the log of $\\left(1+r \\frac{T}{N}\\right)^{N}$ and using l'Hospital's rule.  Given the initial wealth, $X(0)$ and the rate of change $r X(t)$ (which, if the unit of account is dollars, is in units dollars / time), we can we  solve for the value of our wealth at all times. \n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\nimport plotly.graph_objects as go\nimport numpy as np\n\ntrace1= go.Scatter(\n    x=np.arange(31), \n    y=1.08**np.arange(31),\n    mode=\"lines\",\n    name=\"8%\"\n)\n\ntrace2 = go.Scatter(\n    x=np.arange(31), \n    y=1.04**np.arange(31),\n    mode=\"lines\",\n    name=\"4%\"\n)\n\nfig = go.Figure()\nfig.add_trace(trace1)\nfig.add_trace(trace2)\nstring = \"year %{x}<br>balance = $%{y:.2f}\"\nfig.update_traces(hovertemplate=string)\nfig.update_layout(\n    template=\"none\",\n    xaxis_title=\"Year\",\n    yaxis_title=\"Account Balance\",\n    yaxis_tickprefix=\"$\", \n    yaxis_tickformat=\",.0f\",\n    legend=dict(\n        yanchor=\"top\", \n        y=0.99, \n        xanchor=\"left\", \n        x=0.01\n        )\n)\nfig.show()\n```\n\n::: {#fig-miracle-exponential .cell-output .cell-output-display}\n```{=html}\n<div>                            <div id=\"0b6167a1-1d1d-493e-9342-87f416dd632e\" class=\"plotly-graph-div\" style=\"height:525px; width:100%;\"></div>            <script type=\"text/javascript\">                require([\"plotly\"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById(\"0b6167a1-1d1d-493e-9342-87f416dd632e\")) {                    Plotly.newPlot(                        \"0b6167a1-1d1d-493e-9342-87f416dd632e\",                        [{\"mode\":\"lines\",\"name\":\"8%\",\"x\":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],\"y\":[1.0,1.08,1.1664,1.2597120000000002,1.3604889600000003,1.4693280768000005,1.5868743229440005,1.7138242687795209,1.8509302102818825,1.9990046271044333,2.158924997272788,2.331638997054611,2.5181701168189803,2.719623726164499,2.937193624257659,3.172169114198272,3.425942643334134,3.700018054800865,3.9960194991849343,4.315701059119729,4.660957143849308,5.033833715357253,5.436540412585834,5.8714636455927005,6.341180737240117,6.8484751962193275,7.396353211916874,7.9880614688702245,8.627106386379843,9.31727489729023,10.06265688907345],\"type\":\"scatter\",\"hovertemplate\":\"year %{x}\\u003cbr\\u003ebalance = $%{y:.2f}\"},{\"mode\":\"lines\",\"name\":\"4%\",\"x\":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],\"y\":[1.0,1.04,1.0816000000000001,1.124864,1.1698585600000002,1.2166529024000001,1.2653190184960004,1.3159317792358403,1.3685690504052739,1.423311812421485,1.4802442849183444,1.5394540563150783,1.6010322185676815,1.6650735073103888,1.7316764476028044,1.8009435055069165,1.8729812457271933,1.947900495556281,2.0258165153785326,2.106849175993674,2.191123143033421,2.278768068754758,2.369918791504948,2.464715543165146,2.5633041648917523,2.665836331487422,2.772469784746919,2.883368576136796,2.998703319182268,3.118651451949559,3.2433975100275414],\"type\":\"scatter\",\"hovertemplate\":\"year %{x}\\u003cbr\\u003ebalance = $%{y:.2f}\"}],                        {\"template\":{\"data\":{\"scatter\":[{\"type\":\"scatter\"}]}},\"yaxis\":{\"title\":{\"text\":\"Account Balance\"},\"tickprefix\":\"$\",\"tickformat\":\",.0f\"},\"legend\":{\"yanchor\":\"top\",\"y\":0.99,\"xanchor\":\"left\",\"x\":0.01},\"xaxis\":{\"title\":{\"text\":\"Year\"}}},                        {\"responsive\": true}                    ).then(function(){\n                            \nvar gd = document.getElementById('0b6167a1-1d1d-493e-9342-87f416dd632e');\nvar x = new MutationObserver(function (mutations, observer) {{\n        var display = window.getComputedStyle(gd).display;\n        if (!display || display === 'none') {{\n            console.log([gd, 'removed!']);\n            Plotly.purge(gd);\n            observer.disconnect();\n        }}\n}});\n\n// Listen for the removal of the full notebook cells\nvar notebookContainer = gd.closest('#notebook-container');\nif (notebookContainer) {{\n    x.observe(notebookContainer, {childList: true});\n}}\n\n// Listen for the clearing of the current output cell\nvar outputEl = gd.closest('.output');\nif (outputEl) {{\n    x.observe(outputEl, {childList: true});\n}}\n\n                        })                };                });            </script>        </div>\n```\n\nGrowth of an investment account at different rates of return.\n:::\n:::\n\n\nHowever, most investments involve risk.  We might think that part of the return is more or less known while a portion of the investment is random or risky.  Therefore we would like a model which can be written as \n$$ d X(t) = \\mu X(t) dt + \\text{`noise'} \\times X(t). $$\n\nIt makes sense that the units of the noise should be in the unit of account (dollars) and it should have zero mean but it is not obvious how to make sense of a noisy change over an instant.  In the next section we examine the most popular choice for this model, namely Brownian motion.  Loosely speaking, we can take expectations to get\n\n$$ d E[X(t)]= \\mu E[X(t)] dt$$ \n\nwhich gives a solution \n\n$$E[X(T)]=X(0) e^{\\mu T}. $$\n\nSo we can think of this model as a known expected continuously compunded investment at a rate $\\mu$ plus a noisy return.\n\nHistorically, these deterministic mathematics trace back to Issac Newton who developed the classical laws of motion.  The model of noise was developed by Ito to account for random disturbances, such as unpredictable wind gusts,  to a deterministic model, for example, in a model predicting the position of a falling object.\n\nThis chapter has three objectives.  The first is to introduce the concept of a Brownian motion.  A Brownian motion is a random process (a variable that changes randomly over time) that evolves continuously in time and has the property that its change over any time period is normally distributed with mean zero and variance equal to the length of the time period.  The mean zero feature means that a Brownian motion is a martingale.  We will also give a different characterization (Levy's theorem) emphasizing the quadratic variation process, which is a property of the paths (how the variable evolves over time, in a given state of the world) of the process.  \n\nThe second objective is to explain Ito's formula, which is the chain rule for stochastic calculus.  In the Black-Scholes model, the stock price is assumed to satisfy\n$$\\frac{\\mathrm{d} S}{S}=\\mu\\,\\mathrm{d} t+\\sigma\\,\\mathrm{d} B\\; ,$$\nwhere $B$ is a Brownian motion.  In the case that the stock pays no dividend, the rate of return is its price change $\\mathrm{d} S$ divided by the initial price $S$, so the model states that the expected rate of return in each instant $\\mathrm{d} t$  is $\\mu\\,\\mathrm{d} t$ (of course, $t$ denotes time, so $\\mathrm{d} t$ is the change in time).  The variance of the rate of return depends on $\\sigma$.  This model can be equivalently written in terms of the natural logarithm of $S$, which we will write as $\\log S$.  The above equation for the rate of return is equivalent to\n$$\\mathrm{d}\\,\\log S = \\left(\\mu - \\frac{1}{2}\\sigma^2\\right)\\,\\mathrm{d} t + \\sigma\\,\\mathrm{d} B\\; .$$\nWe will explain this equivalence and other similar calculations that are useful for pricing derivatives.\n\nThe third objective is to explain how, when we change numeraires, as described in the previous chapter, we can calculate the expectation in the fundamental pricing @eq-formula.  The question is what effect does changing the numeraire (and hence the probability measure) have on the distribution of an asset price.  \n\nEverything in the remainder of the book is based on the mathematics presented in this chapter.  For easy reference, the essential formulas have been highlighted in boxes.  \n\n\n\n\n## Simulating a Brownian Motion {#sec-s_simulatingbrownian}\nWe begin with the fact that changes in the value of a Brownian motion \\index{Brownian motion} are normally distributed with mean zero and variance equal to the length of the time period.  Let $B(t)$ denote the value of a Brownian motion at time $t$.  Then for any date $u>t$, given the information at time $t$, the random variable $B(u) - B(t)$ is normally distributed with mean zero and variance equal to $u-t$.  Unless stated otherwise, our convention will be that a Brownian motion starts at $B(0)=0$.\n\nWe can generate an approximate Brownian motion in Python.  To do so, we take a small time period $\\Delta t$ and define the value at the end of the period to be the value of the Brownian motion at the beginning plus a normally distributed variable with mean 0 and variance $\\Delta t$.  In the following procedure, we input the length $T=0.5$ of the entire time period over which the Brownian motion is to be simulated.  One input the is number $n=10000$ of time periods of length $\\Delta t$ within the full interval $[0,T]$.  The length $\\Delta t$ of each individual time period is then calculated as $T/n$.  The quality of the approximation of this simulation to a true Brownian motion will be always be improved by increasing the number $n$.  Plotting the output of the procedure creates a picture of what we call a path of the Brownian motion, which means that it shows the value taken at each time in one state of the world.  The procedure generates $m=2$ paths which can be interpreted as the values of the Brownian motion in another state of the world.  In other words, the path of the Brownian motion is itself random, depending in this approximation on the numbers produced by Python's random number generating function.  The random number generator np.random.normal(loc = 0, scale = vol,size = (n,m)) is an algorithm which produces numbers which mimic $n \\times m$ normally distributed random variables with mean 0 (loc=0) and standard deviation $\\sqrt{\\Delta t}$ (scale=vol).  By setting the seed=1234 the generator is initialized and we will always get the same output whenever we run the code. The Brownian path is just the cumulative sum of $n$ of the normal increments.  \n\n::: {#simulated-brownian-motion .cell execution_count=2}\n``` {.python .cell-code}\nimport numpy as np\nimport matplotlib.pyplot as plt\n\n# number of subdivisions\nn = 10000\n# number of paths\nm = 2\n# last date\nT = 0.5\n# delta t\ndt = T/n\n# volatility is standard deviation\nvol = np.sqrt(dt)\n# seed for random generator\nseed= 1234\n# define a random generator\nnp.random.seed(seed)\n\n# generate \"dB\" for each date on each path distributed N(0,vol)\ninc = np.random.normal(loc = 0, scale = vol,size = (n,m))\nBt = np.zeros(shape = (n + 1, m))\n\n# Brownian path starts at 0 and is cumulative sum of the dB\nBt[1:] = inc.cumsum(axis = 0)\n# Could do previous step in a loop\nfor i in range(1, n + 1):\n    Bt[i] = Bt[i - 1] + inc[i - 1]\n\n# plot one path\nt = np.array(range(0, n + 1, 1)) * dt\nplt.figure(figsize=(9,6))\nplt.plot(t,Bt[:,0])\nplt.xlabel(\"Time\")\nplt.ylabel(\"Brownian Motion\")\n```\n\n::: {#simulated-brownian-motion-1 .cell-output .cell-output-display execution_count=11}\n```\nText(0, 0.5, 'Brownian Motion')\n```\n\nSimulated Brownian Motion\n:::\n\n::: {.cell-output .cell-output-display}\n![](Chapter2_files/figure-html/simulated-brownian-motion-output-2.png){#simulated-brownian-motion-2 width=738 height=503}\n:::\n:::\n\n\n<!-- ^[The generation of normally distributed random numbers in Excel is discussed in Appendix~A.  The function RandN() here is user-created (to simplify typing) to equal the function Application.NormSInv(Rnd()) supplied in VBA.  The construction $\\text{sqrtdt]*z$ scales the standard normal $z$ so that its standard deviation is $\\sqrt{\\Delta t}$ and hence its variance is $\\Delta t$, as desired.  The subroutine creates two columns of data below the active cell in the Excel worksheet with headings Time and Brownian Motion.  To plot the path of the Brownian motion, select the two columns and insert an XY (Scatter) chart, with data points connected by lines.} -->\n\n<!-- <!-- \\addcontentsline{lof}{figure}{Simulating Brownian Motion}\n\\begin{verbatim}\nSub Simulating_Brownian_Motion()\nDim T, dt, Sqrdt, BrownianMotion, i, N\nT = InputBox(\"Enter the length of the time period (T)\")\nN = InputBox(\"Enter the number of periods (N)\")\ndt = T / N\nSqrdt = Sqr(dt)\nActiveCell.Value = \"Time\"\nActiveCell.Offset(0, 1) = \"Brownian Motion\"\nActiveCell.Offset(1, 0) = 0   ' beginning time\nActiveCell.Offset(1, 1) = 0   ' beginning value of Brownian motion\nBrownianMotion = 0\nFor i = 1 To N\n  ActiveCell.Offset(i + 1, 0) = i * dt          ' next time\n  BrownianMotion = BrownianMotion + Sqrdt * RandN()\n  ActiveCell.Offset(i + 1, 1) = BrownianMotion  ' next value\nNext i\nEnd Sub -->\n<!-- \\end{verbatim} --> -->\n\n\n\n\n## Quadratic Variation {#sec-s_quadraticvariation}\nIf we take a large number $n$ of time steps in the simulation of the preceding section, we will see the distinctive characteristic of a Brownian motion: it jiggles rapidly, moving up and down in a very erratic way.  The name Brownian motion derives from the botanist Robert Brown's observations of the erratic behavior of particles suspended in a fluid.  This has long been thought to be a reasonable model for the behavior of a stock price.   \nThe plot of other functions with which we may be familiar will be much smoother.  This is captured in the concept of quadratic variation.  \n\nConsider a discrete partition \n$$0=t_0 < t_1 < t_2 < \\cdots < t_N=T$$\nof the time interval $[0,T]$.  Let $B$ be a Brownian motion and calculate the sum of squared changes\n$$\\sum_{i=1}^N [\\Delta B(t_i)]^2\\; ,$$\nwhere $\\Delta B(t_i)$ denotes the change $B(t_i)-B(t_{i-1}).$  If we consider finer partitions with the length of each time interval $t_i-t_{i-1}$ going to zero, the limit of the sum is called the quadratic variation of the process.  \\index{quadratic variation} For a Brownian motion, the quadratic variation over an interval $[0,T]$ is equal to $T$ with probability one.  Here is a plot of the quadratic variation.  For large values of $n$, it is equal to $t$.\n\n::: {#quadratic-variation .cell execution_count=3}\n``` {.python .cell-code}\n# quadratic variation\nQ = np.zeros(shape = (n, m))\n# Generate dB^2\nQ = (Bt[1:n + 1] - Bt[0:n])**2\n\n# Quadratic variation is the cumulative sum of dB^2\nQV = np.zeros(shape = (n + 1, m))\nQV[1:] = Q.cumsum(axis = 0)\nplt.figure(figsize=(9,6))\nplt.plot(t,QV[:,0])\nplt.xlabel(\"Time\")\nplt.ylabel(\"Quadratic Variation\")\n```\n\n::: {#quadratic-variation-1 .cell-output .cell-output-display execution_count=12}\n```\nText(0, 0.5, 'Quadratic Variation')\n```\n\nQuadratic Variation\n:::\n\n::: {.cell-output .cell-output-display}\n![](Chapter2_files/figure-html/quadratic-variation-output-2.png){#quadratic-variation-2 width=738 height=503}\n:::\n:::\n\n\nThe functions with which we are normally familiar are continuously differentiable.  If $X$ is a continuously differentiable function of time (in each state of the world), then the quadratic variation of $X$ will be zero.  A simple example is a linear function: $X(t) = at$ for some constant $a$.  Then, taking $t_i-t_{i-1} = \\Delta t = T/N$ for each $i$, the sum of squared changes is\n$$\\sum_{i=1}^N [\\Delta X(t_i)]^2 = \\sum_{i=1}^N  [a\\,\\Delta t]^2 = Na^2 (\\Delta t)^2 = Na^2 \\left(\\frac{T}{N}\\right)^2 = \\frac{a^2T^2}{N} \\rightarrow 0$$\nas $N \\rightarrow \\infty$.  Essentially the same argument shows that the quadratic variation of any continuously differentiable function is zero, because such a function is approximately linear at each point.  Below is a plot of the quadratic variation for the function $X(t)=t$.  Look carefully at the scale of the y-axis\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\n# Plot dt^2\nplt.figure(figsize=(9,6))\nplt.plot(t,t * dt **2)\n```\n\n::: {.cell-output .cell-output-display}\n![Approximate Squared Variation of $f(t)=t$](Chapter2_files/figure-html/squaredvariation-output-1.png){#squaredvariation width=719 height=499}\n:::\n:::\n\n\nThus, the jiggling of a Brownian motion, which leads to the nonzero quadratic variation, is quite unusual.  To explain exactly how unusual it is, it is helpful to introduce the concept of total variation, \\index{total variation} which is defined in the same way as quadratic variation but with the squared changes $[\\Delta B(t_i)]^2$ replaced by the absolute value of the changes $|\\Delta B(t_i)|.$  If the quadratic variation of a continuous function is nonzero, then its total variation is necessarily infinite, so each path of a Brownian motion has infinite total variation (with probability one).  It was mentioned above that, with a large number of time steps in the simulation of the preceding section, one could see the distinctive jiggling property of a Brownian motion.  This is not quite right.  Any plot drawn by a pencil (or a laser printer, for that matter) must have finite total variation, because the total variation is the total distance traveled by the pencil.  Hence, no matter how many time steps one uses, one will never create a continuous plot with the nonzero quadratic variation (and infinite total variation) that a Brownian path has.  Another way to understand this is to consider focusing on a small segment of a plot and viewing it with a magnifying glass.  If the segment is small enough, and excluding the finite number of kinks that a pencil can draw in the plot of a function, it will look approximately like a straight line under the magnifying glass (with slope equal to the derivative of the function).  However, if one could view a segment of a path of a true Brownian motion under a magnifying glass, it would look much the same as the entire picture does to the naked eye---no matter how small the segment, one would still see the characteristic jiggling.\n\nOne may well question why we should be interested in this curious mathematical object.  The reason is that asset pricing inherently involves martingales (variables that evolve randomly over time in such a way that their expected changes are always zero), as our fundamental pricing @eq-formula establishes.  Furthermore, continuous processes (variables whose paths are continuous functions of time) are much more tractable mathematically than are processes that can jump at some instants.  More importantly, it is possible in a mathematical model with continuous processes to define perfect hedges much more readily than it is in a model involving jump processes.  So, we are led to a study of continuous martingales.  An important fact is that any non-constant continuous martingale must have infinite total variation!  So, the normal functions with which we are familiar are left behind once we enter the study of continuous martingales.  \n\nThere remains perhaps the question of why we focus on Brownian motion within the world of continuous martingales.  The answer here is that any continuous martingale is really just a transformation of a Brownian motion.  This is a consequence of the following important fact, which is known as Levy's theorem: \\index{Levy's theorem}\n\n::: {.callout-tip}\n## \nA continuous martingale is a Brownian motion if and only if its quadratic variation over each interval $[0,T]$ equals $T$.\n:::\n\nThus, among continuous martingales, a Brownian motion is defined by the condition that the quadratic variation over each interval $[0,T]$ is equal to $T$.  This is really just a normalization.  A different continuous martingale may have a different quadratic variation, but it can be converted to a Brownian motion just by deforming the time scale.  Furthermore, many continuous martingales can be constructed as stochastic integrals with respect to a Brownian motion.  We take up this topic in the next section.\n\n## Ito Processes {#sec-s_itoprocesses}\nAn Ito process is a variable $X$ that changes over time as \\index{Ito process}\n$$\n\\mathrm{d} X(t) = \\mu(t)\\,\\mathrm{d} t+\\sigma(t)\\,\\mathrm{d} B(t)\\;,\n$$ {#eq-itoprocess}\n\nwhere $B$ is a Brownian motion, and $\\mu$ and $\\sigma$ can also be random processes.  Some regularity conditions are needed on $\\mu$ and $\\sigma$ which we will omit, except for noting that $\\mu(t)$ and $\\sigma(t)$ should be known at time $t$.  In particular, constant $\\mu$ and $\\sigma$ are certainly acceptable.  When we add the changes over time, we get\n$$X(T)=X(0) + \\int_0^T\\mu(t)\\,\\mathrm{d} t + \\int_0^T\\sigma(t)\\,\\mathrm{d} B(t)$$\nfor any $T>0$.  There are other types of random processes, in particular, processes that can jump, but we will not consider them in this book.\n\nWe will not formally define the integral $\\int_0^T \\sigma(t)\\,\\mathrm{d} B(t)$, but it should be understood as being approximately equal to a discrete sum of the form \n$$\\sum_{i=1}^N \\sigma(t_{i-1})\\,\\Delta B(t_i)\\; ,$$\nwhere $0=t_0 < \\cdots t_N=T$ and the time periods $t_i-t_{i-1}$ are small.  Given that we can simulate the changes $\\Delta B(t_i)$ as random normals, we can approximately simulate the random variable $\\int_0^T \\sigma(t)\\,\\mathrm{d} B(t)$ and hence we can approximately simulate $X(T)$.\n\nAn Ito process evolves continuously over time.  We interpret $\\mu(t)\\,\\mathrm{d} t$ as the expected change in $X$ in an instant $\\mathrm{d} t$.  The quantity $\\mu(t)$  is also called the drift of the process $X$ at time $t$.   \\index{drift} The coefficient $\\sigma(t)$ is called the diffusion coefficient of $X$ at time $t$.  \\index{diffusion coefficient}\n\nIf $\\mu$ and $\\sigma$ are constant, it is standard to refer to an Ito process $X$ as a $(\\mu,\\sigma)$--Brownian motion.  In this case we have\n$$X(t)= \\mu t + \\sigma B_t$$\n\nOf course, it is not a martingale when $\\mu\\neq 0$.  For example, when $\\mu>0$, $X$ tends to increase over time.  However, it has the jiggling property of a Brownian motion, scaled by the diffusion coefficient $\\sigma$. \n\nA very important fact is that an Ito process such as @eq-itoprocess can be a martingale only if $\\mu=0$.  This should seem sensible, because $\\mu\\,\\mathrm{d} t$ is the expected change in $X$, and a process is a martingale only if its expected change is zero.^[If the sources of uncertainty in the market can be modeled as Brownian motions, then in fact every martingale is an Ito process with $\\mu=0$.  This is some justification for the assumption we will make in this book, when studying continuous-time models, that all martingales are Ito processes.]   This observation plays a fundamental role in deriving asset pricing formulas, as we will begin to see in @sec-s_girsanov.\nConversely, if $\\mu=0$ and \n$$\nE \\left[\\int_0^T \\sigma^2(t)\\,\\mathrm{d} t\\right] < \\infty\n$$ {#eq-regularity1}\n\nfor each $T$,  \nthen the Ito process is a continuous martingale and the variance of its date--$T$ value, calculated with the information available at date 0, is:\n$$\\mathrm{var}[X(T)] = E \\left[\\int_0^T \\sigma^2(t)\\,\\mathrm{d} t\\right]\\; .$$  \n\nWhether $\\mu$ is zero or not, and independently of the assumption @eq-regularity1, the quadratic variation of the Ito process $X$ is \n$$\n\\lim_{N \\rightarrow \\infty} \\sum_{i=1}^N[\\Delta X(t_i)]^2 = \\int_0^T \\sigma^2(t)\\,\\mathrm{d} t\n$$ {#eq-itoquadraticvariation}\n\nwith probability one.  Thus we obtain (when $\\mu=0$ and @eq-regularity1 holds) a continuous martingale with a different quadratic variation than a Brownian motion via the diffusion function $\\sigma$.  In fact, when @eq-regularity1 holds, a somewhat more precise definition of the stochastic integral is the (unique) martingale with quadratic variation given by @eq-itoquadraticvariation.\n\nTo compute the quadratic variation of an Ito process, we use the following simple and important rules (for the sake of brevity, we drop the $(t)$ notation from $B(t)$ here and sometimes later):\n\n::: {.callout-tip}\n## \n\n\n$$\n(\\mathrm{d} t)^2 = 0\\;, \n$$ {#eq-dtsquared}\n\n$$\n(\\mathrm{d} t)(\\mathrm{d} B) =0\\;, \n$$ {#eq-dtdB}\n\n$$\n(\\mathrm{d} B)^2 =\\mathrm{d} t\\;. \n$$ {#eq-dBsquared}\n\n\n\n:::\n\n\nWe apply these rules to compute the quadratic variation of $X$ as follows:\n\n::: {.callout-tip}\n## \nIf $\\mathrm{d} X = \\mu\\,\\mathrm{d} t + \\sigma\\,\\mathrm{d} B$ for a Brownian motion $B$, then\n\\begin{align*}\n(\\mathrm{d} X)^2 &= (\\mu\\,\\mathrm{d} t+\\sigma\\,\\mathrm{d} B)^2\\\\\n&= \\mu^2(\\mathrm{d} t)^2 + 2\\mu\\sigma(\\mathrm{d} t)(\\mathrm{d} B) + \\sigma^2(\\mathrm{d} B)^2\\\\\n&= 0 + 0 + \\sigma^2\\,\\mathrm{d} t\\;.\n\\end{align*}\n:::\n\nWe integrate this from 0 to $T$ to obtain the quadratic variation @eq-itoquadraticvariation over that time period:^[In a more formal mathematical presentation, one normally writes $\\mathrm{d]\\langle X,X\\rangle$ for what we are writing here as $(\\mathrm{d} X)^2$.  This is the differential of the quadratic variation process, and the quadratic variation through date $T$ is\n$$\\langle X,X\\rangle (T) = \\int_0^T \\mathrm{d}\\langle X,X\\rangle(t) = \\int_0^T \\sigma^2(t)\\,\\mathrm{d} t\\;.$$}\n$$\n\\int_0^T (\\mathrm{d} X(t))^2 = \\int_0^T \\sigma^2(t)\\,\\mathrm{d} t\\;.\n$$ {#eq-itoquadraticvariation2}\n\n\n\n\n## Ito's Formula {#sec-s_itosformula}\n\nFirst we recall some facts of the ordinary calculus.  If $y=g(x)$ and $x = f(t)$ with $f$ and $g$ being continuously differentiable functions, then \n$$\\frac{\\mathrm{d} y}{\\mathrm{d} t} = \\frac{\\mathrm{d} y}{\\mathrm{d} x}\\times \\frac{\\mathrm{d} x}{\\mathrm{d} t} = g'(x(t))f'(t)\\; .$$\nOver a time period $[0,T]$, this implies that\n$$y(T) = y(0) + \\int_0^T \\frac{\\mathrm{d} y}{\\mathrm{d} t}\\,\\mathrm{d} t = y(0) + \\int_0^T g'(x(t))f'(t)\\,\\mathrm{d} t\\; .$$\nSubstituting $\\mathrm{d} x(t) = f'(t)\\,\\mathrm{d} t$, we can also write this as\n$$\ny(T) = y(0) + \\int_0^T g'(x(t))\\,\\mathrm{d} x(t)\\;.\n$$ {#eq-ordinarycalculus}\n\n\nWe can contrast  @eq-ordinarycalculus  with a special case of Ito's formula for the calculus of Ito processes (the more general formula will be discussed in the next section).  If $B$ is a Brownian motion and $Y = g(B)$ for a twice-continuously differentiable function $g$, then \\index{Ito's formula}\n$$\nY(T) = Y(0) + \\int_0^T g'(B(t))\\,\\mathrm{d} B(t) + \\frac{1}{2}\\int_0^T g''(B(t))\\,\\mathrm{d} t\\;.\n$$ {#eq-itonew1}\n\nThus, relative to the ordinary calculus, Ito's formula has an extra term involving the second derivative $g''$.  We can write @eq-itonew1 in differential form as\n$$dY(t) = \\frac{1}{2}g''(B(t))\\,\\mathrm{d} t + g'(B(t))\\,\\mathrm{d} B(t).$$\nThus, $Y=g(B)$ is an Ito process with drift $g''(B(t))/2$ and diffusion coefficient $g'(B(t))$.\n\nTo gain some intuition for the extra term in Ito's formula, we return to the ordinary calculus.  Given dates $t<u$, the derivative defines a linear approximation of the change in $y$ over this time period; i.e., setting $\\Delta x = x(u)-x(t)$ and $\\Delta y = y(u) - y(t)$, we have the approximation\n$$\\Delta y \\approx g'(x(t)) \\,\\Delta x\\; .$$\nA better approximation is given by the second-order Taylor series expansion\n$$\\Delta y \\approx g'(x(t))\\,\\Delta x + \\frac{1}{2} g''(x(t))\\,[\\Delta x]^2\\; .$$\nAn interpretation of  @eq-ordinarycalculus is that the linear approximation works perfectly for infinitesimal time periods $\\mathrm{d} t$, because we can compute the change in $y$ over the time period $[0,T]$ by summing up the infinitesimal changes $g'(x(t))\\,\\mathrm{d} x(t)$.  In other words, the second-order term $\\frac{1}{2} g''(x(t))\\,[\\Delta x]^2$ vanishes when we consider very small time periods.\n\nThe second-order Taylor series expansion in the case of $Y=g(B)$ is \n$$\\Delta Y \\approx g'(B(t))\\,\\Delta B + \\frac{1}{2} g''(B(t))\\,[\\Delta B]^2\\; .$$\nFor example, given a partition $0=t_0 < t_1 < \\cdots < t_N=T$ of the time interval $[0,T]$, we have, with the same notation we have used earlier,\n\n$$\nY(T) = Y(0) + \\sum_{i=1}^N \\Delta Y(t_i)  \n$$\n$$\n\\approx Y(0) + \\sum_{i=1}^N g'(B(t_{i-1}))\\,\\Delta B(t_i) + \\frac{1}{2} \\sum_{i=1}^N g''(B(t_{i-1}))\\,[\\Delta B(t_i)]^2\\;.\n$$ {#eq-itonew2}\n\n\nIf we make the time intervals $t_i-t_{i-1}$ shorter, letting $N \\rightarrow \\infty$, we cannot expect that the extra term here will disappear, leading to the result @eq-ordinarycalculus of the ordinary calculus, because we know that\n$$\\lim_{N \\rightarrow \\infty} \\sum_{i=1}^N [\\Delta B(t_i)]^2 = T\\; ,$$\nwhereas for the continuously differentiable function $x(t) = f(t)$, the same limit is zero.  In fact it seems sensible to interpret the limit of $[\\Delta B]^2$ as $(\\mathrm{d} B)^2 =\\mathrm{d} t$.\nThis is perfectly consistent with Ito's formula: if we take the limit in @eq-itonew2, replacing the limit of $[\\Delta B(t_i)]^2$ with $(\\mathrm{d} B)^2 = \\mathrm{d} t$, we obtain @eq-itonew1.\n\nThe code below defines a function $g(x)=e^{x}$ (g'(x)=e^x$ and g''(x) = e^x$) and simulates the value $e^{B_t}$ in two ways.  The first way is to simulate the Ito expansion\n$$e^{B_t}=1 + \\int_0^t e^{B_s} d B_s + \\frac{1}{2}\\int_0^t e^{B_s} ds$$\nusing the discretization\n$$\\Delta e^{B_t}= e^{B_t} \\Delta B_t + \\frac{1}{2} e^{B_t} \\Delta t $$\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\n# Define a function and its first and second derivative\nG = lambda x: np.exp(x)\nDG = lambda x: np.exp(x)\nDDG = lambda x: np.exp(x)\n# Build G'(x)dB\nGdB = np.zeros(shape = (n, m))\nGdB[0] = np.repeat(DG(0), m) * inc[0]\nGdB[1:] = DG(Bt[0:n - 1]) * inc[1:]\nSI = np.zeros(shape = (n, m))\n# Stochastic Integral is cumulative sum of G'(B)dB plus initial\nSI = GdB.cumsum(axis = 0) + 0.5 * (DDG(Bt[0:n])*Q).cumsum(axis =0) + G(0)\n# Compare Ito's Lemma \nplt.figure(figsize=(9,6))\nplt.plot(t[0:n], SI[:,0])\n```\n\n::: {.cell-output .cell-output-display}\n![Simulated Ito Formula](Chapter2_files/figure-html/simulated-ito-formula-output-1.png){#simulated-ito-formula width=719 height=485}\n:::\n:::\n\n\nBelow is the exact simulated solution $e^{B_t}$.  It is almost impossible to see a difference.\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\n#exact solution\nplt.figure(figsize=(9,6))\nplt.plot(t[0:n], G(Bt[1:n + 1, 0]))\n```\n\n::: {.cell-output .cell-output-display}\n![Simulated Exact Solution](Chapter2_files/figure-html/simulated-exact-solution-output-1.png){#simulated-exact-solution width=719 height=485}\n:::\n:::\n\n\nBelow we plot the $\\int_0^t \\frac{1}{2} g''(B_s) ds$ term.  Without this term the two plots above will not match.\n\n::: {.cell execution_count=7}\n``` {.python .cell-code}\n# Correction term in Ito formula\nQVV = np.zeros(shape = (n, m))\nQVV = 0.5*(DDG(Bt[0:n]) * Q).cumsum(axis = 0)\nplt.figure(figsize=(9,6))\nplt.plot(t[0:n], QVV[:,0])\n```\n\n::: {.cell-output .cell-output-display}\n![Second Derivative Term in Ito's Formula](Chapter2_files/figure-html/correction-output-1.png){#correction width=728 height=488}\n:::\n:::\n\n\n## Multiple Ito Processes\n\nNow consider two Ito processes\n\n\n$$\n\\mathrm{d} X(t) = \\mu_x(t)\\,\\mathrm{d} t + \\sigma_x(t)\\,\\mathrm{d} B_x(t)\\;,\n$$ {#eq-itoprocess110}\n\n$$\n\\mathrm{d} Y(t) = \\mu_y(t)\\,\\mathrm{d} t + \\sigma_y(t)\\,\\mathrm{d} B_y(t)\\;,\n$$ {#eq-itoprocess111}\n\n\n\nwhere $B_x$ and $B_y$ can be different Brownian motions.  The relation between the two Brownian motions is determined by their covariance or correlation.  Given dates $t<u$, we know that both changes $B_x(u)-B_x(t)$ and $B_y(u)-B_y(t)$ are normally distributed with mean 0 and variance equal to $u-t$.  There will exist a (possibly random) process $\\rho$ such that the covariance \\index{covariance} of these two normally distributed random variables, given the information at date $t$, is \n$$E_t \\left[\\int_t^u \\rho(s)\\,\\mathrm{d} s\\right]\\; .$$\nThe process $\\rho$ is called the correlation coefficient of the two Brownian motions, \\index{correlation coefficient} because when it is constant the correlation of the changes $B_x(u)-B_x(t)$ and $B_y(u)-B_y(t)$ is\n$$\\frac{\\text{covariance}}{\\text{product of standard deviations}}  = \\frac{\\int_t^u \\rho \\,\\mathrm{d} s}{\\sqrt{u-t} \\sqrt{u-t}} = \\frac{(u-t)\\rho}{u-t} = \\rho\\; .$$\nMoreover, given increasingly fine partitions $0=t_0 < \\cdots < t_N=T$ of an interval $[0,T]$ as before, we will have\n$$\\sum_{i=1}^N \\Delta B_x(t_i) \\times \\Delta B_y(t_i) \\rightarrow \\int_0^T \\rho(t)\\,\\mathrm{d} t$$\nas $N \\rightarrow \\infty$, with probability one.  \n\nWe know that\n$$\\sum _{i=1}^N [\\Delta X(t_i)]^2 \\rightarrow \\int_0^T \\sigma_x^2(t)\\,\\mathrm{d} t \\quad \\text{and}\\quad  \\sum _{i=1}^N [\\Delta Y(t_i)]^2 \\rightarrow \\int_0^T\\sigma_y^2(t)\\,\\mathrm{d} t\\;.\n$$ {#eq-itoprocess112}\n\nFurthermore, it can be shown that the sum of products satisfies\n$$\n\\sum_{i=1}^N \\Delta X(t_i) \\times \\Delta Y(t_i) \\rightarrow \\int_0^T \\sigma_x(t)\\sigma_y(t)\\rho(t)\\,\\mathrm{d} t\\;.\n$$ {#eq-itoprocess113}\n\n\n::: {.callout-tip}\n## \nBy adding the rule \n$$\n(\\mathrm{d} B_x)(\\mathrm{d} B_y) = \\rho\\,\\mathrm{d} t \n$$ {#eq-dBdB}\n to the rules @eq-dtsquared--@eq-dBsquared, we can compute the limit in @eq-itoprocess113 as\n\n$$\n\\lim_{N \\rightarrow\\infty} \\sum_{i=1}^N \\Delta X(t_i) \\times \\Delta Y(t_i)  = \\int_0^T (\\mathrm{d} X)(\\mathrm{d} Y)\n$$\n$$\n= \\int_0^T (\\mu_x\\,\\mathrm{d} t +\\sigma_x\\,\\mathrm{d} B_x)(\\mu_y\\,\\mathrm{d} t+\\sigma_y\\,\\mathrm{d} B_y)\n$$\n$$\n= \\int_0^T\\sigma_x(t)\\sigma_y(t) \\rho(t)\\,\\mathrm{d} t\\;.\n$$ {#eq-itojointvariation}\n\n\n:::\n\n\nThe most general case of Ito's formula that we will need is for a function $Z(t) = g(t, X(t), Y(t))$ where $X$ and $Y$ are Ito processes as in @eq-itoprocess110 - @eq-itoprocess111.  In this case, Ito's formula is^[We need to assume $g(t,x,y)$ is continuously differentiable in $t$ and twice continuously differentiable in $(x,y)$ for @eq-itogeneralnew and @eq-itogeneralnew2 to be valid.  Note also that we are using a short-hand notation here.  The partial derivatives of $g$ will generally depend on $t$, $X(t)$ and $Y(t)$ just as $g$ does.]\n\n$$\nZ(T) = Z(0) + \\int_0^T \\frac{\\partial g}{\\partial t}\\,\\mathrm{d} t + \\int_0^T \\frac{\\partial g}{\\partial x}\\,\\mathrm{d} X(t) + \\int_0^T \\frac{\\partial g}{\\partial y}\\,\\mathrm{d} Y(t) \n$$\n$$\n+ \\frac{1}{2} \\int_0^T \\frac{\\partial^2 g}{\\partial x^2}\\,(\\mathrm{d} X(t))^2 +  \\frac{1}{2} \\int_0^T \\frac{\\partial^2 g}{\\partial y^2}\\,(\\mathrm{d} Y(t))^2 \n$$\n$$\n+  \\int_0^T \\frac{\\partial^2 g}{\\partial x\\partial y}\\,(\\mathrm{d} X(t))( \\mathrm{d} Y(t))\\;.\n$$ {#eq-itogeneralnew}\n\n\nIn this equation, we apply the rules @eq-dtsquared--@eq-dBdB to compute\n\\begin{align*}\n(\\mathrm{d} X(t))^2&= \\sigma_x^2(t)\\,\\mathrm{d} t\\; ,\\\\\n(\\mathrm{d} Y(t))^2 &= \\sigma_y^2(t)\\,\\mathrm{d} t\\; ,\\\\\n(\\mathrm{d} X(t))( \\mathrm{d} Y(t)) &= \\sigma_x(t)\\sigma_y(t)\\rho(t)\\,\\mathrm{d} t\\;.\n\\end{align*}\nIto's @eq-itogeneralnew appears a bit simpler (and easier to remember) if we write it in differential form.\"  We have:\n\n\n::: {.callout-tip}\n## \nIf $Z(t) = g(t, X(t), Y(t))$ where $X$ and $Y$ are Ito processes as in @eq-itoprocess110 - @eq-itoprocess111, then\n\n$$\n\\mathrm{d} Z =  \\frac{\\partial g}{\\partial t}\\,\\mathrm{d} t + \\frac{\\partial g}{\\partial x}\\,\\mathrm{d} X +  \\frac{\\partial g}{\\partial y}\\,\\mathrm{d} Y + \\frac{1}{2} \\frac{\\partial^2 g}{\\partial x^2}\\,(\\mathrm{d} X)^2 +  \\frac{1}{2}  \\frac{\\partial^2 g}{\\partial y^2}\\,(\\mathrm{d} Y)^2 \n$$\n$$\n+ \\frac{\\partial^2 g}{\\partial x\\partial y}\\,(\\mathrm{d} X)(\\mathrm{d} Y)\\;.\n$$ {#eq-itogeneralnew2}\n\n\n\n:::\n\n\n## Examples of Ito's Formula {#sec-s_examples}\nThe following are the applications of Ito's formula that will be used most frequently in the book.  They follow from the boxed formula at the end of the previous section by taking $g(x,y)=xy$ or $g(x,y)=y/x$ or $g(x)=e^x$ or $g(x) = \\log x$.\n\n\n\n\n::: {.callout-tip}\n## \n\n**Products.**\\;\nIf $Z=XY$, then $\\mathrm{d} Z=X\\,\\mathrm{d} Y+Y\\,\\mathrm{d} X + (\\mathrm{d} X)(\\mathrm{d} Y)$.  We can write this as\n$$\n\\frac{\\mathrm{d} Z}{Z}=\\frac{\\mathrm{d} X}{X} + \\frac{\\mathrm{d} Y}{Y} + \\left(\\frac{\\mathrm{d} X}{X}\\right)\\left(\\frac{\\mathrm{d} Y}{Y}\\right)\\;.\n$$ {#eq-rule2}\n\n\n:::\n\n\n\n\n::: {.callout-tip}\n## \n\n**Ratios.**\\;\nIf $Z=Y/X$, then \n$$\\frac{\\mathrm{d} Z}{Z} = \\frac{\\mathrm{d} Y}{Y} -\\frac{\\mathrm{d} X}{X} - \\left(\\frac{\\mathrm{d} Y}{Y}\\right)\\left(\\frac{\\mathrm{d} X}{X}\\right) + \\left(\\frac{\\mathrm{d} X}{X}\\right)^2\\;.\n$$ {#eq-rule4}\n\n\n:::\n\n\n\n::: {.callout-tip}\n## \n\n**Exponentials.**\\;\nIf $Z=\\mathrm{e}^X$, then \n$$\\frac{\\mathrm{d} Z}{Z}=\\mathrm{d} X + \\frac{(\\mathrm{d} X)^2}{2}\\;.\n$$ {#eq-rule5}\n\n\n:::\n\n\n\n::: {.callout-tip}\n## \n\n**Logarithms.**\\;\nIf $Z=\\log X$, then\n$$\n\\mathrm{d} Z=\\frac{\\mathrm{d} X}{X} - \\frac{1}{2}\\left(\\frac{\\mathrm{d} X}{X}\\right)^2\\;.\n$$ {#eq-rule6}\n\n\n:::\n\n\n\n::: {.callout-tip}\n## \n\n**Compounding/Discounting.**\nLet  \n$$Y(t) =\\exp\\left(\\int_0^t q(s)\\,\\mathrm{d} s\\right)$$\nfor some (possibly random) process $q$ and define $Z=XY$ for any Ito process $X$.\nThe usual calculus gives us \n$\\mathrm{d} Y(t)=q(t)Y(t)\\,\\mathrm{d} t$,\nand the product rule above implies\n$$\n\\frac{\\mathrm{d} Z}{Z}=q\\,\\mathrm{d} t + \\frac{\\mathrm{d} X}{X}\\;.\n$$ {#eq-compdisc1}\n\nThis is the same as in the usual calculus.  \n\n:::\n\n\n\n\n## Reinvesting Dividends {#sec-s_reinvestingdividends}\n\nFrequently, we will assume that the asset underlying a derivative security pays a constant dividend yield, \\index{dividend yield} which we will denote by $q$.  This means, for an asset with price $S(t)$, that the dividend in an instant $\\mathrm{d} t$ is $q S(t)\\,\\mathrm{d} t$.  If the dividends are reinvested in new shares, the number of shares will grow exponentially at rate $q$.  To see this, consider the portfolio starting with a single share of the asset and reinvesting dividends until some date $T$.  Let $X(t)$ denote the number of shares resulting from this strategy at any time $t\\leq T$.  Then the dividend received at date $t$ is $q S(t)X(t)\\,\\mathrm{d} t$, which can be used to purchase $q X(t)\\,\\mathrm{d} t$ new shares.  This implies that $\\mathrm{d} X(t)=q X(t)\\,\\mathrm{d} t$, or $\\mathrm{d} X(t)/\\mathrm{d} t = q X(t)$, and it is easy to check (and very well known) that this equation is solved by $X(t)=\\mathrm{e}^{q t}X(0)$.  In our case, with $X(0)=1$, we have $X(t)=\\mathrm{e}^{q t}$.\n\nThe dollar value of the trading strategy just described will be $X(t)S(t) = \\mathrm{e}^{q t}S(t)$.  Denote this by $V(t)$.  This is the value of a non-dividend-paying portfolio, because all dividends are reinvested.  From the Compounding/Discounting example in @sec-s_examples, we know that\n$$ \n\\frac{\\mathrm{d} V}{V} = q\\,\\mathrm{d} t + \\frac{\\mathrm{d} S}{S}\\;.\n$$ {#eq-reinvestingdividends}\n\nThis means that the rate of return on the portfolio is the dividend yield $q\\,\\mathrm{d} t$ plus the return $\\mathrm{d} S/S$ due to capital gains.\n\n\n## Geometric Brownian Motion {#sec-s_geometricbrownianmotion}\nA random variable is lognormally distributed if it can be written as $\\tilde{y}=  e^{\\tilde{x}}$ where $\\tilde{x}$ is distributed according to a normal distribution with mean $m$ and standard deviation $s$.  The expected value of $\\tilde{y}$ is given by $E[\\tilde{y}] = e^{m+\\frac{s^2}{2}}$.\n\n::: {.callout-tip}\n## \n\n**Lognormal Random Variable.**\\;\nIf $\\tilde{x}$ is normally distributed with mean $m$ and standard deviation $s$, then $e^{\\tilde{x}}$ is lognormally distributed and\n$$E[e^{\\tilde{x}}]=e^{m + \\frac{1}{2} s^2};.\n$$ {#eq-lognormal}\n\n\n:::\n\nAn important stochastic process is the Geometric Brownian Motion given by\n$$\nS(t)=S(0)\\exp\\left(\\mu t- \\sigma^2 t/2 + \\sigma B(t)\\right)\n$$ {#eq-exponential1}\n\nfor constants $\\mu$ and $\\sigma$, where $B$ is a Brownian motion.  Note that for each time $t$, geometric Brownian motion is a lognormal random variable.\nUsing the product rule and the rule for exponentials, we obtain\n$$\n\\frac{\\mathrm{d} S}{S} = \\mu\\,\\mathrm{d} t+\\sigma\\,\\mathrm{d} B\\;.\n$$ {#eq-Y}\n\nWhen we see an equation of the form @eq-Y, we should recognize @eq-exponential1 as the solution. \n\nThe process $S$ is called a geometric Brownian motion.  \\index{geometric Brownian motion} In keeping with the discussion of @sec-s_itoprocesses, we interpret @eq-Y as stating that $\\mu\\,\\mathrm{d} t$ is the expected rate of change of $S$ and $\\sigma^2\\,\\mathrm{d} t$ is the variance of the rate of change in an instant $\\mathrm{d} t$.  We call $\\mu$ the drift and $\\sigma$ the volatility.  \\index{volatility} The geometric Brownian motion will grow at the average rate of $\\mu$, in the sense that $E[S(t)] = \\mathrm{e}^{\\mu t}S(0)$;  one way to verify this uses the formula for the mean of a lognormal random variable.\n\nTaking the natural logarithm of @eq-exponential1 gives an equivalent form of the solution:\n$$\n\\log S(t)= \\log S(0)+\\left(\\mu -\\frac{1}{2}\\sigma^2\\right)t + \\sigma B(t)\\;.\n$$ {#eq-exponential2}\n  This shows that $\\log S(t) - \\log S(0)$ is a $(\\mu-\\sigma^2/2,\\sigma)$--Brownian motion.  Given information at time $t$, the logarithm of $S(u)$ for $u>t$ is normally \\index{lognormal distribution}distributed with mean $(u-t)(\\mu-\\sigma^2/2)$ and variance $(u-t)\\sigma^2$.  Because $S$ is the exponential of its logarithm, $S$ can never be negative.  For this reason, a geometric Brownian motion is a better model for stock prices than is a Brownian motion.\n\nThe differential of @eq-exponential2 is\n$$\n\\mathrm{d} \\log S(t) = \\left(\\mu -\\frac{1}{2}\\sigma^2\\right)\\,\\mathrm{d} t+ \\sigma\\,\\mathrm{d} B(t)\\;.\n$$ {#eq-exponential3}\n\nWe conclude:\n\n::: {.callout-tip}\n## \n\nThe  equation \n$$\\frac{\\mathrm{d} S}{S} = \\mu\\,\\mathrm{d} t+\\sigma\\,\\mathrm{d} B$$\nis equivalent to the equation\n$$\\mathrm{d} \\log S(t) = \\left(\\mu -\\frac{1}{2}\\sigma^2\\right)\\,\\mathrm{d} t+ \\sigma\\,\\mathrm{d} B(t)\\; .$$\nThe solution of both equations is @eq-exponential1 or the equivalent @eq-exponential2.\n\n:::\n\n\n\nOver a discrete time interval $\\Delta t$, @eq-exponential3 implies that the change in the logarithm of $S$ is \n$$\n\\Delta \\log S = \\left(\\mu -\\frac{1}{2}\\sigma^2\\right)\\Delta t+ \\sigma\\,\\Delta B\\;.\n$$ {#eq-exponential11}\n\nIf $S$ is the price of a non-dividend-paying asset, then over the time period $t_{i-1}$ to $t_i$, with $t_i-t_{i-1}=\\Delta t$, we have\n$$\n\\Delta \\log S = r_i\\,\\Delta t\\;,\n$$ {#eq-exponential10}\n\nwhere $r_i$ is the  continuously compounded annualized rate of return \\index{continuously compounded return} during the period $\\Delta t$.  This follows from the definition of the continuously compounded rate of return as the constant rate over the time period $\\Delta t$ that would cause $S$ to grow (or fall) from $S(t_{i-1})$ to $S(t_i)$.  To be precise, $r_i$ is defined by\n$$\\frac{S(t_i)}{S(t_{i-1})} = \\mathrm{e}^{r_i\\Delta t}\\; ,$$\nwhich is equivalent to @eq-exponential10.\nThus, the geometric Brownian motion model @eq-Y implies that the continuously compounded annualized rate of return over a period of length $\\Delta t$ is given by\n$$r_i = \\mu -\\frac{1}{2}\\sigma^2+ \\frac{\\sigma\\Delta B}{\\Delta t}\\; .$$\nThis means that $r_i$ is normally distributed with mean $\\mu-\\sigma^2/2$ and variance $\\sigma^2/\\Delta t$.  Given historical data on the rates of return, the parameters $\\mu$ and $\\sigma$ can be estimated by standard methods (see @sec-c_stochasticvolatility).\n\nWe can simulate a path of $S$ by simulating the changes $\\Delta \\log S$.  The random variable $\\sigma \\Delta B$  in  @eq-exponential11 has a normal distribution with zero mean and variance equal to $\\sigma^2\\Delta t$.  We simulate it as $\\sigma\\sqrt{\\Delta t}$ multiplied by a standard normal.  The code below simulates $n=10000$ paths with $m=1000$ time steps. There are some features of the simulation which will prove useful later.  The drift $\\mu$ is labelled the interest rate $r=0.1$.  Other parameters are $\\sigma = 0.2$, and $T=0.5$.  The drift of the log stock price is labelled $drift=r-\\frac{\\sigma^2}{2}$.  The plot output is one of the simulated sample paths.  In practice, if we are only interested in the terminal value of the stock price we would use many fewer subdivisions, $n=1$.  Given a simulated mean zero normal random variable, $z$, changing the sign to $-z$ is also a simulated normal random variable with zero mean and the same standard deviation.  As a result, we have two simulations for the stock price labelled $St$ and $St1$, but we only plot one sample path for $St$. \n\n::: {.cell execution_count=8}\n``` {.python .cell-code}\n# Simulate Geometric Brownian Motion\nimport numpy as np\nimport matplotlib.pyplot as plt\n# number of paths\nn = 10000\n#number of divisions\nm = 1000\n# Interest rate (We set the drift equal to the interest rate)\nr = 0.1\n# Volatility\nsig = 0.2\n# Initial Stock Price\nS0 = 42\n# Maturity\nT = 0.5\n# Delta t\ndt = T/m\n# Drift\ndrift = (r-0.5*sig**2)\n# Volatility\nvol = sig * np.sqrt(dt)\n\nt = np.array(range(0,m + 1,1)) * dt\n\n# seed for random generator\nseed= 2020\n# define a random generator\nnp.random.seed(seed)\ninc = np.zeros(shape = (m + 1, n))\ninc[1:] = np.transpose(np.random.normal(loc = 0, scale = vol,size = (n,m)))\nSt = np.zeros(shape = (m + 1, n))\nSt = S0 * np.exp(np.cumsum(inc,axis=0) + (drift * t[0:m + 1])[:,None])\nSt1 = S0 * np.exp(-np.cumsum(inc,axis=0) + (drift * t[0:m + 1])[:,None])\nplt.figure(figsize=(9,6))\nplt.plot(t,St[:,1])\n\n```\n\n::: {.cell-output .cell-output-display}\n![](Chapter2_files/figure-html/cell-9-output-1.png){width=715 height=485}\n:::\n:::\n\n\nThe plot below is the distribution of the simulated stock price at $T$.\n\n::: {.cell execution_count=9}\n``` {.python .cell-code}\nplt.figure(figsize=(9,6))\na=plt.hist(St[m,:], bins=100)\n```\n\n::: {.cell-output .cell-output-display}\n![](Chapter2_files/figure-html/cell-10-output-1.png){width=724 height=485}\n:::\n:::\n\n\nWhile Geometric Brownian Motion is an important stochastic process to model stock prices, the process with drift equal to zero given by\n$$X(t) = \\exp\\left(-\\frac{\\kappa^2}{2} + \\kappa B_t\\right)$$\n\nsatisfies $E[X(t)]=1$ and $E[X(t)|X(s)]=X(s)$ and is an important example of a strictly positive martingale.  Again, these facts can be verified using the formula for the expected value of a lognormal random variable.  Notice we can write\n$$dX(t)= \\kappa X(t) dB_t$$\nwhich agrees with the martingale characterization of $\\int_0^t \\sigma(X_t,t) dB_t$.\n\n## Numeraires and Probabilities {#sec-s_girsanov}\nWhen we change probability measures, we cannot expect a process $B$ that was a Brownian motion to remain a Brownian motion.    The expected change in a Brownian motion must always be zero, but when we change probabilities, the expected change of $B$ is likely to become nonzero.  (Likewise, a martingale is unlikely to remain a martingale when we change probabilities.)  However, the Brownian motion $B$ will still be an Ito process under the new probability measure.  In fact, every Ito process under one probability measure will still be an Ito process under the new probability measure, and the diffusion coefficient of the Ito process will be unaffected by the change in probabilities.^[To be a little more precise, this is true provided sets of states of the world having zero probability continue to have zero probability when the probabilities are changed.  Because of the way we change probability measures when we change numeraires (cf.  @eq-probSnumeraire) this will always be true for us.]  Changing probabilities only changes the drift of an Ito process.  \n\nIn a sense, this should not be surprising.  It was noted in @sec-s_quadraticvariation that a Brownian motion $B$ can be defined as a continuous martingale with paths that jiggle in such a way that the quadratic variation over any interval $[0,T]$ is equal to $T$.  Changing the probabilities will change the probabilities of the various paths (so it may affect the expected change in $B$) but it will not affect how each path jiggles. So, under the new probability measure, $B$ should still be like a Brownian motion but it may have a nonzero drift.  If we consider a general Ito process, the reasoning is the same.  The diffusion coefficient $\\sigma$ determines how much each path jiggles, and this is unaffected by changing the probability measure.  Furthermore, instantaneous covariances---the $(\\mathrm{d} X)(\\mathrm{d} Y)$ terms---between Ito processes are unaffected by changing the probability measure.  Only the drifts are affected.\n\nAs explained in @sec-s_introoptions, we need to know the distribution of the underlying under probability measures corresponding to different numeraires.  Let $S$ be the price of an asset that has a constant dividend yield $q$, and, as in @sec-s_reinvestingdividends, let $V(t)=\\mathrm{e}^{qt}S(t)$.  This is the price of the portfolio in which all dividends are reinvested, and we have \n$$\\frac{\\mathrm{d} V}{V} = q\\,\\mathrm{d} t + \\frac{\\mathrm{d} S}{S}\\; .$$\nLet $Y$ be the price of another another asset that does not pay dividends.  Let $r(t)$ denote the instantaneous risk-free rate at date $t$ and let $R(t) = \\exp\\left(\\int_0^t r(s)\\,\\mathrm{d} s\\right)$.  Assume\n\\begin{align*}\n \\frac{\\mathrm{d} S}{S} &= \\mu_s\\,\\mathrm{d} t+\\sigma_s\\,\\mathrm{d} B_s\\; ,\\\\\n \\frac{\\mathrm{d} Y}{Y} &= \\mu_y\\,\\mathrm{d} t+\\sigma_y\\,\\mathrm{d} B_y\\;,\n\\end{align*}\nwhere $B_s$ and $B_y$ are Brownian motions under the actual probability measure with correlation $\\rho$, and where $\\mu_s, \\mu_y, \\sigma_s, \\sigma_y$ and $\\rho$ can be quite general random pro\\-cesses.  \nWe consider the dynamics of the asset price $S$ under three different probability measures.  In each case, we follow the same steps: (i) we note that the ratio of an asset price to the numeraire asset price must be a martingale, (ii) we use Ito's formula to calculate the drift of this ratio, and (iii) we use the fact that the drift of a martingale must be zero to compute the drift of $\\mathrm{d} S/S$.\n\n\n### Risk-Neutral Probabilities\nUnder the risk-neutral measure, $Z(t)$ defined as \n$$Z(t) = \\frac{V(t)}{R(t)} = \\exp\\left(-\\int_0^t r(s)\\,\\mathrm{d} s\\right)V(t)$$\nis a martingale.  Using the compounding/discounting rule, we have\n$$\\frac{\\mathrm{d} Z}{Z} =-r\\,\\mathrm{d} t + \\frac{\\mathrm{d} V}{V} = (q-r)\\,\\mathrm{d} t + \\frac{\\mathrm{d} S}{S}\\; .$$\nFor $Z$ to be a martingale, the drift ($\\mathrm{d} t$ part) of $\\mathrm{d} Z/Z$ must be zero.  Therefore, the drift of $\\mathrm{d} S/S$ must be $(r-q)\\,\\mathrm{d} t$ under the risk-neutral measure.  Because the change of measure does not affect the volatility, this implies:\n\n::: {.callout-tip}\n## \n$$\n\\frac{\\mathrm{d} S}{S} =( r-q)\\,\\mathrm{d} t+\\sigma_s\\,\\mathrm{d} B^*_s\\;,\n$$ {#eq-riskneutral11}\n\nwhere $B^*_s$ is a Brownian motion under the risk-neutral measure. \n:::\n \n\n\n### Underlying as the Numeraire\nWhen $V$ is the numeraire, the process\n$Z(t)$ defined as \n$$Z(t) = \\frac{R(t)}{V(t)} = \\frac{\\exp\\left(\\int_0^t r(s)\\,\\mathrm{d} s\\right)}{V(t)}$$\nis a martingale.  Using the rule for ratios, we have\n$$\\frac{\\mathrm{d} Z}{Z} =r\\,\\mathrm{d} t - \\frac{\\mathrm{d} V}{V} + \\left(\\frac{\\mathrm{d} V}{V}\\right)^2 = (r -q+ \\sigma^2_s)\\,\\mathrm{d} t - \\frac{\\mathrm{d} S}{S}\\; .$$\nBecause the drift of $\\mathrm{d} Z/Z$ must be zero, this implies that the drift of $\\mathrm{d} S/\nS$ is $(r -q + \\sigma^2_s)\\,\\mathrm{d} t$.  We conclude that:\n\n::: {.callout-tip}\n## \n$$\n\\frac{\\mathrm{d} S}{S} = (r-q+ \\sigma^2_s)\\,\\mathrm{d} t+\\sigma_s\\,\\mathrm{d} B^*_s\\;,\n$$ {#eq-own11}\n\nwhere now $B^*_s$ denotes a Brownian motion when $V(t)=\\mathrm{e}^{qt}S(t)$ is the numeraire.\n:::\n\n\n\n### Another Risky Asset as the Numeraire\nWhen $Y$ is the numeraire, $Z(t)$ defined as \n$$Z(t) = \\frac{V(t)}{Y(t)}$$ must be a martingale.  Using again the rule for ratios, we have\n\\begin{align*}\n\\frac{\\mathrm{d} Z}{Z} &= \\frac{\\mathrm{d} V}{V} -\\frac{\\mathrm{d} Y}{Y}- \\left(\\frac{\\mathrm{d} V}{V}\\right)\\left(\\frac{\\mathrm{d} Y}{Y}\\right) + \\left(\\frac{\\mathrm{d} Y}{Y}\\right)^2\\\\\n& = \\frac{\\mathrm{d} V}{V} -\\frac{\\mathrm{d} Y}{Y} -\\rho\\sigma_s\\sigma_y\\,\\mathrm{d} t+\\sigma_y^2\\,\\mathrm{d} t\\\\\n&= \\frac{\\mathrm{d} S}{S} -\\frac{\\mathrm{d} Y}{Y} + (q-\\rho\\sigma_s\\sigma_y\\,\\mathrm{d} t+\\sigma_y^2)\\,\\mathrm{d} t\\; .\n\\end{align*}\nWe can apply our previous example to compute the dynamics of $Y$ when $Y$ is the numeraire.  This shows that the drift of $\\mathrm{d} Y/Y$ is $(r+ \\sigma^2_y)\\,\\mathrm{d} t$.  Because the drift of $\\mathrm{d} Z/Z$ must be zero, it follows that the drift of $\\mathrm{d} S/S$ is\n$(r-q+ \\rho\\sigma_s\\sigma_y)\\,\\mathrm{d} t$.  We conclude that:\n\n::: {.callout-tip}\n## \n$$\n\\frac{\\mathrm{d} S}{S} = (r-q+ \\rho\\sigma_s\\sigma_y)\\,\\mathrm{d} t+\\sigma_s\\,\\mathrm{d} B^*_s\\;,\n$$ {#eq-other11}\n\nwhere  $B^*_s$ denotes a Brownian motion under the probability measure corresponding to the non-dividend-paying risky asset $Y$ being the numeraire, and where $\\rho$ is the correlation of $S$ and $Y$.\n:::\n\n\nNotice that @eq-other11, while more complicated, is also more general than the others.  In fact, it includes the formulas @eq-riskneutral11 and @eq-own11 as special cases: (i) if $Y$ is the price of the instantaneously risk-free asset, then $\\sigma_y=0$ and @eq-other11 simplifies to @eq-riskneutral11, and (ii) if $Y=\nV$, then $\\sigma_y=\\sigma_s$ and $\\rho=1$, so @eq-other11 simplifies to @eq-own11.\n\n### Further Discussion\n\nIt would be natural for one to ask at this point: what is the Brownian motion $B^*_s$ and where did it come from?  We have argued that once we know the drift, and the fact that the volatility does not change, we can immediately write down, for example, \n$$\\frac{\\mathrm{d} S}{S} = (r-q)\\,\\mathrm{d} t + \\sigma_s\\,\\mathrm{d} B^*_s$$\nfor a Brownian motion $B^*_s$ under the risk-neutral measure.  To answer this question, we will give here the definition of $B^*_s$ under the risk-neutral measure.  The definition shows that we are justified in writing down  @eq-riskneutral11--@eq-other11, but we will not repeat the definition each time we make a statement of this sort.     \n\nWe showed that $Z$ is a martingale under the risk-neutral measure, where $Z$ satisfies\n$$\n\\frac{\\mathrm{d} Z}{Z} = (q-r)\\,\\mathrm{d} t + \\frac{\\mathrm{d} S}{S} = (q-r+\\mu_s)\\,\\mathrm{d} t + \\sigma_s\\,\\mathrm{d} B_s\\;.\n$$ {#eq-numeraire101}\n\nDefine $B^*_s(0) = 0$ and\n$$\n\\mathrm{d} B^*_s = \\left(\\frac{q-r+\\mu_s}{\\sigma_s}\\right)\\,\\mathrm{d} t + \\mathrm{d} B_s\\;.\n$$ {#eq-numeraire102}\n\nThen \n$$\\mathrm{d} B^*_s = \\frac{1}{\\sigma_s}\\left(\\frac{\\mathrm{d} Z}{Z}\\right)$$\nand hence is a continuous martingale under the risk-neutral measure.  We can compute its quadratic variation as\n$$(\\mathrm{d} B^*_s)^2 = \\left(\\frac{q-r+\\mu_s}{\\sigma_s}\\right)^2(\\mathrm{d} t)^2 + 2\\left(\\frac{q-r+\\mu_s}{\\sigma_s}\\right)(\\mathrm{d} t)(\\mathrm{d} B_s) + (\\mathrm{d} B_s)^2 = \\mathrm{d} t\\; .$$\nTherefore, by Levy's theorem (@sec-s_quadraticvariation), $B^*_s$ is a Brownian motion under the risk-neutral measure.   From  @eq-numeraire101 and @eq-numeraire102 we have\n$$(q-r)\\,\\mathrm{d} t + \\frac{\\mathrm{d} S}{S} = \\sigma_s\\,\\mathrm{d} B^*_s \\quad \\Longleftrightarrow \\quad \\frac{\\mathrm{d} S}{S} = (r-q)\\,\\mathrm{d} t + \\sigma_s\\,\\mathrm{d} B^*_s\\;,$$\nas in  @eq-riskneutral11.\n\n## Tail Probabilities of Geometric Brownian Motions {#sec-s_tailprobs}\n\nFor each of the numeraires discussed in the previous section, we have\n$$\n\\mathrm{d} \\log S = \\alpha\\,\\mathrm{d} t + \\sigma\\,\\mathrm{d} B\\;,\n$$ {#eq-tailprob1}\n\nfor some $\\alpha$ and $\\sigma$, where $B$ is a Brownian motion under the probability measure associated with the numeraire.  Specifically, $\\sigma=\\sigma_s$, $B=B^*_s$, and\n\n\n\n\\renewcommand{\\labelenumi}{(\\arabic{enumi})}\n1. for the risk-neutral measure, $\\alpha = r-q-\\sigma_s^2/2$,\n2. when $\\mathrm{e}^{qt}S(t)$ is the numeraire, $\\alpha = r-q +\\sigma_s^2/2$,\n3. when another risky asset price $Y$ is the numeraire, $\\alpha = r-q+\\rho\\sigma_s\\sigma_y-\\sigma_s^2/2$.\n\n\n\nWe will assume in this section that $\\alpha$ and $\\sigma$ are constants.\nThe essential calculation in pricing options, as we will see in the next chapter and in @sec-c_exotics, is to compute $\\text{prob}(S(T)>K)$ and $\\text{prob}(S(T)<K)$ for a constant $K$ (the strike price of an option), where $\\text{prob}$ denotes the probabilities at date 0 (the date we are pricing an option) associated with a particular numeraire.  \n\nEquation @eq-tailprob1 gives us\n$$\\log S(T) = \\log S(0) + \\alpha T + \\sigma B(T)\\; .$$\nGiven this, we deduce\n\n$$ \nS(T) > K  \\quad\\Longleftrightarrow\\quad \\log S(T) > \\log K\n$$\n$$\n \\quad\\Longleftrightarrow\\quad \\sigma B(T) > \\log K - \\log S(0)-\\alpha T\n$$\n$$\n \\quad\\Longleftrightarrow\\quad \\frac{B(T)}{\\sqrt{T}} > \\frac{\\log K - \\log S(0)-\\alpha T}{\\sigma\\sqrt{T}}\n$$\n$$\n \\quad\\Longleftrightarrow\\quad -\\frac{B(T)}{\\sqrt{T}} < \\frac{\\log S(0)-\\log K + \\alpha T}{\\sigma\\sqrt{T}}\n$$\n$$\n \\quad\\Longleftrightarrow\\quad -\\frac{B(T)}{\\sqrt{T}} < \\frac{\\log \\left(\\frac{S(0)}{K}\\right) + \\alpha T}{\\sigma\\sqrt{T}}\\;.\n$$ {#eq-tailprob2}\n\n\nThe random variable on the left-hand side of @eq-tailprob2 has the standard normal distribution---it is normally distributed with mean equal to zero and variance equal to one.  As is customary, we will denote the probability that a standard normal is less than some number $d$ as $\\mathrm{N}(d)$.  We conclude:\n\n::: {.callout-tip}\n## \nAssume $\\mathrm{d} \\log S = \\alpha\\,\\mathrm{d} t + \\sigma\\,\\mathrm{d} B$, where $B$ is a Brownian motion.  Then, for any number $K$,\n$$\n\\text{prob}(S(T)>K) = \\mathrm{N}(d)\\;,\n$$ {#eq-tailprob01}\n\nwhere\n$$\nd = \\frac{\\log \\left(\\frac{S(0)}{K}\\right) + \\alpha T}{\\sigma\\sqrt{T}}\\;.\n$$ {#eq-tailprob3}\n\n:::\n\n\nThe  probability $\\text{prob}(S(T)<K)$ can be calculated similarly, but the simplest way to derive it is to note that the events $S(T)>K$ and $S(T)<K$ are complementary---their probabilities sum to one (the event $S(T)=K$ having zero probability).  Therefore $\\text{prob}(S(T)<K) = 1-\\mathrm{N}(d)$.  This is the probability that a standard normal is greater than $d$, and by virtue of the symmetry of the standard normal distribution, it equals the probability that a standard normal is less than $-d$.  Therefore, we have:\n\n::: {.callout-tip}\n## \nAssume $\\mathrm{d} \\log S = \\alpha\\,\\mathrm{d} t + \\sigma\\,\\mathrm{d} B$, where $B$ is a Brownian motion.  Then, for any number $K$,\n$$\n\\text{prob}(S(T)<K) = \\mathrm{N}(-d)\\;,\n$$ {#eq-tailprob02}\n\nwhere $d$ is defined in @eq-tailprob3.\n:::\n\n\n\n## Volatilities {#sec-s_volatilities}\n\nAs mentioned in @sec-s_geometricbrownianmotion, when we encounter an equation of the form \n$$\\frac{\\mathrm{d} S}{S} = \\mu\\,\\mathrm{d} t + \\sigma\\,\\mathrm{d} B$$\nwhere $B$ is a Brownian motion, we will say  ``$\\sigma$ is the volatility of $S$.  For example, in the Black-Scholes model, the most important assumption is that the volatility of the underlying asset price is constant.  We will occasionally need to compute the volatilities of products or ratios of random processes.  These computations follow directly from Ito's formula.\n\nSuppose \n$$\\frac{\\mathrm{d} X}{X} = \\mu_x\\,\\mathrm{d} t + \\sigma_x\\,\\mathrm{d} B_x \\qquad \\text{and} \\qquad \n\\frac{\\mathrm{d} Y}{Y} = \\mu_y\\,\\mathrm{d} t + \\sigma_y\\,\\mathrm{d} B_y\\; ,$$\nwhere $B_x$ and $B_y$ are Brownian motions with correlation $\\rho$, and $\\mu_x$, $\\mu_y$, $\\sigma_x$, $\\sigma_y$, and $\\rho$ may be quite general random processes.  \n\n### Products\nIf $Z=XY$, then @eq-rule2 gives us\n$$\n\\frac{\\mathrm{d} Z}{Z} = (\\mu_x+\\mu_y+\\rho\\sigma_x\\sigma_y)\\,\\mathrm{d} t + \\sigma_x\\,\\mathrm{d} B_x + \\sigma_y\\,\\mathrm{d} B_y\\;.\n$$ {#eq-volproduct1}\n\nThe instantaneous variance of $\\mathrm{d} Z/Z$ is calculated, using the rules for products of differentials, as\n\\begin{align*}\n\\left(\\frac{\\mathrm{d} Z}{Z}\\right)^2 &= (\\sigma_x\\,\\mathrm{d} B_x + \\sigma_y\\,\\mathrm{d} B_y)^2\\\\\n&= (\\sigma_x^2 + \\sigma_y^2 + 2\\rho\\sigma_x\\sigma_y)\\,\\mathrm{d} t\\;.\n\\end{align*}\nAs will be explained below, the volatility is the square root of the instantaneous variance (dropping the $\\mathrm{d} t$).  This implies:\n\n::: {.callout-tip}\n## \nThe volatility of $XY$ is\n$$\n\\sqrt{\\sigma_x^2 + \\sigma_y^2 + 2\\rho\\sigma_x\\sigma_y}\\;.\n$$ {#eq-volatilityproduct}\n\n:::\n\n\n\n### Ratios\nIf $Z=Y/X$, then @eq-rule4 gives us\n$$\n\\frac{\\mathrm{d} Z}{Z} = (\\mu_y-\\mu_x-\\rho\\sigma_x\\sigma_y+\\sigma_x^2)\\,\\mathrm{d} t + \\sigma_y\\,\\mathrm{d} B_y - \\sigma_x\\,\\mathrm{d} B_x\\;.\n$$ {#eq-ratioproduct1}\n\nThe instantaneous variance of $\\mathrm{d} Z/Z$ is therefore\n\\begin{align*}\n\\left(\\frac{\\mathrm{d} Z}{Z}\\right)^2 &= (\\sigma_y\\,\\mathrm{d} B_y - \\sigma_x\\,\\mathrm{d} B_x)^2\\\\\n&= (\\sigma_x^2 + \\sigma_y^2 - 2\\rho\\sigma_x\\sigma_y)\\,\\mathrm{d} t\\;.\n\\end{align*}\nThis implies:\n\n::: {.callout-tip}\n## \nThe volatility of $Y/X$ is  \n$$\n\\sqrt{\\sigma_x^2 + \\sigma_y^2 - 2\\rho\\sigma_x\\sigma_y}\\;.\n$$ {#eq-volatilityratio}\n\n:::\n\n\n\n### Further Discussion\nTo understand why taking the square root of $(\\mathrm{d} Z/Z)^2$ (dropping the $\\mathrm{d} t$) gives the volatility, consider for example the product case $Z=XY$.  Define a random process $B$ by $B(0)=0$ and \n$$\n\\mathrm{d} B = \\frac{\\sigma_x}{\\sigma}\\,\\mathrm{d} B_x + \\frac{\\sigma_y}{\\sigma}\\,\\mathrm{d} B_y\\;,\n$$ {#eq-foreigndB}\n\nwhere $\\sigma$ is the volatility defined in @eq-volatilityproduct.\nThen we can write  @eq-volproduct1 as\n$$\n\\frac{\\mathrm{d} Z}{Z} = \\left(\\mu_x +\\mu_y+ \\rho\\sigma_x\\sigma_y\\right)\\,\\mathrm{d} t + \\sigma\\,\\mathrm{d} B\\;.$$ {#eq-volproduct2}\n\nFrom the discussion in @sec-s_itoprocesses, we know that $B$ is a continuous martingale.  We can compute its quadratic variation from\n\\begin{align*}\n(\\mathrm{d} B)^2 &= \\left(\\frac{\\sigma_x\\,\\mathrm{d} B_x + \\sigma_s\\,\\mathrm{d} B_s}{\\sigma}\\right)^2\\\\\n&= \\frac{(\\sigma_x^2 + \\sigma_s^2 + 2\\rho\\sigma_x\\sigma_s)\\,\\mathrm{d} t}{\\sigma^2}\\; ,\\\\\n&= \\mathrm{d} t\\;.\n\\end{align*}\nBy Levy's theorem (see @sec-s_quadraticvariation), any continuous martingale with this quadratic variation is necessarily a Brownian motion.  Therefore,  @eq-volproduct2 shows that $\\sigma$ is the volatility of $Z$ as defined at the beginning of the section.\n\n## Exercises\n\n\n::: {#exr-nolabel}\n Consider a discrete partition $0=t_0 < t_1 < \\cdots t_N=T$ of the time interval $[0,T]$ with $t_i - t_{i-1} = \\Delta t = T/N$ for each $i$.  Consider the function \n$$X(t)=\\mathrm{e}^t\\; .$$\nWrite a code, which computes and plots $\\sum_{i=1}^N [\\Delta X(t_i)]^2$, where \n$$\\Delta X(t_i) = X(t_i)-X(t_{i-1}) = \\mathrm{e}^{t_i} - \\mathrm{e}^{t_{i-1}}\\; .$$\n<!-- Hint: The sum can be computed as follows.\n\\begin{verbatim}\nsum = 0\nFor i = 1 To N\n    DeltaX = Exp(i/N)-Exp((i-1)/N)\n    sum = sum + DeltaX * DeltaX\nNext i\n\\end{verbatim} -->\n:::\n::: {#exr-nolabel}\n Repeat the previous problem for the function $X(t) = t^3$.  In both this and the previous problem, what happens to $\\sum_{i=1}^N [\\Delta X(t_i)]^2$ as $N \\rightarrow \\infty$?\n:::\n::: {#exr-nolabel}\n Either use the code provided or write a code to compute $\\sum_{i=1}^N [\\Delta B(t_i)]^2$, where $B$ is a simulated Brownian motion.  For a given $T$, what happens to the sum as $N \\rightarrow \\infty$?  \n:::\n::: {#exr-nolabel}\n Repeat the previous problem to compute $\\sum_{i=1}^N [\\Delta B(t_i)]^3$, where $B$ is a simulated Brownian motion.  For a given $T$, what happens to the sum as $N \\rightarrow \\infty$?  \n:::\n::: {#exr-nolabel}\n Repeat the previous problem, computing instead $\\sum_{i=1}^N |\\Delta B(t_i)|$ where $| \\cdot |$ denotes the absolute value.  What happens to this sum as $N \\rightarrow \\infty$?\n:::\n::: {#exr-nolabel}\nUse Ito's Lemma to derive the stochastic differential equation for $S(t)^2$.  Argue that $S(t)^2$ is Geometric Brownian Motion and find $E[S(t)^2]$.\n::: \n::: {#exr-nolabel}\nIto's Lemma can be used in different ways to get the same answer.  For example, let $X(t) = a t + b B_t$ and use Ito's lemma on the function $e^{X(t)}$.  Alternatively, let $f(t, B_t) = e^{a t + bB_t}$.  Use Ito's lemma on $f(,)$.\n::: \n::: {#exr-nolabel} \nUse the facts $e^{x+y}=e^x \\times e^y$ and $\\frac{e^x}{e^y} = e^{x-y}$ to deduce the drift and volatility of the product and ratio of two Geometric Brownian motions.\n::: \n::: {#exr-nolabel}\n Consider a discrete partition $0=t_0 < t_1 < \\cdots t_N=T$ of the time interval $[0,T]$ with $t_i - t_{i-1} = \\Delta t = T/N$ for each $i$.  Consider a geometric Brownian motion\n$$\\frac{\\mathrm{d} Z}{Z} = \\mu\\,\\mathrm{d} t + \\sigma\\,\\mathrm{d} B\\; .$$\nAn approximate path $\\tilde{Z}(t)$ of the geometric Brownian motion can be simulated as\n$$\n\\Delta \\tilde{Z}(t_i) = \\tilde{Z}(t_{i-1}) \\big[ \\mu\\,\\Delta t + \\sigma\\,\\Delta B\\big]\\;.\n$$ {#eq-exponential111}\nModify the code to generate both a path $Z(t)$ and an approximate path $\\tilde{Z}(t)$ according to @eq-exponential111, using the same $\\Delta B$  for both paths and taking $\\tilde{Z}(0) = Z(0)$.  Plot both paths in the same figure.  How well does the approximation work for large $N$?   Warning:  \nFor $N$ larger than about $100 T$, the approximation will look perfect---you won't be able to tell that there are two plots in the figure.  One reason this is true is an exact formula is \n$$\n Z(t_i) = Z(t_{i-1}) \\exp\\left[ \\left(\\mu -\\frac{\\sigma^2}{2}\\right)\\,\\Delta t + \\sigma\\,\\Delta B\\right]\\;.\n$$ {#eq-exponential112}\nand using Taylor's Theorem for small $\\Delta t$, $e^{\\left(\\mu-\\frac{\\sigma^2}{2}\\right) \\Delta t} \\approx 1+ \\left(\\mu-\\frac{\\sigma^2}{2}\\right) \\Delta t$ and $e^{\\sigma \\Delta B_t} \\approx 1+ \\sigma \\Delta B_t +\\frac{1}{2}\\sigma^2 (\\Delta B_t)^2$ and $(dB_t)^2=\\Delta t$.\n:::\n::: {#exr-nolabel}\nUse simulation to find  $E^*[e^{-r T}{\\bf{1}}_{\\{S(T) \\ge K\\}}]$ in the risk neutral measure where\n\\begin{equation*}\ndS(t)= r S(t) dt + \\sigma S(t) dB_t^*\n\\end{equation*}\nVerify that $S(t)/e^{r t}$ is a martingale in the $*$ measure where $B^*$ is a Brownian motion.\nThen use simulation to find $S(0)E^S[\\frac{1}{S(T)} {\\bf{1}}_{\\{S(T) \\ge K\\}}]$ in the pricing measure which uses the share as numeraire where \n\\begin{equation*}\ndS(t) = (r + \\sigma^2) S(t) dt + \\sigma S(t) dB_t^S\n\\end{equation*}\nso the log satisfies\n\\begin{equation*}\n\\log(S(t)) = \\log(S(0)) + (r + \\frac{\\sigma^2}{2})t + \\sigma B_t^S\n\\end{equation*}\nYou should verify $e^{rt}/S(t)$ is a martingale in the $S$ measure where $B^S$ is a Brownian motion.\nBoth estimates should be the same up to simulation error and give the time zero value of the random payoff ${\\bf{1}}_{\\{S(T) \\ge K\\}}$ which is a random variable equal to $1$ if $S(T)\\ge K$ and $0$ otherwise.  You should choose the values for $r$, $\\sigma$, $T$, and $K$.\n::: \n\n",
    "supporting": [
      "Chapter2_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n<script type=\"text/javascript\">\nwindow.PlotlyConfig = {MathJaxConfig: 'local'};\nif (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: \"STIX-Web\"}});}\nif (typeof require !== 'undefined') {\nrequire.undef(\"plotly\");\nrequirejs.config({\n    paths: {\n        'plotly': ['https://cdn.plot.ly/plotly-2.34.0.min']\n    }\n});\nrequire(['plotly'], function(Plotly) {\n    window._Plotly = Plotly;\n});\n}\n</script>\n\n"
      ]
    }
  }
}