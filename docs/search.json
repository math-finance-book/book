[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Mathematical Finance Book",
    "section": "",
    "text": "This may eventually be a book."
  },
  {
    "objectID": "Chapter1.html",
    "href": "Chapter1.html",
    "title": "1  Asset Pricing Basics",
    "section": "",
    "text": "This chapter introduces the change of numeraire (or martingale) method for valuing derivative securities. The method is introduced in a binomial model and then extended to more general (continuum of states) models. Computations in the more general model require the continuous-time mathematics that will be presented in Chapter 2. We will begin with a brief description of the basic derivatives (calls and puts) and some other financial concepts. More detailed descriptions can be found in any of the many introductory books on derivative securities (e.g., or ).\nIt should be noted that the pricing and hedging results in this book are not tied to any particular currency. However, for specificity (and as a consequence of the author’s habit) the discussion will generally be in terms of dollars. Multiple currencies are addressed in Chapter 6."
  },
  {
    "objectID": "Chapter1.html#longs-shorts-and-margin",
    "href": "Chapter1.html#longs-shorts-and-margin",
    "title": "1  Asset Pricing Basics",
    "section": "Longs, Shorts, and Margin",
    "text": "Longs, Shorts, and Margin\nIn financial markets, the owner of an asset is said to be “long” the asset. If person A owes something to person B, the debt is an asset to person B but a liability to person A. One also says that person A is “short” the asset. For example, if someone borrows money and invests the money in stocks, then the individual is short cash and long stocks.\nOne must invest some of one’s own money when borrowing money to buy stocks. For example, an individual could invest $600, borrow $400, and buy $1000 of stock. The $600 is called the “margin” posted by the investor, and buying stocks in this way is called buying “on margin.” The investor, or the portfolio, is also said to be “levered,” because buying $1000 of stock with only a $600 investment amplifies the risk and return per dollar of investment. On a percentage basis, we would say the account has 60% margin, the 60% being the ratio of the equity (assets minus liabilities = $1000 of stock minus $400 debt) to the assets ($1000 of stock). !!!Replace next part with better explanation. Include Fed Reg T.!!! If the value of the stock drops sufficiently far, then it may become doubtful whether the investor can repay the $400. In this case, the investor must either sell the stock or invest more of his own funds (i.e., he receives a “margin call”). In other words, in actual markets there are “margin requirements,” that specify a minimum percent margin an investor must have initially (when borrowing money) and a minimum percent margin the investor must maintain.\nRather than borrowing money to buy stocks, an investor can do the opposite—he can borrow stocks to buy money. In this case, “buying money” means selling the borrowed stocks for cash. Such an investor will be short stocks and long cash. This is called “short selling” (or, more briefly, “shorting”) stocks. For example, suppose individual A borrows 100 shares of stock from individual B and then sells them to individual C. Both B and C are long the 100 shares and A is short, so the net long position is \\(2 x 100 - 100\\), which is the original 100 shares that B was long. A short seller of stocks must pay to the lender of the stocks any dividends that are paid on the stock. In our example, both B and C own the 100 shares so both expect to receive dividends. The company will pay dividends only to C, and A must pay the dividends to B.\nOf course, investors always wish to buy low and sell high. The usual method is to buy stocks and hope they rise. An investor who short sells also wishes to buy low and sell high, but he reverses the order—he sells first and then hopes the stocks fall. The risk is that the stocks will instead rise, which will increase the value of his liability (short stock position) without increasing the value of his assets (long cash position), thus putting him “under water.” To shield the lender of the stocks from this risk, a short seller must also invest some of his own funds, and this amount is again called the investor’s margin. For example, an investor might invest $600, and borrow and sell $1000 of stock. In this case, the investor will be long $1600 cash and short $1000 worth of stock. His equity is $600 and his percent margin is calculated as $600/$1000 = 60%. Again, there are typically both initial and maintenance margin requirements. An additional feature of short selling for small individual investors is that they typically will not earn interest on the proceeds of the short sale (the $1000 cash obtained from selling stocks in the above example).\nIn this book, we will assume there is a single risk-free rate at which one can both borrow and lend. Moreover, we will assume that investors earn this rate on margin deposits, including the proceeds of short sales (and including any margin that may be required when buying and selling forward and futures contracts). Thus, investors gain from buying on margin if the asset return is sure to exceed the risk-free rate, and they gain from short selling if the return on an asset is sure to be below the risk-free rate. These assumptions are not reasonable for small individual investors, but they are fairly reasonable for institutional investors. We will assume that no asset has a return that is certain to be above the risk-free rate nor certain to be below the risk-free rate, because institutional investors could “arbitrage” such guaranteed high-return or guaranteed low-return assets."
  },
  {
    "objectID": "Chapter1.html#calls-and-puts",
    "href": "Chapter1.html#calls-and-puts",
    "title": "1  Asset Pricing Basics",
    "section": "Calls and Puts",
    "text": "Calls and Puts\nCall and put options are the basic derivative securities and the building blocks of many others. A derivative security is a security the value of which depends upon another security.\nA call option is the right to buy an asset at a pre-specified price. The pre-specified price is called the exercise price, the strike price, or simply the strike. We will often call the asset a “stock,” but there are options on many other types of assets also, and everything we say will be applicable to those as well.1 The asset to which the call option pertains is called the “underlying asset,” or, more briefly, the “underlying.” If the market value of the asset exceeds the exercise price, then we say the call option is “in the money.” Buying a call option is a way to bet on the upside of the underlying asset.\nA put option is the right to sell an asset at a pre-specified (exercise, strike) price. Buying a put is a way to bet on an asset price becoming low (similar to shorting). A put option is in the money if the exercise price exceeds the value of the asset. Both puts and calls are potentially valuable and hence the buyer of a put or call must pay the seller.\nA long put option provides insurance to someone who is long the underlying asset, because it guarantees that the asset can always be sold at the strike price of the put (of course, it can be sold at the market price, if that is higher than the strike of the put). Symmetrically, a long call option provides insurance to someone who is short the underlying asset. The terminology in option markets reflects the parallels between options and insurance contracts. In particular, the seller of an option is said to “write” the option and the compensation (price) he receives from the buyer is called the option “premium,” just as an insurance company writes insurance contracts in exchange for premium income. Calculating the price at which one should be willing to trade an option is the main topic of this book.\nIt is important to recognize the different situations of someone who is short a call option and someone who is long a put. Both positions are bets on the downside of the asset. Both the investor who is short a call and the investor who is long a put may eventually sell the underlying asset and receive the exercise price in exchange. However, the investor who is long a put has an option to sell the asset at the exercise price and the investor who is short a call has an obligation to sell the asset at the exercise price, should the counterparty choose to exercise the call. Thus, the investor who is long a put will be selling at the exercise price when it is profitable to do so, whereas the investor who is short a call will be selling at the exercise price when it is unprofitable. The buyer of a put must pay the premium to the seller; he then profits if the asset price is low, with his maximum possible profit being quite large (the maximum value is attained when the market value of the underlying asset reaches zero). In contrast, the seller of a call receives premium income, and the premium is his maximum possible profit, whereas his potential losses are unbounded. Thus, these are very different positions.\nIndividuals who sell calls usually sell out-of-the-money covered calls. “Covered” means that they own the underlying asset and can therefore deliver the underlying if the call is exercised without incurring any further expense—they experience only an “opportunity cost” in delivering it for less than the market price.2 A call being out of the money implies that the price of the underlying must rise before the call would be exercised against the seller; thus, the seller of an out-of-the money covered call still has some potential for profit from the underlying. In addition, of course, the seller receives the premium income from the call. Institutions often follow this strategy also, using the premium income to “enhance” their return from the underlying. One can hedge a short call without owning a full share of the underlying asset, if one is able to rebalance the hedge over time. Calculating such hedges is another of the principal topics of this book.\nIn a certain sense, option markets are zero-sum games. The profit earned by one counterparty to an option transaction is a loss suffered by the other. However, options can allow for an increase in the welfare of all investors by improving the allocation of risk. A producer who must purchase a certain input may buy a call option, giving him the right to buy the input at a fixed price. This caps his expense. The seller of the call now bears the risk that the input price will be high—in this case, the option will be exercised and he will be forced to sell at a price below the market price. It may be that the seller is in a better position to bear the risk (for example, he may have less of the risk in his portfolio) and the option transaction may thereby improve the allocation of risks across investors. The similarity to insurance should be apparent.\nQuite complex bets or hedges can be created by combining options. For example, a long call and put with the same strike price is called a “straddle.” Such a portfolio is (almost) always in the money. It is in fact a bet on volatility—a big move in the underlying asset value away from the exercise price will lead to either the call or put having a high value. Another important example of an option portfolio is a “collar.” A collar consists of a long put and a short call, or a short call and a long put, with the options having the same maturity. As mentioned before, a long put provides insurance to someone who is long the underlying asset. Selling a call provides premium income that can be used to offset the cost of the put (the most popular type of collar is a zero-cost collar: a collar in which the premium of the call is equal to the premium of the put). The cost of selling a call for an owner of the underlying is that it sells off the upside of the underlying asset—if the value of the asset exceeds the strike price of the call, then the call will be exercised and the underlying asset must be delivered for the strike price (rather than the higher market price). Thus, one can purchase the downside insurance provided by a long put by selling part of the upside potential of the asset, rather than paying the cost of the insurance out of pocket. There are many other examples of option portfolios that could be given.\nSome puts and calls are traded on exchanges. In this case, the exchange clearinghouse “steps between” the buyer and seller and becomes the counterparty to both the buyer and seller. This eliminates the risk that the seller might default on his obligation when the buyer chooses to exercise his option. If the owner of an option chooses to exercise, the clearinghouse randomly chooses someone who is short the option to fulfill the obligation. Most exchange traded options are never exercised, because any gain on a long contract can be captured by selling the contract at the market price, thus cancelling the position. Obviously, however, the right to exercise is essential, because it determines the market price. Puts and calls are also transacted “over the counter,” which means that they are private contracts of the counterparties. Moreover, puts and calls are embedded in many other financial instruments. A prosaic but important example is that most homeowners have the right to pay off their mortgages early. This means they have call options on their mortgages, with exercise price equal to the remaining mortgage principal. Similarly, callable bonds can be redeemed early by the company issuing them, convertible bonds have embedded call options on the company’s stock (which are exercised by “converting” the bonds) and there are many, many other examples. Puts and calls also exist outside financial markets. For example, a company may begin manufacturing a new product at a small scale; if the product is successful, the scale can be expanded. In this case, the company buys a call option on large-scale production with the premium being the cost of launching small-scale production. Adapting the methods developed for financial options to value such “real options” is an important and growing field."
  },
  {
    "objectID": "Chapter1.html#exercise-policies-for-calls-and-puts",
    "href": "Chapter1.html#exercise-policies-for-calls-and-puts",
    "title": "1  Asset Pricing Basics",
    "section": "Exercise Policies for Calls and Puts",
    "text": "Exercise Policies for Calls and Puts\nIt may be rational to exercise a call if the asset value exceeds the exercise price. Thus, denoting the price of the asset by \\(S\\) and the exercise price by \\(K\\), the owner of a call option can profit by \\(S-K\\) dollars by exercising the option when \\(S>K\\). If \\(S<K\\), exercise would be irrational. Thus, the payoff to the owner of the call option is3 \\(\\max(0,S-K)\\). It has been said that timing is everything, and the timing here should be made clearer. The simplest type of option is called a “European” option. A European option has a finite lifetime and can only be exercised at its maturity date. For a European call option, the exercise strategy just described is the optimal one, with \\(S\\) representing the asset price at the maturity date of the option. Equally, if not more, important are “American” options, which can be exercised at any time before maturity.\nFor an American call option, the exercise strategy just described is the optimal one at the maturity date, but it may also be optimal to exercise prior to maturity. Let \\(K\\) denote the exercise price, \\(T\\) the date the option matures, and \\(S(t)\\) the price of the underlying asset at date \\(t \\leq T\\). The “intrinsic value” of the call option at date \\(t\\) is defined to be \\(\\max(0,S(t)-K)\\). One would of course never exercise unless the intrinsic value is positive—i.e., unless the option is in the money. Moreover, if the asset does not pay a dividend (or other type of cash flow) prior to the option maturity then one should not exercise in any circumstances prior to maturity. This is captured in the saying: “calls are better alive than dead.” Exercise being suboptimal is equivalent to the value of the option exceeding the intrinsic value.\nThe principle that calls on non-dividend-paying assets are better alive than dead follows from two facts: (i) it is generally a good thing (in financial markets as well as in life) to keep one’s options open, and (ii) early exercise implies early payment of the exercise price and hence foregone interest. The usual protest that is heard when this statement is made is that one should surely exercise if he expects the stock price to plummet, because by exercising (and then selling the stock acquired) one can lock in the current stock price rather than waiting for it to fall, in which case the option will surely be worth less. This intuition is a reasonable one, but it ignores the fact that the investor could short sell the stock if he expects it to plummet—he doesn’t need to exercise the option to lock in the current stock price. In fact, shorting the stock and retaining the option is always better than exercising, assuming the underlying asset does not pay a dividend.\nSpecifically, suppose an investor considers exercising at date \\(t\\). As an alternative to exercising early, consider shorting the stock at date \\(t\\) and retaining the option. This is always better than exercising at date \\(t\\), because the short position can be “covered” (the stock can be purchased and returned to the lender to cancel the short position) at cost \\(K\\) at date \\(T\\) by exercising the option, and paying \\(K\\) at date \\(T\\) is better than paying it at date \\(t\\), given that interest rates must be nonnegative. To be more precise, note that exercise at date \\(t\\) produces \\(S(t)-K\\) dollars at date \\(t\\). On the other hand, retaining the option, shorting the stock at date \\(t\\), and covering the short either by exercising the option or buying the stock in the market (whichever is cheaper) produces \\(S(t)\\) dollars at date \\(t\\) and \\[\\max(0,S(T)-K) - S(T) = \\max(-S(T), -K) = -\\min(S(T),K) \\geq -K\\] dollars at date \\(T\\). If \\(S(T)>K\\), one has \\(-K\\) dollars at date \\(T\\), in which case retaining the option has been superior due to the time value of money. Furthermore, if \\(S(T)<K\\), the strategy of retaining the option and shorting the stock produces \\(-S(T) > -K\\) dollars at date \\(T\\), so retaining the option is superior due both to flexibility (waiting until \\(T\\) to decide whether to exercise turns out to be better than committing at date \\(t\\)) and because of the time value of money.4\nEarly exercise of a call option can be optimal when the underlying asset pays a dividend. The above analysis does not apply in this case, because paying the dividend to the lender of the stock is an additional cost for the strategy of retaining the option and shorting the stock. If the dividend is so small that it cannot offset the time value of money on the exercise price, then early exercise will not be optimal. In other cases, deriving the optimal exercise strategy is a complicated problem that we will first begin to study in Chapter ?sec-introcomputation.\nA European put option will be exercised at its maturity \\(T\\) if the price \\(S(T)\\) of the underlying asset is below the exercise price \\(K\\). In general, the value at maturity can be expressed as \\(\\max(0,K-S(T))\\). Early exercise of an American put can be optimal, regardless of whether the underlying pays a dividend. While it is valuable to keep one’s options open (for puts as well as calls) the time value of money works in the opposite direction for puts. Early exercise of a put option implies early receipt of the exercise price, and it is better to receive cash earlier rather than later. In general, whether early exercise is optimal depends on how deeply the option is in the money—if the underlying asset price is sufficiently low, then it will be fairly certain that exercise will be optimal, whether earlier or late; in this case, one should exercise earlier to earn interest on the exercise price. How low it should be to justify early exercise depends on the interest rate (a higher rate makes the time-value-of-money issue more important, leading to earlier exercise) and the volatility of the underlying asset price (a lower volatility reduces the value of keeping one’s options open, leading also to earlier exercise). We will begin to study the valuation of American puts in Chapter@sec-introcomputation."
  },
  {
    "objectID": "Chapter1.html#s_continuouscompounding",
    "href": "Chapter1.html#s_continuouscompounding",
    "title": "1  Asset Pricing Basics",
    "section": "Compounding Interest",
    "text": "Compounding Interest\nDuring most of the first two parts of the book (the only exception being Chap. [c_forwardexchange]) we will assume there is a risk-free asset earning a constant rate of return. For simplicity, we will specify the rate of return as a continuously compounded rate. For example, if the annual rate with annual compounding is \\(r_a\\), then the corresponding continuously compounded rate is \\(r\\) defined as \\(r = \\log (1+r_a)\\), where “\\(\\log\\)” denotes the natural logarithm function. This means that the gross return over a year (one plus the rate of return) is \\(\\mathrm{e}^r = 1+r_a\\). More generally, an investment of \\(x\\) dollars for a time period of length \\(T\\) (we measure time in years, so, e.g., a six-month investment would mean \\(T=0.5\\)) will result in the ownership of \\(x\\mathrm{e}^{rT}\\) dollars at the end of the time period.\nExpressing the interest rate as a continuously compounded rate enables us to avoid having to specify in each instance whether the rate is for annual compounding, semi-annual compounding, monthly compounding, etc. For example, the meaning of an annualized rate \\(r_s\\) for semi-annual compounding is that an investment of \\(x\\) dollars will grow over a year to \\(x(1+r_s/2)^2\\). The equivalent continuously compounded rate is defined as \\(r = \\log (1+r_s/2)^2\\), and in terms of this rate we can say that the investment will grow in six months to \\(x\\mathrm{e}^{0.5 r}\\) and that it will grow in one year to \\(x\\mathrm{e}^r\\). We can interpret this rate as being continuously compounded because compounding \\(n\\) times per year at an annualized rate of \\(r\\) results in $1 growing in a year to \\((1+r/n)^n\\) and \\[\\lim_{n \\rightarrow \\infty} \\left(1+\\frac{r}{n}\\right)^n = \\mathrm{e}^r\\;\\;.\\]\nTo develop pricing and hedging formulas for derivative securities, it is a great convenience to assume that investors can trade continuously in time. This requires us to assume also that returns are computed continuously. In the case of a risk-free investment of \\(x(t)\\) dollars at any date \\(t\\) at a continuously compounded rate of \\(r\\), we will say that the interest earned in “an instant \\(d t\\)” is \\(x(t)r\\,\\mathrm{d} t\\) dollars. This is only meaningful when we accumulate the interest over a non-infinitesimal period of time. So consider investing \\(x(0)\\) dollars at time 0 and reinvesting interest in the risk-free asset over a time period of length \\(T\\). Let \\(x(t)\\) denote the account balance at date \\(t\\), for \\(0\\leq t \\leq T\\). The change in the account balance in each instant is the interest earned, so we have \\(d x(t) = x(t)r\\,\\mathrm{d} t\\). The real meaning of this equation is that \\(x(t)\\) satisfies the differential equation \\[\\frac{d x(t)}{d t} = x(t)r\\; ,\\] and it is well known (and easy to verify) that the solution is \\[x(t) = x(0)\\mathrm{e}^{rt}\\; ,\\] leading to an account balance at the end of the time period of \\(x(T) = x(0)\\mathrm{e}^{rT}\\). Thus, the statement that “the interest earned in an instant \\(d t\\) is \\(x(t)r\\,\\mathrm{d} t\\)” is equivalent to the statement that interest is continuously compounded at the rate \\(r\\).\nIn the last part of the book, we will drop the assumption that the risk-free asset earns a constant rate of return. In this case, we will still generally assume that there is a risk-free asset for very short-term investments (i.e., for investments with infinitesimal durations!). We will let \\(r(t)\\) denote the risk-free rate for an instantaneous investment at date \\(t\\). This means that an investment of \\(x(t)\\) dollars at date \\(t\\) in the risk-free asset earns interest in an instant \\(d t\\) equal to \\(x(t)r(t)\\,\\mathrm{d} t\\). Consider again an investment of \\(x(0)\\) dollars at date 0 in this instantaneously risk-free asset with interest reinvested and let \\(x(t)\\) denote the account balance at date \\(t\\). Then \\(x(t)\\) must satisfy the differential equation \\[\\frac{d x(t)}{d t} = x(t)r(t)\\;\\;.\\] The solution of this differential equation is \\[x(t) = x(0)exp\\left(\\int_0^t r(s)\\,\\mathrm{d}s\\right)\\;\\;.\\] The expression \\(\\int_0^t r(s)\\,\\mathrm{d}s\\) can be interpreted as a continuous sum over time of the rates of interest \\(r(s)\\) earned at times \\(s\\) between 0 and \\(t\\). If these rates are all the same, say equal to \\(r\\), then \\(\\int_0^t r(s)\\,\\mathrm{d}s = rt\\) and our compounding factor \\(exp\\left(\\int_0^t r(s)\\,\\mathrm{d}s\\right)\\) is \\(\\mathrm{e}^{rt}\\) as before."
  },
  {
    "objectID": "Chapter1.html#pricing-share-digitals",
    "href": "Chapter1.html#pricing-share-digitals",
    "title": "1  Asset Pricing Basics",
    "section": "Pricing Share Digitals",
    "text": "Pricing Share Digitals\nConsider first the problem of valuing the share digital. Let \\(Y(t)\\) denote its value at each date \\(t \\leq T\\). We seek to find \\(Y(0)\\). Our fundamental pricing formula [formula] tells us that \\[Y(0) = \\text{num}(0) \\mathrm{e}^\\text{num} \\left[\\frac{Y(T)}{\\text{num}(T)}\\right]\\; ,\\] for any numeraire with price \\(\\text{num}(t)\\). We want to choose the numeraire to simplify the calculation of the expectation. The expectation only involves the states of the world in which \\(S(T) \\geq K\\), because \\(Y(T)=0\\) when \\(S(T)<K\\). In the states of the world in which \\(S(T) \\geq K\\), the value of the share digital is \\(S(T)\\). The calculation of the expectation would be simplified if the value were a constant when it was nonzero, because, if you are to receive a constant amount in a certain event, your expected payoff is the constant times the probability of the event (e.g., the expected payoff of a gamble that pays $1 when a fair die rolls a 6 is 1/6). This suggests we should use the stock as the numeraire, because then we will have \\[\\frac{Y(T)}{\\text{num}(T)} = \\frac{S(T)}{S(T)} = 1\\] when \\(S(T) \\geq K\\), implying that \\[\\mathrm{e}^\\text{num} \\left[\\frac{Y(T)}{\\text{num}(T)}\\right] = \\text{prob}^S\\big(S(T)\\geq K\\big)\\; ,\\] where \\(\\text{prob}^S\\) denotes the probability using \\(S\\) as the numeraire. This implies that the value of the share digital is \\[S(0) \\times \\text{prob}^S\\big(S(T)\\geq K\\big)\\;.\\]\nThe remaining question is obviously how to compute the probability. We will not use the formula [probSnumeraire] which expresses the probability in terms of an expectation involving state prices. To attempt to do so would simply raise the question of how to compute the state prices. Instead, we use the fundamental pricing formula again, this time replacing the derivative value \\(Y\\) with the value of the risk-free asset. This is exactly analogous to computing the “\\(q\\) probabilities” from [binomialS5] and [binomialR5] in Sects. [s_oneperiodbinomial]. Recall that the fundamental formula holds for any non-dividend-paying asset, so it holds for \\(R(t)=\\mathrm{e}^{rt}\\), telling us that the ratio \\(R(t)/S(t)\\) is a martingale when we use \\(S\\) as the numeraire. In a continuous-time model (at least until we introduce stochastic volatility) this will give us exactly the information we need to compute the distribution of \\(S(T)\\) when we use \\(S\\) as the numeraire, and from the distribution of \\(S(T)\\) we can easily compute \\(\\text{prob}^S\\big(S(T)\\geq K\\big)\\). This calculation will be covered in Chapter ?sec-blackscholes for the Black-Scholes model."
  },
  {
    "objectID": "Chapter1.html#pricing-digitals",
    "href": "Chapter1.html#pricing-digitals",
    "title": "1  Asset Pricing Basics",
    "section": "Pricing Digitals",
    "text": "Pricing Digitals\nNow consider the problem of pricing the digital. We will change notation to let \\(Y(t)\\) denote now the value of the digital at time \\(t\\). Again we want to compute \\[Y(0) = \\text{num}(0) \\mathrm{e}^\\text{num}\\left[\\frac{Y(T)}{\\text{num}(T)}\\right]\\; ,\\] and again this expectation only involves the states of the world in which \\(S(T) \\geq K\\). In these states of the world, the value of the digital is already a constant \\(K\\), so we should take the numeraire to have a constant value at \\(T\\), so that the ratio \\(Y(T)/\\text{num}(T)\\) will be constant in the states in which \\(S(T) \\geq K\\). This means that we should take the numeraire to be the risk-free asset. For this numeraire, the pricing formula is \\[Y(0) = \\mathrm{e}^{-rT}\\mathrm{e}^R[Y(T)] = \\mathrm{e}^{-rT}K\\times \\text{prob}^R \\big(S(T)\\geq K\\big)\\; ,\\] so we need to compute the risk-neutral probability that \\(S(T) \\geq K\\). We will do this by using the fact that \\(S(t)/R(t) = \\mathrm{e}^{-rt}S(t)\\) is a martingale under the risk-neutral probability measure. This is analogous to computing the risk-neutral probabilities from [binomialS4] and [binomialR4] in Sects. [s_oneperiodbinomial].\nThis calculation will also be covered in Chapter ?sec-blackscholes for the Black-Scholes model.\nReaders familiar with the Black-Scholes formula may already have surmised that, under the Black-Scholes assumptions, \\[\\text{prob}^S\\big(S(T)\\geq K\\big) = \\N(d_1) \\quad \\text{and} \\quad \\text{prob}^R\\big(S(T)\\geq K\\big) = \\N(d_2)\\; ,\\] where \\(\\N\\) denotes the cumulative normal distribution function . The numbers \\(d_1\\) and \\(d_2\\) are different, and hence these are different probabilities, even though they are both probabilities of the option finishing in the money (\\(S(T) \\geq K\\)). They are different probabilities because they are computed under different numeraires."
  },
  {
    "objectID": "Chapter1.html#a-remark",
    "href": "Chapter1.html#a-remark",
    "title": "1  Asset Pricing Basics",
    "section": "A Remark",
    "text": "A Remark\nIt seems worthwhile here to step back a bit from the calculations and try to offer some perspectives on the methods developed in this chapter. The change of numeraire technique probably seems mysterious. Even though one may agree that it works after following the steps in the chapter, there is probably a lingering question about why it works. The author’s opinion is that it may be best to regard it simply as a “computational trick.” Fundamentally it works because valuation is linear. Linearity simply means that the value of a cash flow \\(X=X_1+X_2\\) is the sum of the values of the cash flows \\(X_1\\) and \\(X_2\\) and the value of the cash flow \\(aX\\) is \\(a\\) times the value of \\(X\\), for any constant \\(a\\). This linearity is manifested in the statement that the value of a cash flow is the sum across states of the world of the state prices multiplied by the size of the cash flow in each state. The change of numeraire technique exploits the linearity to further simplify the valuation exercise. There are other ways the linearity can be used (for example, it produces solvable partial differential equations) but the particular trick we have developed in this chapter seems the most useful to the author (and to others, though perhaps not to everyone). After enough practice with it, it will seem as natural as other computational tricks one might have learned."
  },
  {
    "objectID": "Chapter2.html",
    "href": "Chapter2.html",
    "title": "2  Continuous-Time Models",
    "section": "",
    "text": "This chapter has three objectives. The first is to introduce the concept of a Brownian motion. A Brownian motion is a random process (a variable that changes randomly over time) that evolves continuously in time and has the property that its change over any time period is normally distributed with mean zero and variance equal to the length of the time period. The “mean zero” feature means that a Brownian motion is a martingale. We will also give a different characterization (Levy’s theorem) emphasizing the “quadratic variation” process, which is a property of the paths (how the variable evolves over time, in a given state of the world) of the process.\nThe second objective is to explain Itô’s formula, which is the chain rule for stochastic calculus. In the Black-Scholes model, the stock price is assumed to satisfy \\[\\frac{\\D S}{S}=\\mu\\,\\D t+\\sigma\\,\\D B\\; ,\\] where \\(B\\) is a Brownian motion. In the case that the stock pays no dividend, the rate of return is its price change \\(\\D S\\) divided by the initial price \\(S\\), so the model states that the expected rate of return in each instant \\(\\D t\\) is \\(\\mu\\,\\D t\\) (of course, \\(t\\) denotes time, so \\(\\D t\\) is the change in time). The variance of the rate of return depends on \\(\\sigma\\). This model can be equivalently written in terms of the natural logarithm of \\(S\\), which we will write as \\(\\log S\\). The above equation for the rate of return is equivalent to\n\\[\\D\\,\\log S = \\left(\\mu - \\frac{1}{2}\\sigma^2\\right)\\,\\D t + \\sigma\\,\\D B\\; .\\] We will explain this equivalence and other similar calculations that are useful for pricing derivatives.\nThe third objective is to explain how, when we change numeraires, as described in the previous chapter, we can calculate the expectation in the fundamental pricing formula [formula]. The question is what effect does changing the numeraire (and hence the probability measure) have on the distribution of an asset price.\nEverything in the remainder of the book is based on the mathematics presented in this chapter. For easy reference, the essential formulas have been highlighted in boxes."
  },
  {
    "objectID": "Chapter2.html#risk-neutral-probabilities",
    "href": "Chapter2.html#risk-neutral-probabilities",
    "title": "2  Continuous-Time Models",
    "section": "Risk-Neutral Probabilities",
    "text": "Risk-Neutral Probabilities\nUnder the risk-neutral measure, \\(Z(t)\\) defined as \\[Z(t) = \\frac{V(t)}{R(t)} = \\exp\\left(-\\int_0^t r(s)\\,\\D s\\right)V(t)\\] is a martingale. Using the compounding/discounting rule, we have \\[\\frac{\\D Z}{Z} =-r\\,\\D t + \\frac{\\D V}{V} = (q-r)\\,\\D t + \\frac{\\D S}{S}\\; .\\] For \\(Z\\) to be a martingale, the drift (\\(\\D t\\) part) of \\(\\D Z/Z\\) must be zero. Therefore, the drift of \\(\\D S/S\\) must be \\((r-q)\\,\\D t\\) under the risk-neutral measure. Because the change of measure does not affect the volatility, this implies:"
  },
  {
    "objectID": "Chapter2.html#underlying-as-the-numeraire",
    "href": "Chapter2.html#underlying-as-the-numeraire",
    "title": "2  Continuous-Time Models",
    "section": "Underlying as the Numeraire",
    "text": "Underlying as the Numeraire\nWhen \\(V\\) is the numeraire, the process \\(Z(t)\\) defined as \\[Z(t) = \\frac{R(t)}{V(t)} = \\frac{\\exp\\left(\\int_0^t r(s)\\,\\D s\\right)}{V(t)}\\] is a martingale. Using the rule for ratios, we have \\[\\frac{\\D Z}{Z} =r\\,\\D t - \\frac{\\D V}{V} + \\left(\\frac{\\D V}{V}\\right)^2 = (r -q+ \\sigma^2_s)\\,\\D t - \\frac{\\D S}{S}\\; .\\] Because the drift of \\(\\D Z/Z\\) must be zero, this implies that the drift of \\(\\D S/ S\\) is \\((r -q + \\sigma^2_s)\\,\\D t\\). We conclude that:"
  },
  {
    "objectID": "Chapter2.html#another-risky-asset-as-the-numeraire",
    "href": "Chapter2.html#another-risky-asset-as-the-numeraire",
    "title": "2  Continuous-Time Models",
    "section": "Another Risky Asset as the Numeraire",
    "text": "Another Risky Asset as the Numeraire\nWhen \\(Y\\) is the numeraire, \\(Z(t)\\) defined as \\[Z(t) = \\frac{V(t)}{Y(t)}\\] must be a martingale. Using again the rule for ratios, we have \\[\\begin{align*}\n\\frac{\\D Z}{Z} &= \\frac{\\D V}{V} -\\frac{\\D Y}{Y}- \\left(\\frac{\\D V}{V}\\right)\\left(\\frac{\\D Y}{Y}\\right) + \\left(\\frac{\\D Y}{Y}\\right)^2\\\\\n& = \\frac{\\D V}{V} -\\frac{\\D Y}{Y} -\\rho\\sigma_s\\sigma_y\\,\\D t+\\sigma_y^2\\,\\D t\\\\\n&= \\frac{\\D S}{S} -\\frac{\\D Y}{Y} + (q-\\rho\\sigma_s\\sigma_y\\,\\D t+\\sigma_y^2)\\,\\D t\\; .\n\\end{align*}\\] We can apply our previous example to compute the dynamics of \\(Y\\) when \\(Y\\) is the numeraire. This shows that the drift of \\(\\D Y/Y\\) is \\((r+ \\sigma^2_y)\\,\\D t\\). Because the drift of \\(\\D Z/Z\\) must be zero, it follows that the drift of \\(\\D S/S\\) is \\((r-q+ \\rho\\sigma_s\\sigma_y)\\,\\D t\\). We conclude that: \nNotice that the formula \\(\\eqref{other11}\\), while more complicated, is also more general than the others. In fact, it includes the formulas \\(\\eqref{riskneutral11}\\) and \\(\\eqref{own11}\\) as special cases: (i) if \\(Y\\) is the price of the instantaneously risk-free asset, then \\(\\sigma_y=0\\) and \\(\\eqref{other11}\\) simplifies to \\(\\eqref{riskneutral11}\\), and (ii) if \\(Y= V\\), then \\(\\sigma_y=\\sigma_s\\) and \\(\\rho=1\\), so \\(\\eqref{other11}\\) simplifies to \\(\\eqref{own11}\\)."
  },
  {
    "objectID": "Chapter2.html#further-discussion",
    "href": "Chapter2.html#further-discussion",
    "title": "2  Continuous-Time Models",
    "section": "Further Discussion",
    "text": "Further Discussion\nTo understand why taking the square root of \\((\\D Z/Z)^2\\) (dropping the \\(\\D t\\)) gives the volatility, consider for example the product case \\(Z=XY\\). Define a random process \\(B\\) by \\(B(0)=0\\) and \\[\\begin{equation}\\label{foreigndB}\n\\D B = \\frac{\\sigma_x}{\\sigma}\\,\\D B_x + \\frac{\\sigma_y}{\\sigma}\\,\\D B_y\\;,\n\\end{equation}\\] where \\(\\sigma\\) is the volatility defined in \\(\\eqref{volatilityproduct}\\). Then we can write \\(\\eqref{volproduct1}\\) as \\[\\begin{equation}\\label{volproduct2}\n\\frac{\\D Z}{Z} = \\left(\\mu_x +\\mu_y+ \\rho\\sigma_x\\sigma_y\\right)\\,\\D t + \\sigma\\,\\D B\\;.\\end{equation}\\] From the discussion in Sect.~\\(\\ref{s_itoprocesses}\\), we know that \\(B\\) is a continuous martingale. We can compute its quadratic variation from \\[\\begin{align*}\n(\\D B)^2 &= \\left(\\frac{\\sigma_x\\,\\D B_x + \\sigma_s\\,\\D B_s}{\\sigma}\\right)^2\\\\\n&= \\frac{(\\sigma_x^2 + \\sigma_s^2 + 2\\rho\\sigma_x\\sigma_s)\\,\\D t}{\\sigma^2}\\; ,\\\\\n&= \\D t\\;.\n\\end{align*}\\] By Levy’s theorem (see Sect.~\\(\\ref{s_quadraticvariation}\\)), any continuous martingale with this quadratic variation is necessarily a Brownian motion. Therefore, \\(\\eqref{volproduct2}\\) shows that \\(\\sigma\\) is the volatility of \\(Z\\) as defined at the beginning of the section."
  },
  {
    "objectID": "Chapter2.html#products",
    "href": "Chapter2.html#products",
    "title": "2  Continuous-Time Models",
    "section": "Products",
    "text": "Products\nIf \\(Z=XY\\), then \\(\\eqref{rule2}\\) gives us \\[\\begin{equation}\\label{volproduct1}\n\\frac{\\D Z}{Z} = (\\mu_x+\\mu_y+\\rho\\sigma_x\\sigma_y)\\,\\D t + \\sigma_x\\,\\D B_x + \\sigma_y\\,\\D B_y\\;.\n\\end{equation}\\] The instantaneous variance of \\(\\D Z/Z\\) is calculated, using the rules for products of differentials, as \\[\\begin{align*}\n\\left(\\frac{\\D Z}{Z}\\right)^2 &= (\\sigma_x\\,\\D B_x + \\sigma_y\\,\\D B_y)^2\\\\\n&= (\\sigma_x^2 + \\sigma_y^2 + 2\\rho\\sigma_x\\sigma_y)\\,\\D t\\;.\n\\end{align*}\\] As will be explained below, the volatility is the square root of the instantaneous variance (dropping the \\(\\D t\\)). This implies:"
  },
  {
    "objectID": "Chapter2.html#ratios",
    "href": "Chapter2.html#ratios",
    "title": "2  Continuous-Time Models",
    "section": "Ratios",
    "text": "Ratios\nIf \\(Z=Y/X\\), then \\(\\eqref{rule4}\\) gives us \\[\\begin{equation}\\label{ratioproduct1}\n\\frac{\\D Z}{Z} = (\\mu_y-\\mu_x-\\rho\\sigma_x\\sigma_y+\\sigma_x^2)\\,\\D t + \\sigma_y\\,\\D B_y - \\sigma_x\\,\\D B_x\\;.\n\\end{equation}\\] The instantaneous variance of \\(\\D Z/Z\\) is therefore \\[\\begin{align*}\n\\left(\\frac{\\D Z}{Z}\\right)^2 &= (\\sigma_y\\,\\D B_y - \\sigma_x\\,\\D B_x)^2\\\\\n&= (\\sigma_x^2 + \\sigma_y^2 - 2\\rho\\sigma_x\\sigma_y)\\,\\D t\\;.\n\\end{align*}\\] This implies:"
  },
  {
    "objectID": "Chapter3.html",
    "href": "Chapter3.html",
    "title": "3  Black-Scholes",
    "section": "",
    "text": "In this chapter, we will study the value of European digital and share digital options and standard European puts and calls under the Black-Scholes assumptions. We will also explain how to calculate implied volatilities and the option “Greeks.” The Black-Scholes assumptions are that the underlying asset pays a constant dividend yield \\(q\\) and has price \\(S\\) satisfying \\[\\begin{equation}\\label{bs1}\n\\frac{\\D S}{S} = \\mu\\,\\D t + \\sigma\\,\\D B\n\\end{equation}\\] for a Brownian motion B. Here \\(\\sigma\\) is assumed to be constant (though we will allow it to vary in a non-random way at the end of the chapter) and \\(\\mu\\) can be a quite general random process. It is also assumed that there is a constant continuously-compounded risk-free rate~\\(r\\).\nUnder these assumptions, we will complete the discussion of Sect. [s_introoptions] to derive option pricing formulas. Recall that, to price a European call option, all that remains to be done is to calculate the probabilities of the option finishing in the money when we use the risk-free asset and the underlying asset as numeraires. We will do this using the results of Sect. [s_girsanov]. As in Sect. [s_introoptions], we will approach the pricing of call and put options by first considering their basic building blocks: digitals and share digitals."
  },
  {
    "objectID": "Chapter3.html#black-scholes-call-and-put-formulas",
    "href": "Chapter3.html#black-scholes-call-and-put-formulas",
    "title": "3  Black-Scholes",
    "section": "Black-Scholes Call and Put Formulas",
    "text": "Black-Scholes Call and Put Formulas\nThe following function implements the Black-Scholes call pricing formula. For the sake of completeness, the function returns a value even when a volatility of zero is input, in which case the formula [blackscholescall] is invalid (it involves division by zero in the calculation of \\(d_1\\) and \\(d_2\\)). If the volatility is zero, then the stock is riskless and should appreciate at rate \\(r-q\\). Moreover the option is riskless and its date–0 value should be the date–T value discounted at the risk-free rate. This implies that the call value at date 0 is4\n\nIt is useful to note that\ngives the same result as\nIn the latter formulation, we view the underlying asset as the portfolio which starts with \\(\\E^{-qT}\\) shares of the asset and reinvests dividends until date \\(T\\). This portfolio has value \\(S(T)\\) at date \\(T\\), so a European call option on this non-dividend-paying portfolio is equivalent to a European call option on the stock. The initial value of the portfolio is \\(\\E^{-qT}S(0)\\), which is input as the asset price in the latter formulation.\nThe Black-Scholes formula for the value of a European put option can be implemented as follows."
  },
  {
    "objectID": "Chapter3.html#black-scholes-greeks",
    "href": "Chapter3.html#black-scholes-greeks",
    "title": "3  Black-Scholes",
    "section": "Black-Scholes Greeks",
    "text": "Black-Scholes Greeks\nThe delta and gamma of a European call option can be computed with the following functions. The other Greeks are obviously calculated in a similar manner. Note that the constant \\(\\pi = 3.14159...\\) is provided in Excel as the “function” Pi() and can be accessed in Excel VBA as Application.Pi."
  },
  {
    "objectID": "Chapter3.html#implied-volatilities",
    "href": "Chapter3.html#implied-volatilities",
    "title": "3  Black-Scholes",
    "section": "Implied Volatilities",
    "text": "Implied Volatilities\nWe could find an implied volatility using the Solver tool, but then we would have to re-run Solver each time we changed one of the input values. We will need to solve similar problems on several occasions, so it seems worthwhile to program a Solver-like function in VBA. We will write this in such a way that it can easily be applied in other contexts. We will assume there is a single variable for which we want to solve, solving for multiple variables being more difficult.\nLetting denote the market price of a European call option, the implied volatility is satisfying\nThe solution of this equation is called a ``root’’ of the function\nand the problem of finding roots of functions is a standard numerical problem. Roots are found by what are essentially sophisticated trial-and-error methods. The simplest method is to start with upper and lower bounds for \\(\\sigma\\) and repeatedly bisect the interval containing \\(\\sigma\\), each time finding a new upper or lower bound. The program below is a standard bisection routine.\nFor there to be a volatility that equates the market price to the Black-Scholes price, it is necessary for the call option price to satisfy the arbitrage bound5 \\(C +\\E^{-rT}K \\geq \\E^{-qT}S\\). We check this condition at the beginning of the program and supply an error message if it is violated.\nWe need to input all of the inputs of other than~\\(\\sigma\\), and we need to input the call option price. The following uses an error tolerance of \\(10^{-6}\\). Therefore, the value that is returned will equal the exact implied volatility to at least five decimal places. The bisection is begun with a lower bound of \\(\\sigma =0\\). An iterative procedure is used to find an upper bound, starting with \\(\\sigma = 100\\)%.\nThis same algorithm can be used to find a real number \\(x\\) such that \\(f(x)=0\\) for any (continuous) function \\(f\\). The only changes necessary are in the right hand sides of the assignment statements for flower, fupper, and fguess and in finding lower and upper bounds (and obviously one would not check the arbitrage bound in general).6 We will use this algorithm on several occasions to find roots of functions.\n\nTo compute an implied volatility from a put option price, one can first compute a corresponding call option price from put-call parity and then run the above program.\nThere are faster root-finding methods than bisection. These use other methods to update the guess than just halving the distance between the prior guess and the upper or lower bound. For example, one can use the vega (the derivative of the option formula with respect to \\(\\sigma\\)) at the given guess for \\(\\sigma\\) and replace the bisection with\nThis amounts to approximating the Black-Scholes formula as being linear in \\(\\sigma\\) and using the root of the approximation as the updated guess. This is the essence of the Newton-Raphson method. A similar idea that does not require the computation of vega is to keep track of the two most recent (guess, call) pairs and to approximate vega as:\nThis is the essence of the method."
  },
  {
    "objectID": "Chapter3.html#discretely-rebalanced-delta-hedges",
    "href": "Chapter3.html#discretely-rebalanced-delta-hedges",
    "title": "3  Black-Scholes",
    "section": "Discretely-Rebalanced Delta Hedges",
    "text": "Discretely-Rebalanced Delta Hedges\nTo compute the real-world distribution of gains and losses from a discretely-rebalanced delta hedge, we input the expected rate of return \\(\\mu\\). We consider adjusting the hedge at dates \\(0=t_0<t_1<\\cdots<t_N=T\\), with \\(t_i-t_{i-1}=\\varDelta t = T/N\\) for each \\(i\\). The changes in the natural logarithm of the stock price between successive dates \\(t_{i-1}\\) and \\(t_i\\) are simulated as\n\\[\\varDelta \\log S = \\left(\\mu-q-\\frac{1}{2}\\sigma^2\\right)\\,\\varDelta t + \\sigma\\,\\varDelta B\\; ,\\] where \\(\\varDelta B\\) is normally distributed with mean zero and variance \\(\\varDelta t\\). The random variables \\(\\varDelta B\\) are simulated as standard normals multiplied by \\(\\sqrt{\\varDelta t}\\). We begin with the portfolio that is short a call, long \\(\\delta\\) shares of the underlying, and short \\(\\delta S-C\\) in cash. After the stock price changes, say from \\(S\\) to \\(S'\\), we compute the new delta \\(\\delta'\\). The cash flow from adjusting the hedge is \\((\\delta-\\delta')S'\\). Accumulation (or payment) of interest on the cash position is captured by the factor \\(e^{r\\varDelta t}\\). Continuous payment of dividends is modelled similarly: the dividends earned during the period \\(\\varDelta t\\) is taken to be \\(\\delta S\\left(e^{q\\varDelta t}-1\\right)\\). The cash position is adjusted due to interest, dividends, and the cash flow from adjusting the hedge. At date \\(T\\), the value of the portfolio is the cash position less the intrinsic value of the option.\nTo describe the distribution of gains and losses, we compute percentiles of the distribution. You should see that the hedge becomes more nearly perfect as the number of periods \\(N\\) is increased. Note that this is true regardless of the \\(\\mu\\) that is input, which reaffirms the point that option values and hedges do not depend on the expected rate of return of the underlying. The percentile is calculated with the Excel Percentile function.7"
  },
  {
    "objectID": "Chapter4.html",
    "href": "Chapter4.html",
    "title": "4  Estimating and Modelling Volatility",
    "section": "",
    "text": "In the first three sections, we will consider the problem of estimating the volatility. The discussion of estimation methods leads naturally into the discussion of modelling a changing volatility.\n\n5 Statistics Review\nWe begin with a brief review of basic statistics. Given a random sample \\(\\{x_1,\\ldots,x_N\\}\\) of size \\(N\\) from a population with mean \\(\\mu\\) and variance \\(\\sigma^2\\), the best estimate of \\(\\mu\\) is of course the sample mean \\[\\bar{x} = \\frac{1}{N}\\sum_{i=1}^{N}x_i\\; .\\] The variance is the expected value of \\((x-\\mu)^2\\), so an obvious estimate of the variance is the sample average of \\((x_i-\\mu)^2\\), replacing \\(\\mu\\) with its estimate \\(\\bar{x}\\). This would be \\[\\frac{1}{N}\\sum_{i=1}^{N} (x_i-\\bar{x})^2\\] However, because \\(\\bar{x}\\) is computed from the \\(x_i\\), the \\(x_i\\) will deviate less on average from \\(\\bar{x}\\) than they do from the true mean \\(\\mu\\). Hence the estimate proposed above will on average be less than \\(\\sigma^2\\). To eliminate this bias, it suffices just to scale the estimate up by a factor of \\(N/(N-1)\\). This leads to the estimate \\[s^2=\\frac{1}{N-1}\\sum_{i=1}^{N} (x_i-\\bar{x})^2\\; ,\\] and the best estimate of \\(\\sigma\\) is the square root \\[s=\\sqrt{\\frac{1}{N-1}\\sum_{i=1}^{N} (x_i-\\bar{x})^2}\\; .\\]\nTo calculate \\(s^2\\), notice that \\[\\begin{align*}\n\\sum_{i=1}^{N} (x_i-\\bar{x})^2 &= \\sum_{i=1}^{N} (x_i^2-2x_i\\bar{x}+\\bar{x}^2)\\\\\n&=\\sum_{i=1}^{N} x_i^2 -2\\bar{x}\\sum_{i=1}^{N} x_i + \\sum_{i=1}^N \\bar{x}^2\\\\\n&=\\sum_{i=1}^{N} x_i^2 -2\\bar{x}(N\\bar{x})+N\\bar{x}^2\\\\\n&=\\sum_{i=1}^{N} x_i^2 -N\\bar{x}^2\\;.\n\\end{align*}\\] Therefore \\[s=\\sqrt{\\frac{1}{N-1}\\left(\\sum_{i=1}^{N} x_i^2-N\\bar{x}^2\\right)}\\; .\\]\nIt is important to know how much variation there would be in \\(\\bar{x}\\) if one had access to multiple random samples. More variation means that an \\(\\bar{x}\\) computed from a single sample will be a less reliable estimate of \\(\\mu\\). The variance of \\(\\bar{x}\\) in repeated samples is \\(\\sigma^2/N\\),1 and our best estimate of this variance is \\(s^2/N\\). The standard deviation of \\(\\bar{x}\\) in repeated samples, which is called the “standard error” of \\(\\bar{x}\\), is \\(\\sigma/\\sqrt{N}\\), and we estimate this by \\(s/\\sqrt{N}\\), which equals\n\n\n6 Estimating a Constant Volatility and Mean\nConsider an asset price that is a geometric Brownian motion under the actual probability measure: \\[\\frac{\\D S}{S} = \\mu\\,\\D t + \\sigma\\,\\D B\\; ,\\] where \\(\\mu\\) and \\(\\sigma\\) are unknown constants and \\(B\\) is a Brownian motion. We can as usual write this in log form as \\[\\D\\log S = \\left(\\mu-\\frac{1}{2}\\sigma^2\\right)\\,\\D t + \\sigma\\,\\D B\\; .\\] Over a discrete time period of length \\(\\varDelta t\\), this implies \\[\\begin{equation}\\label{dlogs}\n\\varDelta \\log S = \\left(\\mu-\\frac{1}{2}\\sigma^2\\right)\\varDelta t + \\sigma \\varDelta B\\;.\n\\end{equation}\\] Suppose we have observed the asset price \\(S\\) at dates \\(0=t_0<t_1<\\cdots< t_N=T\\), where \\(t_i-t_{i-1}=\\varDelta t\\). If the asset pays dividends, we will take \\(S\\) to be the value of the portfolio in which the dividends are reinvested in new shares. Thus, in general, \\(S(t_i)/S(t_{i-1})\\) denotes the gross return (one plus the rate of return) between dates \\(t_{i-1}\\) and \\(t_i\\). This return is measured on a non-compounded and non-annualized basis. The annualized continuously-compounded rate of return is the rate \\(r_i\\) defined by \\[\\frac{S(t_i)}{S(t_{i-1})} = \\E^{r_i\\varDelta t}\\; .\\] This implies that \\[\\begin{equation}\\label{contcompreturn}\nr_i = \\frac{\\log S(t_i)-\\log S(t_{i-1})}{\\varDelta t} = \\mu-\\frac{1}{2}\\sigma^2 + \\sigma \\frac{B(t_i)-B(t_{i-1})}{\\varDelta t}\\;.\n\\end{equation}\\] Because \\(B(t_i)-B(t_{i-1})\\) is normally distributed with mean zero and variance~\\(\\varDelta t\\), the sample \\(\\{r_1,\\ldots,r_N\\}\\) is a sample of independent random variables each of which is normally distributed with mean \\(\\mu-\\sigma^2/2\\) and variance \\(\\sigma^2/\\varDelta t\\). We are focused on estimating \\(\\sigma^2\\), so it will simplify things to define \\[\\begin{equation}\\label{volyi}\ny_i = r_i\\sqrt{\\varDelta t} = \\frac{\\log S(t_i)-\\log S(t_{i-1})}{\\sqrt{\\varDelta t}}\\;.\n\\end{equation}\\] The sample \\(\\{y_1,\\ldots,y_N\\}\\) is a sample of independent random variables each of which is normally distributed with mean \\((\\mu-\\sigma^2/2)\\sqrt{\\varDelta t}\\) and variance \\(\\sigma^2\\). As was discussed in the previous section, the best estimate of the mean of \\(y\\) is the sample mean \\[\\bar{y} = \\frac{1}{N}\\sum_{i=1}^{N}y_i\\; ,\\] and the best estimate of \\(\\sigma^2\\) is \\[\\hat{\\sigma}^2 = \\frac{1}{N-1}\\sum_{i=1}^{N} (y_i-\\bar{y})^2\\; .\\] This means that we estimate \\(\\mu\\) as \\[\\hat{\\mu} = \\frac{\\bar{y}}{\\sqrt{\\varDelta t}} + \\frac{1}{2}\\hat{\\sigma}^2 = \\bar{r}+ \\frac{1}{2}\\hat{\\sigma}^2\\; .\\]\nLet us digress for a moment to discuss the reliability of \\(\\hat{\\mu}\\) as an estimate of \\(\\mu\\). Notice that \\[\\begin{align}\n\\bar{r}\n&= \\frac{\\sum_{i=1}^N \\log S(t_i)-\\log S(t_{i-1})}{N\\varDelta t}\\notag\\\\\n&=   \\frac{\\log S(T)-\\log S(0)}{N\\varDelta t}\\notag\\\\\n& = \\frac{\\log S(T)-\\log S(0)}{T}\\;.\\label{volrbar}\n\\end{align}\\] Therefore the first component \\(\\bar{r}\\) of the estimate of \\(\\mu\\) depends only on the total change in \\(S\\) over the time period. Hence, the reliability of this component cannot depend on how frequently we observe \\(S\\) within the time period \\([0,T]\\). The standard deviation of \\(\\bar{r}\\) in repeated samples is the standard deviation of \\([\\log S(T)-\\log S(0)]/T\\), which is \\(\\sigma/\\sqrt{T}\\). This is likely to be quite large. For example, with \\(\\sigma =0.3\\) and ten years of data (\\(T=10\\)), the standard deviation of \\(\\bar{r}\\) is 9.5%, which means that a 95% confidence interval will be a band of roughly 38%. Given that \\(\\mu\\) itself should be of the order of magnitude of 10%, such a wide confidence interval is useless for all practical purposes.\nFortunately, it is easier to estimate \\(\\sigma\\). We observed in the previous section that the \\(\\hat{\\sigma}^2\\) defined above can be calculated as \\[\\begin{equation}\\label{estimator_sig2}\n\\frac{1}{N-1}\\sum_{i=1}^N y_i^2 - \\frac{N\\bar{y}^2}{N-1}\\;.\n\\end{equation}\\] From the definition \\(\\eqref{volyi}\\) of \\(y_i\\) and equation \\(\\eqref{volrbar}\\), we have \\[\\bar{y} =  \\frac{\\sqrt{\\varDelta t}}{T}[\\log S(T)-\\log S(0)]\\; .\\] Hence, the second term in \\(\\eqref{estimator_sig2}\\) is \\[ \\frac{N}{N-1}\\left(\\frac{\\varDelta t}{T^2}\\right)[\\log S(T)-\\log S(0)]^2\\; .\\] If we observe the stock price sufficiently frequently, so that \\(\\varDelta t\\) is very small, this term will be negligible. In this circumstance, \\(\\hat{\\sigma}^2\\) is approximately \\[\\begin{align}\n\\frac{1}{N-1}\\sum_{i=1}^N y_i^2 &= \\frac{1}{N-1}\\sum_{i=1}^N \\frac{[\\log S(t_i)-\\log S(t_{i-1})]^2}{\\varDelta t}\\\\\n&= \\frac{N}{N-1}\\times \\frac{1}{T}\\times \\sum_{i=1}^N [\\log S(t_i)-\\log S(t_{i-1})]^2 \\label{estimator_sig2_3}\\;.\n\\end{align}\\] If we observe \\(S\\) more and more frequently, letting \\(\\varDelta t \\rightarrow 0\\) and \\(N \\rightarrow \\infty\\), the sum \\[\\sum_{i=1}^N [\\log S(t_i)-\\log S(t_{i-1})]^2\\] will converge with probability one to \\(\\sigma^2T\\), as explained in Sect. [s_quadraticvariation]. This implies that \\(\\hat{\\sigma}^2\\) will converge to \\(\\sigma^2\\). Thus, in theory, we can estimate \\(\\sigma^2\\) with any desired degree of precision by simply observing \\(S\\) sufficiently frequently. This is true no matter how short the overall time period \\([0,T]\\) may be.\nIn practice, this doesn’t work out quite so well. If we observe minute-by-minute data, or we observe each transaction, much of the variation in the price \\(S\\) will be due to bouncing back and forth between the bid price and the ask price. This is not really what we want to estimate, and this source of variation will be much less important if we look at weekly or even daily data. So, there are practical limits to how frequently we should observe \\(S\\). Nevertheless, it is still true that, if \\(\\sigma^2\\) were truly constant, we could estimate it with a very high degree of precision.\nIn fact, we can estimate the volatility of a stock with enough precision to determine that it really isn’t constant! The real problem that we face is to estimate and model a changing volatility.\n\n\n7 Estimating a Changing Volatility\nWithout attempting yet to model how the volatility may change, we can say a few things about how we might estimate a changing volatility. In this and following sections, we will take the observation interval \\(\\varDelta t\\) to be fixed. We assume it is small (say, a day or a week) and focus on the estimate [estimator_sig2_3]. Recall from Sect. [s_statistics] that the reason we are dividing by \\(N-1\\) rather than \\(N\\) is that the sample standard deviation usually underestimates the actual standard deviation, because it uses the sample mean, which will be closer to the points \\(x_i\\) than will be the true mean. However, [estimator_sig2_3] does not employ the sample mean (it replaces it with zero), so there is no reason to make this correction. So, we take as our point of departure the estimate \\[\\frac{1}{T} \\sum_{i=1}^N [\\log S(t_i)-\\log S(t_{i-1})]^2 = \\frac{1}{N}\\sum_{i=1}^N y_i^2 \\; .\\]\nAn obvious response to the volatility changing over time is simply to avoid using data from the distant past. Such data is not likely to be informative about the current value of the volatility. What “distant” should mean in this context is not entirely clear, but, for example, we might want to use only the last 60 observations. If we are using daily data, this would mean that at the end of each day we would add that day’s observation and drop the observation from 61 days past. This leads to a somewhat abruptly varying estimate. For example, a very large movement in the price on a particular day increases the volatility estimate for the next 60 days. On the 61st day, this observation would drop from the sample, leading to an abrupt drop in the estimate (presuming that there is not an equally large change in \\(S\\) on the 61st day). This seems unreasonable. An estimate in which the impact of each observation decays smoothly over time is more attractive.\nWe can construct such an estimate as \\[\\begin{equation}\\label{sig_estimator4}\n\\hat{\\sigma}^2_{i+1} = (1-\\lambda) y_{i}^2 + \\lambda\\hat{\\sigma}^2_{i}\n\\end{equation}\\] for any constant \\(0<\\lambda<1\\). Here, \\(\\hat{\\sigma}^2_{i+1}\\) denotes the estimate of the volatility from date \\(t_{i}\\) to date \\(t_{i+1}\\). The estimate [sig_estimator4] is a weighted average of the estimate \\(\\hat{\\sigma}^2_{i}\\) for the previous time period and the most recently observed squared change \\(y_{i}^2\\). Following the same procedure, the next estimate will be\n\\[\\begin{align*}\n\\hat{\\sigma}^2_{i+2}& = (1-\\lambda) y_{i+1}^2 + \\lambda\\hat{\\sigma}^2_{i+1}\\\\\n&= (1-\\lambda) y_{i+1}^2 + \\lambda(1-\\lambda)  y_{i}^2 + \\lambda^2\\hat{\\sigma}^2_{i}\\;.\n\\end{align*}\\] Likewise, the estimate at the following date will be \\[\\hat{\\sigma}^2_{i+3} = (1-\\lambda) y_{i+2}^2 +\\lambda(1-\\lambda) y_{i+1}^2 + \\lambda^2(1-\\lambda)^2  y_{i}^2 +\\lambda^{3}\\hat{\\sigma}^2_{i}\\; .\\] This demonstrates the declining importance of the squared deviation \\(y_{i}^2\\) for future estimates. At each date, \\(y_{i}^2\\) enters with a weight that is lower by a factor of \\(\\lambda\\), compared to the previous date. If \\(\\lambda\\) is small, the decay in the importance of each squared deviation will be fast. In fact, the formula [sig_estimator4] shows that, if \\(\\lambda\\) is close to zero, the estimate \\(\\hat{\\sigma}_{i+1}^2\\) is approximately equal to the squared deviation \\(y_i^2\\)—previous squared deviations are relatively unimportant. On the other hand, if \\(\\lambda\\) is close to one, the decay will be slow; i.e., the importance of \\(y_i^2\\) for the estimate \\(\\hat{\\sigma}^2_{i+2}\\) will be nearly the same as for \\(\\hat{\\sigma}^2_{i+1}\\), and nearly the same for \\(\\hat{\\sigma}^2_{i+3}\\) as for \\(\\hat{\\sigma}^2_{i+2}\\), etc. This will lead to a smooth (slowly varying) volatility estimate. The slowly varying nature of the estimate in this case is also clear from [sig_estimator4], because it shows that if \\(\\lambda\\) is close to one, then \\(\\hat{\\sigma}^2_{i+1}\\) will be approximately the same as \\(\\hat{\\sigma}^2_{i}\\).\nThis method can also be used to estimate covariances, simply by replacing the squared deviations \\(y_i^2\\) by the product of deviations for two different assets. And, of course, given covariance and variance estimates, we can construct estimates of correlations. To ensure that an estimated correlation is between \\(-1\\) and \\(+1\\), we will need to use the same \\(\\lambda\\) to estimate each of the variances and the covariance. This is the method used by RiskMetrics.2\n\n\n8 GARCH Models\nWe are going to adopt a subtle but important change of perspective now. Instead of considering [sig_estimator4] as simply an estimation procedure, we are going to assume that the actual volatility evolves according to [sig_estimator4], or a generalization thereof. We are also going to reintroduce the expected change in \\(\\log S\\), which we dropped in going from [estimator_sig2] to [estimator_sig2_3]. Specifically, we return to [dlogs], but we operate under the risk-neutral measure, so \\(\\mu=r-q\\), and we have \\[\\begin{equation}\\label{dlogs2}\n\\log S(t_{i+1}) - \\log S(t_i) = \\left(r-q-\\frac{1}{2}\\sigma_{i+1}^2\\right)\\varDelta t + \\sigma_{i+1} \\varDelta B\\;.\n\\end{equation}\\] We assume the volatility \\(\\sigma_{i+1}\\) between dates \\(t_i\\) and \\(t_{i+1}\\) is given by \\[\\begin{equation}\\label{garch}\n\\sigma_{i+1}^2 = a + b y_{i}^2 + c \\sigma_i^2\\;,\n\\end{equation}\\] for some constants \\(a > 0\\), \\(b\\geq 0\\) and \\(c\\geq 0\\), with \\(y_i\\) now defined by \\[y_i = \\frac{\\log S(t_i)-\\log S(t_{i-1})-\\left(r-q-\\frac{1}{2}\\sigma_i^2\\right)\\varDelta t}{\\sqrt{\\varDelta t}}\\; .\\] From \\(\\eqref{dlogs2}\\), applied to the period from \\(t_{i-1}\\) to \\(t_i\\), this implies that \\(y_i\\) is normally distributed with mean zero and variance \\(\\sigma_i^2\\), and of course \\(y_{i+1}\\) has variance \\(\\sigma_{i+1}^2\\), etc.\nUnder these assumptions, the random process \\(\\log S\\) is called a GARCH(1,1) process.3 There are many varieties of GARCH processes that have been proposed in the literature, but we will only consider GARCH(1,1), which is the simplest.\nWe assume \\(b+c<1\\), in which case we can write the variance equation as a generalization of \\(\\eqref{sig_estimator4}\\). Namely, %\\[\\sigma_{i+1}^2 = (1-\\phi)d + \\phi\\left[(1-\\lambda) y_{i}^2 + \\lambda \\sigma^2_{i}\\right]\\; ,\\] \\[\\begin{equation}\\label{garch10}\n\\sigma_{i+1}^2 = \\kappa\\theta + (1-\\kappa)\\left[  (1-\\lambda) y_{i}^2 + \\lambda\\sigma^2_{i}\\right]\\;,\n\\end{equation}\\] where \\(\\lambda=c/(b+c)\\), %\\(\\phi=b+c\\), and \\(d=a/(1-b-c)\\).\n\\(\\kappa = 1-b-c\\), and \\(\\theta=a/(1-b-c)\\). Hence, \\(\\sigma_{i+1}^2\\) is a weighted average with weights \\(\\kappa\\) and \\(1-\\kappa\\), of two parts, one being the constant \\(\\theta\\) and the other being itself a weighted average of \\(y_{i}^2\\) and \\(\\sigma^2_{i}\\). Whatever the variance might be at time \\(t_i\\), the variance of \\(y_j\\) at any date \\(t_j\\) far into the future, computed without knowing the intervening \\(y_{i+1}, y_{i+2},\\ldots\\), will be approximately the constant \\(\\theta\\). The constant \\(\\theta\\) is called the “unconditional variance,” whereas \\(\\sigma_{i}^2\\) is the “conditional variance” of \\(y_i\\).\nTo understand the unconditional variance, it is useful to consider the variance forecasting equation. Specifically, we can calculate \\(E_{t_i} \\left[\\sigma_{i+n}^2\\right]\\), which is the estimate made at date \\(t_i\\) of the variance of \\(y_{i+n}\\); i.e, we estimate the variance without having observed \\(y_{i+1},\\ldots,y_{i+n-1}\\). Note that by definition \\(E_{t_{i}}[y_{i+1}^2]=\\sigma_{i+1}^2\\), so [garch10] implies\n\\[\\begin{align*}\nE_{t_{i}}\\left[\\sigma_{i+2}^2\\right] &= \\kappa\\theta + (1-\\kappa)\\left[  (1-\\lambda) E_{t_{i}}[y_{i+1}^2] + \\lambda\\sigma^2_{i+1}\\right] \\\\\n&= \\kappa\\theta + (1-\\kappa)\\sigma^2_{i+1}\\; .\n\\end{align*}\\] Likewise, \\[E_{t_{i+1}}\\left[\\sigma_{i+3}^2\\right] = \\kappa\\theta + (1-\\kappa)\\sigma^2_{i+2}\\; ,\\] and taking the expectation at date \\(t_i\\) of both sides of this yields \\[\\begin{align*}\nE_{t_{i}}\\left[\\sigma_{i+3}^2\\right] = E_{t_{i}}\\left[E_{t_{i+1}}\\left[\\sigma_{i+3}^2\\right]\\right] &=\\kappa\\theta + (1-\\kappa)E_{t_{i}}\\left[\\sigma_{i+2}^2\\right]\\\\\n&=\\kappa\\theta + (1-\\kappa)\\left[\\kappa\\theta + (1-\\kappa)\\sigma^2_{i+1}\\right]\\\\\n&=\\kappa\\theta[1+(1-\\kappa)] + (1-\\kappa)^2\\sigma^2_{i+1}\\;.\n\\end{align*}\\] This generalizes to \\[E_{t_{i}}\\left[\\sigma_{i+n}^2\\right] = \\kappa\\theta\\left[1+(1-\\kappa)+ \\cdots (1-\\kappa)^{n-2}\\right] + (1-\\kappa)^{n-1}\\sigma^2_{i+1}\\; .\\] Thus, there is decay at rate \\(\\kappa\\) in the importance of the current volatility \\(\\sigma^2_{i+1}\\) for forecasting the future volatility. Furthermore, as \\(n\\rightarrow \\infty\\), the geometric series \\[1+(1-\\kappa)+ \\cdots (1-\\kappa)^{n-2}\\] converges to \\(1/\\kappa\\), so, as \\(n \\rightarrow \\infty\\) we obtain \\[E_{t_{i}}\\left[\\sigma_{i+n}^2\\right] \\rightarrow \\theta\\; .\\] This means that our best estimate of the conditional variance, at some date far in the future, is approximately the unconditional variance \\(\\theta\\).\nThe most interesting feature of the volatility equation is that large returns (in absolute value) lead to an increase in the variance and hence are likely to be followed by more large returns (whether positive or negative). This is the phenomenon of “volatility clustering,” which is quite observable in actual markets. This feature also implies that the distribution of returns will be “fat tailed” (more technically, “leptokurtic”). This means that the probability of extreme returns is higher than under a normal distribution with the same standard deviation.4 It is well documented that daily and weekly returns in most markets have this “fat-tailed” property.\nWe can simulate a path of an asset price that follows a GARCH process and the path of its volatility as follows. The following macro produces three columns of data (with headings), the first column being time, the second the asset price, and the third the volatility.\n\nTo price European options, we need to compute the usual probabilities \\(\\text{prob}^S(S(T)>K)\\) and \\(\\text{prob}^R(S(T) >K)\\). Heston and Nandi [@HN] provide a fast method for computing these probabilities in a GARCH (1,1) model.5 Rather than developing this approach, we will show in Chap. [c_introcomputation] how to apply Monte-Carlo methods.\n\n\n9 Stochastic Volatility Models\nThe volatility is stochastic (random) in a GARCH model, but it is determined by the changes in the stock price. In this section, in contrast, we will consider models in which the volatility depends on a second Brownian motion. The most popular model of this type is the model of Heston [@Heston]. In this model, we have, as usual, where \\(B_v\\) is a Brownian motion under the risk-neutral measure having a constant correlation \\(\\rho\\) with the Brownian motion \\(B_s\\). In this equation, \\(\\kappa\\), \\(\\theta\\) and \\(\\gamma\\) are positive constants. Given the empirical fact that negative return shocks have a bigger impact on future volatility than do positive shocks, one would expect the correlation \\(\\rho\\) to be negative.\nThe term \\(\\kappa (\\theta-v)\\) will be positive when \\(v<\\theta\\) and negative when \\(v>\\theta\\) and hence \\(\\sigma^2=v\\) will tend to drift towards \\(\\theta\\), which, as in the GARCH model, is the long-run or unconditional mean of \\(\\sigma^2\\). Thus, the volatility is said to “mean revert.” The rate at which it drifts towards \\(\\theta\\) is obviously determined by the magnitude of \\(\\kappa\\), also as in the GARCH model.\nThe specification [heston2] implies that the volatility of \\(v\\) approaches zero whenever \\(v\\) approaches zero. In this circumstance, one might expect the drift towards \\(\\theta\\) to dominate the volatility and keep \\(v\\) nonnegative, and this is indeed the case; thus, the definition \\(\\sigma(t) = \\sqrt{v(t)}\\) is possible. Moreover, the parameter \\(\\gamma\\) plays a role here that is similar to the role of \\(1-\\lambda\\) in the GARCH model—the variance of the variance in the GARCH model [garch10] depends on the weight \\(1-\\lambda\\) placed on the scaled return \\(y_i\\), just as the variance of the variance in the stochastic volatility model [heston2] depends on the weight \\(\\gamma\\) placed on \\(\\D B_v\\).\nWe could discretize \\(\\eqref{heston12combined}\\) as: However, even though in the continuous-time model [heston12combined] we always have \\(v(t) \\geq 0\\) and hence can define \\(\\sigma(t)=\\sqrt{v(t)}\\), there is no guarantee that \\(v(t_{i+1})\\) defined by [heston4] will be nonnegative. A simple remedy is to define \\(v(t_{i+1})\\) as the larger of zero and the right-hand side of [heston4]; thus, we will simulate the Heston model as [heston3] and6\nA simple way to simulate the changes \\(\\varDelta B_s\\) and \\(\\varDelta B_v\\) in the two correlated Brownian motions is to generate two independent standard normals \\(z_1\\) and~\\(z_2\\) and take \\[\\varDelta B_s = \\sqrt{\\varDelta t}\\,z \\qquad \\text{and} \\qquad \\varDelta B_v = \\sqrt{\\varDelta t}\\,z^*\\; ,\\] where we define \\[z = z_1 \\qquad \\text{and} \\qquad z^* = \\rho z_1 + \\sqrt{1-\\rho^2}\\,z_2\\; .\\] The random variable \\(z^*\\) is also a standard normal, and the correlation between~\\(z\\) and \\(z^*\\) is~\\(\\rho\\).\n\nTo price European options, we again need to compute \\[\\text{prob}^S(S(T)>K) \\qquad \\text{and} \\qquad \\text{prob}^R(S(T)>K)\\; .\\] The virtue of modelling volatility as in [heston2] is that these probabilities can be computed quite efficiently, as shown by Heston [@Heston].7 There are many other ways in which one could model volatility, but the computations may be more difficult. For example, one could replace [heston2] by\nOne way to implement the GARCH or stochastic volatility model is to imply both the initial volatility \\(\\sigma(0)\\) and the constants \\(\\kappa\\), \\(\\theta\\) and \\(\\lambda\\) or \\(\\kappa\\), \\(\\theta\\), \\(\\gamma\\) and \\(\\rho\\) from observed option prices. These four (or five) constants can be computed by forcing the model prices of four (or five) options to equal the observed market prices. Or, a larger set of prices can be used and the constants can be chosen to minimize the average squared error or some other measure of goodness-of-fit between the model and market prices.\n\n\n10 Smiles and Smirks Again\nAs mentioned before, the GARCH and stochastic volatility models can generate “fat-tailed” distributions for the asset price \\(S(T)\\). Thus, they can be more nearly consistent with the option smiles discussed in Sect. [s_smiles] than is the Black-Scholes model (though it appears that one must include jumps in asset prices as well as stochastic volatility in order to duplicate market prices with an option pricing formula). To understand the relation, let \\(\\sigma_\\text{am}\\) denote the implied volatility from an at-the-money call option, i.e., a call option with strike \\(K=S(0)\\). The characteristic of a smile is that implied volatilities from options of the same maturity with strike prices significantly above and below \\(S(0)\\) are higher than \\(\\sigma_\\text{am}\\).\nA strike price higher than \\(S(0)\\) corresponds to an out-of-the money call option. The high implied volatility means that the market is pricing the right to buy at \\(K>S(0)\\) above the Black-Scholes price computed from the volatility \\(\\sigma_\\text{am}\\); thus, the market must attach a higher probability to stock prices \\(S(T)>S(0)\\) than the volatility \\(\\sigma_\\text{am}\\) would suggest.\nA strike price lower than \\(S(0)\\) corresponds to an in-the-money call option. The put option with the same strike is out of the money. The high implied volatility means that the market is pricing call options above the Black-Scholes price computed from the volatility \\(\\sigma_\\text{am}\\). By put-call parity, the market must also be pricing put options above the Black-Scholes price computed from the volatility \\(\\sigma_\\text{am}\\). The high prices for the rights to buy and sell at \\(K<S(0)\\) means that the market must attach a higher probability to stock prices \\(S(T)<S(0)\\) than the volatility \\(\\sigma_\\text{am}\\) would suggest. In particular, the high price for the right to sell at \\(K<S(0)\\) means a high insurance premium for owners of the asset who seek to insure their positions, which is consistent with a market view that there is a significant probability of a large loss. This can be interpreted as a “crash premium.” Indeed, the implied volatilities at strikes less than \\(S(0)\\) are typically higher than the implied volatilities at strikes above \\(S(0)\\) (giving the smile the appearance of a smirk, as discussed in Sect. [s_smiles]), which is consistent with a larger probability of crashes than of booms (a fatter tail for low returns than for high).\n\n\n11 Hedging and Market Completeness\nThe GARCH model is inherently a discrete-time model. If returns have a GARCH structure at one frequency (e.g., monthly), they will not have a GARCH structure at a different frequency (e.g., weekly). Hence, the return period (monthly, weekly, …) is part of the specification of the model. One interpretation of the model is that the dates \\(t_i\\) at which the variance changes are the only dates at which investors can trade. Under this interpretation, it is impossible to perfectly hedge an option: the gross return \\(S(t_i)/S(t_{i-1})\\) over the interval \\((t_{i-1},t_i)\\) is lognormally distributed, so no portfolio of the stock and riskless asset formed at \\(t_{i-1}\\) and held over the interval \\((t_{i-1},t_i)\\) can perfectly replicate the return of an option over the interval. As discussed in Sect. [s_incomplete], we call a market in which some derivatives cannot be perfectly hedged an “incomplete market.” Thus, the GARCH model is an example of an incomplete market, if investors can only trade at the frequency at which returns have a GARCH structure. However, it is unreasonable to assume that investors can only trade weekly or monthly or even daily.\nAnother interpretation of the GARCH model is that investors can trade continuously and the asset has a constant volatility within each period \\((t_{i-1},t_i)\\). Under this interpretation, the market is complete and options can be delta-hedged. The completeness is a result of the fact that the change \\(\\sigma_{i+1}-\\sigma_i\\) in the volatility at date \\(t_i\\) (recall that \\(\\sigma_i\\) is the volatility over the period \\((t_{i-1},t_i)\\) and \\(\\sigma_{i+1}\\) is the volatility over the period \\((t_{i},t_{i+1})\\)) depends only on \\(\\log S(t_i)\\). Thus, the only random factor in the model that needs to be hedged is, as usual, the underlying asset price. However, this interpretation of the model is also a bit strange. Suppose for example that monthly returns are assumed to have a GARCH structure. Then the model states that the volatility in February will be higher if there is an unusually large return (in absolute value) in January. Suppose there is an unusually large return in the first half of January. Then, intuitively, one would expect the change in the volatility to occur in the second half of January rather than being delayed until February. However, the model specifies that the volatility is constant during each month, hence constant during January in this example.\nThe stochastic volatility model is more straightforward. The market is definitely incomplete. The value of a call option at date \\(t<T\\), where \\(T\\) is the maturity of the option, will depend on the underlying asset price \\(S(t)\\) and the volatility \\(\\sigma(t)\\). Denoting the value by \\(C(t,S(t),\\sigma(t))\\), we have from Itô’s formula that\n\\[\n\\D C(t) = \\text{something}\\;\\D t + \\frac{\\partial C}{\\partial S}\\,\\D S(t) + \\frac{\\partial C}{\\partial \\sigma}\\,\\D \\sigma(t)\\; .\\] A replicating portfolio must have the same dollar change at each date \\(t\\). If we hold \\(\\partial C/\\partial S\\) shares of the underlying asset, then the change in the value of the shares will be \\((\\partial C/\\partial S)\\,\\D S\\). However, there is no way to match the\n\\((\\partial C/\\partial \\sigma)\\,\\D \\sigma\\) term using the underlying asset and the riskless asset.\nThe significance of the market being incomplete is that the value of a derivative asset that cannot be replicated using traded assets (e.g., the underlying and riskless assets) is not uniquely determined by arbitrage considerations. As discussed in Sect. [s_incomplete], one must use “equilibrium” pricing in this circumstance. That is what we have implicitly done in this chapter. By assuming particular dynamics for the volatility under the risk-neutral measure, we have implicitly selected a particular risk-neutral measure from the set of risk-neutral measures that are consistent with the absence of arbitrage.\n\n\nProblems\n\n\n\n\n\n\nFurther discussion can be found in Epps [@Epps]. \\[\\begin{equation}\\label{heston5}\\tag{\\ref{heston2}$'$}\n\\sigma(t) = \\E^{v(t)} \\quad \\text{and} \\quad dv(t) = \\kappa (\\theta-v(t))\\,\\D t + \\lambda \\,\\D B^*\\;.\n\\end{equation}\\] This implies a lognormal volatility and is simpler to simulate than \\(\\eqref{heston2}\\)—because \\(\\E^{v}\\) is well defined even when \\(v\\) is negative—but it is easier to calculate the probabilities \\(\\text{prob}^S(S(T)>K)\\) and \\(\\text{prob}^R(S(T)>K)\\) if we assume \\(\\eqref{heston2}\\).↩︎\nFurther discussion can be found in Epps [@Epps]. \\[\\begin{equation}\\label{heston5}\\tag{\\ref{heston2}$'$}\n\\sigma(t) = \\E^{v(t)} \\quad \\text{and} \\quad dv(t) = \\kappa (\\theta-v(t))\\,\\D t + \\lambda \\,\\D B^*\\;.\n\\end{equation}\\] This implies a lognormal volatility and is simpler to simulate than \\(\\eqref{heston2}\\)—because \\(\\E^{v}\\) is well defined even when \\(v\\) is negative—but it is easier to calculate the probabilities \\(\\text{prob}^S(S(T)>K)\\) and \\(\\text{prob}^R(S(T)>K)\\) if we assume \\(\\eqref{heston2}\\).↩︎\nFurther discussion can be found in Epps [@Epps]. \\[\\begin{equation}\\label{heston5}\\tag{\\ref{heston2}$'$}\n\\sigma(t) = \\E^{v(t)} \\quad \\text{and} \\quad dv(t) = \\kappa (\\theta-v(t))\\,\\D t + \\lambda \\,\\D B^*\\;.\n\\end{equation}\\] This implies a lognormal volatility and is simpler to simulate than \\(\\eqref{heston2}\\)—because \\(\\E^{v}\\) is well defined even when \\(v\\) is negative—but it is easier to calculate the probabilities \\(\\text{prob}^S(S(T)>K)\\) and \\(\\text{prob}^R(S(T)>K)\\) if we assume \\(\\eqref{heston2}\\).↩︎\nFurther discussion can be found in Epps [@Epps]. \\[\\begin{equation}\\label{heston5}\\tag{\\ref{heston2}$'$}\n\\sigma(t) = \\E^{v(t)} \\quad \\text{and} \\quad dv(t) = \\kappa (\\theta-v(t))\\,\\D t + \\lambda \\,\\D B^*\\;.\n\\end{equation}\\] This implies a lognormal volatility and is simpler to simulate than \\(\\eqref{heston2}\\)—because \\(\\E^{v}\\) is well defined even when \\(v\\) is negative—but it is easier to calculate the probabilities \\(\\text{prob}^S(S(T)>K)\\) and \\(\\text{prob}^R(S(T)>K)\\) if we assume \\(\\eqref{heston2}\\).↩︎\nFurther discussion can be found in Epps [@Epps]. \\[\\begin{equation}\\label{heston5}\\tag{\\ref{heston2}$'$}\n\\sigma(t) = \\E^{v(t)} \\quad \\text{and} \\quad dv(t) = \\kappa (\\theta-v(t))\\,\\D t + \\lambda \\,\\D B^*\\;.\n\\end{equation}\\] This implies a lognormal volatility and is simpler to simulate than \\(\\eqref{heston2}\\)—because \\(\\E^{v}\\) is well defined even when \\(v\\) is negative—but it is easier to calculate the probabilities \\(\\text{prob}^S(S(T)>K)\\) and \\(\\text{prob}^R(S(T)>K)\\) if we assume \\(\\eqref{heston2}\\).↩︎\nFurther discussion can be found in Epps [@Epps]. \\[\\begin{equation}\\label{heston5}\\tag{\\ref{heston2}$'$}\n\\sigma(t) = \\E^{v(t)} \\quad \\text{and} \\quad dv(t) = \\kappa (\\theta-v(t))\\,\\D t + \\lambda \\,\\D B^*\\;.\n\\end{equation}\\] This implies a lognormal volatility and is simpler to simulate than \\(\\eqref{heston2}\\)—because \\(\\E^{v}\\) is well defined even when \\(v\\) is negative—but it is easier to calculate the probabilities \\(\\text{prob}^S(S(T)>K)\\) and \\(\\text{prob}^R(S(T)>K)\\) if we assume \\(\\eqref{heston2}\\).↩︎\nFurther discussion can be found in Epps [@Epps]. \\[\\begin{equation}\\label{heston5}\\tag{\\ref{heston2}$'$}\n\\sigma(t) = \\E^{v(t)} \\quad \\text{and} \\quad dv(t) = \\kappa (\\theta-v(t))\\,\\D t + \\lambda \\,\\D B^*\\;.\n\\end{equation}\\] This implies a lognormal volatility and is simpler to simulate than \\(\\eqref{heston2}\\)—because \\(\\E^{v}\\) is well defined even when \\(v\\) is negative—but it is easier to calculate the probabilities \\(\\text{prob}^S(S(T)>K)\\) and \\(\\text{prob}^R(S(T)>K)\\) if we assume \\(\\eqref{heston2}\\).↩︎"
  },
  {
    "objectID": "Chapter5.html",
    "href": "Chapter5.html",
    "title": "5  Introduction to Monte Carlo and Binomial Models",
    "section": "",
    "text": "In this chapter, we will introduce two principal numerical methods for valuing derivative securities: Monte Carlo and binomial models. We will consider two applications: valuing European options in the presence of stochastic volatility with Monte Carlo and valuing American options via binomial models. Additional applications of these methods will be presented in Chap. [c_montecarlo]. Throughout the chapter, we will assume there is a constant risk-free rate. The last section, while quite important, could be skimmed on first reading—the rest of the book does not build upon it."
  },
  {
    "objectID": "Chapter5.html#monte-carlo-valuation-of-a-european-call",
    "href": "Chapter5.html#monte-carlo-valuation-of-a-european-call",
    "title": "5  Introduction to Monte Carlo and Binomial Models",
    "section": "Monte Carlo Valuation of a European Call",
    "text": "Monte Carlo Valuation of a European Call\nWe will illustrate Monte Carlo by valuing a European call under the Black-Scholes assumptions. We will also estimate the delta by each of the methods described in Sects. [s_montecarlogreeks1] and [s_montecarlogreeks2]. Of course, we know the call value and its delta from the Black-Scholes formulas, and they can be used to evaluate the accuracy of the Monte Carlo estimates.\nIn this circumstance, we only need to simulate the price of the underlying at the option maturity rather than the entire path of the price process. To estimate the option delta as a difference ratio \\((C_u-C_d)/(S_u-S_d)\\), we use the perturbations \\(S_u = 1.01S\\) and \\(S_d = 0.99S\\). The inputs are the same as for the Black-Scholes formula plus the sample size~\\(M\\) (the number of stock prices to be simulated)."
  },
  {
    "objectID": "Chapter5.html#monte-carlo-valuation-in-a-garch-model",
    "href": "Chapter5.html#monte-carlo-valuation-in-a-garch-model",
    "title": "5  Introduction to Monte Carlo and Binomial Models",
    "section": "Monte Carlo Valuation in a GARCH Model",
    "text": "Monte Carlo Valuation in a GARCH Model\nFor another example of Monte Carlo, we will value a European call option and estimate its standard error in a GARCH model. The underlying asset price is simulated as in Sect. [s_garch]. After each path of the underlying is simulated, we compute the date–T value of the option. We sum these as the simulations proceed in order to compute the average value. We also sum the squared date– T option values in order to compute the standard error of the estimate of the date–0 option value.\nIn addition to the inputs in the previous function, we input the number \\(N\\) of time periods in the interval \\([0,T]\\)—implying a GARCH model for returns over time intervals of length \\(\\varDelta t = T/N\\) under the risk-neutral measure—and the GARCH parameters \\(\\kappa\\), \\(\\theta\\), and~\\(\\lambda\\). To value a different type of European derivative, we would simply modify the statement"
  },
  {
    "objectID": "Chapter5.html#binomial-valuation-of-european-options",
    "href": "Chapter5.html#binomial-valuation-of-european-options",
    "title": "5  Introduction to Monte Carlo and Binomial Models",
    "section": "Binomial Valuation of European Options",
    "text": "Binomial Valuation of European Options\nThe binomial model for path-independent European options can be implemented as follows. We will use the Cox-Ross-Rubinstein parameters. To value a different type of European option in a binomial model, one would only have to change the formula\nin the following. We first define the binomial parameters and some useful constants, denoting the probability \\(p\\,\\) of an up move as and the probability \\(1-p\\) of a down move as~.\n\nNow we calculate the stock price at the bottom node (the node corresponding to all down moves), the probability of reaching that node, and the first term in the sum \\(\\eqref{binomialsum}\\).\n\nTo calculate the other \\(N\\) terms in the sum, we note that the stock price when there are \\(i\\) up moves is \\(u^2\\) times the stock price with only \\(i-1\\) up moves (because one more up move also means one fewer down move and adding an up and removing a down produces the factor \\(u/d = u^2\\)). Furthermore, the ratio of the probability of \\(i\\) up moves to \\(i-1\\) up moves is \\[\\frac{p^i(1-p)^{N-i}N!/i!(N-i)!}{p^{i-1}(1-p)^{N-i+1}N!/(i-1)!(N-i+1)!} = \\frac{(N-i+1)p}{(1-p)i}\\; .\\] Therefore, as we increase the index \\(i\\) in computing the sum \\(\\eqref{binomialsum}\\), we need to multiply the previous stock price by \\(u^2\\) and multiply the previous probability by \\((N-i+1)p/[(1-p)i]\\). We add the result to each time and, at the end, discount by \\(\\E^{-rT}\\)."
  },
  {
    "objectID": "Chapter5.html#binomial-valuation-of-american-options",
    "href": "Chapter5.html#binomial-valuation-of-american-options",
    "title": "5  Introduction to Monte Carlo and Binomial Models",
    "section": "Binomial Valuation of American Options",
    "text": "Binomial Valuation of American Options\nWe will consider an American put. It may also be optimal to exercise an American call early, if there is a positive dividend yield, and the same procedure can be used for American calls. We begin as in the previous subsection by defining the binomial parameters, some useful constants, and the stock price at the bottom node at the last date. We also compute the put value \\(P(0)\\) at the bottom node at the last date.\n\nNow we loop over the other nodes at the last date, increasing the stock price by a factor of \\(u^2\\) each time as before, and defining the put value as its intrinsic value at maturity.\n\nNow we do the backward induction. Note that a “period” is the time period between successive dates. In a one-period model, there are two dates (the beginning and end) and in general there are \\(N+1\\) dates in an \\(N\\)–period model. We index the dates as \\(i=0,\\ldots,N\\). Since we are backing up in the tree, we step backwards from \\(i=N-1\\) to \\(i=0\\). At each date we start by defining the stock price at the bottom node. At date \\(i\\) there have been \\(i\\) past periods, so the bottom node corresponds to \\(i\\) down moves. The put value at each node is computed as the larger of the discounted expected value and the value of immediate exercise (the intrinsic value). Having already dealt with the bottom node (\\(j=0\\)) we loop over the nodes \\(j=1,\\ldots,i\\) at each date \\(i\\), increasing the stock price by a factor of \\(u^2\\) each time. When we have backed up to date 0, we return the put value \\(P(0)\\), the value at the bottom node, which is the only node at date 0."
  },
  {
    "objectID": "Chapter5.html#binomial-estimation-of-delta-and-gamma",
    "href": "Chapter5.html#binomial-estimation-of-delta-and-gamma",
    "title": "5  Introduction to Monte Carlo and Binomial Models",
    "section": "Binomial Estimation of Delta and Gamma",
    "text": "Binomial Estimation of Delta and Gamma\nWe add two periods to the model and then stop the backward induction at date \\(n=2\\), as described in Sect.~\\(\\ref{s_binomial_greeks}\\)."
  },
  {
    "objectID": "Chapter6.html",
    "href": "Chapter6.html",
    "title": "6  Foreign Exchange",
    "section": "",
    "text": "For concreteness, we will call one currency the “domestic” currency and the other the “foreign” currency.\nLet \\(X(t)\\) denote the exchange rate at time \\(t\\) measured in units of the domestic currency per unit of the foreign currency. Exchange rates can be confusing, because we can look at them from the perspective of either currency, so it may help to keep in mind that \\(X(t)\\) here means the price of a unit of the foreign currency, just as we might consider the price of a stock. When we speak of the “cost” or “value” of something without specifying the currency, it should be understood to be the domestic currency that we mean. If \\(S\\) is the price of a foreign asset, denominated in units of the foreign currency, we can convert it into a domestic asset price simply by multiplying by the exchange rate: \\(X(t)S(t)\\) is the price of the asset, denominated in the domestic currency. For example, if the domestic currency is dollars and the foreign currency is yen, then \\(S\\) is in units of yen and \\(X\\) is units of dollars per unit of yen, so \\(XS\\) is in units of dollars.\nThroughout the chapter, we will maintain assumptions similar to the Black-Scholes assumptions. There is a foreign asset with price \\(S\\) in the foreign currency. It has a constant dividend yield \\(q\\) and a constant volatility \\(\\sigma_s\\). The exchange rate has a constant volatility \\(\\sigma_x\\) and a constant correlation \\(\\rho\\) with the foreign asset. There is a domestic risk-free asset with constant interest rate \\(r\\) and a foreign risk-free asset with constant interest rate \\(r_f\\). The term “risk free” means of course that they are risk-free in their respective currencies. For example, an investment in the foreign risk-free asset is not risk free to a domestic investor, because of exchange rate risk.\n\n7 Currency Options\nA European call option on the exchange rate \\(X\\) pays \\(\\max(0,X(T)-K)\\) at its maturity \\(T\\), where \\(K\\) is the strike price (in domestic currency). The underlying asset should be regarded as the foreign risk-free asset, the domestic price of which fluctuates with the exchange rate. An investment in the foreign risk-free asset grows via reinvestment of interest at rate \\(r_f\\), just as the number of shares held of a stock grows via reinvestment of dividends at rate \\(q\\), if \\(q\\) is its constant dividend yield. In particular, the cost at date 0 of obtaining one unit of foreign currency at date \\(T\\) is the cost at date 0 of \\(\\E^{-r_fT}\\) units of foreign currency, which is \\(\\E^{-r_fT}X(0)\\). Thus, the exchange rate is analogous to a stock price, with the foreign risk-free rate being its dividend yield. This means we can apply the Black-Scholes formulas to value currency calls and puts:\n\n\n8 Options on Foreign Assets Struck in Foreign Currency\nAn option on a foreign asset, with the strike price defined in the foreign currency, can be priced with the Black-Scholes formula, assuming the volatility and dividend yields of the asset are constant and that the (foreign) interest rate is constant. This must be true, because we did not need to specify the currency (dollars, yen, etc.) when deriving the Black-Scholes formula. The value given by the Black-Scholes formula is in the same currency as the asset. To obtain a value in domestic currency for an option on a foreign asset, we simply multiply the Black-Scholes formula by the current exchange rate.\n\n\n9 Options on Foreign Assets Struck in Domestic Currency\nA call option on a foreign asset with domestic strike price \\(K\\) on the foreign asset with price \\(S\\) pays \\[\\max(X(T)S(T)-K,0)\\] at its maturity \\(T\\). The underlying price \\(X(T)S(T)\\) is the value in domestic currency of the portfolio that with starts with \\(\\E^{-qT}\\) units of the asset and reinvests dividends until date \\(T\\). Thus, we can use the Black-Scholes formula to value it, taking the initial asset price to be \\(\\E^{-qT}X(0)S(0)\\) and the dividend rate to be zero (or taking the initial asset price to be \\(X(0)S(0)\\) and the dividend rate to be \\(q\\)). The volatility that should be input into the Black-Scholes formula is the volatility of the domestic currency price \\(\\E^{-q(T-t)}X(t)S(t)\\), which is the same as the volatility of \\(X(t)S(t)\\).\nAccording to the formula \\(\\eqref{volatilityproduct}\\), the volatility of the domestic currency price \\(XS\\) is \\[\\begin{equation}\\label{foreignoptiondomcurrencyvol}\n\\sigma = \\sqrt{\\sigma_x^2+\\sigma_s^2+2\\rho\\sigma_x\\sigma_s}\\;.\n\\end{equation}\\] We conclude: \n\n\n10 Currency Forwards and Futures\nConsider a forward contract maturing at some date \\(T\\) on one unit of foreign currency. In keeping with our convention for options, we will always assume (without loss of generality) that a forward contract is written on a single unit of currency. Let \\(F(t)\\) denote the forward price (in domestic currency) at date \\(t\\leq T\\). This means that someone who purchases (goes long) the contract at date \\(t\\) will receive a unit of foreign currency, worth \\(X(T)\\), at date \\(T\\) and must pay \\(F(t)\\) at date \\(T\\). The value of the long contract at date \\(T\\) is therefore \\(X(T) - F(t)\\). The value at date \\(T\\) of a short contract initiated at date \\(t\\) is the opposite: \\(F(t)-X(T)\\). Naturally, the forward price \\(F(t)\\) is called the “forward exchange rate.” \nThe deepest market for currency is the inter-bank forward market, but futures contracts are also traded on exchanges. The difference between forwards and futures is that futures are “marked to market” daily. Thus, there are daily cash flows with a futures contract, whereas the only cash flows on a forward contract occur at the maturity of the forward. In both cases, there is no cash flow at the time the contract is bought/sold, so its market value is zero. In Sect. [s_futuresforwards] we will discuss futures contracts further. In particular, we will show, assuming continuous marking to market, that if there is a constant (domestic) risk-free rate—or, more generally, if there is an instantaneous risk-free rate that changes over time in a non-random way—then futures prices must equal forward prices in the absence of arbitrage opportunities. Thus, our assumptions in this chapter imply that currency futures prices should equal currency forward prices. We will consider currency forwards in the remainder of this section.\nA forward contract on a traded asset can always be created synthetically simply by buying the asset and holding it, using borrowed money to finance the purchase and to finance any storage costs, assuming the storage costs can be estimated in advance. If the asset pays dividends or generates other positive cash flows, then we do not need to purchase the entire amount covered by the forward contract, because we can accumulate additional amounts of the asset by reinvesting the dividends. There are no storage costs on currency and its dividend yield is equal to the foreign risk-free rate. A forward contract on one unit of foreign currency maturing at date \\(T\\) can be created synthetically at date 0 by buying \\(\\E^{-r_fT}\\) units of foreign currency and borrowing the cost \\(\\E^{-r_fT}X(0)\\) at the domestic risk-free rate. This will lead to ownership of one unit of foreign currency at date \\(T\\) and a liability, including interest, of \\(\\E^{(r-r_f)T}X(0)\\) at date \\(T\\). Thus, the forward price at date 0 must be \\(F(0) = \\E^{(r-r_f)T}X(0)\\); otherwise, one could arbitrage by buying the forward and “selling” the synthetic forward, or vice versa. More generally,\nThe relation [forwardexchangerate] is called “covered interest parity.” The name stems from the fact that an investment in one of the risk-free assets (foreign or domestic) financed by borrowing in the other, with the currency risk hedged (“covered”) by a forward contract, is certain to generate zero value (otherwise, it would be an arbitrage opportunity).1\nSuppose that one has made a commitment to pay a certain amount of foreign currency (perhaps to a foreign manufacturer) at some date in the future. The exchange rate risk that this commitment entails can obviously be hedged by buying the currency forward. However, one can also create a synthetic forward, by buying currency today and investing it in the foreign risk-free asset. The cash outflow can be incurred today, or it can be deferred by borrowing the cost of the currency at the domestic risk-free rate. In the latter case, we have created a true synthetic forward. In either case, we would call this a “money market hedge” because we have utilized the foreign money market (risk-free asset) to create the hedge.\nLater in this chapter we will construct replicating strategies for various contracts using the foreign risk-free asset and the domestic risk-free asset. One can interpret these replicating strategies as money market hedges or synthetic currency forwards. In practice, it will often be more convenient to use actual forwards rather than using the foreign risk-free asset. Using actual currency forwards produces an equivalent (given that we are not considering transaction costs) replicating strategy. Here is, in abstract, the way we convert from money market hedges to hedges using forwards. As we have discussed, \\[\\begin{align*}\n\\text{Long Currency Forward} &= \\text{Long Synthetic Currency Forward} \\\\\n&= \\text{Long Foreign Risk-Free Asset} \\\\\n&\\qquad + \\text{Short Domestic Risk-Free Asset}\\;.\n\\end{align*}\\] Subtracting a short position is the same as adding a long position, so we can rearrange this as \\[\\begin{multline*}\n\\text{Long Currency Forward} + \\text{Long Domestic Risk-Free Asset}\\\\=  \\text{Long Foreign Risk-Free Asset} \\; .\n\\end{multline*}\\] Thus, an investment in the foreign risk-free asset can be replaced in any replicating strategy by long currency forwards and an investment in the domestic risk-free asset.\nTo be more precise about the sizes of the investments, consider replacing a money market hedge with a forward hedge at some date \\(t\\) prior to the maturity of the forward and analyze the replacement per unit of the money market hedge (per unit of foreign currency invested in the foreign risk-free asset). One unit of foreign currency invested in the foreign risk-free asset at date \\(t\\) will grow to \\(\\E^{r_f(T-t)}\\) units by date \\(T\\). Thus, the corresponding forward contract should be on \\(\\E^{r_f(T-t)}\\) units of currency. The value at date \\(t\\) of both sides of the above equation should be the same, and the value of a forward contract at the date of initiation is zero, so the investment in the domestic risk-free asset should be the domestic currency equivalent of one unit of foreign currency, which is the exchange rate \\(X(t)\\). Thus, we have To check this, consider holding the portfolios until date \\(T\\). As explained in the first paragraph of this section, the currency forwards will have value \\(\\E^{r_f(T-t)}[X(T)-F(t)]\\), which by covered interest parity is \\(\\E^{r_f(T-t)}X(T)-\\E^{r(T-t)}X(t)\\). When we include the long position in the domestic risk-free asset with accumulated interest, the value at date \\(T\\) of the portfolio on the left-hand side of \\(\\eqref{mmhedge}\\) is \\(\\E^{r_f(T-t)}X(T)\\). On the other, the right-hand side of \\(\\eqref{mmhedge}\\) with accumulated interest will consist of \\(\\E^{r_f(T-t)}\\) units of foreign currency, also worth \\(\\E^{r_f(T-t)}X(T)\\).\n\n\n11 Quantos\nA “quanto” is a derivative written on a foreign asset the value of which is converted to domestic currency at a fixed exchange rate. In other words, the contract pays in the domestic currency and the exchange rate is part of the contract. Such contracts are very useful for investors who want to bet on foreign assets but do not want exposure to exchange rate risk. Such an investor could simply buy the foreign asset and hedge the currency risk by selling currency futures or forwards, but doing so is a bit tricky because the amount of currency that needs to be hedged depends on how well the foreign asset does. Thus, quantos can be desirable contracts. Of course, when an investor purchases a quanto, the problem of hedging the exchange rate risk has simply been transferred to the seller. In this and the following section, we will see how to value and how to replicate a contract that pays the price of a foreign asset at some future date \\(T\\) with the price translated into the domestic currency at a fixed exchange rate. The replicating strategy is the strategy that would be followed by the seller (or by an investor who wants to create a synthetic on his own). Specifically, in this section we will determine the value at date 0 (in domestic currency) of a contract that pays \\(\\bar{X}S(T)\\) at date \\(T\\), where \\(\\bar{X}\\) is a fixed exchange rate. Later in the chapter, we will consider quanto forwards and quanto options.\nIn addition to being practically useful, this contract is an excellent example for demonstrating the methodology of pricing and hedging. The best way to proceed in problems of this general type is to first value the contract and then calculate the replicating strategy.2 As discussed in Sect. [s_introoptions], valuation is simplified by choosing a numeraire that will cancel the randomness in the contract payoff. Our numeraire must be a non-dividend-paying (domestic) asset price, so we can choose \\(Z(t)=X(t)\\E^{qt}S(t)\\) to be the numeraire asset price. This is the value in the domestic currency of a strategy that is long one unit of the foreign asset at date 0 and which reinvests the dividends of the asset into new shares. As we will see immediately, using it as numeraire introduces randomness into the payoff through the exchange rate, and that poses some complications. Applying our fundamental pricing formula [formula], the value of the contract is\n\\[\\begin{align}\nZ(0) E^Z \\left[\\frac{\\bar{X}S(T)}{Z(T)}\\right] &= \\E^{-qT}X(0)S(0)E^Z \\left[\\frac{\\bar{X}S(T)}{X(T)S(T)}\\right]\\notag\\\\\n&= \\E^{-qT}\\bar{X}S(0)E^Z \\left[\\frac{X(0)}{X(T)}\\right]\\;.\\label{quanto}\n\\end{align}\\]\nNow we need to evaluate \\(E^Z[X(0)/X(T)]\\), which is the expected growth of \\(1/X\\) when \\(Z\\) is used as the numeraire. We will show that \\[\\begin{equation}\\label{growthreciprocalX}\nE^Z \\left[\\frac{X(0)}{X(T)}\\right] = \\exp\\left\\{(r_f - r-\\rho\\sigma_x\\sigma_s)T\\right\\}\\;.\n\\end{equation}\\] This implies: \n\n\n12 Replicating Quantos\nThe assets we will use to replicate the payoff \\(\\bar{X}S(T)\\) are the foreign asset with price \\(S\\), the foreign risk-free asset, and the domestic risk-free asset. At the end of this section, we will explain how to replace the foreign risk-free asset with currency forwards, as discussed in Sect. [s_currencyforwards]. Before beginning the calculations, we can make the following intuitive observations:\n\nThe payoff \\(\\bar{X}S(T)\\) has exposure to the foreign asset price \\(S\\), so the replicating portfolio must be long the foreign asset.\nThe payoff \\(\\bar{X}S(T)\\) has no exposure to the exchange rate, so the replicating portfolio cannot have any exposure to the exchange rate either. Thus, the long position in the foreign risky asset must be offset by an equal short position in the foreign risk-free asset.\nAs a result of the previous observation, the value of the replicating portfolio, displayed in [quanto1], will equal the investment in the domestic risk-free asset.\n\nConsequently, our real task is to compute the number of shares of the foreign asset that should be held, the remainder of the replicating portfolio being thereby determined.\nThe value of the replicating portfolio at any date \\(t\\leq T\\) must be the value at date \\(t\\) of receiving the payoff \\(\\bar{X}S(T)\\) at date \\(T\\). We have calculated this value at date 0, and, clearly, the formula \\(\\eqref{quanto1}\\) applies to general dates \\(t\\), when we replace the time \\(T\\) to maturity by \\(T-t\\) and the asset price \\(S(0)\\) at the date of valuation by \\(S(t)\\). That is, the value of the portfolio at any date \\(t\\leq T\\) must be \\(V(t)\\) defined as \\[\\begin{equation}\\label{quanto2}\nV(t) = \\exp\\left\\{(r_f - r-q-\\rho\\sigma_x\\sigma_s)(T-t)\\right\\}\\bar{X}S(t)\\;.\n\\end{equation}\\] As just noted, we will need to invest this amount in the domestic risk-free asset at date~\\(t\\). What remains to be done is to calculate the size of the long position in the foreign risky asset and the offsetting short position in the foreign risk-free asset.\nFrom Itô’s formula, we have \\[\\begin{equation}\\label{quanto21}\n\\frac{\\D V}{V} = -(r_f - r-q-\\rho\\sigma_x\\sigma_s)\\,\\D t + \\frac{\\D S}{S}\\;.\n\\end{equation}\\] Equivalently, \\[\\begin{equation}\\label{quanto5}\n\\D V =(r+q-r_f+\\rho\\sigma_x\\sigma_s)V\\,\\D t + V\\frac{\\D S}{S}\\;.\n\\end{equation}\\] On the other hand, consider a strategy that invests \\(a(t)\\) units of the domestic currency in the foreign asset, \\(b(t)\\) units of the domestic currency in the foreign risk-free asset, and \\(c(t)\\) units of the domestic currency in the domestic risk-free asset. Let \\(W=a+b+c\\) denote the value of this portfolio. The return on the foreign asset, per unit of domestic currency invested, is \\[\\begin{align}\n\\frac{\\D (X\\E^{qt}S)}{X\\E^{qt}S} &= q\\,\\D t+\\frac{\\D X}{X} + \\frac{\\D S}{S} + \\left(\\frac{\\D X}{X} \\right)\\left( \\frac{\\D S}{S}\\right) \\notag\\\\\n&= (q+\\rho\\sigma_x\\sigma_s)\\,\\D t+\\frac{\\D X}{X} + \\frac{\\D S}{S}\\;.\\label{quanto200}\n\\end{align}\\] Similarly, the rate of return on the foreign risk-free asset is \\[\\begin{equation}\\label{quanto300}\n\\frac{\\D (\\E^{r_ft}X)}{\\E^{r_ft}X} = r_f\\,\\D t + \\frac{\\D X}{X}\\;,\n\\end{equation}\\] and of course the rate of return on the domestic risk-free asset is \\(r\\,\\D t\\). Therefore, the change in the value of the portfolio will be \\[\\begin{align}\n\\D W &= a\\left[(q+\\rho\\sigma_x\\sigma_s)\\,\\D t+\\frac{\\D X}{X} + \\frac{\\D S}{S}\\right] + b\\left[r_f\\,\\D t + \\frac{\\D X}{X}\\right] + cr\\,\\D t\\notag\\\\\n&=( aq+a\\rho\\sigma_x\\sigma_s + br_f+cr)\\,\\D t +  (a+b)\\frac{\\D X}{X} +a \\frac{\\D S}{S}\\; .\\label{quanto6}\n\\end{align}\\] The change \\(\\eqref{quanto6}\\) of the portfolio value will match the change \\(\\eqref{quanto5}\\) of \\(V\\) if and only if \\[\\begin{equation}\\label{quanto7}\na= V, \\qquad b= -V, \\qquad c = V\\;.\n\\end{equation}\\] This implies: \nFrom our analysis at the end of Sect. [s_currencyforwards], we know that the foreign risk-free asset in this replicating strategy can be replaced by currency forwards. The strategy here involves borrowing at the foreign risk-free rate, so we should replace “long” by “short” in [mmhedge]. Borrowing \\(V(t)\\) units of domestic currency means borrowing \\(V(t)/X(t)\\) units of the foreign currency. Therefore, [mmhedge] gives us: \nAt the beginning of the previous section, we noted that an investor who wants to bet on a foreign asset but does not want the exchange rate exposure could simply buy the asset and sell the currency forward. This shows how much of the asset he should buy and how much currency he should sell forward.\nIt is important to note that this strategy involves continuously buying and selling forwards, just as it involves continuously trading the foreign asset. Buying at date \\(t\\) a forward contract sold at date \\(s<t\\) cancels the delivery obligation on the contract sold at \\(s\\) and leaves a cash flow of \\(F(s)-F(t)\\) to be paid/received at the maturity date \\(T\\). Therefore, the strategy accumulates a liability or asset, depending on the direction the forward price moves, to be received at \\(T\\). On the other hand, maintaining an investment of \\(V(t)\\) in the foreign asset will generate cash flows as the asset is sold or purchased over time. As [quanto4] shows, whether it is sold or purchased depends on the direction the exchange rate moves. These cash flows should be invested or borrowed at the domestic risk-free rate. Thus, there is a liability or asset to be received at date \\(T\\) that is not shown in the boxed statement immediately above, and there is an investment or liability in the domestic risk-free asset that is not shown. It can be demonstrated that these cancel each other: if profits are made from trading forwards, then they (more precisely, their present value) will be consumed by the cost of buying the foreign asset, and vice versa. Hedging with forwards (and with futures) is considered in more detail in Sect. [s_hedgingforwards].\n\n\n13 Quanto Forwards\nIn this section, we consider a contract similar to that of the previous section, except that it is a pure forward, meaning that the payment for the contract occurs at date \\(T\\). We maintain all of the assumptions of the previous section. The payment at date \\(T\\) is in domestic currency, and we define the quanto forward price in units of domestic currency. Specifically, a long quanto forward contract, initiated at date \\(t\\) and maturing at date \\(T\\) and initiated at the forward price \\(F^*(t)\\) will pay\n\\[\\bar{X}S(T)-F^*(t)\\] at date \\(T\\). The forward price \\(F^*(t)\\) should be the price that makes this contract have a value of 0 at date \\(t\\).\nWe already know how to replicate the underlying payoff \\(\\bar{X}S(T)\\) of the forward contract at the cost \\(V(t)\\) defined in [quanto2]. Thus, the synthetic quanto forward is to purchase the replicating strategy and to borrow the cost \\(V(t)\\) at the domestic risk-free rate. This leads to the liability \\(\\E^{r(T-t)}V(t)\\) at date \\(T\\). Therefore, we have:\nNotice that borrowing \\(V\\) in domestic currency to finance the replicating strategy of the previous section — i.e., the domestic currency investments described in [quanto7] — means eliminating the domestic risk-free investment \\(c=V\\) required in the previous section. The replicating strategy for the quanto forward is simply to invest \\(V\\) in the foreign asset and to finance the investment entirely by borrowing at the foreign risk-free rate. As in the previous section, borrowing at the foreign risk-free rate can be replaced by borrowing at the domestic risk-free rate and selling currency forwards.\n\n\n14 Quanto Options\nConsider now a European call option on a foreign asset, with strike \\(K\\) set in the domestic currency and the value of the foreign asset being converted to domestic currency at a fixed exchange rate \\(\\bar{X}\\). This is called a “quanto call.” We maintain all the assumptions of the previous two sections.\nThe value of the quanto call at maturity is \\(\\max(0, \\bar{X}S(T)-K)\\). To value this, we make use of what we learned in Sect. [s_quantos]. Namely, the portfolio with value \\(V\\) defined in [quanto2] replicates the payoff \\(\\bar{X}S(T)\\): in each state of the world, \\(V(T) = \\bar{X}S(T)\\). Therefore, the quanto call is equivalent to a standard European call on the portfolio with domestic currency price \\(V\\). The value is therefore given by the Black-Scholes formula. From the formula [quanto21] for the dynamics of \\(V\\), we see that the volatility of \\(V\\) is the same as that of \\(S\\); therefore, we should input \\(\\sigma_s\\) as the volatility in the Black-Scholes formula. Furthermore, the portfolio \\(V\\) is non-dividend-paying (it is the value of a claim to \\(\\bar{X}S(T)\\) at date \\(T\\) with no interim cash flows), so the dividend rate in the Black-Scholes formula should be zero. Thus, we have:\nNotice that this is simply the Black-Scholes call option formula with inputs \\(V(0)=\\) initial asset price, \\(K=\\) exercise price, \\(r=\\) interest rate, \\(\\sigma_s=\\) volatility, \\(0=\\) dividend yield, and \\(T=\\) time to maturity.\nWe can hedge a written quanto call the same way we hedge a written ordinary call: we buy delta shares of the underlying and borrow the difference between the cost of the delta shares and the option value. However, for the quanto call, the underlying should be regarded as the portfolio with value \\(V\\) described in Sect. [s_quantos]. This portfolio consists of investing \\(V(0)\\) units of domestic currency in the foreign asset, borrowing the same amount at the foreign risk-free rate, and investing \\(V(0)\\) units of domestic currency in the domestic risk-free asset. The delta of the call is \\(\\N(d_1)\\), so the hedge consists of investing \\(\\N(d_1)V(0)\\) units of domestic currency in the foreign asset, borrowing the same amount at the foreign risk-free rate, and investing \\(\\N(d_1)V(0)\\) in the domestic risk-free asset. The difference between the cost of this portfolio and the value of the option is \\[\\N(d_1)V(0) - [V(0)\\N(d_1) - \\E^{-rT}K\\N(d_2)] = \\E^{-rT}K\\N(d_2)\\; .\\] This amount is to be borrowed at the domestic risk-free rate. Thus, the net investment in the domestic risk-free asset is \\[\\N(d_1)V(0) - \\E^{-rT}K\\N(d_2)\\; ,\\] which is just the value of the option. To summarize: \nAs in Sect. [s_replicatingquantos], borrowing \\(\\N(d_1)V(0)\\) units of domestic currency at the foreign risk-free rate can be replaced by borrowing the same amount at the domestic risk-free rate and selling \\(\\E^{r_fT}\\N(d_1)V(0)/X(0)\\) currency forwards. This results in:\n\n\n15 Return Swaps\nThere are many types and applications of return swaps, but here is one important example that involves the concepts discussed in this chapter. Suppose an investor wants to receive at date \\(T\\) the difference in the rates of return of two assets that are denominated in different currencies. The return will be calculated on a given “notional principal.” For example, an investor may want to receive at the end of a year the Nikkei rate of return minus the rate of return on the S&P 500, calculated on a $1 million notional principal. If the Nikkei earns 15% over the year and the S&P earns 10%, then the payment to the investor is 5% of $1 million. If the reverse happens—the Nikkei earns 10% and the S&P earns 15%—then the investor must pay 5% of $1 million to the counterparty.\nTo model this, let \\(S_f\\) denote the price of a foreign asset and \\(S_d\\) the price of a domestic asset. Assume they have constant dividend yields \\(q_f\\) and \\(q_d\\). If the returns are calculated excluding dividends, as is likely to be the case, then the payment to the investor is \\[\\left(\\frac{S_f(T)-S_f(0)}{S_f(0)} - \\frac{S_d(T)-S_d(0)}{S_d(0)}\\right)  A = \\left(\\frac{S_f(T)}{S_f(0)} - \\frac{S_d(T)}{S_d(0)}\\right)  A\\; ,\\] where \\(A\\) denotes the notional principal. Of course, the investor may want the reverse swap, and we consider this particular case only for concreteness.\nThe swap may have nonzero market value at date 0, which means that some payment will have to be made upfront. To eliminate this, we can add a “swap spread” into the contract, affecting the cash flow at date \\(T\\). This is a constant number \\(a\\) (which may be positive or negative), and including it changes the payment to the investor to \\[\\begin{equation}\\label{returnswap1}\n\\left(a+\\frac{S_f(T)}{S_f(0)} - \\frac{S_d(T)}{S_d(0)}\\right)  A\\;.\n\\end{equation}\\] The question we will address here is: what is the “fair” swap spread; i.e., for what number \\(a\\) does the cash flow [returnswap1] have zero market value at date 0?\nIf the value is zero, then it is zero for any notional principal \\(A\\), so we can conveniently take \\(A=1\\). The cash flow consists of three pieces, all of which are to be received/paid at date \\(T\\): the constant \\(a\\), the gross return on the foreign asset, and the gross return on the domestic asset. The value at date 0 of receiving \\(a\\) units of domestic currency is obviously \\(\\E^{-rT}a\\). As we have observed several times before, the value at date 0 of receivin \\(S_d(T)\\) units of domestic currency at date \\(T\\) is \\(\\E^{-q_d t}S_d(0)\\), because this is the cost of enough shares to accumulate to one share at date \\(T\\) via reinvestment of dividends. Therefore, the value at date 0 of receiving \\(S_d(T)/S_d(0)\\) at date \\(T\\) is \\(\\E^{-q_dT}S_d(0)/S_d(0) = \\E^{-q_dT}\\).\nWhat remains is to calculate the value of receiving \\(S_f(T)/S_f(0)\\) units of domestic currency at date \\(T\\). We can do this by interpreting \\(1/S_f(0)\\) as the fixed exchange rate \\(\\bar{X}\\) in the definition of a quanto. We need to assume as before that the foreign asset price \\(S_f\\) and the exchange rate have constant volatilities and a constant correlation. Denoting the volatilities by \\(\\sigma_s\\) and \\(\\sigma_x\\) and the correlation by \\(\\rho\\) as before, equation~\\(\\eqref{quanto1}\\) shows that the value of receiving \\(\\bar{X}S_f(T) = S_f(T)/S_f(0)\\) units of domestic currency at date \\(T\\) is \\[\\exp\\left\\{(r_f - r-q_f-\\rho\\sigma_x\\sigma_s)T\\right\\}\\; .\\] Adding up the pieces, the value at date 0 of the cash flow \\(\\eqref{returnswap1}\\) (with \\(A=1\\)) is \\[\\E^{-rT}a + \\exp\\left\\{(r_f - r-q_f-\\rho\\sigma_x\\sigma_s)T\\right\\} - \\E^{-q_dT}\\; ,\\] so we conclude: # Uncovered Interest Parity in the Risk-Neutral Probabilities\nWhen we use numerical methods to value American and path-dependent options, as in Chap. [c_introcomputation], we typically focus on the dynamics of asset prices under the risk-neutral measure. To apply these results to currency options or options on foreign assets, we need to know the dynamics of the exchange rate under the risk-neutral measure. Because we can view the exchange rate as the domestic price of an asset with the foreign risk-free rate \\(r_f\\) being its dividend yield, we have already calculated these dynamics in equation [riskneutral11] of Sect. [s_girsanov]. The result is: \nThis equation has an interesting interpretation in terms of “uncovered interest parity,” which is the theory that differences in interest rates across currencies will be offset on average by appreciation/depreciation of the currencies. In other words, it is the theory that the strategy of borrowing in low-interest-rate currencies to invest in high-interest-rate currencies will not earn money on average because of depreciation of the high-interest-rate currency relative to the low-interest-rate currency. It is well known that this theory is not always true in reality. However, equation [uncoveredparity] shows that it is true when we calculate expectations using the risk-neutral measure.\nTo see the interpretation of equation [uncoveredparity] as uncovered interest parity, suppose that the foreign interest rate \\(r_f\\) is lower than the domestic rate \\(r\\). Then one may be tempted to borrow at the foreign rate and invest at the domestic rate. This would create a short position in the foreign currency. Equation [uncoveredparity] states that the exchange rate is expected (under the risk-neutral measure) to appreciate at the rate \\(r-r_f\\); thus, repayment of the foreign currency will be more expensive in terms of domestic currency, offsetting the interest rate differential.\n\n\nProblems\n\n\n\n\n\n\nWe did the same thing in Chap. [c_blackscholes]: we first derived the Black-Scholes formula and then found the replicating strategy (delta hedge) by differentiating the formula.↩︎\nWe did the same thing in Chap. [c_blackscholes]: we first derived the Black-Scholes formula and then found the replicating strategy (delta hedge) by differentiating the formula.↩︎"
  },
  {
    "objectID": "Chapter7.html",
    "href": "Chapter7.html",
    "title": "7  Forward, Futures, and Exchange Options",
    "section": "",
    "text": "Unless explicitly stated otherwise, we will not assume in this chapter the existence of a risk-free asset (or even an instantaneously risk-free asset as described in Sect. [s_continuouscompounding]). This implies that the market is incomplete and there are many risk-neutral measures. Nevertheless, we can price exchange options, forward and futures options, and stock options by arbitrage. Understanding this issue is not essential for deriving the formulas in this chapter—as mentioned, they will all be derived from the Black-Scholes formula—but the issue is nonetheless important. It is discussed in the final section of the chapter.\nNaturally, all of the option-pricing formulas discussed in this chapter are quite similar. The similarity can be seen from the Black-Scholes formula for a call option, which we can write as follows (replacing \\(d_1\\) by \\(x\\) and \\(d_2\\) by \\(y\\)): Note that \\(\\E^{-qT}S(0)\\) is the present value at date 0 of the stock that would be acquired if the option is exercised, because it is the cost that one must pay at date 0 to have one share of the stock at date \\(T\\) with no withdrawal of dividends in the interim. Obviously, \\(\\E^{-rT}K\\) is the present value of the cash that is paid if the option is exercised. Moreover, \\(x\\) is equal to \\[\\frac{\\log \\left(\\frac{\\E^{-qT}S(0)}{\\E^{-rT}K} \\right)+ \\frac{1}{2}\\sigma^2T}{\\sigma\\sqrt{T}}\\; ,\\] and the logarithm in the numerator is of the ratio of present values. All of the option pricing formulas in this chapter have the same form: the present value of the asset to be acquired multiplied by \\(\\N(x)\\) minus the present value of the asset to be delivered multiplied by \\(\\N(y)\\). Moreover in each case \\(x\\) is the logarithm of the ratio of present values plus one-half \\(\\sigma^2T\\) all divided by \\(\\sigma\\sqrt{T}\\), and in each case \\(y\\) is defined by \\(\\eqref{d2again}\\). Notice that the Black-Scholes put option formula has this structure also. The Black-Scholes put option formula is This similarity is discussed further in Sect.~\\(\\ref{s_matlabimplementations}\\), where the pricing formulas are implemented in VBA.\n\n8 Margrabe’s Formula\nConsider two assets with prices \\(S_1\\) and \\(S_2\\) and a European option to exchange asset 2 for asset 1 at date \\(T\\). The value of the option at maturity is \\[\\max(0,S_1(T)-S_2(T))\\; .\\] Note that there is no real difference between a put and a call: the exchange option can be viewed as a call on the first asset with random strike \\(S_2(T)\\) or as a put on the second asset with random strike \\(S_1(T)\\).\nAssume the assets pay constant dividend yields \\(q_i\\) and assume the prices satisfy \\[\\frac{\\D S_i}{S_i} = \\mu_i\\,\\D t+\\sigma_i\\,\\D B_i\\] where each \\(B_i\\) is a Brownian motion under the actual probability measure. As before, the drifts \\(\\mu_i\\) can be quite general random processes. We also allow the volatilities \\(\\sigma_i\\) and the correlation \\(\\rho\\) of the Brownian motions to be random processes; however, we make the assumption that \\(\\sigma\\) defined as \\[\\begin{equation}\\label{margrabesigma}\n\\sigma = \\sqrt{\\sigma_1^2 + \\sigma_2^2 - 2\\rho\\sigma_1\\sigma_2}\n\\end{equation}\\] is a constant. As shown in \\(\\eqref{volatilityratio}\\), \\(\\sigma\\) is the volatility of \\(S_1/S_2\\) (and also \\(S_2/S_1\\)). So, the assumption we are making is that the volatility of the ratio of the asset prices is constant. In Sect.~\\(\\ref{s_volatility}\\), we will relax this assumption to allow \\(\\sigma\\) to be time-varying (though still non-random).\nThe following is the formula of Margrabe [@Margrabe]:\nMargrabe’s derivation is a very simple argument based on the Black-Scholes formula. We noted in Chap. [c_foreignexchange] that the Black-Scholes formula does not depend on the currency—if the underlying asset and risk-free asset are dollar denominated, the formula gives the dollar value of an option; if they are yen denominated, the formula gives the yen value of an option, etc. So we can take the “currency” to be units of the second asset; i.e., we will use the second asset as numeraire. With this numeraire, the value of the first asset is \\(S_1/S_2\\). The value of the exchange option at maturity is \\[\\max(0,S_1(T)-S_2(T)) = S_2(T)\\max\\left(0,\\frac{S_1(T)}{S_2(T)}-1\\right)\\; .\\] This is the value in the natural currency (e.g., dollars). The value using the second asset as numeraire is obtained by dividing by \\(S_2(T)\\), so it is \\[\\max\\left(0,\\frac{S_1(T)}{S_2(T)}-1\\right)\\; .\\] This is the value of a standard call option, the underlying being the first asset measured in units of the second. We can apply the Black-Scholes formula to obtain the value of the option (in units of the second asset) at date 0. Multiplying this value by \\(S_2(0)\\) will give the option value in the natural currency.\nThe risk-free rate when the second asset is the numeraire is the dividend yield on the second asset \\(q_2\\). To see this, note that the price of the second asset is always equal to one; moreover, an investment in the second asset will accumulate at the rate \\(q_2\\) via reinvestment of dividends. Therefore, \\(q_2\\) is a risk-free rate of return.\nThe dividend yield on the first asset remains \\(q_1\\). To see this, note that the dividend paid in the natural currency is \\(q_1S_1(t)\\,\\D t\\) in an instant \\(\\D t\\) and the value of this dividend using the second asset as numeraire is \\([q_1S_1(t)/S_2(t)]\\,\\D t\\), which is the fraction \\(q_1\\,\\D t\\) of the value \\(S_1(t)/S_2(t)\\) of the first asset using the second asset as numeraire.\nThe volatility of the first asset using the second as numeraire is the volatility of the ratio \\(S_1(t)/S_2(t)\\), which is \\(\\sigma\\) defined in [margrabesigma]. Applying the Black-Scholes formula with these inputs yields Margrabe’s formula directly.1\n\n\n9 Black’s Formula\nBlack [@Black] gives formulas for the values of options on futures contracts when interest rates are deterministic (i.e., non-random). It is well known (and we will establish this in Sect. [s_futuresforwards]) that, when interest rates are deterministic, futures prices should equal forward prices, so Black’s formulas also yield formulas for the values of options on forward contracts when interest rates are deterministic. However, the formulas for options on forwards are valid more generally (even when interest rates vary randomly) and now a mention of Black’s formulas is more likely to be referring to the formulas for options on forwards, instead of the formulas for options on futures. In any case, we will start with the formulas for options on forwards and then in Sect. [s_futuresoptions] derive the formulas for options on futures when interest rates are deterministic.\nWe consider a forward contract that matures at some date \\(T'\\) and a call or put option on the forward that matures at \\(T \\leq T'\\). The meaning of a call option on a forward is that exercise of the call creates a long position in the forward contract with forward price equal to the strike price of the option. The long forward contract means that the investor will receive the underlying asset at \\(T'\\) and pay the forward price (the strike of the option) at \\(T'\\). Thus, the strike price is not paid at the date of exercise but instead is paid when the underlying asset is delivered. Symmetrically, the exercise of a put creates a short position in the forward contract with forward price equal to the strike of the put, which means that the exerciser must deliver the underlying at \\(T'\\) and will receive the strike price at \\(T'\\).\nWe will denote the market forward price by \\(F(t)\\). We assume the forward price satisfies \\[\\begin{equation}\\label{dforward}\n\\frac{\\D F}{F} = \\mu\\,\\D t + \\sigma\\,\\D B\\;,\n\\end{equation}\\] where \\(B\\) is a Brownian motion. As before, \\(\\mu\\) can be a quite general random process. We will assume in this section that the volatility \\(\\sigma\\) is a constant and generalize to a time-varying (but non-random) volatility in Sect. [s_volatility]. In Sect. [s_merton], we will discuss the relations of the forward price and its volatility to the price and volatility of the underlying.\nBlack’s formulas are particularly useful when interest rates are assumed to be random, as we will see in Part [p_fixedincome] of the book when we study fixed income derivatives. Therefore, we do not assume here that there is a constant risk-free rate. Instead we will assume that there is a “discount bond” that pays $1 at date \\(T'\\). It is called a “discount bond” because its price is the appropriate discount factor for computing the present value of nonrandom cash flows at date \\(T'\\). Such a bond is also called a “zero coupon” bond because it does not pay any cash flows until \\(T'\\), when it pays its face value (which we take simply for convenience to be $1). We will let \\(P(t,T')\\) denote the price of the bond at date \\(t\\).2\nBlack’s formulas are: \nBlack’s formulas are a simple consequence of Margrabe’s formula. To see this, we first need to describe the value of an option on a forward at the maturity date \\(T\\) of the option. Consider a call option. Exercise of the call results in a long forward position with forward price \\(K\\). The value of the long forward is given by its market price \\(F(T)\\), but we must keep in mind that the forward price is not paid until the underlying is delivered at date \\(T'\\). So suppose that you exercise the call and then sell a forward contract at the market forward price \\(F(T)\\). The delivery/receipt obligations of the long and short forwards cancel, leaving you with the obligation to pay \\(K\\) dollars at date \\(T'\\) and with an asset of \\(F(T)\\) dollars to be received at date \\(T'\\). The value of the net cash flow at date \\(T\\) is \\(P(T,T')[F(T)-K]\\). This is the value if exercised, so the value of the call at date \\(T\\) is\n\\[\\begin{equation}\\label{blackcallexchange1}\n\\max\\big(0, P(T,T')[F(T)-K]\\big) = \\max\\big(0,P(T,T')F(T)-P(T,T')K\\big)\\;.\\end{equation}\\] We can write this as \\[\\begin{equation}\\label{blackcallexchange2}\n\\max(0,S_1(T)-S_2(T))\n\\end{equation}\\] if we define \\[\\begin{equation}\\label{blackexchange}\nS_1(t) = P(t,T')F(t) \\quad \\text{and} \\quad S_2(t) = P(t,T')K\n\\end{equation}\\] for \\(t=T\\) (and more generally for \\(t \\leq T\\)). Thus, the value at maturity of a call option on a forward is the value at maturity of an option to exchange the two assets with prices \\(S_1\\) and \\(S_2\\) (we will establish in a moment that \\(S_1\\) and \\(S_2\\) are actually asset prices). It follows that the value at date 0 of a call option on a forward is the value at date 0 of an option to exchange the two assets.\nNow consider a put option on a forward. Exercising the put and unwinding the short forward position by buying a forward at the market price \\(F(T)\\) will leave one with a net cash flow of \\(K-F(T)\\) to be received at the maturity date \\(T'\\) of the forward. Therefore the value of the put at maturity is \\[\\begin{equation}\\label{blackputexchange}\n\\max(0,P(T,T')[K-F(T)]) = \\max(S_2(T)-S_1(T))\\;.\n\\end{equation}\\] Therefore, the value at date 0 of the put option on a forward must be the value at date 0 of an exchange option, where asset one in [blackexchange] is exchanged for asset two.\nThe key assumption in deriving Margrabe’s formula is that the volatility of the ratio of asset prices is a constant. For a call option on a forward, the relevant ratio is \\(S_1/S_2 = F/K\\). Because \\(K\\) is a constant, the volatility of the ratio is the volatility \\(\\sigma\\) of the forward price \\(F\\), which we have assumed to be constant. For a put option on a forward, the relevant ratio is \\(S_2/S_1 = K/F\\). Itô’s formula implies \\[\\begin{align*}\n\\frac{d(K/F)}{K/F} &= -\\frac{\\D F}{F} + \\left(\\frac{\\D F}{F}\\right)^2\\; ,\\\\\n&= (-\\mu +\\sigma^2)\\,\\D t - \\sigma\\,\\D B\\\\\n&= (-\\mu+\\sigma^2)\\,\\D t + \\sigma (-\\D B),\n\\end{align*}\\] The purpose of the last equality displayed here is to emphasize that we should take the volatility of \\(K/F\\) to be the positive number \\(\\sigma\\). We can do this by using \\(-B\\) as the Brownian motion instead of \\(B\\).3 Thus, we can apply Margrabe’s formula to value calls and puts on forwards (once we verify that \\(S_1\\) and \\(S_2\\) are indeed asset prices).\nTo obtain Black’s formula [black] for a call on a forward from Margrabe’s formula [margrabeoption], we simply substitute \\(S_1(0)=P(0,T')F(0)\\), \\(S_2(0)=P(0,T')K\\), \\(q_1=0\\) and \\(q_2=0\\) in Margrabe’s formula. A put option is the reverse exchange, so Margrabe’s formula gives \\[\\begin{equation}\\label{margrabeput}\nP(0,T')K\\N(d^m_1) - P(0,T')F(0)\\N(d^m_2)\\;,\n\\end{equation}\\] where \\[\\begin{align*}\nd^m_1&= \\frac{\\log\\left(\\frac{P(0,T')K}{P(0,T')F(0)}\\right)+\\frac{1}{2}\\sigma^2T}{\\sigma\\sqrt{T}}\\; ,\\\\\nd^m_2 &=d^m_1-\\sigma\\sqrt{T}.\n\\end{align*}\\] We introduce the superscript \\(m\\) here to distinguish these numbers in Margrabe’s formula from the \\(d_1\\) and \\(d_2\\) defined in \\(\\eqref{black_d1}\\) and \\(\\eqref{black_d2}\\). Notice that \\[\\begin{align*}\nd^m_1& = -\\frac{\\log\\left(\\frac{F(0)}{K}\\right)-\\frac{1}{2}\\sigma^2T}{\\sigma\\sqrt{T}} = -d_2\\\\\nd^m_2 &= -\\frac{\\log\\left(\\frac{F(0)}{K}\\right)+\\frac{1}{2}\\sigma^2T}{\\sigma\\sqrt{T}} =-d_1,\n\\end{align*}\\] so Margrabe’s formula [margrabeput] is the same as Black’s formula [black_put] for a put option on a forward.\nWe still need to explain why \\(S_1\\) and \\(S_2\\) defined in [blackexchange] are asset prices, in fact the prices of non-dividend-paying assets since we have taken \\(q_1=q_2=0\\) in applying Margrabe’s formula. The case of \\(S_2\\) should be clear: it is the price of \\(K\\) units of the discount bond maturing at \\(T'\\). The case of \\(S_1\\) is more subtle. It is the price of the following portfolio constructed at date 0 and held until date \\(T\\): go long one forward contract and buy \\(F(0)\\) units of the discount bond maturing at \\(T'\\). The value at date \\(t\\) of the bonds in the portfolio is \\(F(0)P(t,T')\\). The value at date \\(t\\) of the long forward contract can be seen by considering unwinding it by selling a forward at date \\(t\\) at the market price \\(F(t)\\). This cancels the delivery/receipt obligations on the underlying and results in a net cash flow of \\(F(t)-F(0)\\) to be received at date \\(T'\\). The value at date \\(t\\) of this future cash flow is \\(P(t,T')[F(t)-F(0)]\\) and when we add this to the value of the bonds we obtain \\(P(t,T')F(t) = S_1(t)\\).\nPut-call parity for options on forwards is \\[\\text{Call Price}  + P(0,T')K = \\text{Put Price}  + P(0,T')F(0)\\; .\\] The left-hand side is the cost of the call and \\(K\\) units of the discount bond, which have value \\(\\max(F(T),K)P(T,T')\\) at time \\(T\\). The right-hand side is the cost of the put option and \\(F(0)\\) units of the discount bond, which, together with a long forward contract initiated at date 0, also have value \\(\\max(F(T),K)P(T,T')\\) at time \\(T\\).\n\n\n10 Merton’s Formula\nNow we reconsider the Black-Scholes model but without assuming there is a constant risk-free rate. We assume instead that there is a discount bond maturing at the same date as the option. Letting \\(T\\) denote the maturity date of the option and discount bond, we write the price of the discount bond at dates \\(t \\leq T\\) as \\(P(t,T)\\). We continue to assume that the stock has a constant dividend yield \\(q\\) but we make a different assumption about volatility—instead of assuming that the volatility of the stock is constant, we assume that the volatility of its forward price is constant. We relax this to allow time-varying but non-random volatility of the forward price in Sect. [s_volatility].\nThe forward contract we consider is a forward contract for the stock maturing at the date \\(T\\) that the option matures. Let \\(F(t)\\) denote the forward price for this contract at dates \\(0 \\leq t\\leq T\\). Because the forward price must equal the spot price at the maturity of a forward contract, we have \\(F(T)=S(T)\\). Consider a call option on the forward, with the call maturing at \\(T\\) also. In the notation of the previous section, we have \\(T'=T\\) and hence \\(P(T,T')=1\\) (the discount bond is worth $1 at maturity). Therefore the value [blackcallexchange1] of the call on the forward at its maturity \\(T\\) is \\[\\max(0,F(T)-K) = \\max(0,S(T)-K)\\; ,\\] which is the same as the value of the call on the stock. Therefore, the value at date 0 of the call on the stock must equal the value at date 0 of the call on the forward, and we can use Black’s formula [black] for a call option on a forward to price a call option on the stock, assuming the forward price has a constant volatility.\nLikewise, the value at the maturity date \\(T\\) of a put option on the same forward contract is, from [blackputexchange], \\[\\max(0,K-F(T)) = \\max(0,K-S(T))\\; .\\] Hence, we can use Black’s formula [black_put] to price a put option on the stock, assuming the forward price has a constant volatility.\nIt is not necessary that the forward contract be traded, because we can create a synthetic forward using the stock. To create a synthetic forward at date \\(t\\) we buy \\(\\E^{-q(T-t)}\\) shares of the stock at cost \\(\\E^{-q(T-t)}S(t)\\). With reinvestment of dividends, this will accumulate to one share at date \\(T\\). We finance the purchase of the stock by shorting \\(\\E^{-q(T-t)}S(t)/P(t,T)\\) units of the discount bond. This results in a liability of \\(\\E^{-q(T-t)}S(t)/P(t,T)\\) dollars at date \\(T\\), so the forward purchase is arranged by promising to pay \\(\\E^{-q(T-t)}S(t)/P(t,T)\\) dollars at the delivery date; i.e., the forward price is \\[\\begin{equation}\\label{forwardprice}\nF(t) = \\frac{\\E^{-q(T-t)}S(t)}{P(t,T)}\\;.\n\\end{equation}\\] The assumption we need to apply Black’s formulas is that \\[\\begin{equation}\\label{mertonforward}\n\\frac{\\D F}{F} = \\mu\\,\\D t+\\sigma\\,\\D B\\;,\n\\end{equation}\\] where \\(B\\) is a Brownian motion, \\(\\mu\\) can be a quite general random process, and \\(\\sigma\\) is a constant. At the end of this section, we will discuss the meaning of this assumption in terms of the volatilities of the stock and bond and their correlation.\nUnder this assumption, the following formulas originally due to Merton [@Merton] follow immediately from Black’s formulas [blackcombined] by substituting \\(F(0) = \\E^{-qT}S(0)/P(0,T)\\). \nThese formulas are clearly similar to the Black-Scholes formulas. The similarities are made more apparent by writing the discount bond price in terms of its yield. The yield \\(y\\) of the discount bond is defined as \\[y = \\frac{-\\log P(0,T)}{T} \\qquad\\Longleftrightarrow \\qquad P(0,T) = \\E^{-yT}\\; .\\] Substituting this into the expressions above, we have: This shows that the Merton call and put formulas can be calculated from the Black-Scholes call and put functions given in Chap. [c_blackscholes] by inputting the yield of the discount bond as the risk-free rate and by inputting the volatility of the forward price as \\(\\sigma\\).\nThis shows that the Merton call and put formulas can be calculated from the Black-Scholes call and put functions given in Chap. [c_blackscholes] by inputting the yield of the discount bond as the risk-free rate and by inputting the volatility of the forward price as \\(\\sigma\\). If one wants to assume that there is a constant risk-free rate, then the discount bond price will have to be \\(\\E^{-rT}\\) and its yield will be the risk-free rate \\(r\\). In this case, the forward price is \\(\\E^{(r-q)T}S(0)\\) and it has the same volatility as \\(S\\). Making these substitutions, the Merton formulas [Mertoncombined] are the same as the Black-Scholes formulas. However, the Merton formulas are an important generalization. It is common practice to use the yield of the discount bond as the risk-free rate that is input into the Black-Scholes formulas. The Merton formulas justify this practice. It is less common to attempt to estimate the volatility of the forward price and use this (as one should since the risk-free rate really is not constant) as the volatility in the Black-Scholes-Merton formulas. However, this does little damage for pricing short-term options, because the volatility of the forward price—see [mertonsigma] below—will be approximately the same as the volatility of the underlying for short-term options, due to the low volatility of short-term bond prices. Moreover, when one computes an implied volatility from the Black-Scholes formula (using the discount bond yield as the risk-free rate), it should be regarded as the market’s view of the forward price volatility, and it is perfectly appropriate to input it into the Black-Scholes-Merton formulas to price another option (assuming of course that the forward price volatility can be regarded as constant).\nThe volatility of the forward price can be computed in terms of the volatilities and correlation of the stock and discount bond as follows. Assume that \\[\\begin{align*}\n\\frac{\\D S}{S}& = \\mu_s\\,\\D t + \\sigma_s\\,\\D B_s\\; ,\\\\\n\\frac{\\D P}{P}& = \\mu_p\\,\\D t + \\sigma_p\\,\\D B_p,\n\\end{align*}\\] where \\(B_s\\) and \\(B_p\\) are Brownian motions with correlation \\(\\rho\\). Then \\(\\eqref{volatilityproduct}\\) and \\(\\eqref{volatilityratio}\\) show that the volatility of \\(F(t) = \\E^{-q(T-t)}S(t)/P(t,T)\\) is \\(\\sigma\\) defined as \\[\\begin{equation}\\label{mertonsigma}\n\\sigma = \\sqrt{\\sigma_s^2+\\sigma_p^2 - 2\\rho\\sigma_s\\sigma_p}\\;.\n\\end{equation}\\] As mentioned before, we will consider in Sect. [s_volatility] that the the volatility [mertonsigma] may vary over time in a non-random way.\n\n\n11 Deferred Exchange Options\nA call option on a forward can be viewed as an option to exchange \\(K\\) dollars (or, equivalently, \\(K\\) units of the discount bond maturing at the maturity date of the forward) for the underlying asset, with the exchange taking place at the maturity date of the forward. Therefore, it is an exchange option in which the exchange takes place at a fixed date after the option matures. We can easily extend Margrabe’s formula to value options to exchange other assets when the option maturity precedes the date of the exchange.\nAs in Sect. [s_margrabe], consider two assets with prices \\(S_i\\) and constant dividend yields \\(q_i\\) and assume the prices satisfy \\[\\frac{\\D S_i}{S_i} = \\mu_i\\,\\D t + \\sigma_i\\,\\D B_i\\; ,\\] where the drifts \\(\\mu_i\\), the volatilities \\(\\sigma_i\\) and the correlation \\(\\rho\\) of the two Brownian motions can be general random processes. However, also as in Sect. [s_margrabe], assume that the volatility \\[\\sigma = \\sqrt{\\sigma_1^2 + \\sigma_2^2 - 2\\rho\\sigma_1\\sigma_2}\\] of the ratio of asset prices is constant.\nConsider an option maturing at date \\(T\\) to exchange the second asset for the first asset at date \\(T'\\geq T\\). To understand the value of the option at date \\(T\\), suppose it is exercised. To unwind the positions in the two assets, one can sell a forward contract on the asset to be received and buy a forward contract on the asset to be delivered, with the forward contracts maturing at the date of the exchange. Then the difference \\(F_1(T)-F_2(T)\\) in the forward prices is a cash flow to be received/paid at the exchange date \\(T'\\) and its value at date \\(T\\) is \\(P(T,T')[F_1(T)-F_2(T)]\\). Therefore, the value of the option at its maturity \\(T\\) is \\[\\max(0,P(T,T')F_1(T) - P(T,T')F_2(T))\\; .\\] As in Sect. [s_black], this valuation does not require the existence of traded forward contracts, because synthetic forwards can be created. Also as in Sect. [s_black] we know that \\[S^*_1(t) = P(t,T')F_1(t) \\quad \\text{and} \\quad S^*_2(t) = P(t,T')F_2(t)\\] are the prices of non-dividend-paying assets. Therefore, the option to exchange the assets at date \\(T'\\) must have the same value as an option to exchange at date \\(T\\) the assets with prices \\(S^*_i\\).\nWe recall here the arbitrage formula [forwardprice] for the forward prices (making the change that here the forwards mature at \\(T'\\)): \\[F_i(t) =  \\frac{\\E^{-q_i(T'-t)}S_i(t)}{P(t,T')}\\; .\\] Thus, \\[S^*_i(t) = \\E^{-q_i(T'-t)}S_i(t)\\; .\\] This implies that the volatility of the ratio \\(S_1^*/S_2^*\\) is the same as the volatility of the ratio \\(S_1/S_2\\). Therefore, we can price a deferred exchange option from Margrabe’s formula, inputting the prices \\(S^*_i(0) = \\E^{-q_iT'}S_i(0)\\) as the initial asset prices and zero as their dividend yields. This formula is: \n\n\n12 Calculations in VBA\nWe could of course write entirely separate programs for the options discussed so far in this chapter but it seems useful to emphasize their common structure. As discussed in the introduction to this chapter, each is the present value of what is received upon exercise multiplied by \\(\\N(x)\\) minus the present value of what is delivered upon exercise multiplied by \\(\\N(y)\\) and \\(x\\) in each case is the logarithm of the ratio of present values plus one-half \\(\\sigma^2T\\), all divided by \\(\\sigma\\sqrt{T}\\). In the case of options on forwards, the present values are the present values of what is received or delivered at the maturity of the forward contract. We can do this calculation in the following program.\n\nNow we can use the following one-line programs to value exchange and forward options. We will explain in Sect. [s_futuresoptions] why (and in what circumstance) the Black call and put functions are appropriate for options on futures.\n\n\n\n\nWe could also have calculated the Black-Scholes call formula as\nand the Black-Scholes put formula as\n\n\n13 Greeks and Hedging\nThe Greeks for the Margrabe and Black formulas can be calculated in the same way that we calculated them in Chap. [c_blackscholes] for the Black-Scholes formula. In analogy with [greeksimplify], it can be shown for the Margrabe formula that \\[\\E^{-q_1T}S_1(0)\\nd(d_1) = \\E^{-q_2T}S_2(0)\\nd(d_2)\\; ,\\] and again this simplifies the calculations. This equation applies to the Black call formula by taking \\(q_1=q_2=0\\), \\(S_1(0)=P(0,T')F(0)\\), and \\(S_2(0)=P(0,T')K\\), leading to \\[F(0)\\nd(d_1) = K\\nd(d_2)\\; .\\] The Greeks for the Black call formula and the Margrabe formula are: \nHedging for the Margrabe formula is much the same as for the Black-Scholes formula. We would delta-hedge a written exchange option by holding \\(\\delta_1=\\E^{-q_1T}\\N(d_1)\\) shares of the first asset and \\(\\delta_2 =- \\E^{-q_2T}\\N(d_2)\\) shares of the second asset (which means shorting the second asset). This position would be financed by borrowing at the risk-free rate (or shorting the discount bond). The same argument that we used in Sect. [s_deltahedging] shows that this zero-cost portfolio will have a zero return if continuously rebalanced.\nBecause the Black formulas are a special case of the Margrabe formula, we can delta-hedge options on forwards in the same way. Putting \\(q_1=q_2=0\\), \\(S_1(0)=P(0,T')F(0)\\) and \\(S_2(0)=P(0,T')K\\), we would delta-hedge a written call option by buying \\(\\N(d_1)\\) shares of the first asset and shorting \\(\\N(d_2)\\) shares of the second, where \\(d_1\\) and \\(d_2\\) are defined in the Margrabe formulas [margrabe_d1] and [margrabe_d2] and equivalently in the Black formulas [black_d1] and [black_d2]. This position would be financed by shorting the discount bond to raise the difference between the cost of the portfolio and the option value so that the cost of the total portfolio (including the short discount bond) equals the option value. However, the first asset here consists of a long forward contract plus \\(F(0)\\) units of the discount bond, and the second asset is \\(K\\) units of the discount bond. Furthermore, we are using the discount bond to finance the position (including the buying and shorting of the discount bond!). We can conclude that buying \\(\\N(d_1)\\) units of the first asset means that we should buy \\(\\N(d_1)\\) forward contracts. This has zero cost. Therefore, the portfolio value will equal the value of the discount bonds, and this must equal the option value. So, we actually invest the option value \\[P(0,T')F(0)\\N(d_1) - P(0,T')K\\N(d_2)\\; ,\\] in the discount bond, which means buying \\(F(0)\\N(d_1)-K\\N(d_2)\\) units of the bond.\nA more direct analysis of hedging options on forwards is possible and instructive. We will consider that topic further in Sect. [s_hedgingforwards].\n\n\n14 The Relation of Futures Prices to Forward Prices\nThe difference between futures and forward contracts is that futures are marked to market, which means that daily gains and losses are posted to the investor’s margin account. Thus, there are interim cash flows on a futures contract, whereas the only cash flows on a forward contract are at the maturity of the forward. We will establish three useful facts in this section, the last of which follows from the first two:\nWe consider the idealized case in which the futures contract is continuously marked to market. Assume there is an instantaneously risk-free asset with rate of return \\(r\\), which could vary randomly over time, and define, as in Sect. [s_continuouscompounding], \\[R(t) = \\exp\\left(\\int_0^t r(s)\\,ds\\right)\\; ,\\] which is the value at date \\(t\\) of a $1 investment in the asset at date 0, with interest continuously reinvested. Let \\(T'\\) denote the maturity of the futures contract, and let \\(F^*(t)\\) denote the futures price at dates \\(t \\leq T'\\) (the \\(^*\\) notation is to distinguish the futures price from the forward price \\(F\\)). Consider the portfolio strategy that starts with zero dollars and one long futures contract at price \\(F^*(0)\\) and which continuously invests and withdraws from the risk-free asset the gains and losses on the futures contract. Let \\(V(t)\\) denote the value of this portfolio at date \\(t\\). The change in the value of the portfolio at any instant is the interest earned (or paid, if \\(V<0\\)) on the risk-free asset plus the gain/loss on the futures. This means that \\[\\D V = rV\\,\\D t + \\D F^*\\; .\\] Because all gains and losses on this portfolio are reinvested, \\(V\\) is the price of a non-dividend-paying asset. Therefore, under the risk-neutral measure (i.e., using \\(R\\) as the numeraire), the ratio \\(V/R\\) must be a martingale and hence have zero drift. From Itô’s formula, \\[\\begin{align*}\n\\frac{\\D (V/R)}{V/R} &= \\frac{\\D V}{V} - \\frac{\\D R}{R}\\\\\n&=\\frac{rV\\,\\D t + \\D F^*}{V} - r\\,\\D t\\\\\n&= \\frac{\\D F^*}{V}\\;.\n\\end{align*}\\] Thus, the drift of \\(V/R\\) being zero implies the drift of \\(F^*\\) is zero. We need to assume (and can assume) that \\(F^*\\) is an Itô process with finite expected quadratic variation—cf. condition [regularity1]—in which case the absence of a drift implies that it is a martingale.\nNow we turn to fact (2). Consider a forward contract with maturity \\(T'\\) and a discount bond also maturing at \\(T'\\). Let \\(F(t)\\) denote the forward price and let \\(P(t,T')\\) denote the price of the discount bond at dates \\(t \\leq T'\\). We observed in Sect. [s_black] that there is a non-dividend paying asset with price \\(P(t,T')F(t)\\). When we use the discount bond as the numeraire, the ratio \\(P(t,T')F(t)/P(t,T') = F(t)\\) must be a martingale, which is fact (2). Because of this fact, a probability measure corresponding to a discount bond being the numeraire is called a “forward measure.” \nSuppose now that interest rates are deterministic, that is, even if \\(r\\) varies over time, it does so in a non-random way. Then the discount bond price at date 0 must be the discount factor \\[P(0,T') = \\exp\\left(-\\int_0^{T'} r(t)\\,\\D t\\right)\\; .\\] Equation \\(\\eqref{probSnumeraire}\\) gives the probability of any event \\(A\\) when the discount bond is used as the numeraire as \\[\\text{prob}^P[A] = E\\left[1_A\\phi(T')\\frac{P(T',T')}{P(0,T')}\\right] = \\exp\\left(-\\int_0^{T'} r(t)\\,\\D t\\right)E[1_A\\phi(T')]\\; ,\\] where \\(\\phi\\) denotes the state prices. On the other hand, the same equation gives the probability of \\(A\\) when \\(R\\) is used as the numeraire as \\[\\text{prob}^R[A] = E\\left[1_A\\phi(T')\\frac{R(T')}{R(0)}\\right] = \\exp\\left(-\\int_0^{T'} r(t)\\,\\D t\\right)E[1_A\\phi(T')]\\; .\\] Therefore, the two probability measures are the same, and consequently the expectations \\(E^P\\) and \\(E^R\\) are the same. Now using the fact that both the futures price and the forward price must equal the spot price at maturity, we have \\(F^*(T') = F(T')\\), and, from the martingale properties, \\[F^*(t) = E_t^P[F^*(T')] = E_t^P[F(T')] = E_t^R[F(T')] = F(t)\\; ,\\] which is fact (3).\n\n\n15 Futures Options\nNow we consider options on futures contracts, assuming that interest rates are deterministic. We just showed that in this circumstance the futures price will equal the forward price for a contract of the same maturity. However, the values of options on a futures contract do not equal the values of options on the corresponding forward contract.\nThe difference is due to marking to market. Consider futures and forward contracts with maturity \\(T'\\) and options maturing at \\(T \\leq T'\\). Exercise of a call option on a futures contract will roll the investor into a long futures contract with futures price equal to the market futures price at that date. The difference \\(F^*(T)-K\\) between the market futures price and the strike price of the option is immediately credited to the investor’s margin account. On the other hand, exercise of an option on a forward and sale of the forward results in a cash flow of \\(F(T) - K\\) that is received at the maturity date \\(T'\\) of the forward. Therefore, the value at maturity of a call option on a futures contract is \\(\\max(0,F^*(T)-K)\\), whereas, as noted before, the value of a call option on a forward at the maturity of the option is \\(P(T,T')\\max(0,F(T)-K)\\)\nAs in the analysis of options on forwards, an options on a futures contract can be viewed as an exchange option, where one exchanges the asset with price \\(S_2(t) = P(t,T)K\\) at date \\(t\\leq T\\) for the asset with price \\(S_1(t) = P(t,T)F^*(t)\\). The asset with price \\(S_2\\) is of course \\(K\\) units of the discount bond maturing at \\(T\\). Assuming interest rates are deterministic, we have \\(F^*(t) = F(t)\\), and we noted in Sect. [s_black] that \\(P(t,T)F(t)\\) is the price of a non-dividend-paying asset. Thus, we can apply Margrabe’s formula to price call (and put) options on futures when interest rates are deterministic. Compared to options on forwards, the difference is that the discount bonds defining the prices \\(S_1\\) and \\(S_2\\) mature at the maturity date of the option rather than at the maturity date of the futures or forward contract. The result is: We can calculate these values from the Black_Call and Black_Put functions by inputting the price of the discount bond maturing when the option matures rather than the price of the discount bond maturing when the forward/futures matures. We will derive delta hedges for futures options in Sect. [s_hedgingforwards].\n\n\n16 Time-Varying Volatility\nAll of the option pricing formulas in this chapter were derived from Margrabe’s formula, the main assumption of which is that the logarithm of the ratio of asset prices at date \\(T\\) is normally distributed with variance equal to \\(\\sigma^2T\\). As in Sect. [s_timevaryingvolatility] regarding the Black-Scholes formulas, the formulas in this chapter can easily be adapted to allow a time-varying but non-random volatility. If the volatility is a non-random function \\(\\sigma(t)\\) of time, then we define \\(\\sigma_{\\text{avg}}\\) to be the number such that \\[\\begin{equation}\\label{averagesigma}\n\\sigma_{\\text{avg}}^2 = \\frac{1}{T}\\int_0^T \\sigma^2(t)\\,\\D t\\;.\n\\end{equation}\\] We should input \\(\\sigma_{\\text{avg}}\\) as (i) the volatility of the ratio of asset prices in Margrabe’s formula and the deferred exchange option formula if \\(\\sigma(t)\\) is the volatility of the ratio at date \\(t\\) or as (ii) the volatility of the forward price in Black’s and Merton’s formulas if \\(\\sigma(t)\\) is the volatility of the forward price at date \\(t\\). As in Sect. [s_timevaryingvolatility], equation [averagesigma] enables one to interpret and apply different implied volatilities computed at different maturities. Another circumstance in which it can be useful is in conjunction with bond price models such as the Vasicek and extended Vasicek models described in Chap. [c_vasicek] that imply a time-varying non-random volatility for discount bond prices.4 If we assume a constant volatility for the price of the underlying and a constant correlation between the underlying and the discount bond, then we will have a time-varying non-random forward price volatility via [mertonsigma], and we should input the “average volatility” \\(\\sigma_{\\text{avg}}\\) defined in [averagesigma] for the forward price volatility in Black’s and Merton’s formulas. As mentioned in Sect. [s_merton], this will be more important for long-term options than for short-term options.\n\n\n17 Hedging with Forwards and Futures\nIn Chap. [c_foreignexchange], we considered hedging quanto contracts with currency forwards. In Sect. [s_forwardhedging], we considered hedging options on forwards with forwards. To present a more complete analysis of these topics, we need to discuss the gains and losses that accrue from trading forwards.\nConsider dates \\(t<u\\) and a forward contract with maturity \\(T\\). Suppose we purchase \\(x(t)\\) forwards at date \\(t\\) and then change our position in forwards to \\(x(u)\\) at time \\(u\\). The purchase/sale of \\(x(u)-x(t)\\) new contracts does not affect the portfolio value, so the change in the value of the portfolio is the change in the value of the \\(x(t)\\) contracts purchased at date \\(t\\). These contracts were worth zero at date \\(t\\), because forward contracts have zero value at initiation. Selling them at date \\(u\\) cancels the obligation to deliver/receive the underlying, leaving one with a cash flow of \\(x(t)[F(u)-F(t)]\\) dollars to be received at date \\(T\\). The value of this cash flow at date \\(u\\) is \\(x(t)P(u,T)[F(u)-F(t)]\\). We can write this as \\[\\begin{align*}\nx(t)P(u,T)&[F(u)-F(t)]  \\\\\\begin{split}&= x(t)\\big[P(t,T)[F(u)-F(t)] + [P(u,T)-P(t,T)][F(u)-F(t)]\\big]\\\\\n&= x(t)\\big[P(t,T)\\,\\varDelta F + (\\varDelta P)(\\varDelta F)\\big]\\;.\n\\end{split}\n\\end{align*}\\] This motivates the following definition: \nHedging with futures is a bit simpler, because the gains and losses are received instantaneously (daily, at least) rather than being deferred to the contract maturity. Letting \\(x(t)\\) denote the number of futures contracts held at date \\(t\\) and \\(F^*(t)\\) the futures price, the cash flow from the contracts is \\(x(t)\\,\\D F^*(t)\\). This is also the change in the value of the portfolio, because marking to market means that the contracts always have zero value.\nTo compare hedging with futures and forwards, assume there is a constant risk-free rate~\\(r\\). Let \\(T\\) denote the maturity of the futures and forward contracts. Because there is a constant risk-free rate, we have \\(P(t,T) = \\E^{-r(T-t)}\\), which implies \\((\\D P)(\\D F) =0\\). Moreover, futures prices equal forward prices. Thus, Comparing \\(\\eqref{forwardchange100}\\) and \\(\\eqref{futureschange100}\\), we see that if \\(x(t)\\) is the number of forward contracts that should be held in a hedge, then \\[\\begin{equation}\\label{futuresxy}\ny(t) = \\E^{-r(T-t)}x(t)\n\\end{equation}\\] is the number of futures contracts that should be held, because with this number of contracts we have \\[\\begin{align*}\n\\text{Change in Forward Portfolio} & = x(t)\\E^{-r(T-t)}\\,\\D F(t)\\\\\n& = y(t)\\,\\D F(t)\\\\\n& = \\text{Change in Futures Portfolio}\\;.\n\\end{align*}\\] In short, we don’t require as many futures contracts as forward contracts, and the scaling factor to convert from forwards to futures is just the present value factor \\(\\E^{-r(T-t)}\\).\nFor example, the result of Sect. [s_replicatingquantos] on replicating the payoff \\(\\bar{X}S(T)\\) with forward contracts leads to the following:\nWe can use [futuresxy] to determine how to delta hedge futures options. As explained in Sect. [s_futuresoptions], assuming non-random interest rates, futures options are more valuable than options on forwards because futures are marked to market upon exercise of an option. Specifically, Black’s formulas [blackcombined] for options on forwards and [blackcombinedfutures] for options on futures show that the values are the same except for the maturity of the discount bond appearing in the equations. With a constant risk-free rate \\(r\\), options maturing at \\(T\\) and futures/forwards maturing at \\(T'\\), the relation is\n\\[\\text{Value of Futures Option} = \\E^{r(T'-T)} \\times \\text{Value of Forward Option}\\; .\\] Because the scaling factor \\(\\E^{r(T'-T)}\\) does not change as time passes, this implies that as time passes we have \\[\\begin{multline}\\label{futures1001}\n\\text{Change in Futures Option Value } \\\\= \\E^{r(T'-T)} \\times \\text{Change in Forward Option Value}\\;.\n\\end{multline}\\] We can combine [futuresxy] and [futures1001] to convert from a hedge of a forward option using forward contracts, which we discussed in Sect. [s_forwardhedging], to a hedge of a futures option using futures contracts. For example, we concluded in Sect. [s_forwardhedging] that we should be long \\(\\N(d_1)\\) forwards to hedge a short call option on a forward contract. Consequently, [futuresxy] shows that we can hedge a short call option on a forward by being long \\(\\E^{-r(T'-t)}\\N(d_1)\\) futures, and then we see from [futures1001] that the hedge for a short call on a futures is being long \\[\\E^{r(T'-T)}\\E^{-r(T'-t)}\\N(d_1) = \\E^{-r(T-t)}\\N(d_1)\\] futures contracts.\nIn Sect. [s_forwardhedging], we derived the hedges for forward options by considering them as exchange options. We can use the definition [changeforwardvalue] to confirm that our calculations were correct. Consider hedging a short call maturing at \\(T\\) on a forward contract maturing at \\(T'\\). We can assume interest rates vary randomly and use discount bonds in the hedge. We stated in Sect. [s_forwardhedging] that we should hold \\(F(0)\\N(d_1)-K\\N(d_2)\\) units of the discount bond maturing at~\\(T'\\) and we should go long \\(\\N(d_1)\\) forwards to hedge the short call. This is a zero-cost portfolio when we include the proceeds from selling the call. Using [changeforwardvalue], we see that the change in the value of the portfolio will be \\[\\begin{equation}\\label{forwardhedging1}\n-\\D C + [F(0)\\N(d_1)-K\\N(d_2)]\\D P + \\N(d_1)[P(0,T')\\,\\D F + (\\D P)(\\D F)]\\;.\n\\end{equation}\\] The value of the call at date \\(t\\) will be a function of \\(t\\), \\(P(t,T')\\) and \\(F(t)\\), which we write as \\(C(t,P,F)\\). From It^o’s formula, \\[\\begin{align*}\n\\D C &= \\frac{\\partial C}{\\partial t}\\,\\D t + \\frac{\\partial C}{\\partial P}\\,\\D P + \\frac{\\partial C}{\\partial F}\\,\\D F \\\\  &\\qquad + \\frac{1}{2}\\frac{\\partial^2 C}{\\partial P^2}\\, (\\D P)^2   + \\frac{1}{2}\\frac{\\partial^2 C}{\\partial F^2}\\, (\\D F)^2 + \\frac{\\partial^2 C}{\\partial F \\partial P} (\\D P)(\\D F)\\;.\\\\\n&=\\Theta\\,\\D t + \\delta_P\\,\\D P + \\delta_F\\,\\D F  + \\frac{1}{2}\\Gamma_{PP} (\\D P)^2 + \\frac{1}{2}\\Gamma_{FF} (\\D F)^2  + \\Gamma_{FP}\\,(\\D P)(\\D F)\\;,\n\\end{align*}\\] where the \\(\\delta\\)’s and \\(\\Gamma\\)’s denote the first and second partial derivatives indicated by the subscripts. Inserting this formula into [forwardhedging1] and making use of the formulas in the table in Sect. [s_forwardhedging], we see that the \\(\\D P\\) terms cancel because \\(\\delta_P = F(0)\\N(d_1)-K\\N(d_2)\\). Furthermore, the \\(\\D F\\) terms cancel because \\(\\delta_F = \\N(d_1)P(0,T')\\). Thus, there is no exposure in the portfolio to the two risky asset prices \\(P\\) and \\(F\\). Furthermore, \\(\\Gamma_{PP} = 0\\) and the \\((\\D P)(\\D F)\\) terms cancel because \\(\\Gamma_{FP} = \\N(d_1)\\). These substitutions simplify the change [forwardhedging1] in the value of the portfolio to \\[-\\Theta\\,\\D t - \\frac{1}{2}\\Gamma_{FF} (\\D F)^2  = \\frac{\\sigma P(0,T')F(0)\\nd(d_1)}{2\\sqrt{T}}\\,\\D t  -  \\frac{P(0,T')\\nd(d_1)}{2\\sigma\\sqrt{T}F(0)}\\,(\\D F)^2\\; ,\\] which we can see to be zero because \\((\\D F)^2 = \\sigma^2F^2\\,\\D t\\). Thus, the hedge is perfect when continuously rebalanced.\n\n\n18 Market Completeness\nA formal definition of market completeness must specify which state-contingent claims (random variables depending on the history of prices) can be replicated by trading the marketed assets—for example, one might want all of the claims with finite means to be replicable, or only all of the claims with finite variances, etc. A formal analysis of market completeness is not presented in this book, except for the binomial and trinomial models in Chap. [c_basics]. However, we have stated that stochastic volatility models are incomplete. This follows intuitively from the fact that a portfolio containing only one risky asset (the underlying) cannot be perfectly correlated with the two Brownian motions that determine the value of a derivative asset (the Brownian motions driving the price of the underlying and its volatility). In general, a market must include an instantaneously risk-free asset and as many risky assets as there are Brownian motions in order to be complete.\nThe exchange-option model of Margrabe—with two risky assets, two Brownian motions, and no risk-free asset—is obviously incomplete. For example, it is impossible to have exactly $100 at date \\(T\\). With no risk-free asset, there is simply no way to store money. This may seem far-fetched, but we might be interested in payoffs in “real” (i.e., inflation-adjusted) dollars, in which case the absence of a risk-free asset may be a normal situation. In any case, we have not assumed a risk-free asset exists, but we have priced options without appealing to “equilibrium” arguments. This deserves some clarification.\nAs mentioned above, a formal definition of market completeness must specify which contingent claims are to be replicable. The Margrabe model is complete for a certain set of contingent claims. Contingent claims of the form \\(S_2(T)X(T)\\) where \\(X(T)\\) is a random variable depending on the relative prices \\(S_1(t)/S_2(t)\\) for \\(0 \\leq t\\leq T\\) can be replicated. Likewise, contingent claims of the form \\(S_1(T)X(T)\\) can be replicated. The payoffs of exchange options are of this form, so they can be priced by arbitrage, even though there are other contingent claims (for example, receiving exactly $100 at date \\(T\\)) that cannot be replicated and hence cannot be priced by arbitrage. Likewise, the Black and Merton models in which there is a zero-coupon bond but no instantaneously risk-free asset are examples of incomplete markets that are still sufficiently complete to price options by arbitrage (the options can be replicated). The proof that the Margrabe model is complete in the sense stated here follows from the change of numeraire argument used to derive Margrabe’s formula from the Black-Scholes formula (recall that the second asset is risk-free when we use it as the numeraire, so there is a risk-free asset under the new numeraire) and a proof that the Black-Scholes model is complete (which we have omitted, except to show that European options can be replicated).\n\n\nProblems\n\n\n\n\n\n\nThe volatility of a discount bond price cannot be constant because it must go to zero as the bond approaches maturity.↩︎\nThe volatility of a discount bond price cannot be constant because it must go to zero as the bond approaches maturity.↩︎\nThe volatility of a discount bond price cannot be constant because it must go to zero as the bond approaches maturity.↩︎\nThe volatility of a discount bond price cannot be constant because it must go to zero as the bond approaches maturity.↩︎"
  },
  {
    "objectID": "Chapter8.html",
    "href": "Chapter8.html",
    "title": "8  Exotic Options",
    "section": "",
    "text": "We will only discuss a few exotic options. The reason for studying the derivation of an option pricing formula is that it may better equip one to analyze new products. Hopefully, this chapter will be of some assistance in that regard. Of course, one cannot expect to derive a closed-form solution for the value of every product, and often numerical methods will be necessary. For a much more comprehensive presentation of exotic option pricing formulas, the book by Haug [@Haug] and the Excel software that accompanies it are highly recommended. Zhang [@Zhang] is also a comprehensive reference for exotics.\nThe valuation of an American call option on an asset paying a discrete cash dividend (rather than a continuous dividend) is considered in Sect. [s_discrete]. Under a particular assumption on the volatility, valuing this option is very similar to valuing a compound option. Except for the assumption of a discrete dividend in Sect. [s_discrete], we will make the Black-Scholes assumptions throughout this chapter: there is a constant risk-free rate \\(r\\) and the underlying asset has a constant volatility \\(\\sigma\\) and a constant dividend yield \\(q\\).\nThe order in which exotics are presented in this chapter is based on the simplicity of the analysis—the chapter begins with the easiest to analyze and works towards the more difficult. This order is roughly the inverse of importance, the most important exotics in practice being barriers, baskets, spreads and Asians. In the cases of Asian and basket options, we will explain why there are no simple closed-form formulas (sums of lognormally distributed random variables are not lognormal). We will use these cases and discretely-sampled barriers and lookbacks as examples in the next chapter."
  },
  {
    "objectID": "Chapter8.html#forward-start-call-payoff",
    "href": "Chapter8.html#forward-start-call-payoff",
    "title": "8  Exotic Options",
    "section": "Forward-Start Call Payoff",
    "text": "Forward-Start Call Payoff\nA forward-start call is defined by its maturity date \\(T'\\) and the date \\(T<T'\\) at which the strike price is set. The value of a forward-start call at maturity is \\[\\max(0,S(T')-S(T))\\; .\\] Let \\[x= \\begin{cases} 1 &\\text{if $S(T')>S(T)$\\;,}\\\\\n                               0 & \\text{otherwise\\;.}\n        \\end{cases}\n\\] Then, the value of the call at maturity can be written as \\[xS(T')-xS(T)\\; .\\]"
  },
  {
    "objectID": "Chapter8.html#numeraires",
    "href": "Chapter8.html#numeraires",
    "title": "8  Exotic Options",
    "section": "Numeraires",
    "text": "Numeraires\nConsider numeraires \\(V_1(t) = \\E^{q_1t}S_1(t)\\), \\(V_2(t)=\\E^{q_2t}S_2(t)\\), and \\(R(t)=\\E^{rt}\\). By familiar arguments, the value of the option at date 0 is \\[\\begin{multline*}\n\\E^{-q_1T}S_1(0)\\times\\text{prob}^{V_1}(x=1) + \\E^{-q_2T}S_2(0)\\times\\text{prob}^{V_2}(y=1) \\\\- \\E^{-rT}K\\times\\text{prob}^R(z=1)\\; .\n\\end{multline*}\\]"
  },
  {
    "objectID": "Chapter8.html#calculating-probabilities",
    "href": "Chapter8.html#calculating-probabilities",
    "title": "8  Exotic Options",
    "section": "Calculating Probabilities",
    "text": "Calculating Probabilities"
  },
  {
    "objectID": "Chapter8.html#forward-start-call-pricing-formula",
    "href": "Chapter8.html#forward-start-call-pricing-formula",
    "title": "8  Exotic Options",
    "section": "Forward-Start Call Pricing Formula",
    "text": "Forward-Start Call Pricing Formula\nCombining these results, we have:"
  },
  {
    "objectID": "Chapter8.html#put-call-parity",
    "href": "Chapter8.html#put-call-parity",
    "title": "8  Exotic Options",
    "section": "Put-Call Parity",
    "text": "Put-Call Parity\nForward-strike calls and puts satisfy a somewhat unusual form of put-call parity. The usual put-call parity is of the form: \\[\\text{Call} \\;+\\; \\text{Cash} \\quad = \\quad \\text{Put} \\;+ \\;\\text{Underlying}\\; .\\] The amount of cash is the amount that will accumulate to the exercise price at maturity; i.e., it is \\(\\E^{-rT'}K\\). For forward-start calls and puts, the effective exercise price is \\(S(T)\\), which is not known at date 0. However, the portfolio used as numeraire to value the second part of the payoff will be worth \\(\\E^{r(T'-T)}S(T)\\) at date \\(T'\\), and by following the same strategy but starting with \\(\\E^{-r(T'-T)-qT}\\) instead of \\(\\E^{-qT}\\) shares, we will have \\(S(T)\\) dollars at date \\(T'\\). The date–0 value of this portfolio should replace “Cash” in the above. Thus:"
  },
  {
    "objectID": "Chapter8.html#call-on-a-call-payoff",
    "href": "Chapter8.html#call-on-a-call-payoff",
    "title": "8  Exotic Options",
    "section": "Call-on-a-Call Payoff",
    "text": "Call-on-a-Call Payoff\nLet the underlying call option have exercise price \\(K'\\) and maturity \\(T'\\). Consider an option maturing at \\(T<T'\\) to purchase the underlying call at price \\(K\\).\nLet \\(C(t,S)\\) denote the value at date \\(t\\) of the underlying call when the stock price is \\(S\\) (i.e., \\(C\\) is the Black-Scholes formula). It is of course rational to exercise the compound call at date \\(T\\) if the value of the underlying call exceeds \\(K\\); i.e., if \\(C(T,S(T))>K\\). Let \\(S^*\\) denote the critical price such that \\(C(T,S^*)=K\\). To calculate \\(S^*\\), we need to solve Black_Scholes_Call(Sstar,Kprime,r,sigma,q,Tprime-T) = K.\nfor \\(S^*\\). We can do this by bisection or one of the other methods mentioned in Sect. [s_impliedvolatility].\nIt is rational to exercise the compound option when \\(S(T) > S^*\\).\nWhen \\(S(T) > S^*\\), exercise of the compound option generates a cash flow of \\(-K\\) at date \\(T\\). There is a cash flow (of \\(S(T')-K'\\)) at date \\(T'\\) only if the compound call is exercised and the underlying call finishes in the money. This is equivalent to: \\[\\begin{equation}\\label{compound1}\nS(T) > S^* \\quad\\text{and}\\quad S(T')>K'\\;.\n\\end{equation}\\] Let \\[\\begin{align*}\nx&= \\begin{cases} 1 &\\text{if $S(T)>S^*$\\;,}\\\\\n                               0 & \\text{otherwise\\;,}\n        \\end{cases}\\\\\n\\intertext{and let}\ny&= \\begin{cases} 1 &\\text{if $S(T)>S^*$ and $S(T')>K'$\\;,}\\\\\n                               0 & \\text{otherwise\\;.}\n        \\end{cases}\n\\end{align*}\\] The cash flows of the compound option are \\(-xK\\) at date \\(T\\) and \\(yS(T')-yK'\\) at date \\(T'\\). We can value the compound option at date 0 by valuing these separate cash flows.\nThe cash flow \\(-xK\\) is the cash flow from being short \\(K\\) digital options on the underlying asset with strike price \\(S^*\\) and maturity \\(T\\). Therefore the value at date 0 of this cash flow is \\(-\\E^{-rT}K\\N(d_2)\\), where \\[\\begin{equation}\\label{calloncalld1d2}\nd_1 = \\frac{\\log\\left(\\frac{S(0)}{S^*}\\right)+\\left(r-q+\\frac{1}{2}\\sigma^2\\right)T}{\\sigma\\sqrt{T}},  \\qquad d_2 = d_1-\\sigma\\sqrt{T}\\;.\n\\end{equation}\\]"
  },
  {
    "objectID": "Chapter8.html#american-call-pricing-formula",
    "href": "Chapter8.html#american-call-pricing-formula",
    "title": "8  Exotic Options",
    "section": "American Call Pricing Formula",
    "text": "American Call Pricing Formula"
  },
  {
    "objectID": "Chapter8.html#chooser-payoff",
    "href": "Chapter8.html#chooser-payoff",
    "title": "8  Exotic Options",
    "section": "Chooser Payoff",
    "text": "Chooser Payoff\nThe value of the chooser at date \\(T\\) will be the larger of the call and put prices. Let \\(S^*\\) denote the stock price at which the call and put have the same value. We can find \\(S^*\\) by solving\nFor a simple chooser with \\(K_c=K_p=K\\) and \\(T_c=T_p=T'\\), we can find \\(S^*\\) from the put-call parity relation at \\(T\\), leading to \\(S^*=\\E^{(q-r)(T'-T)}K.\\)\nThe call will be chosen when \\(S(T)>S^*\\) and it finishes in the money if \\(S(T_c)>K_c\\) at date \\(T_c\\), so the payoff of the chooser is \\(S(T_c)-K_c\\) when \\[S(T)>S^* \\quad \\text{and}\\quad S(T_c)>K_c\\;.\n\\] The payoff is \\(K_p-S(T_p)\\) at date \\(T_p\\) when \\[\nS(T)<S^* \\quad \\text{and}\\quad S(T_p)<K_p\\;.\n\\] Let \\[\\begin{align*}\nx&= \\begin{cases} 1 &\\text{if $S(T)>S^* $ and $S(T_c)>K_c$\\;,}\\\\\n                               0 & \\text{otherwise\\;.}\n        \\end{cases}\\\\\n\\intertext{Likewise, let}\ny&= \\begin{cases} 1 &\\text{if $S(T)<S^*$ and $S(T_p)<K_p$\\;,}\\\\\n                               0 & \\text{otherwise\\;.}\n        \\end{cases}\n\\end{align*}\\] Then the payoff of the chooser is \\(xS(T_c)-xK_c\\) at date \\(T_c\\) and \\(yK_p-yS(T_p)\\) at date \\(T_p\\)."
  },
  {
    "objectID": "Chapter8.html#chooser-pricing-formula",
    "href": "Chapter8.html#chooser-pricing-formula",
    "title": "8  Exotic Options",
    "section": "Chooser Pricing Formula",
    "text": "Chooser Pricing Formula\nEquation [chooser1] and calculations similar to those of the previous two sections lead us to:"
  },
  {
    "objectID": "Chapter8.html#call-on-the-max-payoff",
    "href": "Chapter8.html#call-on-the-max-payoff",
    "title": "8  Exotic Options",
    "section": "Call-on-the-Max Payoff",
    "text": "Call-on-the-Max Payoff\nTo value the above option, define the random variables: \\[\\begin{align*}\nx&= \\begin{cases} 1 & \\text{if $S_1(T)>S_2(T)$ and $S_1(T)>K$}\\; ,\\\\\n0 & \\text{otherwise}\\;, \\end{cases}\\\\\ny&= \\begin{cases} 1 & \\text{if $S_2(T)> S_1(T)$ and $S_2(T)>K$}\\; ,\\\\\n0 & \\text{otherwise}\\;, \\end{cases}\\\\\nz&= \\begin{cases} 1 & \\text{if $S_1(T) > K$ or $S_2(T)> K$}\\; ,\\\\\n0 & \\text{otherwise}\\;. \\end{cases}\n\\end{align*}\\] Then the value of the option at maturity is \\[xS_1(T) + yS_2(T) - zK\\; .\\]"
  },
  {
    "objectID": "Chapter8.html#down-and-out-call-pricing-formula",
    "href": "Chapter8.html#down-and-out-call-pricing-formula",
    "title": "8  Exotic Options",
    "section": "Down-and-Out Call Pricing Formula",
    "text": "Down-and-Out Call Pricing Formula"
  },
  {
    "objectID": "Chapter8.html#floating-strike-lookback-call-payoff",
    "href": "Chapter8.html#floating-strike-lookback-call-payoff",
    "title": "8  Exotic Options",
    "section": "Floating-Strike Lookback Call Payoff",
    "text": "Floating-Strike Lookback Call Payoff\nAs in the previous section, let \\(z\\) denote the minimum stock price realized over the remaining lifetime of the contract. This is not necessarily the minimum stock price realized during the entire lifetime of the contract. Let \\(S_{\\min}\\) denote the minimum stock price realized during the lifetime of the contract up to and including date 0, which is the date at which we are valuing the contract. The minimum stock price during the entire lifetime of the contract will be the smaller of \\(z\\) and \\(S_{\\text{min}}\\). The payoff of the floating strike lookback call is \\(S(T) - \\min\\left(z, S_{\\text{min}}\\right)\\)."
  },
  {
    "objectID": "Chapter8.html#calculations",
    "href": "Chapter8.html#calculations",
    "title": "8  Exotic Options",
    "section": "Calculations",
    "text": "Calculations\nThe value at date 0 of the piece \\(S(T)\\) is simply \\(\\E^{-qT}S(0)\\). Using the result in Appendix [a_minimum] on the distribution of \\(z\\), it can be shown (see, e.g., Musiela and Rutkowski [@MR] for the details) that the value at date 0 of receiving \\[\\min(z, S_{\\text{min}})\\] at date \\(T\\) is \\[\\begin{multline*}\n\\E^{-rT}S_{\\text{min}}\\N(d_2) -\\frac{\\sigma^2}{2(r-q)}\\left(\\frac{S_{\\text{min}}}{S(0)}\\right)^{2(r-q)/\\sigma^2}\\E^{-rT}S(0)\\N(d_2') \\\\\n+\\left(1+ \\frac{\\sigma^2}{2(r-q)}\\right)\\E^{-qT}S(0)\\N(-d_1)\\;.\n\\end{multline*}\\] where Using the fact that \\([1-\\N(-d_1)]\\E^{-qT}S(0)=\\E^{-qT}S(0)\\N(d_1)\\), this implies:"
  },
  {
    "objectID": "Chapter8.html#floating-strike-lookback-call-pricing-formula",
    "href": "Chapter8.html#floating-strike-lookback-call-pricing-formula",
    "title": "8  Exotic Options",
    "section": "Floating-Strike Lookback Call Pricing Formula",
    "text": "Floating-Strike Lookback Call Pricing Formula"
  },
  {
    "objectID": "Chapter8.html#bivariate-normal-distribution-function",
    "href": "Chapter8.html#bivariate-normal-distribution-function",
    "title": "8  Exotic Options",
    "section": "Bivariate Normal Distribution Function",
    "text": "Bivariate Normal Distribution Function\nThe following is a fast approximation of the bivariate cumulative normal distribution function, accurate to six decimal places, due to Drezner [@Drezner]). For given numbers \\(a\\) and \\(b\\), this function gives the probability that \\(\\xi_1<a\\) and \\(\\xi_2<b\\) where \\(\\xi_1\\) and \\(\\xi_2\\) are standard normal random variables with a given correlation \\(\\rho\\), which we must input.\n\nNotice that this function calls itself. This is an example of ``recursion.’’"
  },
  {
    "objectID": "Chapter8.html#forward-start-call",
    "href": "Chapter8.html#forward-start-call",
    "title": "8  Exotic Options",
    "section": "Forward-Start Call",
    "text": "Forward-Start Call\nThe forward-start call pricing formula is of the same form as the Black-Scholes, Margrabe, Black, and Merton formulas, as discussed in Sect. [s_matlabimplementations]. We can compute it with our Generic_Option pricing function."
  },
  {
    "objectID": "Chapter8.html#call-on-a-call",
    "href": "Chapter8.html#call-on-a-call",
    "title": "8  Exotic Options",
    "section": "Call on a Call",
    "text": "Call on a Call\nWe will use bisection to find the critical price \\(S^*\\). We can use \\(e^{q(T'-T)}(K+K')\\) as an upper bound for \\(S^*\\) and 0 as a lower bound.\nThe following uses \\(10^{-6}\\) as the error tolerance in the bisection."
  },
  {
    "objectID": "Chapter8.html#call-on-a-put",
    "href": "Chapter8.html#call-on-a-put",
    "title": "8  Exotic Options",
    "section": "Call on a Put",
    "text": "Call on a Put\nThe implementation of the call-on-a-put formula is of course very similar to that of a call-on-a-call. One difference is that there is no obvious upper bound for \\(S^*\\), so we start with \\(2K'\\) (= 2*K2) and double this until the value of the put is below \\(K\\). We can take 0 again to be the lower bound. Recall that we assume \\(K<\\E^{-r(T'-T)}K'\\) and the right-hand side of this is the value of the put at date \\(T\\) when \\(S(T)=0\\)."
  },
  {
    "objectID": "Chapter8.html#american-calls-with-discrete-dividends",
    "href": "Chapter8.html#american-calls-with-discrete-dividends",
    "title": "8  Exotic Options",
    "section": "American Calls with Discrete Dividends",
    "text": "American Calls with Discrete Dividends\nTo value an American call when there is one dividend payment before the option matures, we input the initial asset price \\(S(0)\\) and then compute \\(Z(0)=X(0)-\\E^{-rT}D\\). If \\(D-K \\leq -\\E^{-r(T'-T)}K\\), we return the Black-Scholes value of a European call written on \\(Z\\). Otherwise, we need to compute \\(Z^*\\) and our bisection algorithm requires an upper bound for \\(Z^*\\), which would be any value of \\(Z(T)\\) such that exercise at \\(T\\) is optimal. It is not obvious what this should be, so we start with \\(K\\) and keep doubling this until we obtain a value of \\(Z(T)\\) at which exercise would be optimal. Then, we use the bisection algorithm to compute \\(Z^*\\) and finally compute the option value [americancall]."
  },
  {
    "objectID": "Chapter8.html#choosers",
    "href": "Chapter8.html#choosers",
    "title": "8  Exotic Options",
    "section": "Choosers",
    "text": "Choosers\nTo implement the bisection to compute \\(S^*\\), we can take zero as a lower bound and \\(K_c+K_p\\) as an upper bound."
  },
  {
    "objectID": "Chapter8.html#floating-strike-lookbacks",
    "href": "Chapter8.html#floating-strike-lookbacks",
    "title": "8  Exotic Options",
    "section": "Floating-Strike Lookbacks",
    "text": "Floating-Strike Lookbacks"
  },
  {
    "objectID": "Chapter8.html#discretely-sampled-geometric-average-price-calls",
    "href": "Chapter8.html#discretely-sampled-geometric-average-price-calls",
    "title": "8  Exotic Options",
    "section": "Discretely-Sampled Geometric-Average-Price Calls",
    "text": "Discretely-Sampled Geometric-Average-Price Calls"
  },
  {
    "objectID": "Chapter9.html",
    "href": "Chapter9.html",
    "title": "9  More on Monte Carlo and Binomial Valuation",
    "section": "",
    "text": "This chapter is a continuation of Chap. [c_introcomputation], introducing somewhat more advanced issues and applications of Monte Carlo and binomial models. We will consider some of the exotic options introduced in the previous chapter for which closed-form solutions do not exist: basket options, spread options, discretely-sampled lookback options, and Asian options. The next chapter introduces finite difference methods, which are similar to binomial models in their applications (useful for American options, not so useful for path-dependent options) but generally faster."
  },
  {
    "objectID": "Chapter9.html#monte-carlo-valuation-of-path-dependent-options",
    "href": "Chapter9.html#monte-carlo-valuation-of-path-dependent-options",
    "title": "9  More on Monte Carlo and Binomial Valuation",
    "section": "Monte Carlo Valuation of Path-Dependent Options",
    "text": "Monte Carlo Valuation of Path-Dependent Options\nWe will illustrate the valuation of path-dependent options by Monte Carlo by valuing a discretely-sampled floating-strike lookback call.\nThe inputs of the following are the same as for the lookback-call pricing function in Sect. [s_lookbacks], plus the number of time periods N and the number of simulations M. The logarithm of the initial stock price S and the logarithm of the historical minimum Smin are calculated and stored at the beginning of the program. In each simulation \\(i = 1,\\ldots, M\\), the variables logS and logSmin are initialized to equal the stored values. They are then updated at each time period \\(j=1,\\ldots N\\) in accord with [pathdependent], with LogSmin being changed only when a new minimum is reached."
  },
  {
    "objectID": "Chapter9.html#binomial-valuation-of-american-spread-options",
    "href": "Chapter9.html#binomial-valuation-of-american-spread-options",
    "title": "9  More on Monte Carlo and Binomial Valuation",
    "section": "Binomial Valuation of American Spread Options",
    "text": "Binomial Valuation of American Spread Options\nTo illustrate binomial valuation of basket and spread options, we will consider an American put written on a spread \\(S_1 - S_2\\). The value of the option at maturity is \\[\\max\\big(0,K-[S_1(T)-S_2(T)]\\big) = \\max\\big(0,K-S_1(T)+S_2(T)\\big)\\; .\\] We input the stock parameters as vectors \\(=\\{S(1),S(2)\\}\\), \\(= \\{q(1),q(2)\\}\\), \\(=\\{\\sigma(1),\\sigma(2)\\}\\). This can be done by inputting a cell range (e.g., ) for each variable or by inputting the values enclosed in curly braces (e.g., \\(\\{50,40\\}\\)). The following declares certain arrays and defines the binomial parameters.\n\nIn each of the two binomial models, there are \\(N+1\\) nodes at the last date. This implies \\((N+1)^2\\) possible combinations. We define the put values at the last date by looping over the \\(N+1\\) possibilities for the second stock price, for each possible value for the first stock price. Rather than recalculating the \\(N+1\\) values for the second stock price each time we loop over them, it is more efficient to store them in a vector. For the sake of simplicity, we will do the same for the first stock. We store all the prices in a \\(2 \\times (N\\!+\\!1)\\) array denoted Stock. We store the put values in an \\((N\\!+\\!1) \\times (N\\!+\\!1)\\) array. PutV(0,0) is the put value when both stocks are at their bottom nodes, PutV(0,1) is the value when the first stock is at its bottom node and the second stock is one node up from the bottom, etc.\nNow we back up \\(N\\) times to get to the beginning of the tree, checking the early exercise condition at each date, and return the put value as ."
  },
  {
    "objectID": "Chapter9.html#cholesky-decomposition",
    "href": "Chapter9.html#cholesky-decomposition",
    "title": "9  More on Monte Carlo and Binomial Valuation",
    "section": "Cholesky Decomposition",
    "text": "Cholesky Decomposition\nAn algorithm for computing the decomposition is as follows. We assume the \\(L\\times L\\) matrix has been input as , with the interpretation that is \\(\\sigma_i\\sigma_j\\rho_{ij}\\) and is~\\(\\sigma_i^2\\) for \\(i, j = 1, \\ldots, L\\). We start the indices \\(i,j\\) at 1 because this is the convention when inputting arrays from an Excel worksheet. The output matrix is also indexed \\(i,j = 1, \\ldots, L\\)."
  },
  {
    "objectID": "Chapter9.html#monte-carlo-valuation-of-european-basket-options",
    "href": "Chapter9.html#monte-carlo-valuation-of-european-basket-options",
    "title": "9  More on Monte Carlo and Binomial Valuation",
    "section": "Monte Carlo Valuation of European Basket Options",
    "text": "Monte Carlo Valuation of European Basket Options\nWe input S as the vector of initial asset prices, q as the vector of dividend yields, cov as the covariance matrix, w as the vector of weights defining the basket option, and L as the number of assets in the basket. The following function can also be used to value a spread option, by inputting L \\(=2\\) and w = \\([1, -1]\\)."
  },
  {
    "objectID": "Chapter9.html#monte-carlo-valuation-with-an-antithetic-variate",
    "href": "Chapter9.html#monte-carlo-valuation-with-an-antithetic-variate",
    "title": "9  More on Monte Carlo and Binomial Valuation",
    "section": "Monte Carlo Valuation with an Antithetic Variate",
    "text": "Monte Carlo Valuation with an Antithetic Variate\nWe will illustrate antithetic variates by modifying our previous valuation of a floating strike call. We denote \\(\\log S\\) by and \\(\\log S^*\\) by . We simulate \\[\\varDelta \\,\\text{LogS(1)} = \\nu\\,\\varDelta t + \\sigma \\varDelta B\\] and \\[\\varDelta \\,\\text{LogS(2)} = \\nu\\,\\varDelta t - \\sigma \\varDelta B\\; .\\] We compute the minimums and of the logarithms of the two stock prices for each simulated path, and compute at the end of each simulated path the average call value \\[0.5 \\times \\max\\left(0,\\E^{\\text{LogS(1)}} - \\E^{\\text{LogSMin(1)}}\\right) + 0.5 \\times \\max\\left(0,\\E^{\\text{LogS(2)}} - \\E^{\\text{LogSMin(2)}}\\right)\\; .\\]"
  },
  {
    "objectID": "Chapter9.html#monte-carlo-valuation-with-a-control-variate",
    "href": "Chapter9.html#monte-carlo-valuation-with-a-control-variate",
    "title": "9  More on Monte Carlo and Binomial Valuation",
    "section": "Monte Carlo Valuation with a Control Variate",
    "text": "Monte Carlo Valuation with a Control Variate\nWe use the geometric average as a control variate for the arithmetic average in an average-price call, using a pre-sample to estimate the beta. For pedagogic purposes, we return the beta in addition to the call value."
  },
  {
    "objectID": "Chapter9.html#accelerated-binomial-valuation-of-american-puts",
    "href": "Chapter9.html#accelerated-binomial-valuation-of-american-puts",
    "title": "9  More on Monte Carlo and Binomial Valuation",
    "section": "Accelerated Binomial Valuation of American Puts",
    "text": "Accelerated Binomial Valuation of American Puts\nFirst we create a binomial valuation program that replaces (i) calculation of the intrinsic value at maturity and (ii) calculation of the value at the penultimate date as the larger of intrinsic value and the discounted value at maturity with (iii) calculation of the value at the penultimate date as the larger of intrinsic value and the Black-Scholes value of a European option with one period to maturity.\n\nNow we create a program that uses Richardson extrapolation from a binomial model with \\(N\\) periods and a binomial model with \\(N/2\\) periods to estimate the value from a binomial model with an infinite number of periods. We use the previous program as our binomial model."
  },
  {
    "objectID": "Chapter10.html",
    "href": "Chapter10.html",
    "title": "10  Finite Difference Methods",
    "section": "",
    "text": "In this chapter we will see how to estimate derivative values by numerically solving the partial differential equation (pde) that the derivative value satisfies, using finite difference methods. More advanced discussions of this topic can be found in Wilmott, DeWynne and Howison [@WDH], Wilmott [@Wilmott], and Tavella [@Tavella], among other places. We will only consider derivatives written on a single underlying asset, but the ideas generalize to derivatives written on multiple underlying assets (e.g., basket and spread options) in much the same way that binomial models can be applied to derivatives on multiple underlying assets. The curse of dimensionality is the same for finite difference methods as for binomial models—the computation time increases exponentially with the number of underlying assets # Fundamental PDE {#fundamentalpde}\nConsider an asset with price \\(S\\) and constant dividend yield \\(q\\).\nSet \\(X=\\log S\\). Then we have \\[\\D X = \\nu\\,\\D t+\\sigma\\,\\D B\\; ,\\] where \\(\\nu =r-q-\\sigma^2/2\\) and \\(B\\) is a Brownian motion under the risk-neutral measure.\nLet \\(T\\) denote the maturity date of a derivative security. At time \\(t\\) (when the remaining time to maturity is \\(T-t\\)), assume the price of the derivative can be represented as \\(C(t,X(t))\\).1\nOn the other hand, under the risk-neutral measure, the instantaneous expected rate of return on the derivative is the risk-free rate, so \\[\\frac{\\D C}{C} =r\\,\\D t + \\text{something}\\,\\,\\D B\\; .\\] where the “something” is the volatility of the derivative value. We can of course rearrange this as \\[\\begin{equation}\\label{1}\n\\D C = rC\\,\\D t+\\text{something}\\,\\,C\\,\\D B\\;.\n\\end{equation}\\] In order for both [2] and [1] to hold, the drifts on both right-hand sides must be equal.2 This implies\nSometimes one writes the derivative value as a function of time to maturity (\\(\\tau = T-t\\)) instead of \\(t\\). The partial derivative of \\(C\\) with respect to \\(\\tau\\) is the negative of the partial derivative with respect to \\(t\\), so the fundamental pde is the same except for a different sign on the first term of the right-hand side of [3]. Rearranging a little, we have \\[\\begin{equation}\\label{4}\n\\frac{\\partial C}{\\partial \\tau} = -rC + \\nu\\frac{\\partial C}{\\partial X}+ \\frac{1}{2}\\sigma^2\\frac{\\partial^2 C}{\\partial X^2}\\;.\\tag{\\ref{3}$'$}\n\\end{equation}\\] In this form, the pde is similar to important equations in physics, in particular the equation for how heat propagates through a rod over time. In fact, it can be transformed exactly into the heat equation, which is how Black and Scholes originally solved the option valuation problem. The terminal condition for a call option, \\(C = \\max(S-K,0)\\), can be viewed as defining \\(C\\) over the \\(X\\) dimension at \\(\\tau=0\\), just as the temperature along the length of the rod might be specified at an initial date, and as \\(\\tau\\) increases \\(C\\) changes at each point \\(X\\) according to [4], which is similar, as noted, to the equation for the change in temperature at a point on the rod as time passes."
  },
  {
    "objectID": "Chapter10.html#crank-nicolson",
    "href": "Chapter10.html#crank-nicolson",
    "title": "10  Finite Difference Methods",
    "section": "Crank-Nicolson",
    "text": "Crank-Nicolson\nWe will create a program that solves a system of equations of the form [crank3], [crank4a] and [crank4b]. We input the vector \\(a\\) of coefficients, a vector \\(y\\) of dimension \\(2M+1\\) containing the estimated values of the derivative at any date \\(t_{i+1}\\), an integer \\(L\\) from which \\(M\\) is defined as \\(M=(L-1)/2\\) (i.e., \\(L=2M+1\\)). The function will return the vector of values at date \\(t_i\\).\nWe will write the boundary conditions \\(\\eqref{crank4a}\\) and \\(\\eqref{crank4b}\\), respectively, in the more general forms where \\(z_1\\), \\(b_1\\), \\(z_L\\) and \\(b_L\\) are numbers to be calculated or input by the user. The equations [crank4a] and [crank4b] are the special cases in which \\(z_1 = \\lambda_0(S-S_{\\text{up}})\\), \\(b_1 = 1\\), \\(z_L = \\lambda_\\infty(S-S_{\\text{down}})\\), and \\(b_L=1\\). The additional generality in allowing \\(b_1\\) and \\(b_L\\) to be different from one is important for many purposes, and we will see an example of it in the valuation of barrier options.\nThe system of equations that we want to solve is therefore  \\[\n\\begin{pmatrix}\n1 & -b_1 & 0 & 0 & 0  & \\cdots  & 0 & 0 & 0 & 0 & 0\\\\\n-a_3 & a_1 & - a_2 & 0 & 0 & \\cdots & 0 & 0 & 0 & 0 & 0\\\\\n0 & - a_3 & a_1 & -a_2 & 0 & \\cdots & 0 & 0 & 0 & 0 & 0\\\\\n\\vdots & \\vdots & \\vdots & \\vdots & \\vdots & \\vdots &\\vdots & \\vdots & \\vdots & \\vdots & \\vdots \\\\\n0 & 0 & 0 & 0 & 0 & \\cdots & 0 & -a_3 & a_1 & - a_2 & 0\\\\\n0 & 0 & 0 & 0 & 0 & \\cdots  & 0 & 0 & -a_3 & a_1 & - a_2 \\\\\n0 & 0 & 0 & 0 & 0 & \\cdots  & 0 & 0 & 0 & -b_L & 1 \\end{pmatrix}\n\\begin{pmatrix}\nC_1 \\\\\nC_2\\\\\nC_3\\\\\n\\vdots\\\\\nC_{L-2}\\\\\nC_{L-1}\\\\\nC_L\n\\end{pmatrix}\n=\n\\begin{pmatrix}\nz_1 \\\\\nz_2\\\\\nz_3\\\\\n\\vdots\\\\\nz_{L-2}\\\\\nz_{L-1}\\\\\nz_L\n\\end{pmatrix}\\] where we are denoting the derivative values to be determined at date \\(t_i\\) across the \\(L\\) (\\(=2M+1\\)) space nodes as \\(C_1, \\ldots, C_L\\). The coefficients \\(a_i\\) are defined in [crank3]. The numbers \\(z_2, \\ldots, z_{L-1}\\) are the right-hand sides of [crank3] and are determined by the coefficients \\(a_i\\) and the derivative values \\(y_1, \\ldots, y_{L}\\) at date \\(t_{i+1}\\). The system of equations that must be solved to implement the implicit method is of this same form.\nThe first equation in this array (equation [crank4aa]) can be written as Our induction argument gives us \\[C_{L-1} = u_{L-1} + b_{L-1}C_{L}\\; ,\\] and when we combine these we have two equations in two unknowns and can solve for \\(C_L\\) as \\[C_L = \\frac{z_L+ b_Lu_{L-1}}{1-b_Lb_{L-1}}\\; .\\] We then successively obtain \\(C_{L-1}, C_{L-2}, \\ldots, C_1\\) from \\(\\eqref{crank101}\\)."
  },
  {
    "objectID": "Chapter10.html#crank-nicolson-for-european-options",
    "href": "Chapter10.html#crank-nicolson-for-european-options",
    "title": "10  Finite Difference Methods",
    "section": "Crank-Nicolson for European Options",
    "text": "Crank-Nicolson for European Options\nWe will demonstrate the Crank-Nicolson method by valuing a European call. Any other path-independent European derivative is valued in the same way, by appropriately redefining the value of the derivative at the final date and redefining the constants \\(z_1\\) and \\(z_L\\) in the boundary conditions [crank4aabbcombined] at the bottom and top of the grid.\nAs elsewhere in this chapter, \\(N\\) denotes the number of time periods, and \\(2M+1\\) will be the number of \\(x\\) values on the grid. We use the symbol \\(D\\) to denote the distance of the top (or bottom) of the grid from \\(\\log S(0)\\). In other words, \\(D = x_M-x_0\\). A reasonable value for \\(D\\) would be three standard deviations for \\(\\log S\\), which would mean \\(D = |\\nu|T +3 \\sigma\\sqrt{T}\\). For example, for a one-year option on a stock with a volatility of 30%, it should suffice to input \\(D=1\\).\nAs should be clear, the program is conceptually very similar to a binomial model. The difference is that the “backing up” procedure, which involves node-by-node discounting in a binomial model, here is accomplished via the Crank-Nicolson algorithm.3"
  },
  {
    "objectID": "Chapter10.html#crank-nicolson-for-barrier-options",
    "href": "Chapter10.html#crank-nicolson-for-barrier-options",
    "title": "10  Finite Difference Methods",
    "section": "Crank-Nicolson for Barrier Options",
    "text": "Crank-Nicolson for Barrier Options\nTo price a down-and-out (or up-and-out option), we put the bottom (or top) of the grid at the boundary. The boundary condition that we use is that the value at the boundary is zero. We will consider the example of a down-and-out call option. In this case, the boundary condition at the bottom of the grid is [crank4aa] with \\(z_1=0\\) and \\(b_1 = 0\\). The boundary condition at the top is the same as for an ordinary call. We can easily handle a rebate paid when the option is knocked out by inputting the value of the rebate as \\(z_1\\).\nThe main new issue that we encounter in valuing barriers is locating the boundary of the grid at the barrier. For the down-and-out, we will input the value of the stock price at which the option is knocked out as Bar. We want the bottom of the grid to lie at the natural logarithm of this number. This will influence our choice of the space step \\(\\varDelta x\\), because we want to have an integer number of steps between the bottom of the grid and \\(\\log S(0)\\). We assume that the value \\(M\\) input by the user represents the desired number of space steps above \\(\\log S(0)\\). We start with \\(\\varDelta x=D/M\\) as an initial estimate of the size of the space step. We then decrease it, if necessary, to ensure that the distance between Bar and \\(\\log S(0)\\) is an integer multiple of \\(\\varDelta x\\). We then increase \\(M\\), if necessary, to ensure that the top of the grid will still be at or above \\(D+\\log S(0)\\). Finally, we define the top of the grid to be at \\(\\log S(0) +M \\cdot \\varDelta x\\)."
  },
  {
    "objectID": "Chapter11.html",
    "href": "Chapter11.html",
    "title": "11  Fixed Income Concepts",
    "section": "",
    "text": "We will focus on derivatives and underlyings that have very little default risk and ignore the pricing of default (credit) risk. Credit risk and credit derivatives are booming areas in both theory and practice. For this topic, one can consult the recent books of Bielecki and Rutkowski [@BR], Duffie and Singleton [@DS], Schönbucher [@Schonbucher], and Tavakoli [@Tavakoli]. Another important topic that will not be covered is mortgages.\nIn the first section, we introduce a fundamental construct: the yield curve, by which we mean the yields of (possibly theoretical) zero-coupon bonds of various maturities. The last two sections of the chapter (on principal components) are optional—nothing else in the book builds upon them.\n\n12 The Yield Curve\nGiven prices of discount (zero-coupon) bonds of all maturities, any coupon paying bond can be priced as a portfolio of discount bonds. The relationship between time to maturity and the price of the corresponding discount bond with $1 face value is sometimes called the discount function. An equivalent concept is the yield curve, which is the relationship between time to maturity and the yield of the corresponding discount bond. Yields can be quoted according to different compounding conventions (semi-annual being the most common), but we will continue to use continuous compounding.1 With this convention, the yield of a zero-coupon bond\n with $1 face value having \\(\\tau\\) years to maturity and price \\(P\\) is defined to be the rate \\(y\\) such that \\(P = \\E^{-y\\tau}\\). Denoting this yield \\(y\\) at maturity \\(\\tau\\) by \\(y(\\tau)\\), the yield curve is the collection of yields \\(\\{y(\\tau)| \\tau>0\\}\\), conventionally plotted with maturity \\(\\tau\\) on the horizontal axis and the yields \\(y(\\tau)\\) on the vertical. Usually (but certainly not always) this is an upward sloping curve, meaning that rates at longer maturities are higher than rates at shorter maturities.\nSome amount of estimation is necessary to compute the yield curve. We would like to know yields at arbitrary maturities, but there are not enough actively traded zero-coupon bonds to provide this information. Thus, we have to “fill in” the missing maturities. We may also use coupon-paying bonds (or swap rates, as we will discuss later) to estimate the yields.\nThe most popular method of estimating the yield curve from bond prices is to fit a “cubic spline,” using the prices of a finite set of actively traded bonds. Given the set of bonds, let \\(P_i\\) denote the price of bond \\(i\\), \\(N_i\\) the number of dates at which bond \\(i\\) pays a coupon or its face value, and \\(\\{\\tau_{ij}| j=1, \\ldots, N_i\\}\\) the dates at which bond \\(i\\) pays a coupon or its face value. Finally, let \\(C_{ij}\\) denote the cash flow paid by bond \\(i\\) at date \\(\\tau_{ij}\\) for \\(j=1,\\ldots,N_i\\). Then for each \\(i\\) it “should” be the case that\n\\[\\begin{equation}\\label{yieldcurve1}\nP_i = \\sum_{j=1}^{N_i} \\E^{-y(\\tau_{ij})\\tau_{ij}}C_{ij}\\;.\n\\end{equation}\\] This simply says that the price should be the present value of the cash flows.\nHowever, in practice, we will typically be unable to find yields \\(y(\\tau_{ij})\\) such that [yieldcurve1] holds exactly for each bond \\(i\\). This is due to “measurement errors” in the form of bid-ask spreads and nonsynchronous pricing. Furthermore, even if we can find such yields, we still face the issue of estimating the yields at other maturities \\(\\tau \\notin \\{\\tau_{ij}\\}\\). The cubic spline is one way to address these issues.\nA cubic spline consists of several cubic polynomials “spliced” together at a set of “knot points.” Specifically, it consists of maturities \\(\\tau_1,\\ldots, \\tau_n\\) (the “knot points”) and coefficients \\((a_i, b_i, c_i, d_i)\\) for \\(i= 0,\\ldots,n\\), and the yield curve is modeled as \\[y(\\tau) = \\begin{cases} a_0 \\tau^3 + b_0 \\tau^2 + c_0 \\tau + d_0 & \\text{for $0 < \\tau \\leq \\tau_1\\;,$}\\\\\na_1 \\tau^3 + b_1 \\tau^2 + c_1 \\tau + d_1 & \\text{for $\\tau_1 < \\tau \\leq \\tau_2\\;,$}\\\\\n\\cdots & \\cdots \\\\\na_{n} \\tau^3 + b_{n} \\tau^2 + c_{n} \\tau + d_{n} & \\text{for $\\tau_n < \\tau \\leq T$,}\\end{cases}\n\\] where \\(T\\) is the maximum maturity considered. By changing the constants \\(d_1,\\ldots,d_n\\), we can write this in an equivalent and more convenient form: \\[\\begin{equation}\\label{cubicspline00}\ny(\\tau) = \\begin{cases} a_0 \\tau^3 + b_0 \\tau^2 + c_0 \\tau + d_0 & \\text{for $0 < \\tau \\leq \\tau_1\\;,$}\\\\\na_1 (\\tau-\\tau_1)^3 + b_1 (\\tau-\\tau_1)^2 + c_1 (\\tau-\\tau_1)+ d_1 & \\text{for $\\tau_1 < \\tau \\leq \\tau_2\\;,$}\\\\\n\\cdots & \\cdots \\\\\na_{n} (\\tau-\\tau_n)^3 + b_{n} (\\tau-\\tau_n)^2 + c_{n} (\\tau-\\tau_n) + d_{n} & \\text{for $\\tau_n < \\tau \\leq T\\;.$}\\end{cases}\n\\end{equation}\\]\nTo “splice” these polynomials together at the knot points means to choose the coefficients so that the two polynomials that meet at a knot point have the same value and the same first and second derivatives at the knot point. For example, at the first knot point \\(\\tau_1\\), we want the adjacent polynomials to satisfy \\[\n\\begin{array}{llrcl}\n\\text{Equality of yields:} &\\quad &a_0 \\tau_1^3 + b_0 \\tau_1^2 + c_0 \\tau_1 + d_0 &= &d_1\\; ,\\\\\n\\text{Equality of first derivatives:} & \\quad &3a_0 \\tau_1^2 + 2b_0 \\tau_1 + c_0  &= &c_1\\; ,\\\\\n\\text{Equality of second derivatives:} & \\quad &6a_0 \\tau_1 + 2b_0  &= &2b_1\\;.\n\\end{array}\\] Thus, given the coefficients \\(a_0, b_0, c_0, d_0\\), the only free coefficient for the second polynomial is~\\(a_1\\). Likewise, at the second knot point \\(\\tau_2\\), we want the adjacent polynomials to agree with regard to: \\[\n\\begin{array}{llrcl}\n\\text{Yields:} &\\quad &a_1 (\\tau_2-\\tau_1)^3 + b_1(\\tau_2- \\tau_1)^2 + c_1 (\\tau_2-\\tau_1) + d_1 &= &d_2\\; ,\\\\\n\\text{First derivatives:} & \\quad &3a_1 (\\tau_2-\\tau_1)^2 + 2b_1(\\tau_2- \\tau_1) + c_1  &= &c_2\\; ,\\\\\n\\text{Second derivatives:} & \\quad &6a_1 (\\tau_2-\\tau_1) + 2b_1  &= &2b_2\\;.\n\\end{array}\\] Thus, the only free coefficient for the third polynomial is~\\(a_2\\). Continuing in this way, we see that the cubic spline is defined by the knot points and the coefficients \\(a_0\\), \\(b_0\\), \\(c_0\\), \\(d_0\\), \\(a_1\\), \\(a_2\\), …, \\(a_n\\). One wants to choose the knot points (hopefully, not too many) and these coefficients so that the relations [yieldcurve1] hold as closely as possible in some sense. For more on this subject, a good reference is James and Webber [@JW].\n\n\n13 LIBOR\nMany fixed-income instruments have cash flows tied to interest rate indices that are quoted as simple (i.e., noncompounded) interest rates. If you deposit $1 at an annualized simple interest rate of \\(\\mathcal{R}\\) for a period of time \\(\\varDelta t\\), then at the end of the period you will have \\(1+\\mathcal{R}\\,\\varDelta t\\) dollars.2 The most common interest rate index is LIBOR (London Inter-Bank Offered Rate)\n which is an average rate offered by large London banks on large deposits for a specific term. For example, if \\(\\mathcal{R}\\) denotes six-month LIBOR, a $1 million deposit at this rate will grow in six months to $1 million times \\(1+\\mathcal{R}\\,\\varDelta t\\), where \\(\\varDelta t=1/2\\). We will use “LIBOR” as a generic term for such indices.\nWe will frequently find it convenient to express LIBOR rates in terms of equivalent bond prices. As before, let \\(P(t,u)\\) denote the price at date \\(t\\) of a zero-coupon bond with a face value of $1 maturing at date \\(u\\), having \\(\\varDelta t = u-t\\) years to maturity. Previously, we used this notation only for default-free bonds such as Treasuries. However, there is a small amount of credit risk in LIBOR rates because of the possibility of a bank failure. In discussing derivatives linked to LIBOR rates, such as swaps, caps, and floors, we will use the notation \\(P(t,u)\\) for the price of a bond having the same default risk as a LIBOR deposit, but our models will ignore the possibility of default. An investment of $1 at date \\(t\\) in the bond will purchase \\(1/P(t,u)\\) units of the bond, which, in the absence of default, will be worth \\(1/P(t,u)\\) dollars at maturity. We will assume\n\\[\\begin{equation}\\label{spot1}\n\\frac{1}{P(t,u)} = 1+\\mathcal{R}\\,\\varDelta t\\;.\n\\end{equation}\\] When necessary for clarity, we call the rate \\(\\mathcal{R}\\) a “spot rate” (at date \\(t\\) for the time period \\(\\varDelta t\\)), to distinguish it from “forward rates” to be defined later. The spot rate is also called a “floating rate,” because it changes with market conditions.\n\n\n14 Swaps\nA “plain vanilla” interest rate swap involves the swap of a fixed interest rate for a floating interest rate on a given “notional principal.” Let \\(\\bar{\\mathcal{R}}\\) denote the fixed rate on a swap. The floating rate will be LIBOR (or some other interest rate index). In addition to \\(\\bar{\\mathcal{R}}\\) and the floating rate index, the swap is defined by “payment dates,” which we will denote by \\(t_1,\\dots,t_N\\), with \\(t_{i+1}-t_i=\\varDelta t\\). In the most common form, the “reset dates” are \\(t_0,\\ldots,t_{N-1}\\), with \\(t_1-t_0=\\varDelta t\\) also.\nAt each reset date \\(t_i\\), the simple interest rate \\(\\mathcal{R}_i\\) for period \\(\\varDelta t\\) is observed. This rate determines a payment at the following date \\(t_{i+1}\\). In terms of bond prices, \\(\\mathcal{R}_i\\) is defined in accord with [spot1], substituting date \\(t_i\\) for date \\(t\\) and date \\(t_{i+1}\\) for date \\(u\\); i.e., \\[\\begin{equation}\\label{spot2}\n\\frac{1}{P(t_i,t_{i+1})} = 1+\\mathcal{R}_i\\,\\varDelta t\\;.\n\\end{equation}\\]\nOne can enter a swap as the fixed-rate payer, normally called simply the “payer” or as the fixed-rate receiver, normally called the “receiver.” The payer pays the fixed rate \\(\\bar{\\mathcal{R}}\\) and receives the spot rate \\(\\mathcal{R}_i\\) at each payment date \\(t_{i+1}\\). Only the net payment is exchanged. If \\(\\bar{\\mathcal{R}} > \\mathcal{R}_i\\) then the amount \\((\\bar{\\mathcal{R}}-\\mathcal{R}_i)\\,\\varDelta t\\) is paid at date \\(t_{i+1}\\) by the payer to the receiver for each $1 of notional principal. If \\(\\bar{\\mathcal{R}} < \\mathcal{R}_i\\), then the payer receives \\((\\mathcal{R}_i - \\bar{\\mathcal{R}})\\,\\varDelta t\\) from the receiver for each $1 of notional principal at date \\(t_{i+1}\\). To state this more simply, the cash flow to the payer is \\((\\mathcal{R}_i - \\bar{\\mathcal{R}})\\,\\varDelta t\\) and the cash flow to the receiver is \\((\\bar{\\mathcal{R}}-\\mathcal{R}_i)\\,\\varDelta t\\), with the usual understanding that a negative cash flow is an outflow. Note that there is no exchange of principal at initiation, and there is no return of principal at the end of the swap. The principal is “notional” because it is used only to define the interest payments.\nThe value of a swap to the fixed-rate payer at any date \\(t \\leq t_0\\) is \\[\\begin{equation}\\label{swapvalue100}\nP(t,t_0) - P(t,t_N) - \\bar{\\mathcal{R}}\\,\\varDelta t\\sum_{i=1}^N P(t,t_i)\\;.\n\\end{equation}\\] To see this, note that \\(P(t,t_0)\\) is the cost at date \\(t\\) of receiving $1 at \\(t_0\\). This $1 can be invested at \\(t_0\\) at the rate \\(\\mathcal{R}_0\\) and the amount \\(\\mathcal{R}_0 \\,\\varDelta t\\) withdrawn at \\(t_1\\) with the $1 principal rolled over at the new rate \\(\\mathcal{R}_1\\). Continuing in this way, one obtains the cash flow \\(\\mathcal{R}_i\\,\\varDelta t\\) at each payment date \\(t_{i+1}\\) and the recovery of the $1 principal at date \\(t_N\\). The value of the $1 principal at date \\(t_N\\) is negated in expression [swapvalue100] by the term \\(-P(t,t_N)\\). Thus, \\(P(t,t_0)-P(t,t_N)\\) is the value of the floating rate payments on the notional principal. On the other hand, \\(\\bar{\\mathcal{R}}\\,\\varDelta t\\sum_{i=1}^N P(t,t_i)\\) is the value of the fixed-rate payments. Therefore, expression \\(\\eqref{swapvalue100}\\) is the difference in the values of the floating and fixed-rate legs. \nAs with a forward price, the swap rate is usually set so that the value of the swap is zero at initiation. A swap initiated at date \\(t \\leq t_0\\) has zero value at initiation if the fixed rate \\(\\bar{\\mathcal{R}}\\) equates the expression [swapvalue100] to zero. This means that \\(\\bar{\\mathcal{R}}=\\mathcal{R}(t)\\), where \\(\\mathcal{R}(t)\\) is defined by \\[\\begin{equation}\\label{swaprate1}\nP(t,t_0) = P(t,t_N) + \\mathcal{R}(t)\\,\\varDelta t\\sum_{i=1}^N P(t,t_i)\\;.\n\\end{equation}\\] If \\(t=t_0\\) the rate \\(\\mathcal{R}(t)\\) is a “spot swap rate,” and and if \\(t<t_0\\) the rate \\(\\mathcal{R}(t)\\) is a “forward swap rate.” The concept of forward swap rates will be important in the discussion of swaptions in Sect. [s_swaptions]. Of course, there are many spot and forward swap rates at any date, corresponding to swaps with different maturities and different payment (and reset) dates.\nThe “swap yield curve” or simply “swap curve” is the relation between time-to-maturity and the yields of discount bonds, where the discount bond prices and yields are inferred from market swap rates. To explain this in a manner consistent with Sect. [s_yieldcurve], consider date \\(t=0\\) and consider swaps with \\(t_0=0\\) (i.e., spot swaps). In the notation of Sect. [s_yieldcurve], and noting that \\(P(0,0)=1\\), equation [swaprate1] can be written in terms of yields as \\[\\begin{equation}\\label{swaprate1b}\n1 = \\E^{-y(t_N)t_N}  + \\sum_{i=1}^N \\E^{-y(t_i)t_i}\\mathcal{R}(0)\\,\\varDelta t\\; .\n\\end{equation}\\] Consider for example a collection of nineteen swaps at date 0 with semi-annual payments and maturity dates \\(t_N=1.0\\), \\(t_N=1.5\\), …, \\(t_N=10.0\\). Each market swap rate (a different rate \\(\\mathcal{R}(0)\\) for each maturity) can be considered to satisfy [swaprate1b]. In these equations we have the twenty yields \\(y(0.5)\\), \\(y(1.0)\\), \\(y(10.0)\\). The yield \\(y(0.5)\\) will be given by six-month LIBOR according to [spot1]. The other nineteen yields can be obtained by simultaneously solving the system of nineteen equations of the form [swaprate1b], given the nineteen market swap rates. In practice, there are missing maturities and the swap curve is estimated using a cubic spline or some other technique, as discussed in Sect. [s_yieldcurve].\n\n\n15 Yield to Maturity, Duration, and Convexity\nConsider a bond with cash flows \\(C_1, ..., C_N\\) at dates \\(u_1 < ... < u_N\\) and price~\\(P\\) at date \\(t\\), where \\(t< u_1\\). Write \\(\\tau_j = u_j-t\\) as the time remaining until the \\(j\\)–th cash flow is paid. The (continuously compounded) yield to maturity of the bond at date \\(t\\) is defined to be the rate \\(\\mathbf{y}\\) such that \\[\\begin{equation}\\label{yieldtomaturity}\nP = \\sum_{j=1}^N \\E^{-\\mathbf{y}\\tau_j}C_j\\;.\n\\end{equation}\\] The bold character \\(\\mathbf{y}\\) is meant to distinguish this from the yield \\(y\\) of a discount bond. Viewing the right-hand side of [yieldtomaturity] as a function of \\(\\mathbf{y}\\), we can express the first derivative in differential form as \\[\\D P = -\\sum_{j=1}^N \\tau_j\\E^{-\\mathbf{y}\\tau_j}C_j\\, \\D \\mathbf{y}\\; ,\\] or, equivalently, \\[\\frac{\\D P}{P} = -\\sum_{j=1}^N \\frac{\\E^{-\\mathbf{y}\\tau_j}C_j}{P}\\tau_j\\, \\D \\mathbf{y}\\; .\\] The factor \\[\\sum_{j=1}^N \\frac{\\E^{-\\mathbf{y}\\tau_j}C_j}{P}\\tau_j\\] is called the “Macaulay duration” of the bond, and we will simplify this to “duration.” It is a weighted average of the times to maturity \\(\\tau_j\\) of the cash flows, the weight on each time \\(\\tau_j\\) being the fraction of the bond value that the cash flow constitutes (using the same rate \\(\\mathbf{y}\\) to discount all of the cash flows). Thus, we have\n\\[\\begin{equation}\\label{durationreturn}\n\\frac{\\D P}{P} = - \\text{Duration} \\times \\,\\D \\mathbf{y}\\;.\n\\end{equation}\\] Given the initial yield \\(\\mathbf{y}\\) and a change in the yield to \\(\\mathbf{y}'\\), this equation suggests the following approximation for the return \\(\\varDelta P/P\\): \\[\\begin{equation}\\label{durationreturn2}\n\\frac{\\varDelta P}{P} \\approx  -  \\text{Duration}  \\times \\,\\varDelta \\mathbf{y}\\;,\n\\end{equation}\\] where \\(\\varDelta \\mathbf{y} = \\mathbf{y}'-\\mathbf{y}\\).\nThe relationship \\(\\eqref{durationreturn2}\\) is the foundation for “duration hedging.” For example, to duration hedge a liability with a present value of \\(x_L\\) dollars and a duration of \\(D_L\\) years, one needs an asset with a value of \\(x_A\\) dollars and a duration of \\(D_A\\) satisfying \\(x_AD_A = x_LD_L\\). If the change in the yields to maturity of the asset and liability are the same number \\(\\varDelta \\mathbf{y}\\), then by \\(\\eqref{durationreturn2}\\) the change in the value of the liability will be approximately \\(-D_L\\,\\varDelta \\mathbf{y}\\) per dollar of initial value, for a total change in value of \\(-x_LD_L\\,\\varDelta \\mathbf{y}\\) dollars. The change in the value of the asset will approximately offset the change in the value of the liability.\nActually, because of the convexity of the bond price \\(\\eqref{yieldtomaturity}\\) as a function of the yield \\(\\mathbf{y}\\), the approximation \\(\\eqref{durationreturn2}\\) will overstate the loss on an asset when the yield rises and understate the gain when the yield falls. Given a change in yield \\(\\varDelta \\mathbf{y}\\), the change in price \\(\\varDelta P = P'-P\\) would actually satisfy \\[\\varDelta P > -  \\text{Duration} \\times P \\times \\varDelta \\mathbf{y}\\; .\\] Thus, if a liability is duration hedged, and the asset value is a “more convex” function of its yield than is the liability value, then an equal change \\(\\varDelta \\mathbf{y}\\) in their yields will lead to a net gain, the asset value falling less than the liability if \\(\\varDelta \\mathbf{y} >0\\) and gaining more than the liability if \\(\\varDelta \\mathbf{y}<0\\). The value of convexity (as a function of the yield to maturity) in a bond portfolio is the same as the value of convexity (as a function of the price of the underlying) in option hedging—cf. Sect. [s_deltahedging].\nIn general, the changes in the yields of an asset and a liability (or two different coupon bonds) will not be equal. To understand how the changes will be related, note that the definition [yieldtomaturity] of the yield to maturity and the formula [yieldcurve1] relating a bond price to the yields of discount bonds imply \\[\\sum_{j=1}^N \\E^{-\\mathbf{y}\\tau_j}C_j =  \\sum_{j=1}^{N} \\E^{-y(\\tau_{j})\\tau_{j}}C_{j}\\; .\\] Taking differentials of both sides, we have \\[\\D P = -P \\times \\text{Duration} \\times \\D \\mathbf{y} = -\\sum_{j=1}^{N} \\tau_j \\E^{-y(\\tau_{j})\\tau_{j}}C_{j}\\,\\D y(\\tau_j)\\; .\\] If we suppose that the changes \\(\\D y(\\tau_j)\\) in the yields of the discount bonds are equal, to, say, \\(\\D y\\), then we have \\[\\D P = -P \\times \\text{Duration} \\times \\D \\mathbf{y} = -P \\times \\text{Duration}' \\times \\D y,\\] where we define \\[\\begin{equation}\\label{newduration100}\n\\text{Duration}' = \\sum_{j=1}^N \\frac{\\E^{-y(\\tau_j)\\tau_j}C_j}{P}\\tau_j.\n\\end{equation}\\] This new definition of duration differs from the previous by using the yields of discount bonds to define the fraction of the bond value that each cash flow contributes, rather than the yield to maturity. If the changes in the yields of discount bonds are equal, then we say that there has been a “parallel shift” in the yield curve—it has moved up or down with the new curve being at each point the same distance from the old. Our previous discussion shows that duration hedging works if we use the new definition [newduration100] of duration and if the yield curve shifts in a parallel fashion. Of course, parallel shifts in the yield curve are not the only, or even most common, types of shifts. In the next two sections, we discuss hedging against more general types of shifts in the yield curve.\nSomething very similar to duration hedging works if we can continuously rebalance the hedge and there is only a single factor determining the yield curve (meaning a single Brownian motion driving all yields). To understand this, we must first note that the expressions given in this section for \\(\\D P\\) are not the Itô differential, which explains how the bond price evolves over time and would include a second-derivative term. For example, in [durationreturn] we are simply asking how different the price would be if the yield to maturity had been different at a given point in time. To define the Itô differential, let now \\(\\mathbf{y}(t)\\) denote the yield to maturity of the bond at date \\(t\\). Equation [yieldtomaturity] can be restated as \\[\\begin{equation}\\label{yieldtomaturityt}\nP(t) = f(t,\\mathbf{y}(t)) = \\sum_{j=1}^N \\E^{\\mathbf{y}(t)(u_j-t)}C_j\\;.\n\\end{equation}\\] Note that even if the yield to maturity were constant over time, the bond price would change with \\(t\\) as a result of the changes in the times to maturity \\(u_j-t\\) of the cash flows. This creates the dependence on \\(t\\) in the function \\(f(t,\\mathbf{y})\\).\nFrom Itô’s formula, we have \\[\\D P = \\frac{\\partial f}{\\partial t} \\, \\D t + \\frac{\\partial f}{\\partial \\mathbf{y}} \\,\\D \\mathbf{y} + \\frac{1}{2} \\frac{\\partial ^2 f}{\\partial \\mathbf{y}^2} (\\D \\mathbf{y})^2\\; .\\]\nAs explained above, the factor \\(\\partial f/\\partial \\mathbf{y}\\) equals \\(- \\text{Duration} \\times P\\). The value of convexity appears here in the last term, the derivative \\(\\partial ^2 f/\\partial \\mathbf{y}^2\\) being positive as a result of convexity and analogous to the gamma of an option. Assuming \\(\\D \\mathbf{y}(t) = \\alpha(t)\\,\\D t+\\sigma(t)\\,\\D B(t)\\) for a Brownian motion \\(B\\) and some \\(\\alpha\\) and \\(\\sigma\\), we have \\[\\frac{\\D P}{P} = \\frac{1}{P}\\left(\\frac{\\partial f}{\\partial t}  + \\frac{\\partial f}{\\partial \\mathbf{y}}\\alpha + \\frac{1}{2} \\frac{\\partial ^2 f}{\\partial \\mathbf{y}^2} \\sigma^2\\right)\\D t-  \\text{Duration}\\times\\sigma \\,\\D B\\; .\\] If the yields of an asset and liability are driven by the same Brownian motion and the duration hedge is adjusted for the relative volatilities of the asset and liability (holding more of the asset if its yield volatility is lower), then a duration hedge will hedge the risky part of the change in the liability value. If adjusted continuously, it will provide a perfect hedge, exactly analogous to a delta hedge of an option position. The Vasicek model we will discuss in Chap. [c_vasicek] and the Cox-Ingersoll-Ross model we will discuss in Chap. [c_survey] are examples of continuous-time models that assume a single Brownian motion driving all yields (i.e., they are single-factor models). The Ho-Lee, Black-Derman-Toy, and Black-Karasinski binomial models that will be discussed in Chap. [c_survey] are also single-factor models and have the same implication for hedging. In the following section, we will discuss the fact that, empirically, there appears to be more than one factor determining the yield curve.\n\n\n16 Principal Components\nThis section will describe a popular statistical method for determining the factors that have the most impact on the yield curve. We consider yields at fixed maturities \\(\\tau_1, ..., \\tau_N\\), the yield for maturity \\(\\tau_j\\) at date \\(t\\) being denoted \\(y(t,\\tau_j)\\). We assume that we have a sample of past yields at dates \\(t_0, ..., t_M\\) at equally spaced dates. Thus, \\(t_i-t_{i-1} = \\varDelta t\\) for some \\(\\varDelta t\\) and each \\(i\\). We compute the changes in yields: \\[\\varDelta_{ij} = y(t_i, \\tau_j) - y(t_{i-1}, \\tau_j)\\; .\\] Thus we are looking at the changes in the yield curve over time periods of length \\(\\varDelta t\\), focusing on \\(N\\) points on the yield curve defined by the maturities~\\(\\tau_j\\). Let \\(V\\) denote the sample covariance matrix of the changes in yields: the element in row \\(j\\) and column \\(k\\) of \\(V\\) is the sample covariance of the changes in yields at maturities \\(\\tau_j\\) and \\(\\tau_k\\); thus, the diagonal elements are the sample variances.3\nThe method of principal components is to compute the “eigenvectors” and “eigenvalues” of the estimated covariance matrix~\\(V\\). An eigenvector is a vector~\\(x\\) for which there corresponds a number \\(\\lambda\\) such that \\(Vx = \\lambda x\\). The number \\(\\lambda\\) is called the eigenvalue corresponding to the eigenvector \\(x\\). Given the \\(N \\times N\\) symmetric matrix \\(V\\), we can construct an \\(N\\times N\\) matrix \\(C\\) whose columns are eigenvectors of \\(V\\) and an \\(N \\times N\\) diagonal matrix \\(D\\) containing the eigenvalues of \\(V\\) on the diagonal. The eigenvectors can be normalized to have unit length and to be mutually orthogonal, which means that the matrix~\\(C\\) of eigenvectors has the property that \\(C^{-1} = C^\\top\\), where \\(C^{-1}\\) denotes the inverse of \\(C\\) and \\(C^\\top\\) its transpose. The property \\(Vx = \\lambda x\\) for the columns~\\(x\\) of \\(C\\) implies that \\(VC= CD\\). Hence \\(C^\\top VC = C^\\top CD = D\\).\nThis can be understood as a factor model for the changes in yields, where there are as many factors as maturities. At date \\(t_i\\), the vector of factor realizations \\(z_{ij}\\) is computed as \\[\\begin{equation}\\label{pc1}\n\\begin{pmatrix} z_{i1} \\\\ \\vdots \\\\ z_{iN} \\end{pmatrix} = C^\\top \\begin{pmatrix} \\varDelta_{i1} \\\\ \\vdots \\\\ \\varDelta_{iN} \\end{pmatrix}\\;.\n\\end{equation}\\] Thus, \\[\\begin{equation}\\label{pc2}\n\\begin{pmatrix} \\varDelta_{i1} \\\\ \\vdots \\\\ \\varDelta_{iN} \\end{pmatrix}  \n= C \\begin{pmatrix} z_{i1} \\\\ \\vdots \\\\ z_{iN} \\end{pmatrix}\\;.\\end{equation}\\] Given any random vector \\(\\xi\\) with covariance matrix \\(\\Sigma\\) and a linear transformation \\(\\xi' = L \\xi\\), the covariance matrix of \\(\\xi'\\) is \\(L\\Sigma L^\\top\\). Therefore, \\(\\eqref{pc1}\\) implies that the covariance matrix of the factors is \\(C^\\top VC\\), and we observed in the previous paragraph that \\(C^\\top VC=D\\). Therefore, the factors are uncorrelated, and the factor variances are the eigenvalues of \\(V\\).\nLet \\(\\beta_{k\\ell}\\) denote the \\((k,\\ell)\\)–th element of \\(C\\). Then we can write \\(\\eqref{pc2}\\) as \\[\\begin{equation}\\label{pc3}\\begin{matrix} \\varDelta_{i1} \\\\ \\vdots \\\\ \\varDelta_{iN} \\end{matrix}\n\\;\\begin{matrix}= \\\\ \\vdots \\\\ = \\end{matrix}\\;\n\\begin{matrix} \\beta_{11}z_{i1} + \\cdots + \\beta_{1N}z_{iN}, \\\\ \\vdots \\\\ \\beta_{N1}z_{i1} + \\cdots + \\beta_{NN}z_{iN} \\;.\\end{matrix}\\end{equation}\\] As in any factor model, the factors are common to all of the maturities. Each factor is random, taking a different value at each date \\(t_i\\). The \\(\\beta\\)’s represent the “loadings” of the yield changes on the factors, \\(\\beta_{k\\ell}\\) being the loading of the change in the yield at maturity \\(\\tau_k\\) on the \\(\\ell\\)-th factor.\nIn a normal factor model, there are fewer factors than variables being explained. It serves no point to have a factor model with as many factors as there are variables to be explained (in our case, as many factors as maturities). We can improve the usefulness of the above by omitting some factors. We will omit the factors that are least important in explaining the changes in yields. For example, if we omit all but the first three factors, we will have \\[\\begin{equation}\\label{pc32}\\begin{matrix} \\varDelta_{i1} \\\\ \\vdots \\\\ \\varDelta_{iN} \\end{matrix}\n\\;\\begin{matrix}= \\\\ \\vdots \\\\ = \\end{matrix}\\;\n\\begin{matrix} \\beta_{11}z_{i1} + \\beta_{12}z_{i2}+ \\beta_{13}z_{i3} +\\varepsilon_{i1}, \\\\ \\vdots \\\\ \\beta_{N1}z_{i1} + \\beta_{N2}z_{i2}+ \\beta_{N3}z_{i3} +\\varepsilon_{iN}\\; ,\\end{matrix}\\end{equation}\\] where \\[\\begin{equation}\\label{principalcomponentsresiduals}\n\\varepsilon_{ij} = \\beta_{j4}z_{i4} + \\cdots + \\beta_{jN}z_{iN}\n\\end{equation}\\] is interpreted as the “residual” part4 of \\(\\varDelta_{ij}\\).\nThe importance of a factor depends on the factor loadings and the variance of the factor. The loadings on the \\(j\\)–th factor are the elements in the \\(j\\)–th column of \\(C\\), which is the \\(j\\)–th eigenvector of \\(V\\). Because the eigenvectors all have unit length and are mutually orthogonal, each vector of loadings has the same importance as any other for explaining the changes in yields. Thus, the importance of a factor in this model depends on the variance of the factor. The variance of the \\(j\\)–th factor is the \\(j\\)–th element on the diagonal of \\(D\\), which is the eigenvalue corresponding to the \\(j\\)–th eigenvector. The factors that we should omit are clearly those with small eigenvalues.\nAs an example, an analysis of monthly changes in (continuously compounded) U.S. Treasury yields from 1992 through 2002 at maturities of 1 month, 3 months, 1 year, 2 years, 3 years, 4 years, and 5 years5 produces seven eigenvalues (corresponding to the seven maturities) that sum to \\(5.526 \\times 10^{-5}\\). This sum is the total variance of the seven factors. The largest eigenvalue is 74% of the total, the two largest eigenvalues constitute 94% of the total, and the three largest constitute 98% of the total. Thus, three factors contribute 98% of the total factor variance for this data set, so a factor model with three (or even two) factors explains a very high percentage of the changes in yields for this data set.\nThe factors can be interpreted by examining the corresponding eigenvectors. The eigenvectors corresponding to the three largest eigenvalues in this data set are the columns below (the first column corresponding to the largest eigenvalue, etc.):\nWe can interpret these as follows. A positive value in a given month for the factor with the highest variance will lead to an increase in all of the yields, because all of the elements in the first column are positive (it will also lead to a slight increase in the slope due to the loadings at longer maturities being generally slightly larger than the loadings at smaller maturities). A positive value for the next factor will decrease yields at short maturities and increase the yields at longer maturities, thus leading to an increase in the slope of the yield curve. A positive value for the third factor will lead to an increase in yields at short and long maturities and a decrease in yields at intermediate maturities, thus affecting the curvature of the yield curve. Results of this sort are common for data sets containing longer maturities also, leading to the conclusion that the most important factor is the level of the yield curve, the second most important factor is the slope of the yield curve, and the third most important factor is the curvature of the yield curve, with three factors explaining nearly all of the variations in yields.\n\n\n17 Hedging Principal Components\nConsider again a bond with cash flows \\(C_1, ..., C_N\\) at dates \\(\\tau_1 < ... < \\tau_N\\) and price \\(P\\) and recall that the price at date \\(0 < \\tau_1\\) should be \\[P = \\sum_{j=1}^{N} \\E^{-y_j\\tau_{j}}C_{j}\\; ,\\] where for convenience we are writing \\(y_j\\) for the yield \\(y(0,\\tau_j)\\) of the discount bond maturing at \\(\\tau_j\\). Viewing the price as a function of \\(y_1, \\ldots, y_N\\), we can write the differential as \\[\\D P = -\\sum_{j=1}^{N} \\tau_j\\E^{-y_j\\tau_{j}}C_{j}\\, \\D y_j\\; .\\] Equivalently, \\[\\frac{\\D P}{P} = -\\sum_{j=1}^{N} \\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j}{P}\\, \\D y_j\\; .\\] Given discrete changes \\(\\varDelta y_j\\) in the yields, this implies the following approximation for the return: \\[\\begin{equation}\\label{durationreturn11}\n\\frac{\\varDelta P}{P} \\approx -\\sum_{j=1}^{N} \\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j}{P}\\, \\varDelta y_j\\;.\n\\end{equation}\\] As in Sect. [s_duration], because of convexity, the approximation understates the new price \\(P' = P + \\varDelta P\\). In Sect. [s_duration] we considered this equation assuming equal changes in the yields (a parallel shift in the yield curve). Here, we will discuss the more general case.\nThe approximation [durationreturn11] suggests how we can hedge against the factors identified in the previous section. For example, let \\(\\beta_{1\\ell}, \\ldots, \\beta_{N\\ell}\\) denote the loadings of the yields at maturities \\(\\tau_1, \\ldots, \\tau_N\\) on the factor with the \\(\\ell\\)–th greatest variance, for \\(\\ell=1, 2, 3\\).6 Then the factor model suggests\n\n\nProblems\nAssume the following discount bond prices for each of the following exercises: \\[\\begin{align*}\nP(0,0.5) & = 0.995\\\\\nP(0,1.0) & = 0.988\\\\\nP(0,1.5) & = 0.978\\\\\nP(0,2.0) & = 0.966\\\\\nP(0,2.5) & = 0.951\\\\\nP(0,3.0) & = 0.935\\\\\nP(0,3.5) & = 0.916\\\\\nP(0,4.0) & = 0.896\\\\\nP(0,4.5) & = 0.874\\\\\nP(0,5.0) & = 0.850\n\\end{align*}\\]\n\n\n\n\n\n\nIt is unlikely that these specific maturities would have been used in the principal components algorithm, so the loadings would have to be estimated by interpolating or fitting some type of curve to the loadings of the maturities that were used.\n\\[\\varDelta y_j \\approx \\beta_{j1} z_1 + \\beta_{j2} z_2 + \\beta_{j3} z_3\\; ,\\] where the \\(z_k\\) denote the realizations of the factors. Combining this with \\(\\eqref{durationreturn11}\\) results in \\[\\begin{align*}\n\\frac{\\varDelta P}{P} &\\approx -\\sum_{j=1}^{N} \\left(\\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j}{P}\\sum_{k=1}^3 \\beta_{jk}z_k \\right)\\\\\n&= -\\sum_{k=1}^3 \\left(\\sum_{j=1}^{N} \\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j\\beta_{jk}}{P}\\right)z_k.\n\\end{align*}\\] This means that the bond return is approximately a linear combination of the factors, with the coefficient (loading) on the \\(k\\)–th factor being \\[\\begin{equation}\\label{modifiedduration3}\n-\\sum_{j=1}^{N} \\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j\\beta_{jk}}{P}\\;.\n\\end{equation}\\] To hedge a liability against the factor, we want this coefficient for the asset multiplied by the dollar value of the asset to equal the corresponding coefficient for the liability multiplied by its dollar value. There are three conditions of this type in a three-factor model, which means that a portfolio of three distinct assets is necessary to hedge a liability. A similar application is in bond portfolio management. If we want to avoid exposing ourselves to factor risk relative to a benchmark portfolio, then we should match the loadings [modifiedduration3] for our portfolio with the corresponding loadings of the benchmark.↩︎\nIt is unlikely that these specific maturities would have been used in the principal components algorithm, so the loadings would have to be estimated by interpolating or fitting some type of curve to the loadings of the maturities that were used.\n\\[\\varDelta y_j \\approx \\beta_{j1} z_1 + \\beta_{j2} z_2 + \\beta_{j3} z_3\\; ,\\] where the \\(z_k\\) denote the realizations of the factors. Combining this with \\(\\eqref{durationreturn11}\\) results in \\[\\begin{align*}\n\\frac{\\varDelta P}{P} &\\approx -\\sum_{j=1}^{N} \\left(\\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j}{P}\\sum_{k=1}^3 \\beta_{jk}z_k \\right)\\\\\n&= -\\sum_{k=1}^3 \\left(\\sum_{j=1}^{N} \\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j\\beta_{jk}}{P}\\right)z_k.\n\\end{align*}\\] This means that the bond return is approximately a linear combination of the factors, with the coefficient (loading) on the \\(k\\)–th factor being \\[\\begin{equation}\\label{modifiedduration3}\n-\\sum_{j=1}^{N} \\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j\\beta_{jk}}{P}\\;.\n\\end{equation}\\] To hedge a liability against the factor, we want this coefficient for the asset multiplied by the dollar value of the asset to equal the corresponding coefficient for the liability multiplied by its dollar value. There are three conditions of this type in a three-factor model, which means that a portfolio of three distinct assets is necessary to hedge a liability. A similar application is in bond portfolio management. If we want to avoid exposing ourselves to factor risk relative to a benchmark portfolio, then we should match the loadings [modifiedduration3] for our portfolio with the corresponding loadings of the benchmark.↩︎\nIt is unlikely that these specific maturities would have been used in the principal components algorithm, so the loadings would have to be estimated by interpolating or fitting some type of curve to the loadings of the maturities that were used.\n\\[\\varDelta y_j \\approx \\beta_{j1} z_1 + \\beta_{j2} z_2 + \\beta_{j3} z_3\\; ,\\] where the \\(z_k\\) denote the realizations of the factors. Combining this with \\(\\eqref{durationreturn11}\\) results in \\[\\begin{align*}\n\\frac{\\varDelta P}{P} &\\approx -\\sum_{j=1}^{N} \\left(\\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j}{P}\\sum_{k=1}^3 \\beta_{jk}z_k \\right)\\\\\n&= -\\sum_{k=1}^3 \\left(\\sum_{j=1}^{N} \\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j\\beta_{jk}}{P}\\right)z_k.\n\\end{align*}\\] This means that the bond return is approximately a linear combination of the factors, with the coefficient (loading) on the \\(k\\)–th factor being \\[\\begin{equation}\\label{modifiedduration3}\n-\\sum_{j=1}^{N} \\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j\\beta_{jk}}{P}\\;.\n\\end{equation}\\] To hedge a liability against the factor, we want this coefficient for the asset multiplied by the dollar value of the asset to equal the corresponding coefficient for the liability multiplied by its dollar value. There are three conditions of this type in a three-factor model, which means that a portfolio of three distinct assets is necessary to hedge a liability. A similar application is in bond portfolio management. If we want to avoid exposing ourselves to factor risk relative to a benchmark portfolio, then we should match the loadings [modifiedduration3] for our portfolio with the corresponding loadings of the benchmark.↩︎\nIt is unlikely that these specific maturities would have been used in the principal components algorithm, so the loadings would have to be estimated by interpolating or fitting some type of curve to the loadings of the maturities that were used.\n\\[\\varDelta y_j \\approx \\beta_{j1} z_1 + \\beta_{j2} z_2 + \\beta_{j3} z_3\\; ,\\] where the \\(z_k\\) denote the realizations of the factors. Combining this with \\(\\eqref{durationreturn11}\\) results in \\[\\begin{align*}\n\\frac{\\varDelta P}{P} &\\approx -\\sum_{j=1}^{N} \\left(\\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j}{P}\\sum_{k=1}^3 \\beta_{jk}z_k \\right)\\\\\n&= -\\sum_{k=1}^3 \\left(\\sum_{j=1}^{N} \\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j\\beta_{jk}}{P}\\right)z_k.\n\\end{align*}\\] This means that the bond return is approximately a linear combination of the factors, with the coefficient (loading) on the \\(k\\)–th factor being \\[\\begin{equation}\\label{modifiedduration3}\n-\\sum_{j=1}^{N} \\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j\\beta_{jk}}{P}\\;.\n\\end{equation}\\] To hedge a liability against the factor, we want this coefficient for the asset multiplied by the dollar value of the asset to equal the corresponding coefficient for the liability multiplied by its dollar value. There are three conditions of this type in a three-factor model, which means that a portfolio of three distinct assets is necessary to hedge a liability. A similar application is in bond portfolio management. If we want to avoid exposing ourselves to factor risk relative to a benchmark portfolio, then we should match the loadings [modifiedduration3] for our portfolio with the corresponding loadings of the benchmark.↩︎\nIt is unlikely that these specific maturities would have been used in the principal components algorithm, so the loadings would have to be estimated by interpolating or fitting some type of curve to the loadings of the maturities that were used.\n\\[\\varDelta y_j \\approx \\beta_{j1} z_1 + \\beta_{j2} z_2 + \\beta_{j3} z_3\\; ,\\] where the \\(z_k\\) denote the realizations of the factors. Combining this with \\(\\eqref{durationreturn11}\\) results in \\[\\begin{align*}\n\\frac{\\varDelta P}{P} &\\approx -\\sum_{j=1}^{N} \\left(\\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j}{P}\\sum_{k=1}^3 \\beta_{jk}z_k \\right)\\\\\n&= -\\sum_{k=1}^3 \\left(\\sum_{j=1}^{N} \\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j\\beta_{jk}}{P}\\right)z_k.\n\\end{align*}\\] This means that the bond return is approximately a linear combination of the factors, with the coefficient (loading) on the \\(k\\)–th factor being \\[\\begin{equation}\\label{modifiedduration3}\n-\\sum_{j=1}^{N} \\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j\\beta_{jk}}{P}\\;.\n\\end{equation}\\] To hedge a liability against the factor, we want this coefficient for the asset multiplied by the dollar value of the asset to equal the corresponding coefficient for the liability multiplied by its dollar value. There are three conditions of this type in a three-factor model, which means that a portfolio of three distinct assets is necessary to hedge a liability. A similar application is in bond portfolio management. If we want to avoid exposing ourselves to factor risk relative to a benchmark portfolio, then we should match the loadings [modifiedduration3] for our portfolio with the corresponding loadings of the benchmark.↩︎\nIt is unlikely that these specific maturities would have been used in the principal components algorithm, so the loadings would have to be estimated by interpolating or fitting some type of curve to the loadings of the maturities that were used.\n\\[\\varDelta y_j \\approx \\beta_{j1} z_1 + \\beta_{j2} z_2 + \\beta_{j3} z_3\\; ,\\] where the \\(z_k\\) denote the realizations of the factors. Combining this with \\(\\eqref{durationreturn11}\\) results in \\[\\begin{align*}\n\\frac{\\varDelta P}{P} &\\approx -\\sum_{j=1}^{N} \\left(\\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j}{P}\\sum_{k=1}^3 \\beta_{jk}z_k \\right)\\\\\n&= -\\sum_{k=1}^3 \\left(\\sum_{j=1}^{N} \\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j\\beta_{jk}}{P}\\right)z_k.\n\\end{align*}\\] This means that the bond return is approximately a linear combination of the factors, with the coefficient (loading) on the \\(k\\)–th factor being \\[\\begin{equation}\\label{modifiedduration3}\n-\\sum_{j=1}^{N} \\frac{\\E^{-y_j\\tau_{j}}C_{j}\\tau_j\\beta_{jk}}{P}\\;.\n\\end{equation}\\] To hedge a liability against the factor, we want this coefficient for the asset multiplied by the dollar value of the asset to equal the corresponding coefficient for the liability multiplied by its dollar value. There are three conditions of this type in a three-factor model, which means that a portfolio of three distinct assets is necessary to hedge a liability. A similar application is in bond portfolio management. If we want to avoid exposing ourselves to factor risk relative to a benchmark portfolio, then we should match the loadings [modifiedduration3] for our portfolio with the corresponding loadings of the benchmark.↩︎"
  },
  {
    "objectID": "Chapter12.html",
    "href": "Chapter12.html",
    "title": "12  Introduction to Fixed Income Derivatives",
    "section": "",
    "text": "In this chapter, we will introduce some fundamental fixed-income derivatives (caps, floors and swaptions) and explain the “market model” approach to valuation. We will also explain the relation between caps, floors and swaptions on the one hand and discount and coupon bond options on the other. This leads to other approaches for valuing caps, floors and swaptions, which will be developed in the following chapters."
  },
  {
    "objectID": "Chapter12.html#valuing-caps-with-blacks-formula",
    "href": "Chapter12.html#valuing-caps-with-blacks-formula",
    "title": "12  Introduction to Fixed Income Derivatives",
    "section": "Valuing Caps with Black’s Formula",
    "text": "Valuing Caps with Black’s Formula\nWe will compute the value of each caplet with the Black_Call function. In the Black_Call function, we input the forward price for the caplet with reset date \\(t_i\\) as \\[\\begin{equation}\\label{capletforwardprice}\nF_i(0) = \\mathcal{R}_i(0)\\,\\varDelta t = \\frac{P(0,t_i)}{P(0,t_{i+1})} - 1\\;,\n\\end{equation}\\] as given in equations \\(\\eqref{forward2}\\) and \\(\\eqref{F_i}\\). The exercise price of each caplet is \\(K=\\bar{\\mathcal{R}}\\,\\varDelta t\\). We also need to input the discounting factor \\(P(0,t_{i+1})\\). The discount bond prices \\(P(0,t_1)\\), …, \\(P(0, t_N)\\) are input as a vector P. The discount bond price \\(P(0,t_0)\\) is input as P0.1 We will assume the same volatility for each forward rate."
  },
  {
    "objectID": "Chapter12.html#valuing-swaptions-with-margrabes-formula",
    "href": "Chapter12.html#valuing-swaptions-with-margrabes-formula",
    "title": "12  Introduction to Fixed Income Derivatives",
    "section": "Valuing Swaptions with Margrabe’s Formula",
    "text": "Valuing Swaptions with Margrabe’s Formula"
  },
  {
    "objectID": "Chapter13.html",
    "href": "Chapter13.html",
    "title": "13  Valuing Derivatives in the Extended Vasicek Model",
    "section": "",
    "text": "In the preceding chapter, we presented models for valuing swaptions, caps, and floors based on assumptions that certain forward rates have constant volatilities. As noted, the assumptions used to value swaptions on the one hand and caps and floors on the other are inconsistent. Because the values of fixed-income derivatives are derived from the yield curve, one can obtain a consistent model by developing a model of how the yield curve will evolve over time. In this chapter, we will give a fairly full account of one popular and relatively simple model. The next chapter contains much briefer descriptions of other models.\nWe will begin by describing the basic Vasicek model. The extended Vasicek model (of which there are several versions) includes time-dependent parameters, so that it can be fit to the yield curve at the time it is used and possibly also to other market variables, such as cap prices or yield volatilities."
  },
  {
    "objectID": "Chapter13.html#discount-bond-options",
    "href": "Chapter13.html#discount-bond-options",
    "title": "13  Valuing Derivatives in the Extended Vasicek Model",
    "section": "Discount Bond Options",
    "text": "Discount Bond Options\nRather than calculating \\(\\sigma_{\\text{avg}}\\) from the volatility \\(\\sigma\\) of the short rate and the constant \\(\\kappa\\) or function \\(\\kappa(t)\\), we will treat \\(\\sigma_{\\text{avg}}\\) as an input into the option pricing formulas. This is necessary if one wants to use (i.e., invert) the following functions to imply \\(\\sigma_{\\text{avg}}\\) from market prices and then used the implied \\(\\sigma_{\\text{avg}}\\) to calibrate the model."
  },
  {
    "objectID": "Chapter13.html#caps",
    "href": "Chapter13.html#caps",
    "title": "13  Valuing Derivatives in the Extended Vasicek Model",
    "section": "Caps",
    "text": "Caps\nWe input the first reset date \\(t_0\\), the time between payments \\(\\varDelta t\\), the total number of payments \\(N\\) and the cap rate \\(\\bar{\\mathcal{R}}\\). As in Sect. [s_fixedincomederivatives_matlab], we input the price of the discount bond maturing at \\(t_0\\) as P0, and we input a vector P containing the \\(N\\) discount bond prices \\(P(0,t_1),\\ldots,P(0,t_{N})\\). We will allow different volatilities for the different caplets. The input sigavg should have elements 1 through \\(N\\), with sigavg(i) being the average volatility of the forward price of the discount bond maturing at \\(t_i\\), where the forward contract matures at \\(t_{i-1}\\), and the average volatility is computed from date 0 to date \\(t_{i-1}\\), according to the formulas in Sect. [s_vasicek_discounts]. Specifically, sigavg(i) should be \\(\\sigma\\,\\varDelta t\\) for the continuous-time Ho-Lee model, and sigavg(i) should be \\[\\begin{equation}\\label{vasicekvbacap}\n\\frac{\\sigma \\E^{-\\kappa t_{i-1}}\\left(1- \\E^{-\\kappa \\,\\varDelta t}\\right) }{\\kappa}\\sqrt{\\frac{\\E^{2\\kappa t_{i-1}}-1}{2\\kappa t_{i-1}}}\n\\end{equation}\\] for the Hull-White model."
  },
  {
    "objectID": "Chapter13.html#coupon-bond-options-in-the-hull-white-model",
    "href": "Chapter13.html#coupon-bond-options-in-the-hull-white-model",
    "title": "13  Valuing Derivatives in the Extended Vasicek Model",
    "section": "Coupon Bond Options in the Hull-White Model",
    "text": "Coupon Bond Options in the Hull-White Model\nWe will value a European call option on a coupon bond. First we create functions to calculate \\(a(\\tau)\\) defined in [extendedvasicek_a], \\(b(\\tau)\\) defined in [extendedvasicek_b], and \\(\\sigma_{\\text{avg}}\\) defined in [vasiceksigmaavg].\n\n\n\nWe calculate the model value of the coupon bond at date \\(T\\) (given by the left-hand side of [swaptions102] for \\(r=r^*\\)) in the function HW_Coup_Bond. The vector Cal contains \\(N\\) elements, and Cal(i) represents the calibration factor \\(\\E^{-\\int_T^{t_i} \\phi(s)\\,\\D s}\\), which will be calculated from [swaptions104] in the main function HW_Coup_Bond_Call.\n\nIn the main function HW_Coupon_Bond_Call, we input the coupon paid by the bond, the number N of coupon payments, the amount of time t1 before the first coupon payment, the amount of time dt between coupon payments, the strike price K of the option, the price MatDisc of the discount bond maturing at the option maturity date \\(T\\), a vector P containing the N market prices of the discount bonds maturing at the coupon payment dates \\(t_1, \\ldots, t_N\\), the current short rate r, the parameters sigma and kappa of the Vasicek model, and the amount of time T until the option matures."
  },
  {
    "objectID": "Chapter14.html",
    "href": "Chapter14.html",
    "title": "14  A Brief Survey of Term Structure Models",
    "section": "",
    "text": "This chapter presents very brief descriptions of several important models. The list of models is certainly not exhaustive, and our descriptions will be far from complete. As mentioned previously, there are many good references for this material in book form already, and our goal here is merely to provide a short introduction."
  },
  {
    "objectID": "Chapter14.html#discount-bond-prices-in-the-cir-model",
    "href": "Chapter14.html#discount-bond-prices-in-the-cir-model",
    "title": "14  A Brief Survey of Term Structure Models",
    "section": "Discount Bond Prices in the CIR Model",
    "text": "Discount Bond Prices in the CIR Model\nDiscount bond prices can be most easily computed in the CIR model by solving the fundamental partial differential equation (pde) discussed in Chap. [c_pde]. Let \\(P(t,u)\\) denote the price at date \\(t\\) of a discount bond maturing at date \\(u\\), having remaining time to maturity of \\(\\tau = u-t\\). The discount bond price will depend on the remaining time to maturity and the short rate at date \\(t\\), because, as in the Vasicek model, the short rate is the only random factor in this model. Thus, there must be some deterministic function \\(f\\) such that \\(P(t,u) = f(r(t),\\tau).\\) As in Chap. [c_pde], the fundamental pde is obtained by applying Itô’s formula to \\(f\\) to compute \\(\\D f\\) in terms of the partial derivatives of \\(f\\) and then using the fact that the expected return of the discount bond (hence the drift of \\(\\D f/f\\)) must equal the short rate under the risk-neutral measure.\nFrom Itô’s formula and the definition [cir] of \\(\\D r\\), we have \\[\\begin{align}\n\\D f &= \\frac{\\partial f}{\\partial \\tau}\\,\\D \\tau + \\frac{\\partial f}{\\partial r}\\,\\D r + \\frac{1}{2}\\frac{\\partial^2 f}{\\partial r^2}\\,(\\D r)^2\\notag\\\\\n& = - \\frac{\\partial f}{\\partial \\tau} \\,\\D t + \\frac{\\partial f}{\\partial r}\\left\\{\\kappa [\\theta-r]\\,\\D t+\\sigma \\sqrt{r}\\,\\D B\\right\\} + \\frac{1}{2}\\frac{\\partial^2f}{\\partial r^2}\\sigma^2r\\,\\D t\\notag\\\\\n&= \\left(- \\frac{\\partial f}{\\partial \\tau} + \\frac{\\partial f}{\\partial r}\\kappa [\\theta-r] + \\frac{1}{2}\\frac{\\partial^2f}{\\partial r^2}\\sigma^2r\\right)\\,\\D t + \\frac{\\partial f}{\\partial r} \\sigma\\sqrt{r}\\,\\D B\\;.\\label{cir10}\n\\end{align}\\] Equating the drift to \\(rf\\,\\D t\\) gives us the fundamental pde: \\[\\begin{equation}\\label{cir2}\n- \\frac{\\partial f}{\\partial \\tau} + \\frac{\\partial f}{\\partial r}\\kappa [\\theta-r] + \\frac{1}{2}\\frac{\\partial^2f}{\\partial r^2}\\sigma^2r = rf\\;.\n\\end{equation}\\] This equation should be solved for the function \\(f\\) subject to the boundary condition that the value of the discount bond is one at maturity; i.e., \\(f(r,0)=1\\) for all \\(r\\).\nThe solution can be obtained by “guessing” a solution of the same form as the Vasicek bond pricing formula [vasicekbond], namely2\n\\[\\begin{equation}\\label{cir3}\nf(r,\\tau) = \\exp\\left(-a(\\tau)-b(\\tau)r\\right)\n\\end{equation}\\] for deterministic functions \\(a\\) and \\(b\\). The boundary condition \\[f(r,0)= \\exp\\left(-a(0)-b(0)r\\right) = 1\\] for all \\(r\\) implies \\(a(0)=b(0)=0\\), and it can easily be checked that the fundamental pde is equivalent to where the “primes” denote derivatives. By differentiating, one can verify that the solution of [betaprime] (which is called a “Riccati equation”) with the boundary condition \\(b(0)=0\\) is To summarize, \nNote that \\(\\eqref{cir3}\\) implies \\(\\partial f/\\partial r = - b(\\tau)f\\). Substituting this into [cir10] gives us the discount bond return as \\[\\begin{equation}\\label{cirdpp}\n\\frac{\\D P(t,u)}{P(t,u)} =\\frac{\\D f}{f} =   r(t)\\,\\D t - b(\\tau)\\sigma\\sqrt{r(t)}\\,\\D B(t)\\;.\n\\end{equation}\\] This is again similar to the Vasicek model except for the appearance of the \\(\\sqrt{\\,r}\\) factor in the volatility. Because of this factor, the volatility is random. Thus, the option pricing formulas of previous chapters cannot be directly applied to price discount bond options (and hence caps, floors, coupon bond options, and swaptions). Nevertheless, the ideas underlying those formulas can be applied to obtain similar valuation formulas.\nHedge ratios depend on relative volatilities, so they are determined by the function \\(b\\), just as discussed in Sect. [s_vasicekhedging] for the Vasicek model."
  },
  {
    "objectID": "Chapter14.html#calibrating-the-cir-model-to-the-yield-curve",
    "href": "Chapter14.html#calibrating-the-cir-model-to-the-yield-curve",
    "title": "14  A Brief Survey of Term Structure Models",
    "section": "Calibrating the CIR Model to the Yield Curve",
    "text": "Calibrating the CIR Model to the Yield Curve\nThe CIR model can be calibrated to current market conditions by taking one or more of the parameters \\(\\kappa\\), \\(\\theta\\) and \\(\\sigma\\) to be time-varying, as in the extended Vasicek model. This was suggested by Cox, Ingersoll and Ross. However, the simplest way to calibrate the model to discount bond prices, which was also suggested by Cox, Ingersoll and Ross, is to take the short rate to be the sum of a non-random function of time and a square-root process as defined in [cir]. Specifically, let \\[r(t) = \\phi(t) + \\hat{r}(t)\\; ,\\] where \\(\\phi\\) is a non-random function and \\(\\hat{r}\\) satisfies \\[\\begin{equation}\\label{cirrhat}\n\\D \\hat{r}(t)=\\kappa [\\theta-\\hat{r}(t)]\\,\\D t+\\sigma \\sqrt{\\hat{r}(t)}\\,\\D B(t)\\;,\n\\end{equation}\\] with \\(\\hat{r}(0) = r(0)\\). Then, as in the Hull-White model, discount bond prices are given by \\[P(t,u) = \\exp\\left(-\\int_t^u \\phi(s)\\,\\D s\\right)E^R_t\\left[\\exp\\left(-\\int_t^u\\hat{r}(s)\\,\\D s\\right)\\right]\\; .\\] Moreover, the expectation in this equation is the discount bond pricing function calculated in the previous subsection, so we have \\[\\begin{equation}\\label{cirPcal}\nP(t,u) = \\exp\\left(-\\int_t^u \\phi(s)\\,\\D s\\right)\\exp\\left(-a(\\tau)-b(\\tau)\\hat{r}(t)\\right)\\;.\n\\end{equation}\\] In particular, discount bond prices at date 0 are \\[P(0,u) = \\exp\\left(-\\int_0^u \\phi(s)\\,\\D s\\right)\\exp\\left(-a(u)-b(u)r(0)\\right)\\; ,\\] so the model can be calibrated to market prices \\(P^{\\text{mkt}}(0,u)\\) by setting \\[\\begin{equation}\\label{circalibration}\n\\exp\\left(-\\int_0^u \\phi(s)\\,\\D s\\right) = \\exp\\left(a(u)+b(u)r(0)\\right)P^{\\text{mkt}}(0,u)\n\\end{equation}\\] for each \\(u\\). Note that the calibration does not affect discount bond returns: the expected return under the risk-neutral measure must still be the short rate and the volatility is unaffected by a deterministic factor. Therefore, we have, as in \\(\\eqref{cirdpp}\\), \\[\\begin{equation}\\label{cirdpp2}\n\\frac{\\D P(t,u)}{P(t,u)}  =   r(t)\\,\\D t - b(\\tau)\\sigma\\sqrt{\\hat{r}(t)}\\,\\D B(t)\\;.\n\\end{equation}\\] This can be verified by applying It^o’s formula to \\(\\eqref{cirPcal}\\)."
  },
  {
    "objectID": "Chapter14.html#pricing-fixed-income-derivatives-in-the-cir-model",
    "href": "Chapter14.html#pricing-fixed-income-derivatives-in-the-cir-model",
    "title": "14  A Brief Survey of Term Structure Models",
    "section": "Pricing Fixed-Income Derivatives in the CIR Model",
    "text": "Pricing Fixed-Income Derivatives in the CIR Model\nIn the previous chapter, it was shown for the extended Vasicek model that pricing formulas for caps, floors, coupon bond options, and swaptions can be derived from a pricing formula for discount bond options. The same is true in the CIR model — caps and floors are of course portfolios of discount bond options and, in a single-factor model such as the Vasicek or CIR model, coupon bond options and swaptions can also be priced as portfolios of discount bond options. Here we will explain briefly how to price discount bond options in the CIR model.\nConsider a call option maturing at date \\(T\\) with the underlying being a discount bond maturing at \\(u>T\\). Let \\(K\\) denote the strike price. From our fundamental pricing formula \\(\\eqref{formula}\\), the value at date~0 of the option is \\[\\begin{equation}\\label{ciroptionprice}\nP(0,u)\\times\\text{prob}^u\\big(P(T,u)>K\\big) - P(0,T)\\times\\text{prob}^T\\big(P(T,u)>K\\big)\\;,\n\\end{equation}\\] where \\(\\text{prob}^u\\) denotes the probability measure using the discount bond maturing at \\(u\\) as numeraire and \\(\\text{prob}^T\\) denotes the probability measure using the discount bond maturing at \\(T\\) as the numeraire. Using the calibration of the previous subsection, the price of the underlying at date \\(T\\) will be, according to the model, \\[P(T,u)  = \\exp\\left(-\\int_T^u \\phi(s)\\,\\D s-a(u-T)-b(u-T)\\hat{r}(T)\\right)\\; .\\] Therefore, the option will finish in the money if and only if \\[\\begin{equation}\\label{ciroptionprice2}\n\\frac{-\\int_T^u \\phi(s)\\,\\D s-a(u-T)-\\log K}{b(u-T)} > \\hat{r}(T)\\;.\n\\end{equation}\\] Thus, to price discount bond options, we need to compute the probabilities that \\(\\hat{r}(T)\\) is less than a given number, using discount bonds as numeraires.\nConsider the discount bond maturing at \\(u\\). The calculation for the discount bond maturing at \\(T\\) can be done in the same way. We use the fact that \\[\\frac{\\E^{\\int_0^t r(s)\\,\\D s}}{P(t,u)}\\] is a martingale, when \\(P(t,u)\\) is used as the numeraire, for \\(t \\leq u\\). Let \\(Z(t)\\) denote this ratio and apply Itô’s formula for ratios to derive \\[\\frac{\\D Z(t)}{Z(t)} = r(t)\\,\\D t - \\frac{\\D P(t,u)}{P(t,u)} + \\left(\\frac{\\D P(t,u)}{P(t,u)}\\right)^2\\; .\\] Substituting from [cirdpp2] now gives us \\[\\begin{align*}\n\\frac{\\D Z(t)}{Z(t)} &= b(\\tau)\\sigma\\sqrt{\\hat{r}(t)}\\,\\D B(t) + b(\\tau)^2\\sigma^2\\hat{r}(t)\\,\\D t\\\\\n&= b(\\tau)\\sigma\\sqrt{\\hat{r}(t)}\\left[\\D B(t) + b(\\tau)\\sigma\\sqrt{\\hat{r}(t)}\\,\\D t\\right]\\;.\n\\end{align*}\\] Given that \\(Z\\) is a martingale, \\(\\D Z/Z\\) cannot have a drift, so it must be that~\\(B^*\\) defined by \\(B^*(0)=0\\) and \\[\\D B^*(t) = \\D B(t) + b(\\tau)\\sigma\\sqrt{\\hat{r}(t)}\\,\\D t\\] is a martingale, and hence a Brownian motion, when \\(P(t,u)\\) is used as the numeraire. Substituting this into the definition \\(\\eqref{cirrhat}\\) of \\(\\hat{r}\\), we have \\[\\begin{align}\n\\D \\hat{r}(t)&=\\kappa [\\theta-\\hat{r}(t)]\\,\\D t+\\sigma \\sqrt{\\hat{r}(t)}\\,\\left[\\D B^*(t) - b(\\tau)\\sigma\\sqrt{\\hat{r}(t)}\\,\\D t\\right]\\notag\\\\\n&= \\kappa [\\theta-\\hat{r}(t)]\\,\\D t+\\sigma \\sqrt{\\hat{r}(t)}\\,\\D B^*(t) - \\sigma^2b(\\tau)\\hat{r}(t)\\,\\D t\\notag\\\\\n&= \\kappa^*(t)[\\theta^*(t)-\\hat{r}(t)]\\,\\D t +\\sigma \\sqrt{\\hat{r}(t)}\\,\\D B^*(t)\\;,\\label{cirru}\n\\end{align}\\] where we define \\[\n\\kappa^*(t) = \\kappa + \\sigma^2b(u-t) \\qquad \\text{and} \\qquad \\theta^*(t) = \\frac{\\kappa\\theta}{\\kappa^*(t)}\\; .\\] Thus, using a discount bond as numeraire, the process \\(\\hat{r}\\) is still a square root process, but now with a time-dependent long-run mean and mean-reversion rate.\nThe random variable \\(\\hat{r}(T)\\) defined by \\(\\hat{r}(0)=0\\) and equation \\(\\eqref{cirru}\\) for \\(t \\leq T\\) is a transformation of a random variable having what is called a ``non-central chi-square’’ distribution. See Appendix~\\(\\ref{a_bessel}\\) for further discussion and calculation of the probabilities \\(\\text{prob}^u\\big(P(T,u)>K\\big)\\) and \\(\\text{prob}^T\\big(P(T,u)>K\\big)\\)."
  },
  {
    "objectID": "Chapter1.html#sec-continuouscompounding",
    "href": "Chapter1.html#sec-continuouscompounding",
    "title": "1  Asset Pricing Basics",
    "section": "1.1 Compounding Interest",
    "text": "1.1 Compounding Interest\nDuring most of the first two parts of the book (the only exception being Chapter ?sec-forwardexchange. we will assume there is a risk-free asset earning a constant rate of return. For simplicity, we will specify the rate of return as a continuously compounded rate. For example, if the annual rate with annual compounding is \\(r_a\\), then the corresponding continuously compounded rate is \\(r\\) defined as \\(r = \\log (1+r_a)\\), where “\\(\\log\\)” denotes the natural logarithm function. This means that the gross return over a year (one plus the rate of return) is \\(\\mathrm{e}^r = 1+r_a\\). More generally, an investment of \\(x\\) dollars for a time period of length \\(T\\) (we measure time in years, so, e.g., a six-month investment would mean \\(T=0.5\\)) will result in the ownership of \\(x\\mathrm{e}^{rT}\\) dollars at the end of the time period.\nExpressing the interest rate as a continuously compounded rate enables us to avoid having to specify in each instance whether the rate is for annual compounding, semi-annual compounding, monthly compounding, etc. For example, the meaning of an annualized rate \\(r_s\\) for semi-annual compounding is that an investment of \\(x\\) dollars will grow over a year to \\(x(1+r_s/2)^2\\). The equivalent continuously compounded rate is defined as \\(r = \\log (1+r_s/2)^2\\), and in terms of this rate we can say that the investment will grow in six months to \\(x\\mathrm{e}^{0.5 r}\\) and that it will grow in one year to \\(x\\mathrm{e}^r\\). We can interpret this rate as being continuously compounded because compounding \\(n\\) times per year at an annualized rate of \\(r\\) results in $1 growing in a year to \\((1+r/n)^n\\) and \\[\\lim_{n \\rightarrow \\infty} \\left(1+\\frac{r}{n}\\right)^n = \\mathrm{e}^r\\;\\;.\\]\nTo develop pricing and hedging formulas for derivative securities, it is a great convenience to assume that investors can trade continuously in time. This requires us to assume also that returns are computed continuously. In the case of a risk-free investment of \\(x(t)\\) dollars at any date \\(t\\) at a continuously compounded rate of \\(r\\), we will say that the interest earned in “an instant \\(d t\\)” is \\(x(t)r\\,\\mathrm{d} t\\) dollars. This is only meaningful when we accumulate the interest over a non-infinitesimal period of time. So consider investing \\(x(0)\\) dollars at time 0 and reinvesting interest in the risk-free asset over a time period of length \\(T\\). Let \\(x(t)\\) denote the account balance at date \\(t\\), for \\(0\\leq t \\leq T\\). The change in the account balance in each instant is the interest earned, so we have \\(d x(t) = x(t)r\\,\\mathrm{d} t\\). The real meaning of this equation is that \\(x(t)\\) satisfies the differential equation \\[\\frac{d x(t)}{d t} = x(t)r\\; ,\\] and it is well known (and easy to verify) that the solution is \\[x(t) = x(0)\\mathrm{e}^{rt}\\; ,\\] leading to an account balance at the end of the time period of \\(x(T) = x(0)\\mathrm{e}^{rT}\\). Thus, the statement that “the interest earned in an instant \\(d t\\) is \\(x(t)r\\,\\mathrm{d} t\\)” is equivalent to the statement that interest is continuously compounded at the rate \\(r\\).\nIn the last part of the book, we will drop the assumption that the risk-free asset earns a constant rate of return. In this case, we will still generally assume that there is a risk-free asset for very short-term investments (i.e., for investments with infinitesimal durations!). We will let \\(r(t)\\) denote the risk-free rate for an instantaneous investment at date \\(t\\). This means that an investment of \\(x(t)\\) dollars at date \\(t\\) in the risk-free asset earns interest in an instant \\(d t\\) equal to \\(x(t)r(t)\\,\\mathrm{d} t\\). Consider again an investment of \\(x(0)\\) dollars at date 0 in this instantaneously risk-free asset with interest reinvested and let \\(x(t)\\) denote the account balance at date \\(t\\). Then \\(x(t)\\) must satisfy the differential equation \\[\\frac{d x(t)}{d t} = x(t)r(t)\\;\\;.\\] The solution of this differential equation is \\[x(t) = x(0)exp\\left(\\int_0^t r(s)\\,\\mathrm{d}s\\right)\\;\\;.\\] The expression \\(\\int_0^t r(s)\\,\\mathrm{d}s\\) can be interpreted as a continuous sum over time of the rates of interest \\(r(s)\\) earned at times \\(s\\) between 0 and \\(t\\). If these rates are all the same, say equal to \\(r\\), then \\(\\int_0^t r(s)\\,\\mathrm{d}s = rt\\) and our compounding factor \\(exp\\left(\\int_0^t r(s)\\,\\mathrm{d}s\\right)\\) is \\(\\mathrm{e}^{rt}\\) as before."
  },
  {
    "objectID": "Chapter1.html#sec-c1-longs-shorts-and-margin",
    "href": "Chapter1.html#sec-c1-longs-shorts-and-margin",
    "title": "1  Asset Pricing Basics",
    "section": "1.1 Longs, Shorts, and Margin",
    "text": "1.1 Longs, Shorts, and Margin\nIn financial markets, the owner of an asset is said to be “long” the asset. If person A owes something to person B, the debt is an asset to person B but a liability to person A. One also says that person A is “short” the asset. For example, if someone borrows money and invests the money in stocks, then the individual is short cash and long stocks.\nOne must invest some of one’s own money when borrowing money to buy stocks. For example, an individual could invest $600, borrow $400, and buy $1000 of stock. The $600 is called the “margin” posted by the investor, and buying stocks in this way is called buying “on margin.” The investor, or the portfolio, is also said to be “levered,” because buying $1000 of stock with only a $600 investment amplifies the risk and return per dollar of investment. On a percentage basis, we would say the account has 60% margin, the 60% being the ratio of the equity (assets minus liabilities = $1000 of stock minus $400 debt) to the assets ($1000 of stock). If the value of the stock drops sufficiently far, then it may become doubtful whether the investor can repay the $400. In this case, the investor must either sell the stock or invest more of his own funds (i.e., he receives a “margin call”). In other words, in actual markets there are “margin requirements,” that specify a minimum percent margin an investor must have initially (when borrowing money) and a minimum percent margin the investor must maintain.\nRather than borrowing money to buy stocks, an investor can do the opposite—he can borrow stocks to buy money. In this case, “buying money” means selling the borrowed stocks for cash. Such an investor will be short stocks and long cash. This is called “short selling” (or, more briefly, “shorting”) stocks. For example, suppose individual A borrows 100 shares of stock from individual B and then sells them to individual C. Both B and C are long the 100 shares and A is short, so the net long position is \\(2 x 100 - 100\\), which is the original 100 shares that B was long. A short seller of stocks must pay to the lender of the stocks any dividends that are paid on the stock. In our example, both B and C own the 100 shares so both expect to receive dividends. The company will pay dividends only to C, and A must pay the dividends to B.\nOf course, investors always wish to buy low and sell high. The usual method is to buy stocks and hope they rise. An investor who short sells also wishes to buy low and sell high, but he reverses the order—he sells first and then hopes the stocks fall. The risk is that the stocks will instead rise, which will increase the value of his liability (short stock position) without increasing the value of his assets (long cash position), thus putting him “under water.” To shield the lender of the stocks from this risk, a short seller must also invest some of his own funds, and this amount is again called the investor’s margin. For example, an investor might invest $600, and borrow and sell $1000 of stock. In this case, the investor will be long $1600 cash and short $1000 worth of stock. His equity is $600 and his percent margin is calculated as $600/$1000 = 60%. Again, there are typically both initial and maintenance margin requirements. An additional feature of short selling for small individual investors is that they typically will not earn interest on the proceeds of the short sale (the $1000 cash obtained from selling stocks in the above example).\nIn this book, we will assume there is a single risk-free rate at which one can both borrow and lend. Moreover, we will assume that investors earn this rate on margin deposits, including the proceeds of short sales (and including any margin that may be required when buying and selling forward and futures contracts). Thus, investors gain from buying on margin if the asset return is sure to exceed the risk-free rate, and they gain from short selling if the return on an asset is sure to be below the risk-free rate. These assumptions are not reasonable for small individual investors, but they are fairly reasonable for institutional investors. We will assume that no asset has a return that is certain to be above the risk-free rate nor certain to be below the risk-free rate, because institutional investors could “arbitrage” such guaranteed high-return or guaranteed low-return assets."
  },
  {
    "objectID": "Chapter1.html#sec-c1-calls-and-puts",
    "href": "Chapter1.html#sec-c1-calls-and-puts",
    "title": "1  Asset Pricing Basics",
    "section": "1.2 Calls and Puts",
    "text": "1.2 Calls and Puts\nCall and put options are the basic derivative securities and the building blocks of many others. A derivative security is a security the value of which depends upon another security.\nA call option is the right to buy an asset at a pre-specified price. The pre-specified price is called the exercise price, the strike price, or simply the strike. We will often call the asset a “stock,” but there are options on many other types of assets also, and everything we say will be applicable to those as well.1 The asset to which the call option pertains is called the “underlying asset,” or, more briefly, the “underlying.” If the market value of the asset exceeds the exercise price, then we say the call option is “in the money.” Buying a call option is a way to bet on the upside of the underlying asset.\nA put option is the right to sell an asset at a pre-specified (exercise, strike) price. Buying a put is a way to bet on an asset price becoming low (similar to shorting). A put option is in the money if the exercise price exceeds the value of the asset. Both puts and calls are potentially valuable and hence the buyer of a put or call must pay the seller.\nA long put option provides insurance to someone who is long the underlying asset, because it guarantees that the asset can always be sold at the strike price of the put (of course, it can be sold at the market price, if that is higher than the strike of the put). Symmetrically, a long call option provides insurance to someone who is short the underlying asset. The terminology in option markets reflects the parallels between options and insurance contracts. In particular, the seller of an option is said to “write” the option and the compensation (price) he receives from the buyer is called the option “premium,” just as an insurance company writes insurance contracts in exchange for premium income. Calculating the price at which one should be willing to trade an option is the main topic of this book.\nIt is important to recognize the different situations of someone who is short a call option and someone who is long a put. Both positions are bets on the downside of the asset. Both the investor who is short a call and the investor who is long a put may eventually sell the underlying asset and receive the exercise price in exchange. However, the investor who is long a put has an option to sell the asset at the exercise price and the investor who is short a call has an obligation to sell the asset at the exercise price, should the counterparty choose to exercise the call. Thus, the investor who is long a put will be selling at the exercise price when it is profitable to do so, whereas the investor who is short a call will be selling at the exercise price when it is unprofitable. The buyer of a put must pay the premium to the seller; he then profits if the asset price is low, with his maximum possible profit being quite large (the maximum value is attained when the market value of the underlying asset reaches zero). In contrast, the seller of a call receives premium income, and the premium is his maximum possible profit, whereas his potential losses are unbounded. Thus, these are very different positions.\nIndividuals who sell calls usually sell out-of-the-money covered calls. “Covered” means that they own the underlying asset and can therefore deliver the underlying if the call is exercised without incurring any further expense—they experience only an “opportunity cost” in delivering it for less than the market price.2 A call being out of the money implies that the price of the underlying must rise before the call would be exercised against the seller; thus, the seller of an out-of-the money covered call still has some potential for profit from the underlying. In addition, of course, the seller receives the premium income from the call. Institutions often follow this strategy also, using the premium income to “enhance” their return from the underlying. One can hedge a short call without owning a full share of the underlying asset, if one is able to rebalance the hedge over time. Calculating such hedges is another of the principal topics of this book.\nIn a certain sense, option markets are zero-sum games. The profit earned by one counterparty to an option transaction is a loss suffered by the other. However, options can allow for an increase in the welfare of all investors by improving the allocation of risk. A producer who must purchase a certain input may buy a call option, giving him the right to buy the input at a fixed price. This caps his expense. The seller of the call now bears the risk that the input price will be high—in this case, the option will be exercised and he will be forced to sell at a price below the market price. It may be that the seller is in a better position to bear the risk (for example, he may have less of the risk in his portfolio) and the option transaction may thereby improve the allocation of risks across investors. The similarity to insurance should be apparent.\nQuite complex bets or hedges can be created by combining options. For example, a long call and put with the same strike price is called a “straddle.” Such a portfolio is (almost) always in the money. It is in fact a bet on volatility—a big move in the underlying asset value away from the exercise price will lead to either the call or put having a high value. Another important example of an option portfolio is a “collar.” A collar consists of a long put and a short call, or a short call and a long put, with the options having the same maturity. As mentioned before, a long put provides insurance to someone who is long the underlying asset. Selling a call provides premium income that can be used to offset the cost of the put (the most popular type of collar is a zero-cost collar: a collar in which the premium of the call is equal to the premium of the put). The cost of selling a call for an owner of the underlying is that it sells off the upside of the underlying asset—if the value of the asset exceeds the strike price of the call, then the call will be exercised and the underlying asset must be delivered for the strike price (rather than the higher market price). Thus, one can purchase the downside insurance provided by a long put by selling part of the upside potential of the asset, rather than paying the cost of the insurance out of pocket. There are many other examples of option portfolios that could be given.\nSome puts and calls are traded on exchanges. In this case, the exchange clearinghouse “steps between” the buyer and seller and becomes the counterparty to both the buyer and seller. This eliminates the risk that the seller might default on his obligation when the buyer chooses to exercise his option. If the owner of an option chooses to exercise, the clearinghouse randomly chooses someone who is short the option to fulfill the obligation. Most exchange traded options are never exercised, because any gain on a long contract can be captured by selling the contract at the market price, thus cancelling the position. Obviously, however, the right to exercise is essential, because it determines the market price. Puts and calls are also transacted “over the counter,” which means that they are private contracts of the counterparties. Moreover, puts and calls are embedded in many other financial instruments. A prosaic but important example is that most homeowners have the right to pay off their mortgages early. This means they have call options on their mortgages, with exercise price equal to the remaining mortgage principal. Similarly, callable bonds can be redeemed early by the company issuing them, convertible bonds have embedded call options on the company’s stock (which are exercised by “converting” the bonds) and there are many, many other examples. Puts and calls also exist outside financial markets. For example, a company may begin manufacturing a new product at a small scale; if the product is successful, the scale can be expanded. In this case, the company buys a call option on large-scale production with the premium being the cost of launching small-scale production. Adapting the methods developed for financial options to value such “real options” is an important and growing field."
  },
  {
    "objectID": "Chapter1.html#sec-c1-exercise-policies-for-calls-and-puts",
    "href": "Chapter1.html#sec-c1-exercise-policies-for-calls-and-puts",
    "title": "1  Asset Pricing Basics",
    "section": "1.3 Exercise Policies for Calls and Puts",
    "text": "1.3 Exercise Policies for Calls and Puts\nIt may be rational to exercise a call if the asset value exceeds the exercise price. Thus, denoting the price of the asset by \\(S\\) and the exercise price by \\(K\\), the owner of a call option can profit by \\(S-K\\) dollars by exercising the option when \\(S>K\\). If \\(S<K\\), exercise would be irrational. Thus, the payoff to the owner of the call option is3 \\(\\max(0,S-K)\\). It has been said that timing is everything, and the timing here should be made clearer. The simplest type of option is called a “European” option. A European option has a finite lifetime and can only be exercised at its maturity date. For a European call option, the exercise strategy just described is the optimal one, with \\(S\\) representing the asset price at the maturity date of the option. Equally, if not more, important are “American” options, which can be exercised at any time before maturity.\nFor an American call option, the exercise strategy just described is the optimal one at the maturity date, but it may also be optimal to exercise prior to maturity. Let \\(K\\) denote the exercise price, \\(T\\) the date the option matures, and \\(S(t)\\) the price of the underlying asset at date \\(t \\leq T\\). The “intrinsic value” of the call option at date \\(t\\) is defined to be \\(\\max(0,S(t)-K)\\). One would of course never exercise unless the intrinsic value is positive—i.e., unless the option is in the money. Moreover, if the asset does not pay a dividend (or other type of cash flow) prior to the option maturity then one should not exercise in any circumstances prior to maturity. This is captured in the saying: “calls are better alive than dead.” Exercise being suboptimal is equivalent to the value of the option exceeding the intrinsic value.\nThe principle that calls on non-dividend-paying assets are better alive than dead follows from two facts: (i) it is generally a good thing (in financial markets as well as in life) to keep one’s options open, and (ii) early exercise implies early payment of the exercise price and hence foregone interest. The usual protest that is heard when this statement is made is that one should surely exercise if he expects the stock price to plummet, because by exercising (and then selling the stock acquired) one can lock in the current stock price rather than waiting for it to fall, in which case the option will surely be worth less. This intuition is a reasonable one, but it ignores the fact that the investor could short sell the stock if he expects it to plummet—he doesn’t need to exercise the option to lock in the current stock price. In fact, shorting the stock and retaining the option is always better than exercising, assuming the underlying asset does not pay a dividend.\nSpecifically, suppose an investor considers exercising at date \\(t\\). As an alternative to exercising early, consider shorting the stock at date \\(t\\) and retaining the option. This is always better than exercising at date \\(t\\), because the short position can be “covered” (the stock can be purchased and returned to the lender to cancel the short position) at cost \\(K\\) at date \\(T\\) by exercising the option, and paying \\(K\\) at date \\(T\\) is better than paying it at date \\(t\\), given that interest rates must be nonnegative. To be more precise, note that exercise at date \\(t\\) produces \\(S(t)-K\\) dollars at date \\(t\\). On the other hand, retaining the option, shorting the stock at date \\(t\\), and covering the short either by exercising the option or buying the stock in the market (whichever is cheaper) produces \\(S(t)\\) dollars at date \\(t\\) and\n\\[\\begin{align*}\n\\max(0,S(T)-K) - S(T) &= \\max(-S(T), -K) \\\\\n&= -\\min(S(T),K) \\\\\n& \\geq -K\n\\end{align*}\\]\ndollars at date \\(T\\). If \\(S(T)>K\\), one has \\(-K\\) dollars at date \\(T\\), in which case retaining the option has been superior due to the time value of money. Furthermore, if \\(S(T)<K\\), the strategy of retaining the option and shorting the stock produces \\(-S(T) > -K\\) dollars at date \\(T\\), so retaining the option is superior due both to flexibility (waiting until \\(T\\) to decide whether to exercise turns out to be better than committing at date \\(t\\)) and because of the time value of money.4\nEarly exercise of a call option can be optimal when the underlying asset pays a dividend. The above analysis does not apply in this case, because paying the dividend to the lender of the stock is an additional cost for the strategy of retaining the option and shorting the stock. If the dividend is so small that it cannot offset the time value of money on the exercise price, then early exercise will not be optimal. In other cases, deriving the optimal exercise strategy is a complicated problem that we will first begin to study in Chapter ?sec-introcomputation.\nA European put option will be exercised at its maturity \\(T\\) if the price \\(S(T)\\) of the underlying asset is below the exercise price \\(K\\). In general, the value at maturity can be expressed as \\(\\max(0,K-S(T))\\). Early exercise of an American put can be optimal, regardless of whether the underlying pays a dividend. While it is valuable to keep one’s options open (for puts as well as calls) the time value of money works in the opposite direction for puts. Early exercise of a put option implies early receipt of the exercise price, and it is better to receive cash earlier rather than later. In general, whether early exercise is optimal depends on how deeply the option is in the money—if the underlying asset price is sufficiently low, then it will be fairly certain that exercise will be optimal, whether earlier or late; in this case, one should exercise earlier to earn interest on the exercise price. How low it should be to justify early exercise depends on the interest rate (a higher rate makes the time-value-of-money issue more important, leading to earlier exercise) and the volatility of the underlying asset price (a lower volatility reduces the value of keeping one’s options open, leading also to earlier exercise). We will begin to study the valuation of American puts in Chapter@sec-introcomputation."
  },
  {
    "objectID": "Chapter1.html#sec-c1-continuouscompounding",
    "href": "Chapter1.html#sec-c1-continuouscompounding",
    "title": "1  Asset Pricing Basics",
    "section": "1.4 Compounding Interest",
    "text": "1.4 Compounding Interest\nDuring most of the first two parts of the book (the only exception being Chapter ?sec-forwardexchange. we will assume there is a risk-free asset earning a constant rate of return. For simplicity, we will specify the rate of return as a continuously compounded rate. For example, if the annual rate with annual compounding is \\(r_a\\), then the corresponding continuously compounded rate is \\(r\\) defined as \\(r = \\log (1+r_a)\\), where “\\(\\log\\)” denotes the natural logarithm function. This means that the gross return over a year (one plus the rate of return) is \\(\\mathrm{e}^r = 1+r_a\\). More generally, an investment of \\(x\\) dollars for a time period of length \\(T\\) (we measure time in years, so, e.g., a six-month investment would mean \\(T=0.5\\)) will result in the ownership of \\(x\\mathrm{e}^{rT}\\) dollars at the end of the time period.\nExpressing the interest rate as a continuously compounded rate enables us to avoid having to specify in each instance whether the rate is for annual compounding, semi-annual compounding, monthly compounding, etc. For example, the meaning of an annualized rate \\(r_s\\) for semi-annual compounding is that an investment of \\(x\\) dollars will grow over a year to \\(x(1+r_s/2)^2\\). The equivalent continuously compounded rate is defined as \\(r = \\log (1+r_s/2)^2\\), and in terms of this rate we can say that the investment will grow in six months to \\(x\\mathrm{e}^{0.5 r}\\) and that it will grow in one year to \\(x\\mathrm{e}^r\\). We can interpret this rate as being continuously compounded because compounding \\(n\\) times per year at an annualized rate of \\(r\\) results in $1 growing in a year to \\((1+r/n)^n\\) and \\[\\lim_{n \\rightarrow \\infty} \\left(1+\\frac{r}{n}\\right)^n = \\mathrm{e}^r\\;\\;.\\]\nTo develop pricing and hedging formulas for derivative securities, it is a great convenience to assume that investors can trade continuously in time. This requires us to assume also that returns are computed continuously. In the case of a risk-free investment of \\(x(t)\\) dollars at any date \\(t\\) at a continuously compounded rate of \\(r\\), we will say that the interest earned in “an instant \\(d t\\)” is \\(x(t)r\\,\\mathrm{d} t\\) dollars. This is only meaningful when we accumulate the interest over a non-infinitesimal period of time. So consider investing \\(x(0)\\) dollars at time 0 and reinvesting interest in the risk-free asset over a time period of length \\(T\\). Let \\(x(t)\\) denote the account balance at date \\(t\\), for \\(0\\leq t \\leq T\\). The change in the account balance in each instant is the interest earned, so we have \\(\\mathrm{d} x(t) = x(t)r\\,\\mathrm{d} t\\). The real meaning of this equation is that \\(x(t)\\) satisfies the differential equation \\[\\frac{\\mathrm{d} x(t)}{\\mathrm{d} t} = x(t)r\\; ,\\] and it is well known (and easy to verify) that the solution is \\[x(t) = x(0)\\mathrm{e}^{rt}\\; ,\\] leading to an account balance at the end of the time period of \\(x(T) = x(0)\\mathrm{e}^{rT}\\). Thus, the statement that “the interest earned in an instant \\(\\mathrm{d} t\\) is \\(x(t)r\\,\\mathrm{d} t\\)” is equivalent to the statement that interest is continuously compounded at the rate \\(r\\).\nIn the last part of the book, we will drop the assumption that the risk-free asset earns a constant rate of return. In this case, we will still generally assume that there is a risk-free asset for very short-term investments (i.e., for investments with infinitesimal durations!). We will let \\(r(t)\\) denote the risk-free rate for an instantaneous investment at date \\(t\\). This means that an investment of \\(x(t)\\) dollars at date \\(t\\) in the risk-free asset earns interest in an instant \\(\\mathrm{d} t\\) equal to \\(x(t)r(t)\\,\\mathrm{d} t\\). Consider again an investment of \\(x(0)\\) dollars at date 0 in this instantaneously risk-free asset with interest reinvested and let \\(x(t)\\) denote the account balance at date \\(t\\). Then \\(x(t)\\) must satisfy the differential equation \\[\\frac{\\mathrm{d} x(t)}{\\mathrm{d} t} = x(t)r(t)\\;\\;.\\] The solution of this differential equation is \\[x(t) = x(0)\\exp\\left(\\int_0^t r(s)\\,\\mathrm{d}s\\right)\\;\\;.\\] The expression \\(\\int_0^t r(s)\\,\\mathrm{d}s\\) can be interpreted as a continuous sum over time of the rates of interest \\(r(s)\\) earned at times \\(s\\) between 0 and \\(t\\). If these rates are all the same, say equal to \\(r\\), then \\(\\int_0^t r(s)\\,\\mathrm{d}s = rt\\) and our compounding factor \\(\\exp\\left(\\int_0^t r(s)\\,\\mathrm{d}s\\right)\\) is \\(\\mathrm{e}^{rt}\\) as before."
  },
  {
    "objectID": "Chapter1.html#sec-c1-oneperiodbinomial",
    "href": "Chapter1.html#sec-c1-oneperiodbinomial",
    "title": "1  Asset Pricing Basics",
    "section": "1.5 State Prices in a One-Period Binomial Model",
    "text": "1.5 State Prices in a One-Period Binomial Model\nTo introduce the concepts that will be discussed in the remainder of the chapter, we will consider in this and the following section the following very simple framework. There is a stock with price \\(S\\) today (which we will call date 0). At the end of some period of time of length \\(T\\), the stock price will take one of two values: either \\(S_u\\) or \\(S_d\\), where \\(S_u > S_d\\). If the stock price equals \\(S_u\\) we say we are in the “up” state of the world, and if it equals \\(S_d\\) we say we are in the “down” state. The stock does not pay a dividend. There is also a risk-free asset earning a continuously compounded rate of interest \\(r\\). Finally we want to consider a European call option on the stock with maturity \\(T\\) and strike \\(K\\). The value of the call option at the end of the period is \\(C_u=\\max(0,S_u-K)\\) in the up state and \\(C_d=\\max(0,S_d-K)\\) in the down state.\nWe will assume \\[\\begin{equation}\n\\label{binomialnoarbitrage}\n\\frac{S_u}{S} > \\mathrm{e}^{rT} > \\frac{S_d}{S}\\;.\n\\end{equation}\\] This condition means that the rate of return on the stock in the up state is greater than the risk-free rate, and the rate of return on the stock in the down state is less than the risk-free rate. If it were not true, there would be an arbitrage opportunity: if the rate of return on the stock were greater than the risk-free rate in both states, then one should buy an infinite amount of the stock on margin, and conversely if the rate of return on the stock were less than the risk-free rate in both states, then one should short an infinite amount of stock and put the proceeds in the risk-free asset. So what we are assuming is that there are no arbitrage opportunities in the market for the stock and risk-free asset.\nThe “delta” of the call option is \\(\\delta = (C_u-C_d)/(S_u-S_d)\\). Multiplying by \\(S_u-S_d\\) gives us \\(\\delta(S_u-S_d) = C_u-C_d\\) and rearranging yields \\(\\delta S_u - C_u = \\delta S_d-C_d\\), which is critical to what follows. Consider purchasing \\(\\delta\\) shares of the stock at date 0 and borrowing \\[\\mathrm{e}^{-rT}(\\delta S_u-C_u) = \\mathrm{e}^{-rT}(\\delta S_d-C_d)\\] dollars at date 0. Then you will owe \\[\\delta S_u-C_u = \\delta S_d-C_d\\] dollars at date \\(T\\), and hence the value of the portfolio at date \\(T\\) in the up state will be\n\\[\\begin{align*}\n\\text{Value of delta shares} - \\text{Dollars owed} &= \\delta S_u - (\\delta S_u-C_u)\\\\\n& = C_u\\; ,\n\\end{align*}\\]\nand the value of the portfolio at date \\(T\\) in the down state will be \\[\\begin{align*}\n\\text{Value of delta shares} - \\text{Dollars owed} &= \\delta S_d - (\\delta S_d-C_d) \\\\\n&= C_d\\;.\n\\end{align*}\\]\nThus, this portfolio of buying delta shares and borrowing money (i.e., buying delta shares on margin) “replicates” the call option. Consequently, the value \\(C\\) of the option at date 0 must be the date–0 cost of the portfolio; i.e.,\n\\[\\begin{align}\\label{C0}\nC &= \\text{Cost of delta shares} - \\text{Dollars borrowed} \\notag\\\\\n&= \\delta S - \\mathrm{e}^{-rT}(\\delta S_u-C_u)\\;.\n\\end{align}\\]\nBecause the call option is equivalent to buying the stock on margin, it can be considered a levered investment in the stock.\nWe will now rewrite the option pricing formula \\(\\eqref{C0}\\) in terms of “state prices.” By substituting for \\(\\delta\\) in \\(\\eqref{C0}\\), we can rearrange it as \\[\\begin{equation}\\label{binomialC1}\nC = \\frac{S-\\mathrm{e}^{-rT}S_d}{S_u-S_d} \\times C_u + \\frac{\\mathrm{e}^{-rT}S_u-S}{S_u-S_d}\\times C_d\\; .\n\\end{equation}\\] A little algebra also shows that \\[\\begin{equation}\\label{binomialS1}\nS = \\frac{S-\\mathrm{e}^{-rT}S_d}{S_u-S_d} \\times\nS_u + \\frac{\\mathrm{e}^{-rT}S_u-S}{S_u-S_d}\\times S_d\\; ,\n\\end{equation}\\] and \\[\\begin{equation}\n\\label{binomialR1}\n1 = \\frac{S-\\mathrm{e}^{-rT}S_d}{S_u-S_d} \\times \\mathrm{e}^{rT}+ \\frac{\\mathrm{e}^{-rT}S_u-S}{S_u-S_d}\\times \\mathrm{e}^{rT}\\;.\n\\end{equation}\\] It is convenient to denote the factors appearing in these equations as \\[\\begin{equation}\\label{binomialstateprices}\n\\pi_u = \\frac{S-\\mathrm{e}^{-rT}S_d}{S_u-S_d} \\quad \\text{and} \\quad \\pi_d = \\frac{\\mathrm{e}^{-rT}S_u-S}{S_u-S_d}\\;.\n\\end{equation}\\] The numbers \\(\\pi_u\\) and \\(\\pi_d\\) are called the “state prices,” for reasons that will be explained below.\nWith these definitions, we can write \\(\\eqref{binomialC1}\\)–\\(\\eqref{binomialR1}\\) as\n\\[\\begin{align}\nC &= \\pi_uC_u + \\pi_dC_d\\;,\\label{binomialC2}\\\\\nS &= \\pi_uS_u+\\pi_dS_d\\;,\\label{binomialS2}\\\\\n1 &= \\pi_u\\mathrm{e}^{rT} + \\pi_d \\mathrm{e}^{rT}\\;.\\label{binomialR2}\n\\end{align}\\]\nThese equations have the following interpretation: the value of a security today is its value in the up state times \\(\\pi_u\\) plus its value in the down state times \\(\\pi_d\\). This applies to (@eq0binomialR2) by considering an investment of $1 today in the risk-free asset—it has value 1 today and will have value \\(\\mathrm{e}^{rT}\\) in both the up and down states at date \\(T\\). Moreover, this same equation will hold for any other derivative asset. For example, if we considered a put option, then a delta–hedging argument analogous to that we just gave for the call option will lead to a formula for the value \\(P\\) of the put today which can be expressed as \\(P = \\pi_uP_u+\\pi_dP_d\\) for the same \\(\\pi_u\\) and \\(\\pi_d\\) defined in \\(\\eqref{binomialstateprices}\\).\nIn this model, we can think of any security as a portfolio of what are called “Arrow securities” (in recognition of the seminal work of Kenneth Arrow [@Arrow]). One of the Arrow securities pays $1 at date \\(T\\) if the up state occurs and the other pays $1 at date \\(T\\) if the down state occurs. For example, the stock is equivalent to a portfolio consisting of \\(S_u\\) units of the first Arrow security and \\(S_d\\) units of the second, because the stock is worth \\(S_u\\) dollars in the up state and \\(S_d\\) dollars in the down state. Equations \\(\\eqref{binomialC2}\\)–\\(\\eqref{binomialR2}\\) show that \\(\\pi_u\\) is the price of the first Arrow security and \\(\\pi_d\\) is the price of the second. For example, the right-hand side of \\(\\eqref{binomialS2}\\) is the value of the stock at date 0 viewed as a portfolio of Arrow securities when the Arrow securities have prices \\(\\pi_u\\) and \\(\\pi_d\\). Because the stock clearly is such a portfolio, its price today must equal its value as that portfolio, which is what \\(\\eqref{binomialS2}\\) asserts.\nAs mentioned before, the prices \\(\\pi_u\\) and \\(\\pi_d\\) of the Arrow securities are called the “state prices,” because they are the prices of receiving $1 in the two states of the world. The state prices should be positive, because the payoff of each Arrow security is nonnegative in both states and positive in one. A little algebra shows that the conditions \\(\\pi_u>0\\) and \\(\\pi_d>0\\) are exactly equivalent to our “no-arbitrage” assumption \\(\\eqref{binomialnoarbitrage}\\). Thus, we conclude that in the absence of arbitrage opportunities, there exist positive state prices such that the price of any security is the sum across the states of the world of its payoff multiplied by the state price.\nThis conclusion generalizes to other models, including models in which the stock price takes a continuum of possible values. We will discuss more general models later in this chapter. It is a powerful result that tremendously simplifies derivative security pricing."
  },
  {
    "objectID": "Chapter1.html#probabilities-and-numeraires",
    "href": "Chapter1.html#probabilities-and-numeraires",
    "title": "1  Asset Pricing Basics",
    "section": "1.3 Probabilities and Numeraires",
    "text": "1.3 Probabilities and Numeraires\nIn this section, we will continue our analysis of the binomial example. To apply the statement about state prices appearing in boldface type above in the most convenient way, we will manipulate the state prices so we can interpret the sums on the right-hand sides of \\(\\eqref{binomialC2}\\)–\\(\\eqref{binomialR2}\\) in terms of expectations. The expectation (or mean) of a random variable is of course its probability-weighted average value.\nIn general, there are different expectations that are useful. In this model, there are two that we can define: one corresponding to the risk-free asset and one corresponding to the stock. Many readers will have experience with the first in the form of “risk-neutral probabilities.”\nThe risk-neutral probabilities are defined as \\(\\pi_u\\mathrm{e}^{rT}\\) for the up state and \\(\\pi_d\\mathrm{e}^{rT}\\) for the down state. Denoting these as \\(p_u\\) and \\(p_d\\) respectively, \\(\\eqref{binomialC2}\\)–\\(\\eqref{binomialR2}\\) can be written as\n\\[\\begin{align}\nC &= \\mathrm{e}^{-rT}[p_uC_u+p_dC_d]\\;,\\label{binomialC3}\\\\\nS &= \\mathrm{e}^{-rT}[p_uS_u+p_dS_d]\\;,\\label{binomialS3}\\\\\n1&= p_u+p_d\\;.\\label{binomialR3}\n\\end{align}\\]\nThe numbers \\(p_u\\) and \\(p_d\\) are both positive (because the state prices are positive under our no-arbitrage assumption) and \\(\\eqref{binomialR3}\\) states that they sum to one, so it is indeed sensible to consider them as probabilities. Equations \\(\\eqref{binomialC3}\\) and \\(\\eqref{binomialS3}\\) state that the value of a security today is its expected value at date \\(T\\) (the expectation taken with respect to the risk-neutral probabilities) discounted at the risk-free rate. Thus, these are “present value” formulas. Unlike the Capital Asset Pricing Model, for example, there is no risk premium in the discount rate. This is the calculation we would do to price assets under the actual probabilities if investors were risk neutral (or for zero-beta assets). So, we can act as if investors are risk neutral by adjusting the probabilities. Of course, we are not really assuming investors are risk neutral. We have simply embedded any risk premia in the probabilities.\nEquations \\(\\eqref{binomialC3}\\) and \\(\\eqref{binomialS3}\\) can be written in an equivalent form, which, though somewhat less intuitive, generalizes more readily. First, let’s introduce some notation for the price of the risk-free asset. Considering an investment of $1 today which grows to \\(\\mathrm{e}^{rT}\\) at date \\(T\\), it is sensible to take the price today to be \\(R=1\\) and the price in the up and down states at date \\(T\\) to be \\(R_u=R_d=\\mathrm{e}^{rT}\\). In terms of this notation, \\(\\eqref{binomialC3}\\)–\\(\\eqref{binomialR3}\\) can be written as:\n\\[\\begin{align}\n\\frac{C}{R} &= p_u \\frac{C_u}{R_u} + p_d \\frac{C_d}{R_d}\\;, \\label{binomialC4}\\\\\n\\frac{S}{R} &= p_u \\frac{S_u}{R_u} + p_d \\frac{S_d}{R_d}\\;, \\label{binomialS4}\\\\\n1&=p_u+p_d\\;.\\label{binomialR4}\n\\end{align}\\]\nEach of equations \\(\\eqref{binomialC4}\\) and \\(\\eqref{binomialS4}\\) states that the price of a security today divided by the price of the risk-free asset equals the expected future value of the same ratio, when we take expectations using the risk-neutral probabilities. In other words, the mean of the date–\\(T\\) value of the ratio is equal to the ratio today. We will discuss the interpretation and significance of these equations further below. First, we consider the other type of expectation in this model, which is based on probabilities corresponding to the stock.\nNote that the risk-neutral probabilities are the state prices multiplied by the gross return on the risk-free asset. Analogously, define numbers \\(q_u = \\pi_uS_u/S\\) and \\(q_d = \\pi_dS_d/S\\). Substituting for \\(\\pi_u\\) and \\(\\pi_d\\) in \\(\\eqref{binomialC2}\\)–\\(\\eqref{binomialR2}\\) and continuing to use the notation \\(R\\) for the price of the risk-free asset, we obtain\n\\[\\begin{align}\n\\frac{C}{S} &= q_u \\frac{C_u}{S_u} + q_d \\frac{C_d}{S_d}\\;, \\label{binomialC5}\\\\\n1 &= q_u + q_d\\;,\\label{binomialS5}\\\\\n\\frac{R}{S}& = q_u \\frac{R_u}{S_u} + q_d \\frac{R_d}{S_d}\\;. \\label{binomialR5}\n\\end{align}\\]\nEquation \\(\\eqref{binomialS5}\\) establishes that we can view the \\(q\\)’s as probabilities (like the risk-neutral probabilities, they are positive because the state prices are positive). Equations \\(\\eqref{binomialC5}\\) and \\(\\eqref{binomialR5}\\) both state that the ratio of a security price to the price of the stock today equals the mean value of the same ratio at date \\(T\\), when we compute expectations using the \\(q\\)’s as probabilities.\nHere is some useful terminology:\n\nAn assignment of probabilities to events is called a probability measure, or simply a measure (because it measures the events, in a sense). Thus, we have described two different probability measures in this section. \nThe ratio of one price to another is the value of the first (numerator) asset when we are using the second (denominator) asset as the numeraire. The term “numeraire” means a unit of measurement. For example, the ratio \\(C/S\\) is the value of the call when we use the stock as the unit of measurement: it is the number of shares of stock for which one call option can be exchanged (to see this, note that \\(C/S\\) shares is worth \\(C/S \\times S = C\\) dollars, so \\(C/S\\) shares is worth the same as one call.)\nA variable that changes randomly over time with the expected future value being always equal to the current value is called a martingale. \n\nThe right-hand sides of \\(\\eqref{binomialC4}\\)–\\(\\eqref{binomialS4}\\) and \\(\\eqref{binomialC5}\\) and \\(\\eqref{binomialR5}\\) are expectations under different probability measures (the \\(p\\)’s or \\(q\\)’s). The expected future (date–\\(T\\)) value equals the current (date–0) value, so the random variables (\\(C/R\\) and \\(S/R\\) or \\(C/S\\) and \\(R/S\\)) are martingales. The values \\(C/R\\) and \\(S/R\\) are the values of the call and stock using the risk-free asset as numeraire, and the values \\(C/S\\) and \\(R/S\\) are the values of the call and risk-free asset sing the stock as numeraire. Thus, we will express \\(\\eqref{binomialC4}\\)–\\(\\eqref{binomialS4}\\) as the call and stock are martingales when we use the risk-free asset as numeraire. Likewise, we will express \\(\\eqref{binomialC5}\\) and \\(\\eqref{binomialR5}\\) as the call and risk-free asset are martingales when we use the stock as numeraire. It should be understood in both cases that using an asset as numeraire means that we also use the corresponding probability measure (i.e., the \\(p\\)’s or \\(q\\)’s). In general, our conclusion that assets can be priced in terms of positive state prices when there are no arbitrage opportunities can be rephrased as: \nFor this exposition, it was convenient to first calculate the state prices and then calculate the various probabilities. However, that is not the most efficient way to proceed in most applications. In a typical application, we would view the prices of the stock and risk-free asset in the various states of the world as given, and we would be attempting to compute the value of the call option. Note that the sets of equations \\(\\eqref{binomialC2}\\)–\\(\\eqref{binomialR2}\\), \\(\\eqref{binomialC4}\\)–\\(\\eqref{binomialR4}\\), and \\(\\eqref{binomialC5}\\)–\\(\\eqref{binomialR5}\\) are all equivalent. In each case we would consider that there are three unknowns—the value \\(C\\) of the call option and either two state prices or two probabilities. In each case the state prices or probabilities can be computed from the last two equations in the set of three equations and then the call value \\(C\\) can be computed from the first equation in the set. All three sets of equations produce the same call value.\nIn fact, as we will see, it will not even be necessary to calculate the probabilities. The fact that ratios of non-dividend paying asset prices to the numeraire asset price are martingales will tell us enough about the probabilities to calculate derivative values without having to calculate the probabilities themselves.\nWe conclude this section with another reformulation of the pricing relations \\(\\eqref{binomialC2}\\)–\\(\\eqref{binomialR2}\\). This formulation will generalize more easily to pricing when there are a continuum of states, the subject of the next section.\nLet \\(\\text{prob}_u\\) denote the actual probability of the up state and \\(\\text{prob}_d\\) denote the probability of the down state. These probabilities are irrelevant for pricing derivatives in the binomial model, but we will use them to write the pricing relations \\(\\eqref{binomialC2}\\)–\\(\\eqref{binomialR2}\\) as expectations with respect to the actual probabilities. To do this, we can define \\[\\begin{align*}\n\\phi_u &= \\frac{\\pi_u}{\\text{prob}_u}\\; ,\\\\\n\\phi_d &= \\frac{\\pi_d}{\\text{prob}_d}\\;.\n\\end{align*}\\] Then \\(\\eqref{binomialC2}\\)–\\(\\eqref{binomialR2}\\) can be written as The right-hand sides are expectations with respect to the actual probabilities. For example, the right-hand side of equation \\(\\eqref{binomialC6}\\) is the expectation of the random variable that equals \\(\\phi_uC_u\\) in the up state and \\(\\phi_dC_d\\) in the down state. The risk-neutral probabilities can be calculated from \\(\\phi_u\\) and \\(\\phi_d\\) as \\(p_u=\\text{prob}_u\\phi_uR_u/R\\) and \\(p_d=\\text{prob}_d\\phi_dR_d/R\\). Likewise, the probabilities using the stock as the numeraire can be calculated from \\(\\phi_u\\) and \\(\\phi_d\\) as \\(q_u=\\text{prob}_u\\phi_uS_u/S\\) and \\(q_d=\\text{prob}_d\\phi_dS_d/S\\). In the following section, we will assume (which can be shown to be true under some technical conditions) that relations such as \\(\\eqref{binomialC6}\\)–\\(\\eqref{binomialR6}\\) hold in a general (non-binomial) model given the absence of arbitrage opportunities. We will then show, using definitions analogous to the definitions of \\(p_u\\), \\(p_d\\), \\(q_u\\), and \\(q_d\\) in this paragraph, that relations analogous to \\(\\eqref{binomialC4}\\)–\\(\\eqref{binomialR4}\\) and \\(\\eqref{binomialC5}\\)–\\(\\eqref{binomialR5}\\) hold."
  },
  {
    "objectID": "Chapter1.html#sec-c1-pricing-share-digitals",
    "href": "Chapter1.html#sec-c1-pricing-share-digitals",
    "title": "1  Asset Pricing Basics",
    "section": "1.9 Pricing Share Digitals",
    "text": "1.9 Pricing Share Digitals\nConsider first the problem of valuing the share digital. Let \\(Y(t)\\) denote its value at each date \\(t \\leq T\\). We seek to find \\(Y(0)\\). Our fundamental pricing formula [formula] tells us that \\[Y(0) = \\text{num}(0) \\mathrm{e}^\\text{num} \\left[\\frac{Y(T)}{\\text{num}(T)}\\right]\\; ,\\] for any numeraire with price \\(\\text{num}(t)\\). We want to choose the numeraire to simplify the calculation of the expectation. The expectation only involves the states of the world in which \\(S(T) \\geq K\\), because \\(Y(T)=0\\) when \\(S(T)<K\\). In the states of the world in which \\(S(T) \\geq K\\), the value of the share digital is \\(S(T)\\). The calculation of the expectation would be simplified if the value were a constant when it was nonzero, because, if you are to receive a constant amount in a certain event, your expected payoff is the constant times the probability of the event (e.g., the expected payoff of a gamble that pays $1 when a fair die rolls a 6 is 1/6). This suggests we should use the stock as the numeraire, because then we will have \\[\\frac{Y(T)}{\\text{num}(T)} = \\frac{S(T)}{S(T)} = 1\\] when \\(S(T) \\geq K\\), implying that \\[\\mathrm{e}^\\text{num} \\left[\\frac{Y(T)}{\\text{num}(T)}\\right] = \\text{prob}^S\\big(S(T)\\geq K\\big)\\; ,\\] where \\(\\text{prob}^S\\) denotes the probability using \\(S\\) as the numeraire. This implies that the value of the share digital is \\[S(0) \\times \\text{prob}^S\\big(S(T)\\geq K\\big)\\;.\\]\nThe remaining question is obviously how to compute the probability. We will not use the formula [probSnumeraire] which expresses the probability in terms of an expectation involving state prices. To attempt to do so would simply raise the question of how to compute the state prices. Instead, we use the fundamental pricing formula again, this time replacing the derivative value \\(Y\\) with the value of the risk-free asset. This is exactly analogous to computing the “\\(q\\) probabilities” from [binomialS5] and [binomialR5] in Sects. [s_oneperiodbinomial]. Recall that the fundamental formula holds for any non-dividend-paying asset, so it holds for \\(R(t)=\\mathrm{e}^{rt}\\), telling us that the ratio \\(R(t)/S(t)\\) is a martingale when we use \\(S\\) as the numeraire. In a continuous-time model (at least until we introduce stochastic volatility) this will give us exactly the information we need to compute the distribution of \\(S(T)\\) when we use \\(S\\) as the numeraire, and from the distribution of \\(S(T)\\) we can easily compute \\(\\text{prob}^S\\big(S(T)\\geq K\\big)\\). This calculation will be covered in Chapter ?sec-blackscholes for the Black-Scholes model."
  },
  {
    "objectID": "Chapter1.html#sec-c1-pricing-digitals",
    "href": "Chapter1.html#sec-c1-pricing-digitals",
    "title": "1  Asset Pricing Basics",
    "section": "1.10 Pricing Digitals",
    "text": "1.10 Pricing Digitals\nNow consider the problem of pricing the digital. We will change notation to let \\(Y(t)\\) denote now the value of the digital at time \\(t\\). Again we want to compute \\[Y(0) = \\text{num}(0) \\mathrm{e}^\\text{num}\\left[\\frac{Y(T)}{\\text{num}(T)}\\right]\\; ,\\] and again this expectation only involves the states of the world in which \\(S(T) \\geq K\\). In these states of the world, the value of the digital is already a constant \\(K\\), so we should take the numeraire to have a constant value at \\(T\\), so that the ratio \\(Y(T)/\\text{num}(T)\\) will be constant in the states in which \\(S(T) \\geq K\\). This means that we should take the numeraire to be the risk-free asset. For this numeraire, the pricing formula is \\[Y(0) = \\mathrm{e}^{-rT}\\mathrm{e}^R[Y(T)] = \\mathrm{e}^{-rT}K\\times \\text{prob}^R \\big(S(T)\\geq K\\big)\\; ,\\] so we need to compute the risk-neutral probability that \\(S(T) \\geq K\\). We will do this by using the fact that \\(S(t)/R(t) = \\mathrm{e}^{-rt}S(t)\\) is a martingale under the risk-neutral probability measure. This is analogous to computing the risk-neutral probabilities from [binomialS4] and [binomialR4] in Sects. [s_oneperiodbinomial].\nThis calculation will also be covered in Chapter ?sec-blackscholes for the Black-Scholes model.\nReaders familiar with the Black-Scholes formula may already have surmised that, under the Black-Scholes assumptions, \\[\\text{prob}^S\\big(S(T)\\geq K\\big) = \\N(d_1) \\quad \\text{and} \\quad \\text{prob}^R\\big(S(T)\\geq K\\big) = \\N(d_2)\\; ,\\] where \\(\\N\\) denotes the cumulative normal distribution function . The numbers \\(d_1\\) and \\(d_2\\) are different, and hence these are different probabilities, even though they are both probabilities of the option finishing in the money (\\(S(T) \\geq K\\)). They are different probabilities because they are computed under different numeraires."
  },
  {
    "objectID": "Chapter1.html#asset-pricing-with-a-continuum-of-states",
    "href": "Chapter1.html#asset-pricing-with-a-continuum-of-states",
    "title": "1  Asset Pricing Basics",
    "section": "1.4 Asset Pricing with a Continuum of States",
    "text": "1.4 Asset Pricing with a Continuum of States\nIn this section, we will define the concepts of state prices and probabilities corresponding to different numeraires in a more general framework than that of the preceding section. This leads to what we will call the “fundamental pricing equation,” namely equation \\(\\eqref{formula}\\). There are really no new concepts in this section, only a bit more mathematics.\nConsider a non-dividend-paying security having the random price \\(S(T)\\) at date \\(T\\). We call the contingencies that affect the price \\(S(T)\\) the “states of the world.” Our principle regarding state prices developed in the preceding section can in general be expressed as: \\[\\begin{equation}\\label{continuum1}\nS(0) = E[\\phi(T)S(T)]\\;.\n\\end{equation}\\] Here, \\(E[\\phi(T)S(T)]\\) denotes the expectation of the random variable \\(\\phi(T)S(T)\\). The random variable \\(\\phi(T)\\) is called the state price density. In a binomial model (or in any model with only a finite number of states of the world), the concept of an expectation is clear: it is just a weighted average of outcomes, the weights being the probabilities. In the binomial model, the right-hand side of equation \\(\\eqref{binomialS6}\\) is the same as the right-hand side of equation \\(\\eqref{continuum1}\\).\nTo convert from state prices to probabilities corresponding to different numeraires, we follow the same procedure as at the end of the previous section: we multiply together (i) the probability of the state, (ii) the value of \\(\\phi(T)\\) in the state, and (iii) the gross return of the numeraire in the state. If there is a continuum of states, then the actual probability of any individual state will typically be zero, so this multiplication will produce a zero probability. However, we can nevertheless add up these probabilities to define the probability of any event \\(A\\), an event being a set of states of the world. To do this, let \\(1_A\\) denote the random variable that takes the value 1 when \\(A\\) is true and which is zero otherwise. Then the probability of \\(A\\) using \\(S\\) as the numeraire is defined as \\[\\begin{equation}\\label{probSnumeraire}\nE\\left[1_A\\phi(T)\\frac{S(T)}{S(0)}\\right]\\;.\n\\end{equation}\\] This makes sense as a probability because it is nonnegative and because, if \\(A\\) is the set of all states of the world, then its probability is \\(E[\\phi(T)S(T)/S(0)]\\), which equals one by virtue of \\(\\eqref{continuum1}\\). From the definition \\(\\eqref{probSnumeraire}\\) of the probability of any event \\(A\\), it can be shown that the expectation of any random variable \\(X\\) using \\(S\\) as the numeraire is \\[\\begin{equation}\\label{expSnumeraire}\nE\\left[X\\phi(T)\\frac{S(T)}{S(0)}\\right]\\;.\n\\end{equation}\\]\nThe use of the symbol \\(S\\) to denote the price of the numeraire may be confusing, because~\\(S\\) is usually used to denote a stock price. The numeraire here could be any non-dividend-paying asset. For example, we can take \\(S(t)=\\mathrm{e}^{rt}\\), the price of the risk-free asset. The definition of probabilities as \\[\\begin{equation}\\label{riskneutralprob00}\nE[1_A\\phi(T)\\mathrm{e}^{rT}]\n\\end{equation}\\] will be called the risk-neutral probability measure or simply risk-neutral measure as before. \nDifferent numeraires lead to different probability measures and hence to different expectations. To keep this straight, we will use the numeraire as a superscript on the expectation symbol: for example, \\(E^S\\) will denote expectation with respect to the probability measure that corresponds to \\(S\\) being the numeraire. Also, we will use the symbol \\(\\text{prob}^S(A)\\) to denote the probability of an event \\(A\\) when we use \\(S\\) as the numeraire. So, \\(\\eqref{probSnumeraire}\\) and \\(\\eqref{expSnumeraire}\\) will be written as \\[\\begin{align}\n\\text{prob}^S(A) &= E\\left[1_A\\phi(T)\\frac{S(T)}{S(0)}\\right]\\;,\\label{probSnumeraire2}\\\\\n\\label{expSnumeraire2}\nE^S[X] &= E\\left[X\\phi(T)\\frac{S(T)}{S(0)}\\right]\\;.\n\\end{align}\\]\nOur key result in the preceding section was that the ratio of the price of any non-dividend paying asset to the price of the numeraire asset is not expected to change when we use the probability measure corresponding to the numeraire. We will demonstrate the same result in this more general model. Recall that \\(T\\) denotes an arbitrary but fixed date at which we have defined the probabilities using \\(S\\) as the numeraire in \\(\\eqref{probSnumeraire}\\). At each date \\(t<T\\), let \\(E^S_t\\) denote the expectation given information at time \\(t\\) and using \\(S\\) as the numeraire (we will continue to write the expectation at date 0 without a subscript; i.e., \\(E^S\\) has the same meaning as \\(E^S_0\\)). Let \\(Y\\) denote the price of another non-dividend-paying asset. We will show that \\[\\begin{equation}\\label{preformula}\n\\frac{Y(t)}{S(t)} = E^S_t \\left[\\frac{Y(T)}{S(T)}\\right]\\;.\n\\end{equation}\\] Thus, the expected future (date–\\(T\\)) value of the ratio \\(Y/S\\) always equals the current (date–\\(t\\)) value when we use \\(S\\) as the numeraire. As discussed in the preceding section, the mathematical term for a random variable whose expected future value always equals its current value is “martingale.” Thus, we can express equation \\(\\eqref{preformula}\\) as stating that the ratio \\(Y/S\\) is a martingale when we compute expectations using the probability measure that corresponds to~\\(S\\) being the numeraire.\nThe usefulness of equation \\(\\eqref{preformula}\\) is that it gives us a formula for the asset price \\(Y(t)\\) at any time \\(t\\)—and recall that this formula holds for every non-dividend paying asset. The formula is obtained from \\(\\eqref{preformula}\\) by multiplying through by \\(S(t)\\): \\[\\begin{equation}\\label{formula}\nY(t) = S(t)E^S_t \\left[\\frac{Y(T)}{S(T)}\\right]\\;.\n\\end{equation}\\] It is at the heart of modern pricing of derivative securities. It is a present value relation: the value at time~\\(t\\) of the asset is the expectation of its value \\(Y(T)\\) at time~\\(T\\) “discounted” by the (possibly random) factor \\(S(t)/S(T)\\). To emphasize that the numeraire can be any non-dividend-paying asset (and not necessarily a stock price, as the symbol \\(S\\) might suggest), we can write equation \\(\\eqref{formula}\\) in the equivalent form \\[\\begin{equation}\\label{formula10}\nY(t) = \\text{num}(t)E^\\text{num}_t \\left[\\frac{Y(T)}{\\text{num}(T)}\\right]\\;,\\tag{\\ref{formula}$'$}\n\\end{equation}\\] where now \\(\\text{num}(t)\\) denotes the price of the (non-dividend-paying) numeraire asset at time~\\(t\\).\nFor example, letting \\(R(t)\\) denote the value \\(\\mathrm{e}^{rt}\\) of the risk-free asset and using it as the numeraire, equation \\(\\eqref{formula}\\) becomes \\[\\begin{equation}\\label{riskneutralformula}\nY(t) = \\mathrm{e}^{rt}E^R_t\\left[\\frac{Y(T)}{\\mathrm{e}^{rT}}\\right] = \\mathrm{e}^{-r(T-t)}E^R_t [Y(T)]\\;,\n\\end{equation}\\] which means that the value \\(Y(t)\\) is the expected value of \\(Y(T)\\) discounted at the risk-free rate for the remaining time \\(T\\!-\\!t\\), when the expectation is computed under the risk-neutral probability measure.\nWe end this section with a proof of \\(\\eqref{preformula}\\), a proof that the reader may skip if desired.\n\n\n\n\n\n\nProof of \\(\\eqref{preformula}\\)\n\n\n\nConsider any time \\(t\\) and any event \\(A\\) that is distinguishable by time \\(t\\). Consider the trading strategy of buying one share of the asset with price \\(Y\\) at time \\(t\\) when \\(A\\) has happened and financing this purchase by short selling \\(Y(t)/S(t)\\) shares of the asset with price \\(S\\). Each share of this asset that you short brings in \\(S(t)\\) dollars, so shorting \\(Y(t)/S(t)\\) shares brings in \\(Y(t)\\) dollars, exactly enough to purchase the desired share of the first asset. Hold this portfolio until time \\(T\\) and then liquidate it. Liquidating it will generate \\[1_A\\left(Y(T)-\\frac{Y(t)}{S(t)}S(T)\\right)\\] dollars. The multiplication by the random variable \\(1_A\\) is because we only implement this strategy when \\(A\\) occurs (i.e., when \\(1_A=1\\)). Consider the security that pays this number of dollars at time \\(T\\). Because we obtained it with a trading strategy that required no investment at time \\(t\\), its price at time 0 must be 0. We already observed that we can represent the price in terms of state prices, so we conclude that \\[E \\left[\\phi(T)1_A\\left(Y(T)-\\frac{Y(t)}{S(t)}S(T)\\right)\\right] = 0\\;\\;.\\] When we divide by \\(S(0)\\), this will still equal zero. Factoring \\(S(T)\\) outside the parentheses gives \\[E \\left[1_A\\frac{S(T)}{S(0)}\\phi(T)\\left(\\frac{Y(T)}{S(T)}-\\frac{Y(t)}{S(t)}\\right)\\right] = 0\\;\\;.\\] We see from the formula \\(\\eqref{expSnumeraire2}\\) for expectations using \\(S\\) as the numeraire that we can write this as \\[E^S\\left[1_A\\left(\\frac{Y(T)}{S(T)}-\\frac{Y(t)}{S(t)}\\right)\\right]=0\\;.\\] This is true for any event \\(A\\) distinguishable at time \\(t\\), so the expectation of \\(Y(T)/S(T)-Y(t)/S(t)\\) must be zero given any information at time \\(t\\) when we use \\(S\\) as the numeraire; i.e., \\[E^S_t\\left[\\frac{Y(T)}{S(T)}-\\frac{Y(t)}{S(t)}\\right]=0\\; ,\\] or, equivalently \\[E^S_t\\left[\\frac{Y(T)}{S(T)}\\right] = \\frac{Y(t)}{S(t)}\\;.\\]"
  },
  {
    "objectID": "Chapter1.html#sec-c1-introoptions",
    "href": "Chapter1.html#sec-c1-introoptions",
    "title": "1  Asset Pricing Basics",
    "section": "1.8 Introduction to Option Pricing",
    "text": "1.8 Introduction to Option Pricing\nA complete development of derivative pricing requires the continuous-time mathematics to be covered in the next chapter. However, we can present the basic ideas using the tools already developed. Consider the problem of pricing a European call option. Let \\(T\\) denote the maturity of the option and \\(K\\) its strike price, and let \\(S\\) denote the price of the underlying. We will assume for now that the underlying does not pay dividends, but we will make no assumptions about the distribution of its price \\(S(T)\\) at the maturity of the option. Assume there is a risk-free asset with constant interest rate \\(r\\).\nOur convention will be that date 0 denotes the date at which we are attempting to value a derivative. The value of the option at maturity is \\(\\max(0,S(T)-K)\\). Consider a contract that pays \\(S(T)\\) at date \\(T\\) when \\(S(T) \\geq K\\) and that pays zero when \\(S(T)<K\\), and consider another contract that pays \\(K\\) at date \\(T\\) when \\(S(T)\\geq K\\) and zero when \\(S(T)<K\\). In Chapter ?sec-blackscholes, we will call the first contract a “share digital” and the second contract a “digital.” The call option is equivalent to a portfolio that is long the first contract and short the second, because the value of the call at maturity is \\(S(T)-K\\) when \\(S(T)\\geq K\\) and it is zero otherwise. So, we can value the call if we can value the share digital and the digital. This “splitting up” of complex payoffs into simpler contracts is a key to analyzing many types of derivatives."
  },
  {
    "objectID": "Chapter1.html#sec-c1-incomplete",
    "href": "Chapter1.html#sec-c1-incomplete",
    "title": "1  Asset Pricing Basics",
    "section": "1.12 An Incomplete Markets Example",
    "text": "1.12 An Incomplete Markets Example\nIn this section, we consider a more difficult valuation problem than the binomial model and discuss the general implications of this example. We only need to make the problem slightly more difficult to see the issues. Consider a “trinomial” model, in which the asset price takes three possible values: \\(S_u > S_m > S_d\\) (“\\(m\\)” for middle, medium, median, ...). We continue to make the “no arbitrage” assumption \\eqref{binomialnoarbitrage}{. State prices \\(\\pi_u\\), \\(\\pi_m\\) and \\(\\pi_m\\) must satisfy equations analogous to \\(\\eqref{binomialS2}\\)–\\(\\eqref{binomialR2}\\); specifically,\n\\begin{subequations} \\begin{align} S &= _uS_u+_mS_m+_dS_d;,\\ 1 &= _u^{rT} + _m^{rT} +_d ^{rT};. end{align}end{subequations} In the binomial case, these equations can be solved for \\(\\pi_u\\) and \\(\\pi_d\\), as shown in \\(\\eqref{binomialstateprices}\\). However, in the trinomial case, we have only two equations in three unknowns. Thus, there exist many solutions.\nGiven any particular solution \\((\\pi_u,\\pi_m,\\pi_d)\\) of \\(\\eqref{binomialSR10combined}\\)), we can define the risk-neutral probabilities \\(p_u\\), \\(p_m\\) and \\(p_d\\) as before—e.g., \\(p_u = \\pi_u\\mathrm{e}^{rT}\\). Likewise, we can define the probabilities using the stock as numeraire. Thus, we can value calls and puts and other derivative securities. However, the values we obtain will depend on the particular solution \\((\\pi_u,\\pi_m,\\pi_d)\\). There are many arbitrage-free values for a call option, one for each solution of \\(\\eqref{binomialSR10combined}\\)).\nThe reason that there are many arbitrage-free values for a call (or put) is that a call cannot be replicated in a trinomial model using the stock and risk-free asset; we can say equivalently that there is no “delta hedge” for a call option. Recall that we first found the value of a call in the binomial model by finding the replicating portfolio and calculating its cost. A similar analysis is impossible in the trinomial model. To see this, consider a portfolio of \\(a\\) dollars invested in the risk free asset and \\(b\\) dollars invested in the stock. The value of the portfolio at date \\(T\\) will be \\(a\\mathrm{e}^{rT} + bS_x/S\\), where \\(x \\in \\{u,m,d\\}\\). To replicate the call, we need \\(a\\) and \\(b\\) to satisfy\n\\[\\begin{align}\na\\mathrm{e}^{rT} + bS_u/S &= \\max(0,S_u-K)\\; ,\\\\\na\\mathrm{e}^{rT} + bS_m/S &= \\max(0,S_m-K)\\; ,\\\\\na\\mathrm{e}^{rT} + bS_d/S &= \\max(0,S_d-K)\\;.\nend{align}\\] These are three linear equations in the two unknowns \\(a\\) and \\(b\\). For any strike price \\(K\\) between \\(S_d\\) and \\(S_u\\), none of the equations is redundant, and the system has no solution. When there are state-contingent claims (such as the call option payoff) that cannot be replicated by trading in the marketed assets (the stock and risk-free asset in this case), one says that the market is “incomplete.” Thus, the trinomial model is an example of an incomplete market.\nTo value derivative securities in this situation, we have to select some particular solution \\((\\pi_u,\\pi_m,\\pi_d)\\) of \\(\\eqref{binomialSR10combined}\\)) and assume that the market uses that solution for valuation. Equivalently, we can assume the market uses a particular set of risk-neutral probabilities \\((p_u, p_m, p_d)\\). This type of valuation is often called “equilibrium” valuation, as opposed to arbitrage valuation, because to give a foundation for our particular choice of risk-neutral probabilities, we would have to assume something about the preferences and endowments of investors and the production possibilities. We will encounter incomplete markets when we consider stochastic volatility in Chapter ?sec-stochasticvolatility."
  },
  {
    "objectID": "Chapter1.html#problems",
    "href": "Chapter1.html#problems",
    "title": "1  Asset Pricing Basics",
    "section": "Problems",
    "text": "Problems\n\\begin{prob} Create an Excel worksheet in which the user inputs \\(S\\), \\(S_d\\), \\(S_u\\), \\(K\\), \\(r\\) and~\\(T\\). Check that the no-arbitrage condition eqref{binomialnoarbitrage} is satisfied. Compute the value of a call option in each of the following ways:\n\nCompute the delta and use [C0].\nCompute the state prices and use [binomialC2].\nCompute the risk-neutral probabilities and use [binomialC3].\nCompute the probabilities using the stock as numeraire and use [binomialC5]\n\nVerify that all of these methods produce the same answer. end{prob} \\begin{prob} In a binomial model, a put option is equivalent to \\(delta_p\\) shares of the stock, where \\(delta_p = (P_u-P_d)/(S_u-S_d)\\) (this will be negative, meaning a short position) and some money invested in the risk-free asset. Derive the amount of money \\(x\\) that should be invested in the risk-free asset to replicate the put option. The value of the put at date~0 must be \\(x+delta_pS\\). end{prob}\n\\begin{prob} Using the result of the previous exercise, repeat Problem~\\(\\ref{e_binomialcall}\\) for a put option. end{prob} \\begin{prob} Here is a chance to apply option pricing theory to real life. Suppose you have a ``significant other’’ who would marry you if you ask.\n\nWhat type of option do you have on marriage? Can you tell when it is in the money?\nUnder what circumstances should you exercise this option early?\nWhat is the put option in a marriage contract called? (You shouldn’t need a hint for this one, but, just in case, it is the name of a song made popular by Dolly Parton!).\n\nBefore anyone might be tempted to take this too literally, it should be pointed out that, in some “real option” settings, keeping one’s options open has both advantages and disadvantages. Airbus’ decision to build a new larger passenger plan can be seen as the early exercise of a call option, justified perhaps because by committing to do so it discouraged Boeing from launching a similar project, both companies presumably believing that the market is too small for both to enter. Thus, the exercise of a real option (commitment) can change the environment in ways that do not arise, or at least we assume not to arise, in financial markets. end{prob}"
  },
  {
    "objectID": "Chapter1.html#sec-c1-a-remark",
    "href": "Chapter1.html#sec-c1-a-remark",
    "title": "1  Asset Pricing Basics",
    "section": "1.11 A Remark",
    "text": "1.11 A Remark\nIt seems worthwhile here to step back a bit from the calculations and try to offer some perspectives on the methods developed in this chapter. The change of numeraire technique probably seems mysterious. Even though one may agree that it works after following the steps in the chapter, there is probably a lingering question about why it works. The author’s opinion is that it may be best to regard it simply as a “computational trick.” Fundamentally it works because valuation is linear. Linearity simply means that the value of a cash flow \\(X=X_1+X_2\\) is the sum of the values of the cash flows \\(X_1\\) and \\(X_2\\) and the value of the cash flow \\(aX\\) is \\(a\\) times the value of \\(X\\), for any constant \\(a\\). This linearity is manifested in the statement that the value of a cash flow is the sum across states of the world of the state prices multiplied by the size of the cash flow in each state. The change of numeraire technique exploits the linearity to further simplify the valuation exercise. There are other ways the linearity can be used (for example, it produces solvable partial differential equations) but the particular trick we have developed in this chapter seems the most useful to the author (and to others, though perhaps not to everyone). After enough practice with it, it will seem as natural as other computational tricks one might have learned."
  },
  {
    "objectID": "Chapter1.html#sec-c1-problems",
    "href": "Chapter1.html#sec-c1-problems",
    "title": "1  Asset Pricing Basics",
    "section": "1.13 Exercises",
    "text": "1.13 Exercises\n\\begin{prob} Create an Excel worksheet in which the user inputs \\(S\\), \\(S_d\\), \\(S_u\\), \\(K\\), \\(r\\) and~\\(T\\). Check that the no-arbitrage condition eqref{binomialnoarbitrage} is satisfied. Compute the value of a call option in each of the following ways:\n\nCompute the delta and use (?eq-C0).\nCompute the state prices and use \\(\\eqref{binomialC2}\\).\nCompute the risk-neutral probabilities and use \\(\\eqref{binomialC3}\\).\nCompute the probabilities using the stock as numeraire and use\n\n\n\n\nVerify that all of these methods produce the same answer. end{prob} \\begin{prob} In a binomial model, a put option is equivalent to \\(\\delta_p\\) shares of the stock, where \\(\\delta_p = (P_u-P_d)/(S_u-S_d)\\) (this will be negative, meaning a short position) and some money invested in the risk-free asset. Derive the amount of money \\(x\\) that should be invested in the risk-free asset to replicate the put option. The value of the put at date~0 must be \\(x+\\delta_pS\\). end{prob}\n\\begin{prob} Using the result of the previous exercise, repeat Problem~\\(\\ref{e_binomialcall}\\) for a put option. end{prob} \\begin{prob} Here is a chance to apply option pricing theory to real life. Suppose you have a ``significant other’’ who would marry you if you ask.\n\nWhat type of option do you have on marriage? Can you tell when it is in the money?\nUnder what circumstances should you exercise this option early?\nWhat is the put option in a marriage contract called? (You shouldn’t need a hint for this one, but, just in case, it is the name of a song made popular by Dolly Parton!).\n\nBefore anyone might be tempted to take this too literally, it should be pointed out that, in some “real option” settings, keeping one’s options open has both advantages and disadvantages. Airbus’ decision to build a new larger passenger plan can be seen as the early exercise of a call option, justified perhaps because by committing to do so it discouraged Boeing from launching a similar project, both companies presumably believing that the market is too small for both to enter. Thus, the exercise of a real option (commitment) can change the environment in ways that do not arise, or at least we assume not to arise, in financial markets. end{prob}"
  },
  {
    "objectID": "Chapter1.html#sec-s_fundamentalconcepts",
    "href": "Chapter1.html#sec-s_fundamentalconcepts",
    "title": "1  Asset Pricing Basics",
    "section": "1.1 Fundamental Concepts",
    "text": "1.1 Fundamental Concepts\n\nLongs, Shorts, and Margin\nIn financial markets, the owner of an asset is said to be long the asset. If person A owes something to person B, the debt is an asset to person B but a liability to person A. One also says that person A is short the asset. For example, if someone borrows money and invests the money in stocks, then the individual is short cash and long stocks.\nOne must invest some of one’s own money when borrowing money to buy stocks. For example, an individual could invest $600, borrow $400, and buy $1000 of stock. The $600 is called the margin posted by the investor, and buying stocks in this way is called buying on margin. The investor, or the portfolio, is also said to be levered, because buying $1000 of stock with only a $600 investment amplifies the risk and return per dollar of investment. On a percentage basis, we would say the account has 60% margin, the 60% being the ratio of the equity (assets minus liabilities = $1000 of stock minus $400 debt) to the assets ($1000 of stock). If the value of the stock drops sufficiently far, then it may become doubtful whether the investor can repay the $400. In this case, the investor must either sell the stock or invest more of his own funds (i.e., he receives a margin call). In other words, in actual markets there are margin requirements, that specify a minimum percent margin an investor must have initially (when borrowing money) and a minimum percent margin the investor must maintain.\nRather than borrowing money to buy stocks, an investor can do the opposite—he can borrow stocks to buy money. In this case, “buying money” means selling the borrowed stocks for cash. Such an investor will be short stocks and long cash. This is called short selling (or, more briefly, shorting) stocks. For example, suppose individual A borrows 100 shares of stock from individual B and then sells them to individual C. Both B and C are long the 100 shares and A is short, so the net long position is \\(2 \\times 100 - 100\\), which is the original 100 shares that B was long. A short seller of stocks must pay to the lender of the stocks any dividends that are paid on the stock. In our example, both B and C own the 100 shares so both expect to receive dividends. The company will pay dividends only to C, and A must pay the dividends to~B.\nOf course, investors always wish to buy low and sell high. The usual method is to buy stocks and hope they rise. An investor who short sells also wishes to buy low and sell high, but he reverses the order—he sells first and then hopes the stocks fall. The risk is that the stocks will instead rise, which will increase the value of his liability (short stock position) without increasing the value of his assets (long cash position), thus putting him under water. To shield the lender of the stocks from this risk, a short seller must also invest some of his own funds, and this amount is again called the investor’s margin. For example, an investor might invest $600, and borrow and sell $1000 of stock. In this case, the investor will be long $1600 cash and short $1000 worth of stock. His equity is $600 and his percent margin is calculated as $600/$1000 = 60%. Again, there are typically both initial and maintenance margin requirements. An additional feature of short selling for small individual investors is that they typically will not earn interest on the proceeds of the short sale (the $1000 cash obtained from selling stocks in the above example).\nIn this book, we will assume there is a single risk-free rate at which one can both borrow and lend. Moreover, we will assume that investors earn this rate on margin deposits, including the proceeds of short sales (and including any margin that may be required when buying and selling forward and futures contracts). Thus, investors gain from buying on margin if the asset return is sure to exceed the risk-free rate, and they gain from short selling if the return on an asset is sure to be below the risk-free rate. These assumptions are not reasonable for small individual investors, but they are fairly reasonable for institutional investors. We will assume that no asset has a return that is certain to be above the risk-free rate nor certain to be below the risk-free rate, because institutional investors could arbitrage such guaranteed high-return or guaranteed low-return assets.\n\n\nCalls and Puts\nCall and put options are the basic derivative securities and the building blocks of many others. A derivative security is a security the value of which depends upon another security. A call option is the right to buy an asset at a pre-specified price. The pre-specified price is called the exercise price, the strike price, or simply the strike. We will often call the asset a stock, but there are options on many other types of assets also, and everything we say will be applicable to those as well. The asset to which the call option pertains is called the underlying asset, or, more briefly, the underlying. If the market value of the asset exceeds the exercise price, then we say the call option is in the money. Buying a call option is a way to bet on the upside of the underlying asset.\nA put option is the right to sell an asset at a pre-specified (exercise, strike) price. Buying a put is a way to bet on an asset price becoming low (similar to shorting). A put option is in the money if the exercise price exceeds the value of the asset. Both puts and calls are potentially valuable and hence the buyer of a put or call must pay the seller.\nA long put option provides insurance to someone who is long the underlying asset, because it guarantees that the asset can always be sold at the strike price of the put (of course, it can be sold at the market price, if that is higher than the strike of the put). Symmetrically, a long call option provides insurance to someone who is short the underlying asset. The terminology in option markets reflects the parallels between options and insurance contracts. In particular, the seller of an option is said to write the option and the compensation (price) he receives from the buyer is called the option premium, just as an insurance company writes insurance contracts in exchange for premium income. Calculating the price at which one should be willing to trade an option is the main topic of this book.\nIt is important to recognize the different situations of someone who is short a call option and someone who is long a put. Both positions are bets on the downside of the asset. Both the investor who is short a call and the investor who is long a put may eventually sell the underlying asset and receive the exercise price in exchange. However, the investor who is long a put has an option to sell the asset at the exercise price and the investor who is short a call has an obligation to sell the asset at the exercise price, should the counterparty choose to exercise the call. Thus, the investor who is long a put will be selling at the exercise price when it is profitable to do so, whereas the investor who is short a call will be selling at the exercise price when it is unprofitable. The buyer of a put must pay the premium to the seller; he then profits if the asset price is low, with his maximum possible profit being quite large (the maximum value is attained when the market value of the underlying asset reaches zero). In contrast, the seller of a call receives premium income, and the premium is his maximum possible profit, whereas his potential losses are unbounded. Thus, these are very different positions.\nIndividuals who sell calls usually sell out-of-the-money covered calls. “Covered” means that they own the underlying asset and can therefore deliver the underlying if the call is exercised without incurring any further expense—they experience only an opportunity cost in delivering it for less than the market price. A call being out of the money implies that the price of the underlying must rise before the call would be exercised against the seller; thus, the seller of an out-of-the money covered call still has some potential for profit from the underlying. In addition, of course, the seller receives the premium income from the call. Institutions often follow this strategy also, using the premium income to enhance their return from the underlying. One can hedge a short call without owning a full share of the underlying asset, if one is able to rebalance the hedge over time. Calculating such hedges is another of the principal topics of this book.\nIn a certain sense, option markets are zero-sum games. The profit earned by one counterparty to an option transaction is a loss suffered by the other. However, options can allow for an increase in the welfare of all investors by improving the allocation of risk. A producer who must purchase a certain input may buy a call option, giving him the right to buy the input at a fixed price. This caps his expense. The seller of the call now bears the risk that the input price will be high—in this case, the option will be exercised and he will be forced to sell at a price below the market price. It may be that the seller is in a better position to bear the risk (for example, he may have less of the risk in his portfolio) and the option transaction may thereby improve the allocation of risks across investors. The similarity to insurance should be apparent.\nQuite complex bets or hedges can be created by combining options. For example, a long call and put with the same strike price is called a straddle. Such a portfolio is (almost) always in the money. It is in fact a bet on volatility—a big move in the underlying asset value away from the exercise price will lead to either the call or put having a high value. Another important example of an option portfolio is a collar. A collar consists of a long put and a short call, or a short call and a long put, with the options having the same maturity. As mentioned before, a long put provides insurance to someone who is long the underlying asset. Selling a call provides premium income that can be used to offset the cost of the put (the most popular type of collar is a zero-cost collar: a collar in which the premium of the call is equal to the premium of the put). The cost of selling a call for an owner of the underlying is that it sells off the upside of the underlying asset—if the value of the asset exceeds the strike price of the call, then the call will be exercised and the underlying asset must be delivered for the strike price (rather than the higher market price). Thus, one can purchase the downside insurance provided by a long put by selling part of the upside potential of the asset, rather than paying the cost of the insurance out of pocket. There are many other examples of option portfolios that could be given.\nSome puts and calls are traded on exchanges. In this case, the exchange clearinghouse steps between the buyer and seller and becomes the counterparty to both the buyer and seller. This eliminates the risk that the seller might default on his obligation when the buyer chooses to exercise his option. If the owner of an option chooses to exercise, the clearinghouse randomly chooses someone who is short the option to fulfill the obligation. Most exchange traded options are never exercised, because any gain on a long contract can be captured by selling the contract at the market price, thus cancelling the position. Obviously, however, the right to exercise is essential, because it determines the market price. Puts and calls are also transacted over the counter, which means that they are private contracts of the counterparties. Moreover, puts and calls are embedded in many other financial instruments. A prosaic but important example is that most homeowners have the right to pay off their mortgages early. This means they have call options on their mortgages, with exercise price equal to the remaining mortgage principal. Similarly, callable bonds can be redeemed early by the company issuing them, convertible bonds have embedded call options on the company’s stock (which are exercised by converting the bonds) and there are many, many other examples. Puts and calls also exist outside financial markets. For example, a company may begin manufacturing a new product at a small scale; if the product is successful, the scale can be expanded. In this case, the company buys a call option on large-scale production with the premium being the cost of launching small-scale production. Adapting the methods developed for financial options to value such real options is an important and growing field. \n\n\nExercise Policies for Calls and Puts\nIt may be rational to exercise a call if the asset value exceeds the exercise price. Thus, denoting the price of the asset by \\(S\\) and the exercise price by \\(K\\), the owner of a call option can profit by \\(S-K\\) dollars by exercising the option when \\(S>K\\). If \\(S<K\\), exercise would be irrational. Thus, the payoff to the owner of the call option is \\(\\max(0,S-K)\\). It has been said that timing is everything, and the timing here should be made clearer. The simplest type of option is called a European option. A European option has a finite lifetime and can only be exercised at its maturity date. For a European call option, the exercise strategy just described is the optimal one, with \\(S\\) representing the asset price at the maturity date of the option. Equally, if not more, important are American options, which can be exercised at any time before maturity.\nFor an American call option, the exercise strategy just described is the optimal one at the maturity date, but it may also be optimal to exercise prior to maturity. Let \\(K\\) denote the exercise price, \\(T\\) the date the option matures, and \\(S(t)\\) the price of the underlying asset at date \\(t \\leq T\\). The intrinsic value of the call option at date \\(t\\) is defined to be \\(\\max(0,S(t)-K)\\). One would of course never exercise unless the intrinsic value is positive—i.e., unless the option is in the money. Moreover, if the asset does not pay a dividend (or other type of cash flow) prior to the option maturity then one should not exercise in any circumstances prior to maturity. This is captured in the saying: “calls are better alive than dead.” Exercise being suboptimal is equivalent to the value of the option exceeding the intrinsic value.\nThe principle that calls on non-dividend-paying assets are better alive than dead follows from two facts: (i) it is generally a good thing (in financial markets as well as in life) to keep one’s options open, and (ii) early exercise implies early payment of the exercise price and hence foregone interest. The usual protest that is heard when this statement is made is that one should surely exercise if he expects the stock price to plummet, because by exercising (and then selling the stock acquired) one can lock in the current stock price rather than waiting for it to fall, in which case the option will surely be worth less. This intuition is a reasonable one, but it ignores the fact that the investor could short sell the stock if he expects it to plummet—he doesn’t need to exercise the option to lock in the current stock price. In fact, shorting the stock and retaining the option is always better than exercising, assuming the underlying asset does not pay a dividend.\nSpecifically, suppose an investor considers exercising at date \\(t\\). As an alternative to exercising early, consider shorting the stock at date~\\(t\\) and retaining the option. This is always better than exercising at date~\\(t\\), because the short position can be covered (the stock can be purchased and returned to the lender to cancel the short position) at cost \\(K\\) at date~\\(T\\) by exercising the option, and paying \\(K\\) at date \\(T\\) is better than paying it at date \\(t\\), given that interest rates must be nonnegative. To be more precise, note that exercise at date \\(t\\) produces \\(S(t)-K\\) dollars at date \\(t\\). On the other hand, retaining the option, shorting the stock at date \\(t\\), and covering the short either by exercising the option or buying the stock in the market (whichever is cheaper) produces \\(S(t)\\) dollars at date \\(t\\) and \\[\\max(0,S(T)-K) - S(T) = \\max(-S(T), -K) = -\\min(S(T),K) \\geq -K\\] dollars at date \\(T\\). If \\(S(T)>K\\), one has \\(-K\\) dollars at date \\(T\\), in which case retaining the option has been superior due to the time value of money. Furthermore, if \\(S(T)<K\\), the strategy of retaining the option and shorting the stock produces \\(-S(T) > -K\\) dollars at date \\(T\\), so retaining the option is superior due both to flexibility (waiting until \\(T\\) to decide whether to exercise turns out to be better than committing at date \\(t\\)) and because of the time value of money.\nEarly exercise of a call option can be optimal when the underlying asset pays a dividend. The above analysis does not apply in this case, because paying the dividend to the lender of the stock is an additional cost for the strategy of retaining the option and shorting the stock. If the dividend is so small that it cannot offset the time value of money on the exercise price, then early exercise will not be optimal. In other cases, deriving the optimal exercise strategy is a complicated problem that we will first begin to study in Chapter 5.\nA European put option will be exercised at its maturity \\(T\\) if the price \\(S(T)\\) of the underlying asset is below the exercise price \\(K\\). In general, the value at maturity can be expressed as \\(\\max(0,K-S(T))\\). Early exercise of an American put can be optimal, regardless of whether the underlying pays a dividend. While it is valuable to keep one’s options open (for puts as well as calls) the time value of money works in the opposite direction for puts. Early exercise of a put option implies early receipt of the exercise price, and it is better to receive cash earlier rather than later. In general, whether early exercise is optimal depends on how deeply the option is in the money—if the underlying asset price is sufficiently low, then it will be fairly certain that exercise will be optimal, whether earlier or late; in this case, one should exercise earlier to earn interest on the exercise price. How low it should be to justify early exercise depends on the interest rate (a higher rate makes the time-value-of-money issue more important, leading to earlier exercise) and the volatility of the underlying asset price (a lower volatility reduces the value of keeping one’s options open, leading also to earlier exercise). We will begin to study the valuation of American puts in Chapter 5 also.\n\n\nCompounding Interest\nDuring most of the first two parts of the book (the only exception being Chapter 7) we will assume there is a risk-free asset earning a constant rate of return. For simplicity, we will specify the rate of return as a continuously compounded rate. For example, if the annual rate with annual compounding is~\\(r_a\\), then the corresponding continuously compounded rate is \\(r\\) defined as \\(r = \\log (1+r_a)\\), where \\(\\log\\) denotes the natural logarithm function. This means that the gross return over a year (one plus the rate of return) is \\(\\mathrm{e}^r = 1+r_a\\). More generally, an investment of \\(x\\) dollars for a time period of length~\\(T\\) (we measure time in years, so, e.g., a six-month investment would mean \\(T=0.5\\)) will result in the ownership of \\(x\\mathrm{e}^{rT}\\) dollars at the end of the time period.\nExpressing the interest rate as a continuously compounded rate enables us to avoid having to specify in each instance whether the rate is for annual compounding, semi-annual compounding, monthly compounding, etc. For example, the meaning of an annualized rate \\(r_s\\) for semi-annual compounding is that an investment of \\(x\\) dollars will grow over a year to \\(x(1+r_s/2)^2\\). The equivalent continuously compounded rate is defined as \\(r = \\log (1+r_s/2)^2\\), and in terms of this rate we can say that the investment will grow in six months to \\(x\\mathrm{e}^{0.5 r}\\) and that it will grow in one year to \\(x\\mathrm{e}^r\\). We can interpret this rate as being continuously compounded because compounding \\(n\\) times per year at an annualized rate of \\(r\\) results in $1 growing in a year to \\((1+r/n)^n\\) and \\[\\lim_{n \\rightarrow \\infty} \\left(1+\\frac{r}{n}\\right)^n = \\mathrm{e}^r\\;\\;.\\]\nTo develop pricing and hedging formulas for derivative securities, it is a great convenience to assume that investors can trade continuously in time. This requires us to assume also that returns are computed continuously. In the case of a risk-free investment of \\(x(t)\\) dollars at any date \\(t\\) at a continuously compounded rate of \\(r\\), we will say that the interest earned in an instant \\(\\mathrm{d} t\\) is \\(x(t)r\\,\\mathrm{d} t\\) dollars. This is only meaningful when we accumulate the interest over a non-infinitesimal period of time. So consider investing \\(x(0)\\) dollars at time 0 and reinvesting interest in the risk-free asset over a time period of length \\(T\\). Let \\(x(t)\\) denote the account balance at date \\(t\\), for \\(0\\leq t \\leq T\\). The change in the account balance in each instant is the interest earned, so we have \\(\\mathrm{d} x(t) = x(t)r\\,\\mathrm{d} t\\). The real meaning of this equation is that \\(x(t)\\) satisfies the differential equation \\[\\frac{\\mathrm{d} x(t)}{\\mathrm{d} t} = x(t)r\\; ,\\] and it is well known (and easy to verify) that the solution is \\[x(t) = x(0)\\mathrm{e}^{rt}\\; ,\\] leading to an account balance at the end of the time period of \\(x(T) = x(0)\\mathrm{e}^{rT}\\). Thus, the statement that “the interest earned in an instant \\(\\mathrm{d} t\\) is \\(x(t)r\\,\\mathrm{d} t\\)” is equivalent to the statement that interest is continuously compounded at the rate \\(r\\).\nIn the last part of the book, we will drop the assumption that the risk-free asset earns a constant rate of return. In this case, we will still generally assume that there is a risk-free asset for very short-term investments (i.e., for investments with infinitesimal durations!). We will let \\(r(t)\\) denote the risk-free rate for an instantaneous investment at date \\(t\\). This means that an investment of \\(x(t)\\) dollars at date \\(t\\) in the risk-free asset earns interest in an instant \\(\\mathrm{d} t\\) equal to \\(x(t)r(t)\\,\\mathrm{d} t\\). Consider again an investment of \\(x(0)\\) dollars at date 0 in this instantaneously risk-free asset with interest reinvested and let \\(x(t)\\) denote the account balance at date \\(t\\). Then \\(x(t)\\) must satisfy the differential equation \\[\\frac{\\mathrm{d} x(t)}{\\mathrm{d} t} = x(t)r(t)\\;\\;.\\] The solution of this differential equation is \\[x(t) = x(0)\\exp\\left(\\int_0^t r(s)\\,\\mathrm{d}s\\right)\\;\\;.\\] The expression \\(\\int_0^t r(s)\\,\\mathrm{d}s\\) can be interpreted as a continuous sum over time of the rates of interest \\(r(s)\\) earned at times \\(s\\) between 0 and \\(t\\). If these rates are all the same, say equal to \\(r\\), then \\(\\int_0^t r(s)\\,\\mathrm{d}s = rt\\) and our compounding factor \\(\\exp\\left(\\int_0^t r(s)\\,\\mathrm{d}s\\right)\\) is \\(\\mathrm{e}^{rt}\\) as before."
  },
  {
    "objectID": "Chapter1.html#sec-s_oneperiodbinomial",
    "href": "Chapter1.html#sec-s_oneperiodbinomial",
    "title": "1  Asset Pricing Basics",
    "section": "1.2 State Prices in a One-Period Binomial Model",
    "text": "1.2 State Prices in a One-Period Binomial Model\nTo introduce the concepts that will be discussed in the remainder of the chapter, we will consider in this and the following section the following very simple framework. There is a stock with price \\(S\\) today (which we will call date~0). At the end of some period of time of length \\(T\\), the stock price will take one of two values: either \\(S_u\\) or \\(S_d\\), where \\(S_u > S_d\\). If the stock price equals \\(S_u\\) we say we are in the up state of the world, and if it equals~\\(S_d\\) we say we are in the down state. The stock does not pay a dividend. There is also a risk-free asset earning a continuously compounded rate of interest~\\(r\\). Finally we want to consider a European call option on the stock with maturity \\(T\\) and strike \\(K\\). The value of the call option at the end of the period is \\(C_u=\\max(0,S_u-K)\\) in the up state and \\(C_d=\\max(0,S_d-K)\\) in the down state.\nWe will assume\n\\[\\begin{equation}\\label{binomialnoarbitrage}\n\\frac{S_u}{S} > \\mathrm{e}^{rT} > \\frac{S_d}{S}\\;.\n\\end{equation}\\]\nThis condition means that the rate of return on the stock in the up state is greater than the risk-free rate, and the rate of return on the stock in the down state is less than the risk-free rate. If it were not true, there would be an arbitrage opportunity: if the rate of return on the stock were greater than the risk-free rate in both states, then one should buy an infinite amount of the stock on margin, and conversely if the rate of return on the stock were less than the risk-free rate in both states, then one should short an infinite amount of stock and put the proceeds in the risk-free asset. So what we are assuming is that there are no arbitrage opportunities in the market for the stock and risk-free asset.\nThe delta of the call option is \\(\\delta = (C_u-C_d)/(S_u-S_d)\\). Multiplying by \\(S_u-S_d\\) gives us \\(\\delta(S_u-S_d) = C_u-C_d\\) and rearranging yields \\(\\delta S_u - C_u = \\delta S_d-C_d\\), which is critical to what follows. Consider purchasing \\(\\delta\\) shares of the stock at date 0 and borrowing \\[\\mathrm{e}^{-rT}(\\delta S_u-C_u) = \\mathrm{e}^{-rT}(\\delta S_d-C_d)\\] dollars at date 0. Then you will owe \\[\\delta S_u-C_u = \\delta S_d-C_d\\] dollars at date \\(T\\), and hence the value of the portfolio at date \\(T\\) in the up state will be \\[\\text{Value of delta shares} - \\text{Dollars owed} = \\delta S_u - (\\delta S_u-C_u) = C_u\\; ,\\] and the value of the portfolio at date \\(T\\) in the down state will be \\[\\text{Value of delta shares} - \\text{Dollars owed} = \\delta S_d - (\\delta S_d-C_d) = C_d\\;\\;.\\] Thus, this portfolio of buying delta shares and borrowing money (i.e., buying delta shares on margin) replicates the call option. Consequently, the value~\\(C\\) of the option at date 0 must be the date–0 cost of the portfolio; i.e.,\n\\[\\begin{equation}\\label{C0}\nC = \\text{Cost of delta shares} - \\text{Dollars borrowed} = \\delta S - \\mathrm{e}^{-rT}(\\delta S_u-C_u)\\;.\n\\end{equation}\\]\nBecause the call option is equivalent to buying the stock on margin, it can be considered a levered investment in the stock. \nWe will now rewrite the option pricing formula \\(\\eqref{C0}\\) in terms of “state prices.” By substituting for \\(\\delta\\) in \\(\\eqref{C0}\\), we can rearrange it as\n\\[\\begin{equation}\\label{binomialC1}\nC = \\frac{S-\\mathrm{e}^{-rT}S_d}{S_u-S_d} \\times C_u + \\frac{\\mathrm{e}^{-rT}S_u-S}{S_u-S_d}\\times C_d\\; .\n\\end{equation}\\]\nA little algebra also shows that \\[\\begin{equation}\n\n\\label{binomialS1}\nS = \\frac{S-\\mathrm{e}^{-rT}S_d}{S_u-S_d} \\times\nS_u + \\frac{\\mathrm{e}^{-rT}S_u-S}{S_u-S_d}\\times S_d\\; ,\n\\end{equation}\\] and \\[\\begin{equation}\n\\label{binomialR1}\n1 = \\frac{S-\\mathrm{e}^{-rT}S_d}{S_u-S_d} \\times \\mathrm{e}^{rT}+ \\frac{\\mathrm{e}^{-rT}S_u-S}{S_u-S_d}\\times \\mathrm{e}^{rT}\\;.\n\\end{equation}\\]\nIt is convenient to denote the factors appearing in these equations as \\[\\begin{equation}\\label{binomialstateprices}\n\\pi_u = \\frac{S-\\mathrm{e}^{-rT}S_d}{S_u-S_d} \\quad \\text{and} \\quad \\pi_d = \\frac{\\mathrm{e}^{-rT}S_u-S}{S_u-S_d}\\;.\n\\end{equation}\\] The numbers \\(\\pi_u\\) and \\(\\pi_d\\) are called the state prices, for reasons that will be explained below.\nWith these definitions, we can write \\(\\eqref{binomialC1}\\)–\\(\\eqref{binomialR1}\\) as\n\\[\\begin{align}\nC &= \\pi_uC_u + \\pi_dC_d\\;,\\label{binomialC2}\\\\\nS &= \\pi_uS_u+\\pi_dS_d\\;,\\label{binomialS2}\\\\\n1 &= \\pi_u\\mathrm{e}^{rT} + \\pi_d \\mathrm{e}^{rT}\\;.\\label{binomialR2}\n\\end{align}\\]\nThese equations have the following interpretation: the value of a security today is its value in the up state times \\(\\pi_u\\) plus its value in the down state times \\(\\pi_d\\). This applies to \\(\\eqref{binomialR2}\\) by considering an investment of $1 today in the risk-free asset—it has value 1 today and will have value \\(\\mathrm{e}^{rT}\\) in both the up and down states at date \\(T\\). Moreover, this same equation will hold for any other derivative asset. For example, if we considered a put option, then a delta–hedging argument analogous to that we just gave for the call option will lead to a formula for the value \\(P\\) of the put today which can be expressed as \\(P = \\pi_uP_u+\\pi_dP_d\\) for the same \\(\\pi_u\\) and \\(\\pi_d\\) defined in \\(\\eqref{binomialstateprices}\\).\nIn this model, we can think of any security as a portfolio of what are called Arrow securities (in recognition of the seminal work of Kenneth Arrow ). One of the Arrow securities pays $1 at date \\(T\\) if the up state occurs and the other pays $1 at date \\(T\\) if the down state occurs. For example, the stock is equivalent to a portfolio consisting of \\(S_u\\) units of the first Arrow security and~\\(S_d\\) units of the second, because the stock is worth \\(S_u\\) dollars in the up state and \\(S_d\\) dollars in the down state. Equations \\(\\eqref{binomialC2}\\)–\\(\\eqref{binomialR2}\\) show that~ \\(\\pi_u\\) is the price of the first Arrow security and \\(\\pi_d\\) is the price of the second. For example, the right-hand side of \\(\\eqref{binomialS2}\\) is the value of the stock at date 0 viewed as a portfolio of Arrow securities when the Arrow securities have prices \\(\\pi_u\\) and~\\(\\pi_d\\). Because the stock clearly is such a portfolio, its price today must equal its value as that portfolio, which is what \\(\\eqref{binomialS2}\\) asserts.\nAs mentioned before, the prices \\(\\pi_u\\) and \\(\\pi_d\\) of the Arrow securities are called the state prices, because they are the prices of receiving $1 in the two states of the world. The state prices should be positive, because the payoff of each Arrow security is nonnegative in both states and positive in one. A little algebra shows that the conditions \\(\\pi_u>0\\) and \\(\\pi_d>0\\) are exactly equivalent to our “no-arbitrage” assumption \\(\\eqref{binomialnoarbitrage}\\). Thus, we conclude that \nThis conclusion generalizes to other models, including models in which the stock price takes a continuum of possible values. We will discuss more general models later in this chapter. It is a powerful result that tremendously simplifies derivative security pricing."
  },
  {
    "objectID": "Chapter1.html#introduction-to-option-pricin-sec-s_introoptions",
    "href": "Chapter1.html#introduction-to-option-pricin-sec-s_introoptions",
    "title": "1  Asset Pricing Basics",
    "section": "1.5 Introduction to Option Pricin {##sec-s_introoptions}",
    "text": "1.5 Introduction to Option Pricin {##sec-s_introoptions}\nA complete development of derivative pricing requires the continuous-time mathematics to be covered in the next chapter. However, we can present the basic ideas using the tools already developed. Consider the problem of pricing a European call option. Let \\(T\\) denote the maturity of the option and \\(K\\) its strike price, and let \\(S\\) denote the price of the underlying. We will assume for now that the underlying does not pay dividends, but we will make no assumptions about the distribution of its price \\(S(T)\\) at the maturity of the option. Assume there is a risk-free asset with constant interest rate \\(r\\).\nOur convention will be that date 0 denotes the date at which we are attempting to value a derivative. The value of the option at maturity is \\(\\max(0,S(T)-K)\\). Consider a contract that pays \\(S(T)\\) at date \\(T\\) when \\(S(T) \\geq K\\) and that pays zero when \\(S(T)<K\\), and consider another contract that pays \\(K\\) at date \\(T\\) when \\(S(T)\\geq K\\) and zero when \\(S(T)<K\\). In Chap.~\\(\\ref{c_blackscholes}\\), we will call the first contract a share digital and the second contract a digital. The call option is equivalent to a portfolio that is long the first contract and short the second, because the value of the call at maturity is \\(S(T)-K\\) when \\(S(T)\\geq K\\) and it is zero otherwise. So, we can value the call if we can value the share digital and the digital. This splitting up of complex payoffs into simpler contracts is a key to analyzing many types of derivatives.\n\nPricing Share Digitals\nConsider first the problem of valuing the share digital. Let \\(Y(t)\\) denote its value at each date \\(t \\leq T\\). We seek to find \\(Y(0)\\). Our fundamental pricing formula \\(\\eqref{formula}\\) tells us that \\[Y(0) = \\text{num}(0) E^\\text{num} \\left[\\frac{Y(T)}{\\text{num}(T)}\\right]\\; ,\\] for any numeraire with price \\(\\text{num}(t)\\). We want to choose the numeraire to simplify the calculation of the expectation. The expectation only involves the states of the world in which \\(S(T) \\geq K\\), because \\(Y(T)=0\\) when \\(S(T)<K\\). In the states of the world in which \\(S(T) \\geq K\\), the value of the share digital is \\(S(T)\\). The calculation of the expectation would be simplified if the value were a constant when it was nonzero, because, if you are to receive a constant amount in a certain event, your expected payoff is the constant times the probability of the event (e.g., the expected payoff of a gamble that pays $1 when a fair die rolls a 6 is 1/6). This suggests we should use the stock as the numeraire, because then we will have \\[\\frac{Y(T)}{\\text{num}(T)} = \\frac{S(T)}{S(T)} = 1\\] when \\(S(T) \\geq K\\), implying that \\[E^\\text{num} \\left[\\frac{Y(T)}{\\text{num}(T)}\\right] = \\text{prob}^S\\big(S(T)\\geq K\\big)\\; ,\\] where \\(\\text{prob}^S\\) denotes the probability using \\(S\\) as the numeraire. This implies that the value of the share digital is \\[S(0) \\times \\text{prob}^S\\big(S(T)\\geq K\\big)\\;.\\]\nThe remaining question is obviously how to compute the probability. We will use the formula \\(\\eqref{probSnumeraire}\\) which expresses the probability in terms of an expectation involving state prices. To attempt to do so would simply raise the question of how to compute the state prices. Instead, we use the fundamental pricing formula again, this time replacing the derivative value \\(Y\\) with the value of the risk-free asset. This is exactly analogous to computing the \\(q\\) probabilities from \\(\\eqref{binomialS5}\\) and \\(\\eqref{binomialR5}\\) in Sects.~\\(\\ref{s_oneperiodbinomial}\\). Recall that the fundamental formula holds for any non-dividend-paying asset, so it holds for \\(R(t)=\\mathrm{e}^{rt}\\), telling us that the ratio \\(R(t)/S(t)\\) is a martingale when we use \\(S\\) as the numeraire. In a continuous-time model (at least until we introduce stochastic volatility) this will give us exactly the information we need to compute the distribution of \\(S(T)\\) when we use \\(S\\) as the numeraire, and from the distribution of \\(S(T)\\) we can easily compute \\(\\text{prob}^S\\big(S(T)\\geq K\\big)\\). This calculation will be covered in Chap.~\\(\\ref{c_blackscholes}\\) for the Black-Scholes model.\n\n\nPricing Digitals\nNow consider the problem of pricing the digital. We will change notation to let \\(Y(t)\\) denote now the value of the digital at time \\(t\\). Again we want to compute \\[Y(0) = \\text{num}(0) E^\\text{num}\\left[\\frac{Y(T)}{\\text{num}(T)}\\right]\\; ,\\] and again this expectation only involves the states of the world in which \\(S(T) \\geq K\\). In these states of the world, the value of the digital is already a constant \\(K\\), so we should take the numeraire to have a constant value at~\\(T\\), so that the ratio \\(Y(T)/\\text{num}(T)\\) will be constant in the states in which \\(S(T) \\geq K\\). This means that we should take the numeraire to be the risk-free asset. For this numeraire, the pricing formula is \\[Y(0) = \\mathrm{e}^{-rT}E^R[Y(T)] = \\mathrm{e}^{-rT}K\\times \\text{prob}^R \\big(S(T)\\geq K\\big)\\; ,\\] so we need to compute the risk-neutral probability that \\(S(T) \\geq K\\). We will do this by using the fact that \\(S(t)/R(t) = \\mathrm{e}^{-rt}S(t)\\) is a martingale under the risk-neutral probability measure. This is analogous to computing the risk-neutral probabilities from \\(\\eqref{binomialS4}\\) and \\(\\eqref{binomialR4}\\) in Sects.~\\(\\ref{s_oneperiodbinomial}\\). This calculation will also be covered in Chap.~\\(\\ref{c_blackscholes}\\) for the Black-Scholes model.\nReaders familiar with the Black-Scholes formula may already have surmised that, under the Black-Scholes assumptions, \\[\\text{prob}^S\\big(S(T)\\geq K\\big) = \\N(d_1) \\quad \\text{and} \\quad \\text{prob}^R\\big(S(T)\\geq K\\big) = \\N(d_2)\\; ,\\] where \\(\\N\\) denotes the cumulative normal distribution function . The numbers \\(d_1\\) and \\(d_2\\) are different, and hence these are different probabilities, even though they are both probabilities of the option finishing in the money (\\(S(T) \\geq K\\)). They are different probabilities because they are computed under different numeraires.\n\n\nA Remark\nIt seems worthwhile here to step back a bit from the calculations and try to offer some perspectives on the methods developed in this chapter. The change of numeraire technique probably seems mysterious. Even though one may agree that it works after following the steps in the chapter, there is probably a lingering question about why it works. The author’s opinion is that it may be best to regard it simply as a computational trick. Fundamentally it works because valuation is linear. Linearity simply means that the value of a cash flow \\(X=X_1+X_2\\) is the sum of the values of the cash flows \\(X_1\\) and~\\(X_2\\) and the value of the cash flow \\(aX\\) is \\(a\\) times the value of \\(X\\), for any constant \\(a\\). This linearity is manifested in the statement that the value of a cash flow is the sum across states of the world of the state prices multiplied by the size of the cash flow in each state. The change of numeraire technique exploits the linearity to further simplify the valuation exercise. There are other ways the linearity can be used (for example, it produces solvable partial differential equations) but the particular trick we have developed in this chapter seems the most useful to the author (and to others, though perhaps not to everyone). After enough practice with it, it will seem as natural as other computational tricks one might have learned."
  },
  {
    "objectID": "Chapter1.html#sec-s_incomplete",
    "href": "Chapter1.html#sec-s_incomplete",
    "title": "1  Asset Pricing Basics",
    "section": "1.6 An Incomplete Markets Example",
    "text": "1.6 An Incomplete Markets Example\nIn this section, we consider a more difficult valuation problem than the binomial model and discuss the general implications of this example. We only need to make the problem slightly more difficult to see the issues. Consider a trinomial model, in which the asset price takes three possible values: \\(S_u > S_m > S_d\\) (“\\(m\\)” for middle, medium, median, …). We continue to make the no arbitrage assumption \\(\\eqref{binomialnoarbitrage}\\). State prices \\(\\pi_u\\), \\(\\pi_m\\) and \\(\\pi_m\\) must satisfy equations analogous to \\(\\eqref{binomialS2}\\)–\\(\\eqref{binomialR2}\\); specifically,\n\\[\\begin{align}\nS &= \\pi_uS_u+\\pi_mS_m+\\pi_dS_d\\;,\\label{binomialS10}\\\\\n1 &= \\pi_u\\mathrm{e}^{rT} + \\pi_m\\mathrm{e}^{rT} +\\pi_d \\mathrm{e}^{rT}\\;.\\label{binomialR10}\n\\end{align}\\]\nIn the binomial case, these equations can be solved for \\(\\pi_u\\) and \\(\\pi_d\\), as shown in \\(\\eqref{binomialstateprices}\\). However, in the trinomial case, we have only two equations in three unknowns. Thus, there exist many solutions.\nGiven any particular solution \\((\\pi_u,\\pi_m,\\pi_d)\\) of \\(\\eqref{binomialS10}\\)–\\(\\eqref{binomialR10}\\), we can define the risk-neutral probabilities \\(p_u\\), \\(p_m\\) and \\(p_d\\) as before—e.g., \\(p_u = \\pi_u\\mathrm{e}^{rT}\\). Likewise, we can define the probabilities using the stock as numeraire. Thus, we can value calls and puts and other derivative securities. However, the values we obtain will depend on the particular solution \\((\\pi_u,\\pi_m,\\pi_d)\\). There are many arbitrage-free values for a call option, one for each solution of \\(\\eqref{binomialS10}\\)–\\(\\eqref{binomialR10}\\).\nThe reason that there are many arbitrage-free values for a call (or put) is that a call cannot be replicated in a trinomial model using the stock and risk-free asset; we can say equivalently that there is no delta hedge for a call option. Recall that we first found the value of a call in the binomial model by finding the replicating portfolio and calculating its cost. A similar analysis is impossible in the trinomial model. To see this, consider a portfolio of \\(a\\) dollars invested in the risk free asset and \\(b\\) dollars invested in the stock. The value of the portfolio at date \\(T\\) will be \\(a\\mathrm{e}^{rT} + bS_x/S\\), where \\(x \\in \\{u,m,d\\}\\). To replicate the call, we need \\(a\\) and \\(b\\) to satisfy These are three linear equations in the two unknowns \\(a\\) and \\(b\\). For any strike price \\(K\\) between \\(S_d\\) and \\(S_u\\), none of the equations is redundant, and the system has no solution. When there are state-contingent claims (such as the call option payoff) that cannot be replicated by trading in the marketed assets (the stock and risk-free asset in this case), one says that the market is incomplete. Thus, the trinomial model is an example of an incomplete market. \nTo value derivative securities in this situation, we have to select some particular solution \\((\\pi_u,\\pi_m,\\pi_d)\\) of \\(\\eqref{binomialS10}\\)–\\(\\eqref{binomialR10}\\) and assume that the market uses that solution for valuation. Equivalently, we can assume the market uses a particular set of risk-neutral probabilities \\((p_u, p_m, p_d)\\). This type of valuation is often called equilibrium valuation, as opposed to arbitrage valuation, because to give a foundation for our particular choice of risk-neutral probabilities, we would have to assume something about the preferences and endowments of investors and the production possibilities. We will encounter incomplete markets when we consider stochastic volatility in Chapter 4."
  },
  {
    "objectID": "Chapter1.html#sec-s_introoptions",
    "href": "Chapter1.html#sec-s_introoptions",
    "title": "1  Asset Pricing Basics",
    "section": "1.5 Introduction to Option Pricing",
    "text": "1.5 Introduction to Option Pricing\nA complete development of derivative pricing requires the continuous-time mathematics to be covered in the next chapter. However, we can present the basic ideas using the tools already developed. Consider the problem of pricing a European call option. Let \\(T\\) denote the maturity of the option and \\(K\\) its strike price, and let \\(S\\) denote the price of the underlying. We will assume for now that the underlying does not pay dividends, but we will make no assumptions about the distribution of its price \\(S(T)\\) at the maturity of the option. Assume there is a risk-free asset with constant interest rate \\(r\\).\nOur convention will be that date 0 denotes the date at which we are attempting to value a derivative. The value of the option at maturity is \\(\\max(0,S(T)-K)\\). Consider a contract that pays \\(S(T)\\) at date \\(T\\) when \\(S(T) \\geq K\\) and that pays zero when \\(S(T)<K\\), and consider another contract that pays \\(K\\) at date \\(T\\) when \\(S(T)\\geq K\\) and zero when \\(S(T)<K\\). In Chapter 3, we will call the first contract a share digital and the second contract a digital. The call option is equivalent to a portfolio that is long the first contract and short the second, because the value of the call at maturity is \\(S(T)-K\\) when \\(S(T)\\geq K\\) and it is zero otherwise. So, we can value the call if we can value the share digital and the digital. This splitting up of complex payoffs into simpler contracts is a key to analyzing many types of derivatives.\n\nPricing Share Digitals\nConsider first the problem of valuing the share digital. Let \\(Y(t)\\) denote its value at each date \\(t \\leq T\\). We seek to find \\(Y(0)\\). Our fundamental pricing formula \\(\\eqref{formula}\\) tells us that \\[Y(0) = \\text{num}(0) E^\\text{num} \\left[\\frac{Y(T)}{\\text{num}(T)}\\right]\\; ,\\] for any numeraire with price \\(\\text{num}(t)\\). We want to choose the numeraire to simplify the calculation of the expectation. The expectation only involves the states of the world in which \\(S(T) \\geq K\\), because \\(Y(T)=0\\) when \\(S(T)<K\\). In the states of the world in which \\(S(T) \\geq K\\), the value of the share digital is \\(S(T)\\). The calculation of the expectation would be simplified if the value were a constant when it was nonzero, because, if you are to receive a constant amount in a certain event, your expected payoff is the constant times the probability of the event (e.g., the expected payoff of a gamble that pays $1 when a fair die rolls a 6 is 1/6). This suggests we should use the stock as the numeraire, because then we will have \\[\\frac{Y(T)}{\\text{num}(T)} = \\frac{S(T)}{S(T)} = 1\\] when \\(S(T) \\geq K\\), implying that \\[E^\\text{num} \\left[\\frac{Y(T)}{\\text{num}(T)}\\right] = \\text{prob}^S\\big(S(T)\\geq K\\big)\\; ,\\] where \\(\\text{prob}^S\\) denotes the probability using \\(S\\) as the numeraire. This implies that the value of the share digital is \\[S(0) \\times \\text{prob}^S\\big(S(T)\\geq K\\big)\\;.\\]\nThe remaining question is obviously how to compute the probability. We will use the formula \\(\\eqref{probSnumeraire}\\) which expresses the probability in terms of an expectation involving state prices. To attempt to do so would simply raise the question of how to compute the state prices. Instead, we use the fundamental pricing formula again, this time replacing the derivative value \\(Y\\) with the value of the risk-free asset. This is exactly analogous to computing the \\(q\\) probabilities from \\(\\eqref{binomialS5}\\) and \\(\\eqref{binomialR5}\\) in Sects.~\\(\\ref{s_oneperiodbinomial}\\). Recall that the fundamental formula holds for any non-dividend-paying asset, so it holds for \\(R(t)=\\mathrm{e}^{rt}\\), telling us that the ratio \\(R(t)/S(t)\\) is a martingale when we use \\(S\\) as the numeraire. In a continuous-time model (at least until we introduce stochastic volatility) this will give us exactly the information we need to compute the distribution of \\(S(T)\\) when we use \\(S\\) as the numeraire, and from the distribution of \\(S(T)\\) we can easily compute \\(\\text{prob}^S\\big(S(T)\\geq K\\big)\\). This calculation will be covered in Chapter 3 for the Black-Scholes model.\n\n\nPricing Digitals\nNow consider the problem of pricing the digital. We will change notation to let \\(Y(t)\\) denote now the value of the digital at time \\(t\\). Again we want to compute \\[Y(0) = \\text{num}(0) E^\\text{num}\\left[\\frac{Y(T)}{\\text{num}(T)}\\right]\\; ,\\] and again this expectation only involves the states of the world in which \\(S(T) \\geq K\\). In these states of the world, the value of the digital is already a constant \\(K\\), so we should take the numeraire to have a constant value at~\\(T\\), so that the ratio \\(Y(T)/\\text{num}(T)\\) will be constant in the states in which \\(S(T) \\geq K\\). This means that we should take the numeraire to be the risk-free asset. For this numeraire, the pricing formula is \\[Y(0) = \\mathrm{e}^{-rT}E^R[Y(T)] = \\mathrm{e}^{-rT}K\\times \\text{prob}^R \\big(S(T)\\geq K\\big)\\; ,\\] so we need to compute the risk-neutral probability that \\(S(T) \\geq K\\). We will do this by using the fact that \\(S(t)/R(t) = \\mathrm{e}^{-rt}S(t)\\) is a martingale under the risk-neutral probability measure. This is analogous to computing the risk-neutral probabilities from \\(\\eqref{binomialS4}\\) and \\(\\eqref{binomialR4}\\) in Sects.~\\(\\ref{s_oneperiodbinomial}\\). This calculation will also be covered in Chapter 3 for the Black-Scholes model.\nReaders familiar with the Black-Scholes formula may already have surmised that, under the Black-Scholes assumptions, \\[\\text{prob}^S\\big(S(T)\\geq K\\big) = \\mathrm{N}(d_1) \\quad \\text{and} \\quad \\text{prob}^R\\big(S(T)\\geq K\\big) = \\mathrm{N}(d_2)\\; ,\\] where \\(\\mathrm{N}\\) denotes the cumulative normal distribution function . The numbers \\(d_1\\) and \\(d_2\\) are different, and hence these are different probabilities, even though they are both probabilities of the option finishing in the money (\\(S(T) \\geq K\\)). They are different probabilities because they are computed under different numeraires.\n\n\nA Remark\nIt seems worthwhile here to step back a bit from the calculations and try to offer some perspectives on the methods developed in this chapter. The change of numeraire technique probably seems mysterious. Even though one may agree that it works after following the steps in the chapter, there is probably a lingering question about why it works. The author’s opinion is that it may be best to regard it simply as a computational trick. Fundamentally it works because valuation is linear. Linearity simply means that the value of a cash flow \\(X=X_1+X_2\\) is the sum of the values of the cash flows \\(X_1\\) and~\\(X_2\\) and the value of the cash flow \\(aX\\) is \\(a\\) times the value of \\(X\\), for any constant \\(a\\). This linearity is manifested in the statement that the value of a cash flow is the sum across states of the world of the state prices multiplied by the size of the cash flow in each state. The change of numeraire technique exploits the linearity to further simplify the valuation exercise. There are other ways the linearity can be used (for example, it produces solvable partial differential equations) but the particular trick we have developed in this chapter seems the most useful to the author (and to others, though perhaps not to everyone). After enough practice with it, it will seem as natural as other computational tricks one might have learned."
  },
  {
    "objectID": "Chapter1.html#exercises",
    "href": "Chapter1.html#exercises",
    "title": "1  Asset Pricing Basics",
    "section": "1.7 Exercises",
    "text": "1.7 Exercises"
  }
]