<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Miscellaneous Facts about Continuous-Time Models – Pricing and Hedging Derivative Securities: Theory and Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Chapter_Survey.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-933f24a0c1e0be8a62c2179459603458.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-217607b4065b1a3128a07792af3f8e33.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<style>
div.callout-CodeToDo.callout {
  border-left-color: #eb4034;
}
div.callout-CodeToDo.callout-style-default > .callout-header {
  background-color: rgba(235, 64, 52, 0.13);
}
div.callout-CodeToDo .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-CodeToDo.callout-style-default .callout-icon::before, div.callout-CodeToDo.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-InProgress.callout {
  border-left-color: #eaacf2;
}
div.callout-InProgress.callout-style-default > .callout-header {
  background-color: rgba(234, 172, 242, 0.13);
}
div.callout-InProgress .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-InProgress.callout-style-default .callout-icon::before, div.callout-InProgress.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Example.callout {
  border-left-color: #e8cc97;
}
div.callout-Example.callout-style-default > .callout-header {
  background-color: rgba(232, 204, 151, 0.13);
}
div.callout-Example .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Example.callout-style-default .callout-icon::before, div.callout-Example.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-WritingToDo.callout {
  border-left-color: #a7f2d8;
}
div.callout-WritingToDo.callout-style-default > .callout-header {
  background-color: rgba(167, 242, 216, 0.13);
}
div.callout-WritingToDo .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-WritingToDo.callout-style-default .callout-icon::before, div.callout-WritingToDo.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Exercise.callout {
  border-left-color: #ede29d;
}
div.callout-Exercise.callout-style-default > .callout-header {
  background-color: rgba(237, 226, 157, 0.13);
}
div.callout-Exercise .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Exercise.callout-style-default .callout-icon::before, div.callout-Exercise.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Extra.callout {
  border-left-color: #d5deed;
}
div.callout-Extra.callout-style-default > .callout-header {
  background-color: rgba(213, 222, 237, 0.13);
}
div.callout-Extra .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Extra.callout-style-default .callout-icon::before, div.callout-Extra.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Rule.callout {
  border-left-color: #a1bced;
}
div.callout-Rule.callout-style-default > .callout-header {
  background-color: rgba(161, 188, 237, 0.13);
}
div.callout-Rule .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Rule.callout-style-default .callout-icon::before, div.callout-Rule.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Principle.callout {
  border-left-color: #e3aab2;
}
div.callout-Principle.callout-style-default > .callout-header {
  background-color: rgba(227, 170, 178, 0.13);
}
div.callout-Principle .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Principle.callout-style-default .callout-icon::before, div.callout-Principle.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Done.callout {
  border-left-color: #e8cc97;
}
div.callout-Done.callout-style-default > .callout-header {
  background-color: rgba(232, 204, 151, 0.13);
}
div.callout-Done .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Done.callout-style-default .callout-icon::before, div.callout-Done.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./AppendixA.html">Appendix</a></li><li class="breadcrumb-item"><a href="./AppendixA.html">Miscellaneous Facts about Continuous-Time Models</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Pricing and Hedging Derivative Securities: Theory and Methods</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/math-finance-book/book-code.git" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Options.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Options</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Futures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Futures and Swaps</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: Mathematical Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Intro_Binomial_Tree.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Brownian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Brownian Motion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Ito.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Ito Processes and Ito’s Formula</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_GBM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Geometric Brownian Motion</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: Arbitrage Pricing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Arbitrage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Foundations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Deltas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Delta Hedges, Replication, and PDEs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_DigitalsMeasures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Digitals and Measures</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Part IV: Black-Scholes and Extensions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_BlackScholes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Black-Scholes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Americans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">American Options</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FX.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">FX and Quantos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Merton.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Merton, Black, and Margrabe</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Asians.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Asians, Baskets, and Spreads</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Exotics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Other Exotics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Part V: Alternative Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_GARCH.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">GARCH Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_StochasticVol.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Stochastic Volatility</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Jumps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Jumps</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_VarianceSwaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Variance Swaps</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Part VI: Numerical Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_MonteCarlo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Monte Carlo Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Binomial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Binomial and Trinomial Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_PDEs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">PDE Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Fourier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Fourier Transforms</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_MachineLearning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Machine Learning</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Part VII: Fixed Income</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FixedIncome.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Fixed-Income Concepts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FixedIncomeDerivatives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Fixed-Income Derivatives</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Vasicek.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Vasicek and Extensions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Survey.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Term Structure Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendix</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./AppendixA.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Miscellaneous Facts about Continuous-Time Models</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./AppendixA.html">Appendix</a></li><li class="breadcrumb-item"><a href="./AppendixA.html">Miscellaneous Facts about Continuous-Time Models</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Miscellaneous Facts about Continuous-Time Models</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="sec-a_girsanov" class="level2">
<h2 class="anchored" data-anchor-id="sec-a_girsanov">Girsanov’s Theorem</h2>
<p>In <span class="quarto-unresolved-ref">?sec-s_girsanov</span>, we were able to compute the expected return of an asset under different numeraires directly, by using Ito’s formula and the fact that the ratio of a non-dividend-paying asset price to the numeraire asset price is a martingale under the measure associated with the numeraire. In other cases (e.g., Heston’s stochastic volatility model and Vasicek’s model) the drift of a process could not be computed directly when we changed numeraires, because the process (volatility in Heston’s model and the short rate in Vasicek’s model) was not an asset price. In general, the change in the drift of a process when we change numeraires (or, more generally, change probability measures) is given by Girsanov’s theorem. </p>
<p>An heuristic explanation of Girsanov’s theorem is as follows. Let <span class="math inline">\(\lambda\)</span> be a constant, and let <span class="math inline">\(B\)</span> be a Brownian motion under a probability measure that we will denote by <span class="math inline">\(\text{prob}\)</span>. Let <span class="math inline">\(B^*(t)=B(t)+\lambda t\)</span>; i.e., <span class="math inline">\(\mathrm{d} B^* = \mathrm{d} B + \lambda\,\mathrm{d} t\)</span>.<br>
Girsanov’s theorem shows how to change the probability measure so that the drift of <span class="math inline">\(B^*\)</span> is zero, i.e., how to change the probability measure to make <span class="math inline">\(B^*\)</span> a martingale and hence (by Levy’s theorem) a Brownian motion.</p>
<p>Consider discrete time periods of length <span class="math inline">\(\Delta t\)</span> and approximate <span class="math inline">\(B\)</span> by a binomial process that steps up or down by <span class="math inline">\(\sqrt{\Delta t}\)</span> in each time period, with up and down being equally likely. This approximation implies that the changes <span class="math inline">\(\Delta B\)</span> of the binomial process have mean equal to zero and variance equal to <span class="math inline">\(\Delta t\)</span>, just as for a true Brownian motion. We have <span class="math inline">\(\Delta B^*=\lambda\,\Delta t\pm\sqrt{\Delta t}\)</span>. If we change the probability of the up move to <span class="math inline">\((1-\lambda\sqrt{\Delta t})/2\)</span> and the probability of the down move to <span class="math inline">\((1+\lambda\sqrt{\Delta t})/2\)</span>, then the expected change in <span class="math inline">\(B^*\)</span> will be <span class="math display">\[
\left(\frac{1-\lambda\sqrt{\Delta t}}{2}\right)\left(\lambda\,\Delta t+\sqrt{\Delta t}\right)+
\left(\frac{1+\lambda\sqrt{\Delta t}}{2}\right)
\left(\lambda\,\Delta t-\sqrt{\Delta t}\right) = 0\; .
\]</span> Therefore, <span class="math inline">\(B^*\)</span> is a martingale under these revised probabilities.</p>
<p>Changing the probabilities of each branch of the binomial tree in this way implies that the probability of a path through the tree is changed as follows. The probability of a path is the product of the probabilities of the branches, so, letting <span class="math inline">\(\text{prob}^*\)</span> denote the revised probabilities, we have <span class="math display">\[\begin{multline*}
\frac{\text{prob}^*(\text{path through time } t)}{\text{prob}\,(\text{path through time } t)}\\=
\frac{\text{prob}^*(\text{path through time } t\!-\!\Delta t)}{\text{prob}\,(\text{path through time } t\!-\!\Delta t)} \times
\frac{\text{prob}^*(\text{branch at } t)}{\text{prob}\,(\text{branch at } t)}\; .
\end{multline*}\]</span> Note that our definitions imply <span class="math display">\[\begin{align*}
\frac{\text{prob}^*(\text{up branch at } t)}{\text{prob}\,(\text{up branch at } t)}&amp;=\frac{\frac{1}{2}\left(1-\lambda\sqrt{\Delta t}\right)}{1/2} =1-\lambda\,\Delta B(t)\;,\\
\frac{\text{prob}^*(\text{down branch at } t)}{\text{prob}\,(\text{down branch at } t)}&amp;=\frac{\frac{1}{2}\left(1+\lambda\sqrt{\Delta t}\right)}{1/2} =1+\lambda\,\Delta B(t)\;.
\end{align*}\]</span> Therefore, <span class="math display">\[\begin{multline*}
\frac{\text{prob}^*(\text{path through time } t)}{\text{prob}\,(\text{path through time } t)}\\=
\frac{\text{prob}^*(\text{path through time } t\!-\!\Delta t)}{\text{prob}\,(\text{path through time } t\!-\!\Delta t)} \times
\big(1-\lambda\,\Delta B(t)\big)\; .
\end{multline*}\]</span> If we let <span class="math inline">\(Y(t)\)</span> denote the ratio of path probabilities through time <span class="math inline">\(t\)</span>, this shows that the percent change in <span class="math inline">\(Y\)</span> at time <span class="math inline">\(t\)</span> is <span class="math inline">\(-\lambda\,\Delta B(t)\)</span>, i.e., <span class="math display">\[Y(t) = Y(t-\Delta t) \times
\big(1-\lambda\,\Delta B(t)\big) \Longrightarrow \frac{ Y(t)- Y(t-\Delta t)}{Y(t-\Delta t)}=-\lambda\,\Delta B(t)\; .\]</span> A continuous-time formulation of this equation is <span class="math display">\[\frac{\mathrm{d} Y(t)}{Y(t)} = -\lambda\,\mathrm{d} B(t)\; .\]</span> This equation implies that <span class="math inline">\(Y\)</span> is a geometric Brownian motion with explicit solution (given that the ratio of path probabilities at date <span class="math inline">\(0\)</span> is <span class="math inline">\(Y(0)=1\)</span>) <span id="eq-girsanov"><span class="math display">\[
Y(t)=\exp\left(-\lambda^2 t/2 - \lambda B(t)\right)\;.
\qquad(1)\]</span></span></p>
<p>The above heuristic argument suggests that the process <a href="#eq-girsanov" class="quarto-xref">Equation&nbsp;<span>1</span></a> defines a ratio of path probabilities, <span class="math inline">\(\text{prob}^*\)</span> to <span class="math inline">\(\text{prob}\)</span>, such that <span class="math inline">\(B^*\)</span> is a martingale under <span class="math inline">\(\text{prob}^*\)</span>.<br>
Because <span class="math inline">\(B^*\)</span> is continuous and its quadratic variation through each date <span class="math inline">\(t\)</span> is equal to <span class="math inline">\(t\)</span> (because the addition of <span class="math inline">\(\lambda t\)</span> to <span class="math inline">\(B\)</span> does not alter the quadratic variation of <span class="math inline">\(B\)</span>), Levy’s theorem implies that <span class="math inline">\(B^*\)</span> must in fact be a Brownian motion relative to the measure <span class="math inline">\(\text{prob}^*\)</span>. This is the content of Girsanov’s theorem. In the formal statement, there is no reference to ratios of path probabilities, because individual paths actually have zero probability under either <span class="math inline">\(\text{prob}\)</span> or <span class="math inline">\(\text{prob}^*\)</span>. Instead, the theorem states that <span class="math inline">\(B^*\)</span> is converted to a Brownian motion by multiplying the probability of any event (set of paths) by the conditional expectation of <span class="math inline">\(Y\)</span>, given the event.</p>
<p>There is no need to assume <span class="math inline">\(\lambda\)</span> is a constant, provided the random process <span class="math inline">\(\lambda\)</span> is sufficiently regular that the general form of <a href="#eq-girsanov" class="quarto-xref">Equation&nbsp;<span>1</span></a>, i.e., <span id="eq-girsanov2"><span class="math display">\[
Y(t) \equiv \exp \left\{ -\frac{ 1}{2}\int_0^t \lambda^2(u)\,du - \int _0^t
\lambda(u)\,\mathrm{d} B(u) \right\},
\qquad(2)\]</span></span></p>
<p>is a martingale.^[The process <a href="#eq-girsanov2" class="quarto-xref">Equation&nbsp;<span>2</span></a> is an Ito process with zero drift. A sufficient condition for it to be a martingale is that <span class="math display">\[E \left[ \exp \left\{ \frac{ 1]{2}\int _0^T \lambda^2(u)\,du \right\} \right]
&lt; \infty\; .\]</span> This is called Novikov’s condition. See, e.g., Karatzas and Shreve <span class="citation" data-cites="KS">(<a href="#ref-KS" role="doc-biblioref">Karatzas and Shreve 1988</a>)</span>.}</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rule
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Girsanov’s Theorem:</strong> Let <span class="math inline">\(B\)</span> be a Brownian motion on a time horizon <span class="math inline">\([0,T]\)</span> and let <span class="math inline">\(\lambda\)</span> be a stochastic process such that <span class="math inline">\(Y\)</span> defined by <a href="#eq-girsanov2" class="quarto-xref">Equation&nbsp;<span>2</span></a> is a martingale. Define <span id="eq-girsanov101"><span class="math display">\[
B^*(t)=B(t)+\int_0^t \lambda(u)\,du,
\qquad(3)\]</span></span></p>
<p>and define a new probability measure <span class="math inline">\(\text{prob}^*\)</span> by setting <span class="math inline">\(\text{prob}^*(A)=0\)</span> for each event <span class="math inline">\(A\)</span> such that <span class="math inline">\(\text{prob}(A)=0\)</span>, and by defining <span id="eq-girsanov102"><span class="math display">\[
\text{prob}^*(A) = E \big[ Y(T) | A \big]\times \text{prob}(A)
\qquad(4)\]</span></span></p>
<p>for each event <span class="math inline">\(A\)</span> such that <span class="math inline">\(\text{prob}(A)&gt;0\)</span>. Then <span class="math inline">\(B^*\)</span> is a Brownian motion on the time horizon <span class="math inline">\([0,T]\)</span> relative to <span class="math inline">\(\text{prob}^*\)</span>.</p>
</div>
</div>
<p>The definition of <span class="math inline">\(\text{prob}^*\)</span> in the boxed statement emphasizes the ratio of probabilities aspect. It is equivalent to the definition <span id="eq-girsanov104"><span class="math display">\[
\text{prob}^*(A) =  E\left[1_AY(T)\right]
\qquad(5)\]</span></span></p>
<p>for each event <span class="math inline">\(A\)</span>. Thus, it is consistent with <a href="Chapter_Arbitrage.html#eq-probSnumeraire" class="quarto-xref">Equation&nbsp;<span>7.23</span></a> of the probability of an event <span class="math inline">\(A\)</span> when we use a non-dividend-paying asset price <span class="math inline">\(S\)</span> as the numeraire. The relation between the two is that the ratio of path probabilities <span class="math inline">\(Y(T)\)</span> equals <span class="math inline">\(\phi(T)S(T)/S(0)\)</span>, where <span class="math inline">\(\phi(T)\)</span> denotes the random state price at date <span class="math inline">\(T\)</span>.</p>
<p>Note also that for any random variable <span class="math inline">\(X\)</span> (for which the mean exists) the mean of <span class="math inline">\(X\)</span> under <span class="math inline">\(\text{prob}^*\)</span>, which we denote by <span class="math inline">\(E^*[X]\)</span>, is given by <span id="eq-girsanov105"><span class="math display">\[
E^*[X] = E[Y(T)X]\;.
\qquad(6)\]</span></span></p>
<p>In some cases we may be given (perhaps by equilibrium arguments) the random variable <span class="math inline">\(Y\)</span> defining the change of measure, and we wish to compute the change in the drift of a Brownian motion (in order to compute, for example, the drift of a volatility or an interest rate). Thus, we need to reverse the above process, in which we started with the change of drift <span class="math inline">\(\lambda\)</span> and computed <span class="math inline">\(Y\)</span>. This is straightforward. Given <span class="math inline">\(Y(T)\)</span>, define <span class="math inline">\(Y(t) = E_t[Y(T)]\)</span>, i.e., the expectation of <span class="math inline">\(Y(T)\)</span> under the original measure, given information at date <span class="math inline">\(t\)</span>. Equation <a href="#eq-girsanov2" class="quarto-xref">Equation&nbsp;<span>2</span></a> shows that <span class="math display">\[\frac{\mathrm{d} Y}{Y} = -\lambda\,\mathrm{d} B\; .\]</span> Therefore, <span class="math display">\[-(\mathrm{d} B)\left(\frac{\mathrm{d} Y}{Y}\right) = \lambda\,\mathrm{d} t\; .\]</span> It follows that the definition <span class="math display">\[\mathrm{d} B^* = \mathrm{d} B - (\mathrm{d} B)\left(\frac{\mathrm{d} Y}{Y}\right)\]</span> gives us a Brownian motion <span class="math inline">\(B^*\)</span> relative to the measure <span class="math inline">\(\text{prob}^*\)</span>. In other words, the drift of <span class="math inline">\(B\)</span> under the measure <span class="math inline">\(\text{prob}^*\)</span> is <span class="math inline">\((\mathrm{d} B)(\mathrm{d} Y)/Y\)</span>.</p>
<section id="sec-a_minimum" class="level3">
<h3 class="anchored" data-anchor-id="sec-a_minimum">Distribution of the Minimum of a Geometric Brownian Motion</h3>
<p>Here we will give an explanation of formulas used in <span class="quarto-unresolved-ref">?sec-c_exotics</span> for valuing barrier and lookback options. From a mathematical point of view, our discussion will be decidedly informal.</p>
<p>Consider an asset price <span class="math inline">\(S\)</span> satisfying <span class="math display">\[
\mathrm{d}\log S = \mu\,\mathrm{d} t+\sigma\,\mathrm{d} B\; ,\]</span> for constants <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span>, where <span class="math inline">\(B\)</span> is a Brownian motion. Consider constants <span class="math inline">\(K \geq L\)</span> with <span class="math inline">\(L&lt; \log S(0)\)</span>. Define <span class="math inline">\(z = \min_{0 \leq t \leq T} S(t)\)</span>. Define <span class="math display">\[x = \begin{cases} 1 &amp; \text{if $S(T)&gt; K$ and $z&gt; L$}\;,\\
0 &amp; \text{otherwise\;.} \end{cases}\]</span> To price a down-and-out call, we need to compute <span class="math inline">\(\text{prob}(x=1)\)</span>. As in <span class="quarto-unresolved-ref">?sec-s_barriers</span>, define <span class="math display">\[y = \begin{cases} 1 &amp; \text{if $S(T)&gt; K$ and $z \leq L$}\;,\\
0 &amp; \text{otherwise\;.} \end{cases}\]</span> The event <span class="math inline">\(S(T)&gt;K\)</span> is the union of the disjoint events <span class="math inline">\(x=1\)</span> and <span class="math inline">\(y=1\)</span>, so we have <span class="math display">\[\begin{align*}
\text{prob}(x=1) &amp;= \text{prob}(S(T)&gt;K) - \text{ prob}(y=1)\\
&amp;= \mathrm{N}(d) - \text{prob}(y=1)\;,
\end{align*}\]</span> where <span id="eq-appendixc100"><span class="math display">\[
d = \frac{\log \left(\frac{S(0)}{K}\right)+ \mu T}{\sigma\sqrt{T}}\;.
\qquad(7)\]</span></span></p>
<p>Thus, the remaining task is to compute <span class="math inline">\(\text{prob}(y=1)\)</span>.</p>
<p>To price lookback options, it is necessary to know the cumulative distribution function of <span class="math inline">\(z\)</span>, i.e., we need to know <span class="math inline">\(\text{prob}(z \leq L)\)</span> for arbitrary <span class="math inline">\(L\)</span>.<br>
The event <span class="math inline">\(z \leq L\)</span> is the union of the disjoint events <span class="math inline">\(S(T) \leq L\)</span> and <span class="math inline">\(y=1\)</span>, where we specialize to the case <span class="math inline">\(K=L\)</span> in the definition of <span class="math inline">\(y\)</span>. Thus, <span class="math display">\[\begin{align*}
\text{prob}(z \leq L) &amp;= \text{prob}(S(T)\leq L) + \text{prob}(y=1)\\
&amp;= \mathrm{N}(-d) + \text{ prob}(y=1)\;,
\end{align*}\]</span> where again we take <span class="math inline">\(K = L\)</span> in the definition of <span class="math inline">\(d\)</span>. Thus, for pricing lookbacks also, the key task is to compute <span class="math inline">\(\text{prob}(y=1)\)</span>.</p>
<p>Assume first that <span class="math inline">\(\mu=0\)</span>, so <span class="math inline">\(\log S\)</span> is a Brownian motion with zero drift. We want to compute the probability of the paths of <span class="math inline">\(\log S\)</span> that dip below <span class="math inline">\(\log L\)</span> and end above <span class="math inline">\(\log K\)</span>. Each such path has a twin defined by reflecting the path (as in a mirror image) through the horizontal line <span class="math inline">\(x(t)=\log L\)</span> after the first time <span class="math inline">\(\log S\)</span> hits <span class="math inline">\(\log L\)</span>. The original path increases by at least <span class="math inline">\(\log K - \log L\)</span> after hitting <span class="math inline">\(\log L\)</span> (otherwise, it could not end above <span class="math inline">\(\log K\)</span>). So, the twin decreases by at least <span class="math inline">\(\log K - \log L\)</span> after hitting <span class="math inline">\(\log L\)</span>. This means that it ends below <span class="math inline">\(2\log L - \log K\)</span>. Moreover, each path ending below <span class="math inline">\(2\log L - \log K\)</span> is the twin in this sense of a path hitting <span class="math inline">\(\log L\)</span> and then ending above <span class="math inline">\(\log K\)</span>. Because <span class="math inline">\(\log S\)</span> has no drift, the twins are equally likely. Therefore, when <span class="math inline">\(\mu=0\)</span>, <span class="math display">\[\begin{align*}
\text{prob}(y=1) &amp;= \text{prob}\big(\log S(T) \leq 2\log L - \log K\big)\\
&amp;= \text{prob}\left(\frac{B(T)}{\sqrt{T}} \leq \frac{2 \log L - \log K - \log S(0)-\mu T}{\sigma\sqrt{T}}\right)\\
&amp;= \mathrm{N}(d^*)\;,
\end{align*}\]</span> where <span id="eq-appendixc101"><span class="math display">\[
d^* = \frac{\log \left(\frac{L^2}{KS(0)}\right) }{\sigma\sqrt{T}}\;.
\qquad(8)\]</span></span></p>
<p>Now consider the case <span class="math inline">\(\mu \neq 0\)</span>, the case in which we are really interested. By Girsanov’s theorem, the process <span class="math inline">\(B^*\)</span> defined by <span class="math inline">\(B^*(0)=0\)</span> and <span class="math display">\[\mathrm{d} B^* = \mathrm{d} B + \frac{\mu}{\sigma}\,\mathrm{d} t\]</span> is a Brownian motion under the measure <span class="math inline">\(\text{prob}^*\)</span> defined by <a href="#eq-girsanov" class="quarto-xref">Equation&nbsp;<span>1</span></a> and <a href="#eq-girsanov102" class="quarto-xref">Equation&nbsp;<span>4</span></a>, where we take <span class="math inline">\(\lambda = \mu/\sigma\)</span> in the definition of <span class="math inline">\(Y(T)\)</span>. The purpose of this definition is that we have <span class="math display">\[\mathrm{d}\log S = \mu\,\mathrm{d} t + \sigma\left(\mathrm{d} B^* - \frac{\mu}{\sigma}\,\mathrm{d} t\right) = \sigma\,\mathrm{d} B^*\; .\]</span> Letting <span class="math inline">\(E\)</span> denote expectation relative to the measure under which <span class="math inline">\(B\)</span> is a Brownian motion and <span class="math inline">\(E^*\)</span> denote expectation relative to <span class="math inline">\(\text{prob}^*\)</span>, we have from <a href="#eq-girsanov105" class="quarto-xref">Equation&nbsp;<span>6</span></a> that</p>
<p><span class="math display">\[
\text{prob}(y=1) =E[y] = E \left[Y(T)\frac{y}{Y(T)}\right]
\]</span> <span class="math display">\[
= E^*\left[\frac{y}{Y(T)}\right]
\]</span> <span class="math display">\[
= E^*\left[\exp\left(\frac{1}{2}\lambda^2T + \lambda B(T)\right)y\right]
\]</span> <span class="math display">\[
= E^*\left[\exp\left(\frac{1}{2}\lambda^2T + \lambda [B^*(T)-\lambda T]\right)y\right]
\]</span> <span id="eq-appendixc1"><span class="math display">\[
=E^*\left[\exp\left(-\frac{1}{2}\lambda^2T + \lambda B^*(T)\right)y\right]\;.
\qquad(9)\]</span></span></p>
<p>Because <span class="math inline">\(\log S\)</span> has no drift under <span class="math inline">\(\text{prob}^*\)</span>, the twin paths described before are equally likely under <span class="math inline">\(\text{prob}^*\)</span>. However, the reflection leads to low values of <span class="math inline">\(\log S(T)\)</span> and hence to low values of <span class="math inline">\(B^*(T)\)</span> rather than high values, and we must compensate for this in <a href="#eq-appendixc1" class="quarto-xref">Equation&nbsp;<span>9</span></a>. Specifically, for a path of <span class="math inline">\(\log S\)</span> that ends above <span class="math inline">\(\log K\)</span>, we have <span id="eq-reflectedpath1"><span class="math display">\[
B^*(T) = \frac{\log K - \log S(0) + \varepsilon}{\sigma}
\qquad(10)\]</span></span></p>
<p>for some <span class="math inline">\(\varepsilon&gt;0\)</span> and the reflection of this path has <span id="eq-reflectedpath2"><span class="math display">\[
B^*(T) = \frac{2\log L - \log K - \log S(0) - \varepsilon}{\sigma}
\qquad(11)\]</span></span></p>
<p>for the same <span class="math inline">\(\varepsilon\)</span>. Therefore, to use the reflected path, we compute <span class="math display">\[\varepsilon = 2\log L - \log K - \log S(0) - \sigma B^*(T)\]</span> from <a href="#eq-reflectedpath2" class="quarto-xref">Equation&nbsp;<span>11</span></a> and substitute this into the right-hand side of <a href="#eq-reflectedpath1" class="quarto-xref">Equation&nbsp;<span>10</span></a> to obtain <span class="math display">\[\begin{multline*}
\frac{\log K - \log S(0) + 2\log L - \log K - \log S(0) - \sigma B^*(T)}{\sigma} \\= \frac{2\log L - 2\log S(0)}{\sigma} - B^*(T)
\end{multline*}\]</span> as the value that should replace <span class="math inline">\(B^*(T)\)</span> in <a href="#eq-appendixc1" class="quarto-xref">Equation&nbsp;<span>9</span></a> when we use the reflected paths. As in the case <span class="math inline">\(\mu=0\)</span>, using the reflected paths means replacing the random variable <span class="math inline">\(y\)</span> with <span class="math inline">\(y'\)</span> defined as <span class="math display">\[y' = \begin{cases} 1 &amp; \text{if $\log S(T)\leq 2 \log L - \log K$}\;,\\
0 &amp; \text{otherwise\;.} \end{cases}\]</span> Substituting into <a href="#eq-appendixc1" class="quarto-xref">Equation&nbsp;<span>9</span></a> and employing some algebra gives us</p>
<p><span class="math display">\[
\text{prob}(y=1) = E^*\left[\exp\left(-\frac{1}{2}\lambda^2T + \lambda\left[\frac{2\log L - 2\log S(0)}{\sigma} - B^*(T)\right]\right)y'\right]
\]</span> <span class="math display">\[
= \left(\frac{L}{S(0)}\right)^{2\mu/\sigma^2}E^*\left[\exp\left(-\frac{1}{2}\lambda^2T - \lambda [B(T)+\lambda T]\right)y'\right]
\]</span> <span class="math display">\[
=\left(\frac{L}{S(0)}\right)^{2\mu/\sigma^2}E^*\left[\exp\left(-\frac{3}{2}\lambda^2T - \lambda B(T)\right)y'\right]
\]</span> <span id="eq-appendixc200"><span class="math display">\[
= \left(\frac{L}{S(0)}\right)^{2\mu/\sigma^2}E\left[\exp\left(-2\lambda^2T - 2\lambda B(T)\right)y'\right]\;,
\qquad(12)\]</span></span></p>
<p>where for the last equality we used <a href="#eq-girsanov105" class="quarto-xref">Equation&nbsp;<span>6</span></a> again.</p>
<p>Now we will define another change of measure. Set <span class="math inline">\(\delta = 2\lambda\)</span>, <span class="math display">\[Z(T) = \exp\left(-\delta^2 T/2 - \delta B(T)\right)\]</span> and <span class="math inline">\(\text{prob}^{**}(A) = E[1_A Z(T)]\)</span> for each event <span class="math inline">\(A\)</span>. From the definition of <span class="math inline">\(\delta\)</span> and <a href="#eq-girsanov105" class="quarto-xref">Equation&nbsp;<span>6</span></a> we have</p>
<p><span class="math display">\[
E\left[\exp\left(-2\lambda^2T - 2\lambda B(T)\right)y'\right] = E\left[\exp\left(-\frac{1}{2}\delta^2T - \delta B(T)\right)y'\right]
\]</span> <span class="math display">\[
= E^{**}[y']
\]</span> <span id="eq-appendixc201"><span class="math display">\[
= \text{prob}^{**}(y'=1)\;.
\qquad(13)\]</span></span></p>
<p>Moreover, Girsanov’s theorem states that <span class="math inline">\(\mathrm{d} B^{**} = \mathrm{d} B + \delta\,\mathrm{d} t\)</span> defines a Brownian motion <span class="math inline">\(B^{**}\)</span> under the measure <span class="math inline">\(\text{prob}^{**}\)</span>. The event <span class="math inline">\(y'=1\)</span> is equivalent to</p>
<p><span class="math display">\[
\log S(0) + \mu T + \sigma B(T) \leq  \log \left(\frac{L^2}{K}\right)
\]</span> <span class="math display">\[
\Longleftrightarrow \log S(0) + \mu T + \sigma [B^{**}(T) - \delta T] \leq \log \left(\frac{L^2}{K}\right)
\]</span> <span class="math display">\[
\Longleftrightarrow \log S(0) - \mu T + \sigma B^{**}(T) \leq \log \left(\frac{L^2}{K}\right)
\]</span> <span id="eq-appendixc202"><span class="math display">\[
\Longleftrightarrow \frac{B^{**}(T)}{\sqrt{T}} \leq d'\;,
\qquad(14)\]</span></span></p>
<p>where we define <span id="eq-appendixc103"><span class="math display">\[
d' = \frac{\log \left(\frac{L^2}{KS(0)}\right) + \mu T }{\sigma\sqrt{T}}\;.
\qquad(15)\]</span></span></p>
<p>Combining <a href="#eq-appendixc200" class="quarto-xref">Equation&nbsp;<span>12</span></a>, <a href="#eq-appendixc201" class="quarto-xref">Equation&nbsp;<span>13</span></a> and <a href="#eq-appendixc202" class="quarto-xref">Equation&nbsp;<span>14</span></a> yields <span class="math display">\[\text{prob}(y=1) = \left(\frac{L}{S(0)}\right)^{2\mu/\sigma^2}\mathrm{N}(d')\; .\]</span> Summarizing, we have</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rule
</div>
</div>
<div class="callout-body-container callout-body">
<p>Assume <span class="math inline">\(\mathrm{d}\log S = \mu\,\mathrm{d} t+\sigma\,\mathrm{d} B\)</span> where <span class="math inline">\(B\)</span> is a Brownian motion. Define <span class="math inline">\(z = \min_{0 \leq t \leq T} S(t)\)</span>. For <span class="math inline">\(K \geq L\)</span> and <span class="math inline">\(L \leq \log S(0)\)</span>,</p>
<ol type="1">
<li>The probability that <span class="math inline">\(S(T)&gt;K\)</span> and <span class="math inline">\(z &gt; L\)</span> is <span class="math display">\[\mathrm{N}(d) - \left(\frac{L}{S(0)}\right)^{2\mu/\sigma^2}\mathrm{N}(d')\; ,\]</span> where <span class="math inline">\(d\)</span> is defined in <a href="#eq-appendixc100" class="quarto-xref">Equation&nbsp;<span>7</span></a> and <span class="math inline">\(d'\)</span> is defined in <a href="#eq-appendixc103" class="quarto-xref">Equation&nbsp;<span>15</span></a>.</li>
<li>The probability that <span class="math inline">\(z \leq L\)</span> is <span class="math display">\[\mathrm{N}(-d) + \left(\frac{L}{S(0)}\right)^{2\mu/\sigma^2}\mathrm{N}(d')\; ,\]</span> where <span class="math inline">\(d\)</span> is defined in <a href="#eq-appendixc100" class="quarto-xref">Equation&nbsp;<span>7</span></a> and <span class="math inline">\(d'\)</span> is defined in <a href="#eq-appendixc103" class="quarto-xref">Equation&nbsp;<span>15</span></a>, substituting <span class="math inline">\(K=L\)</span> in both.</li>
</ol>
</div>
</div>
</section>
</section>
<section id="sec-a_bessel" class="level2">
<h2 class="anchored" data-anchor-id="sec-a_bessel">Bessel Squared Processes and the CIR Model</h2>
<p>This section will present additional results regarding the CIR square-root short rate process discussed in <span class="quarto-unresolved-ref">?sec-s_cir</span>. The ideas described here are one way (though not the only way) to derive the CIR discount bond option pricing formula. We begin with the following simpler process <span id="eq-besq"><span class="math display">\[
\mathrm{d} x(t) = \delta\,\mathrm{d} t + 2 \sqrt{x(t)}\,\mathrm{d} Z
\qquad(16)\]</span></span></p>
<p>for a Brownian motion <span class="math inline">\(Z\)</span> and constant <span class="math inline">\(\delta&gt;0\)</span>. This is called a Bessel-squared process with parameter <span class="math inline">\(\delta\)</span>. The parameter <span class="math inline">\(\delta\)</span> determines whether <span class="math inline">\(x\)</span> can ever reach zero. If <span class="math inline">\(\delta \geq 2\)</span>, then with probability one, <span class="math inline">\(x(t)\)</span> is strictly positive for all <span class="math inline">\(t\)</span>; whereas, if <span class="math inline">\(\delta &lt; 2\)</span>, then with positive probability, <span class="math inline">\(x\)</span> will sometimes hit zero (but will never go negative).</p>
<p>In the particular (rare) case that <span class="math inline">\(\delta\)</span> is an integer, the squared length of a <span class="math inline">\(\delta\)</span>-dimensional vector of independent Brownian motions is a process <span class="math inline">\(x\)</span> satisfying~<a href="#eq-besq" class="quarto-xref">Equation&nbsp;<span>16</span></a>. To see this, let <span class="math inline">\(B_1, \ldots, B_\delta\)</span> be independent Brownian motions starting at given values <span class="math inline">\(b_i\)</span>; i.e., <span class="math inline">\(B_i(0) = b_i\)</span>. Define <span class="math inline">\(x(t) = \sum_{i=1}^\delta B_i(t)^2\)</span>. Then Ito’s formula gives us <span class="math display">\[\begin{align*}
\mathrm{d} x(t) &amp;= \sum_{i=1}^\delta 2B_i(t)\,\mathrm{d} B_i(t) + \sum_{i=1}^\delta \mathrm{d} t\\
&amp;= \delta\,\mathrm{d} t + 2 \sqrt{x(t)}\sum_{i=1}^\delta \frac{B_i(t)}{\sqrt{x(t)}}\,\mathrm{d} B_i(t).
\end{align*}\]</span> The process <span class="math inline">\(Z\)</span> defined by <span class="math inline">\(Z(0)=0\)</span> and <span class="math display">\[\mathrm{d} Z = \sum_{i=1}^\delta \frac{B_i(t)}{\sqrt{x(t)}}\,\mathrm{d} B_i(t)\]</span> is a Brownian motion (because it is a continuous martingale with <span class="math inline">\((\mathrm{d} Z)^2=\mathrm{d} t\)</span>); thus, we obtain <a href="#eq-besq" class="quarto-xref">Equation&nbsp;<span>16</span></a>.</p>
<p>Continuing to assume that <span class="math inline">\(\delta\)</span> is an integer and that <span class="math inline">\(x(t) = \sum_{i=1}^\delta B_i(t)^2\)</span>, note that, for any <span class="math inline">\(t\)</span>, the random variables <span class="math inline">\(\xi_i\)</span> defined as <span class="math inline">\(\xi_i = [B_i(t)-B_i(0)]/\sqrt{t}\)</span> are independent standard normals, and we have <span class="math display">\[\begin{align*}
x(t) &amp;= \sum_{i=1}^\delta \big[b_i + B_i(t)-B_i(0)\big]^2\\
&amp;= t\times \sum_{i=1}^\delta \left(\frac{b_i}{\sqrt{t}} + \xi_i\right)^2.
\end{align*}\]</span> A random variable of the form <span class="math inline">\(\sum_{i=1}^\delta \left(\gamma_i + \xi_i\right)^2\)</span>, where the <span class="math inline">\(\gamma_i\)</span> are constants and the <span class="math inline">\(\xi_i\)</span> are independent standard normals, is said to have a non-central chi-square distribution with <span class="math inline">\(\delta\)</span> degrees of freedom and noncentrality parameter <span class="math inline">\(\sum_{i=1}^\delta \gamma_i^2\)</span>. Thus, <span class="math inline">\(x(t)\)</span> is equal to <span class="math inline">\(t\)</span> times a non-central chi-square random variable with <span class="math inline">\(\delta\)</span> degrees of freedom and noncentrality parameter <span class="math display">\[\sum_{i=1}^\delta \frac{b_i^2}{t} = \frac{x(0)}{t}\; .\]</span> The noncentral chi-square distribution can be defined for a non-integer degrees of freedom also, and a process <span class="math inline">\(x\)</span> satisfying <a href="#eq-besq" class="quarto-xref">Equation&nbsp;<span>16</span></a> for a non-integer <span class="math inline">\(\delta\)</span> has the same relation to it, namely,</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rule
</div>
</div>
<div class="callout-body-container callout-body">
<p>If <span class="math inline">\(x\)</span> satisfies <a href="#eq-besq" class="quarto-xref">Equation&nbsp;<span>16</span></a>, then for any <span class="math inline">\(t\)</span> and <span class="math inline">\(\alpha&gt;0\)</span>, the probability that <span class="math inline">\(x(t)  \leq \alpha\)</span> is equal to the probability that <span class="math inline">\(z \leq \alpha/t\)</span>, where <span class="math inline">\(z\)</span> is a random variable with a non-central chi-square distribution with <span class="math inline">\(\delta\)</span> degrees of freedom and noncentrality parameter <span class="math inline">\(x(0)/t\)</span>.</p>
</div>
</div>
<p>Now consider the CIR process <a href="Chapter_Survey.html#eq-cir" class="quarto-xref">Equation&nbsp;<span>28.9</span></a>. Define <span class="math inline">\(\delta = 4 \kappa
\theta/ \sigma^2\)</span> and define <span class="math inline">\(x\)</span> by <a href="#eq-besq" class="quarto-xref">Equation&nbsp;<span>16</span></a>, with <span class="math inline">\(x(0)= r(0)\)</span>. Set<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> <span class="math display">\[h(t)=\frac{ \sigma^2}{4 \kappa} \left( \mathrm{e}^{\kappa t}-1 \right)\; ,\]</span> and <span class="math display">\[r(t) = \mathrm{e}^{-\kappa t}x(h(t))\; .\]</span> Then it can be shown^[The key to this calculation is the fact that if <span class="math inline">\(Z\)</span> is a Brownian motion and <span class="math inline">\(h\)</span> is a continuously differentiable function with <span class="math inline">\(h'(s)&gt;0\)</span> for all <span class="math inline">\(s&gt;0\)</span> then <span class="math inline">\(B\)</span> defined by <span class="math display">\[B(t) = \int_0^t \frac{1]{\sqrt{h'(s)}}\,\mathrm{d} Z_{h(s)}\]</span> is a Brownian motion also.} that <span class="math inline">\(r\)</span> satisfies the CIR <a href="Chapter_Survey.html#eq-cir" class="quarto-xref">Equation&nbsp;<span>28.9</span></a>, namely <span id="eq-cir17"><span class="math display">\[
\mathrm{d} r = \kappa(\theta-r)\,\mathrm{d} t + \sigma\sqrt{r}\,\mathrm{d} B
\qquad(17)\]</span></span></p>
<p>for a Brownian motion <span class="math inline">\(B\)</span>. For any <span class="math inline">\(t\)</span> and <span class="math inline">\(\alpha&gt;0\)</span>, the probability that <span class="math inline">\(r(t) \leq \alpha\)</span> is equal to the probability that <span class="math inline">\(x(h(t)) \leq \mathrm{e}^{\kappa t}\alpha\)</span>. In view of the previous boxed statement, this implies:</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rule
</div>
</div>
<div class="callout-body-container callout-body">
<p>If <span class="math inline">\(r\)</span> satisfies the CIR <a href="#eq-cir17" class="quarto-xref">Equation&nbsp;<span>17</span></a> where <span class="math inline">\(\kappa\)</span>, <span class="math inline">\(\theta\)</span> and <span class="math inline">\(\sigma\)</span> are positive constants, then, for any <span class="math inline">\(t&gt;0\)</span> and any <span class="math inline">\(\alpha\)</span>, the probability that <span class="math inline">\(r(t) \leq \alpha\)</span> is the probability that <span class="math inline">\(z\leq \mathrm{e}^{\kappa t}\alpha/h(t)\)</span>, where <span class="math inline">\(z\)</span> is a random variable with a non-central chi-square distribution with <span class="math inline">\(\delta = 4 \kappa
\theta/ \sigma^2\)</span> degrees of freedom and noncentrality parameter <span class="math inline">\(r(0)/h(t)\)</span>.</p>
</div>
</div>
<p>To derive the discount bond option pricing formula for the CIR model, we need to know the distribution of <span class="math inline">\(r(T)\)</span> when the parameters <span class="math inline">\(\kappa\)</span> and <span class="math inline">\(\theta\)</span> are time-dependent. Let <span class="math inline">\(w\)</span> denote either <span class="math inline">\(u\)</span> (the maturity of the underlying) or <span class="math inline">\(T\)</span> (the maturity of the option). Using the discount bond maturing at <span class="math inline">\(w\)</span> as the numeraire, we repeat here <a href="Chapter_Survey.html#eq-cirru" class="quarto-xref">Equation&nbsp;<span>28.25</span></a>, dropping now the hat on <span class="math inline">\(\hat{r}\)</span>: <span id="eq-cirstar"><span class="math display">\[
\mathrm{d} r(t)= \kappa^*(t)[\theta^*(t)-r(t)]\,\mathrm{d} t +\sigma \sqrt{r(t)}\,\mathrm{d} B^*(t)\;,
\qquad(18)\]</span></span></p>
<p>where <span class="math display">\[
\kappa^*(t) = \kappa + \sigma^2b(w-t) \qquad \text{and} \qquad \theta^*(t) = \frac{\kappa\theta}{\kappa^*(t)}\; .\]</span> Because <span class="math inline">\(\kappa^*(t)\theta^*(t) = \kappa\theta\)</span>, we again define <span class="math inline">\(\delta = 4 \kappa
\theta/ \sigma^2\)</span> but now set <span class="math display">\[h^*(t) = \frac{ \sigma^2}{4}\int_0^t \exp\left(
\int _0^s \kappa^*(y)\,\mathrm{d} y \right) \,\mathrm{d} s\]</span> and <span class="math display">\[r(t) = \exp\left(-\int_0^t \kappa^*(s)\,\mathrm{d} s\right)x(h^*(t))\; .\]</span> Then it can be shown that <span class="math inline">\(r\)</span> satisfies <a href="#eq-cirstar" class="quarto-xref">Equation&nbsp;<span>18</span></a> for a Brownian motion <span class="math inline">\(B^*\)</span>. Thus, as in the previous paragraphs, the probability that <span class="math inline">\(r(T) \leq \alpha\)</span>, where <span class="math inline">\(r\)</span> satisfies <a href="#eq-cirstar" class="quarto-xref">Equation&nbsp;<span>18</span></a>, is the probability that <span class="math display">\[z \leq \frac{\exp\left(\int_0^T \kappa^*(s)\,\mathrm{d} s\right)\alpha}{h^*(T)}\; ,\]</span> where <span class="math inline">\(z\)</span> has a non-central chi-square distribution with <span class="math inline">\(\delta\)</span> degrees of freedom and noncentrality parameter <span class="math inline">\(r(0)/h^*(T)\)</span>.</p>
<p>Straightforward calculations, using in particular the fact that <span class="math inline">\(b(\tau) = a'(\tau)/(\kappa\theta)\)</span> and <span class="math display">\[\int \frac{\mathrm{e}^{\gamma t}}{c(t)^2}\,\mathrm{d} t = -\frac{1}{(\kappa+\gamma)\gamma} \int \frac{\mathrm{d}}{\mathrm{d} t}\left(\frac{1}{c(t)}\right)\,\mathrm{d} t = -\frac{1}{(\kappa+\gamma)\gamma c(t)}\]</span> give us: <span class="math display">\[\exp\left(\int_0^T \kappa^*(s)\,\mathrm{d} s\right) = \frac{\mathrm{e}^{-\gamma T}c(w)^2}{c(w-T)^2}\]</span> and <span class="math display">\[h^*(T) =\frac{\sigma^2\mathrm{e}^{-\gamma w}c(w)}{4(\kappa + \gamma)\gamma}\left[\frac{c(w)}{c(w-T)}-1\right]\; ,\]</span> where <span class="math inline">\(\gamma\)</span> and <span class="math inline">\(c\)</span> are defined in <a href="Chapter_Survey.html#eq-cirbeta" class="quarto-xref">Equation&nbsp;<span>28.15</span></a> - <a href="Chapter_Survey.html#eq-ciralpha" class="quarto-xref">Equation&nbsp;<span>28.17</span></a>. This simplifies somewhat in the case <span class="math inline">\(w=T\)</span> because <span class="math inline">\(c(0) = 2\gamma\)</span>. Thus, the probabilities in the CIR option pricing <a href="Chapter_Survey.html#eq-ciroptionprice" class="quarto-xref">Equation&nbsp;<span>28.23</span></a>, which are the probabilities of the event shown in <a href="Chapter_Survey.html#eq-ciroptionprice2" class="quarto-xref">Equation&nbsp;<span>28.24</span></a>, are as follows:</p>
<ul>
<li><span class="math inline">\(\text{prob}^u\big(P(T,u)&gt;K\big)\)</span> is the probability that <span class="math display">\[z \leq -\frac{\mu_u}{\lambda_u}\left(\frac{\int_T^u \phi(s)\,\mathrm{d} s+a(u-T)+\log K}{b(u-T)}\right)\; ,\]</span> where <span class="math inline">\(z\)</span> has a non-central chi-square distribution with <span class="math inline">\(4\kappa\theta/\sigma^2\)</span> degrees of freedom and noncentrality parameter <span class="math inline">\(r(0)/\lambda_u\)</span>, and <span class="math display">\[\begin{align*}
\mu_u &amp; = \frac{\mathrm{e}^{-\gamma T}c(u)^2}{c(u-T)^2}\; ,\\
\lambda_u &amp; = \frac{\sigma^2\mathrm{e}^{-\gamma u}c(u)}{4(\kappa + \gamma)\gamma}\left[\frac{c(u)}{c(u-T)}-1\right]\;.
\end{align*}\]</span></li>
<li><span class="math inline">\(\text{prob}^T\big(P(T,u)&gt;K\big)\)</span> is the probability that <span class="math display">\[z \leq -\frac{\mu_T}{\lambda_T}\left(\frac{\int_T^u \phi(s)\,\mathrm{d} s+a(u-T)+\log K}{b(u-T)}\right)\; ,\]</span> where <span class="math inline">\(z\)</span> has a non-central chi-square distribution with <span class="math inline">\(4\kappa\theta/\sigma^2\)</span> degrees of freedom and noncentrality parameter <span class="math inline">\(r(0)/\lambda_T\)</span>, and <span class="math display">\[\begin{align*}
\mu_T &amp; = \frac{\mathrm{e}^{-\gamma T}c(T)^2}{4\gamma^2}\; ,\\
\lambda_T &amp; = \frac{\sigma^2\mathrm{e}^{-\gamma T}c(T)}{4(\kappa + \gamma)\gamma}\left[\frac{c(T)}{2\gamma}-1\right]\;.
\end{align*}\]</span></li>
</ul>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-KS" class="csl-entry" role="listitem">
Karatzas, I., and S. Shreve. 1988. <em>Brownian Motion and Stochastic Calculus</em>. Springer, New York Berlin Heidelberg.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>I learned this transformation from unpublished lecture notes of Hans Buehlmann.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Chapter_Survey.html" class="pagination-link" aria-label="Term Structure Models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Term Structure Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions"><ul><li><a href="https://github.com/math-finance-book/book-code.git/blob/main/AppendixA.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div></div></footer></body></html>