<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>15&nbsp; Other Exotics – Pricing and Hedging Derivative Securities: Theory and Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Chapter_GARCH.html" rel="next">
<link href="./Chapter_Asians.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-933f24a0c1e0be8a62c2179459603458.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-217607b4065b1a3128a07792af3f8e33.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>



<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

<style>
div.callout-WritingToDo.callout {
  border-left-color: #a7f2d8;
}
div.callout-WritingToDo.callout-style-default > .callout-header {
  background-color: rgba(167, 242, 216, 0.13);
}
div.callout-WritingToDo .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-WritingToDo.callout-style-default .callout-icon::before, div.callout-WritingToDo.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-InProgress.callout {
  border-left-color: #eaacf2;
}
div.callout-InProgress.callout-style-default > .callout-header {
  background-color: rgba(234, 172, 242, 0.13);
}
div.callout-InProgress .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-InProgress.callout-style-default .callout-icon::before, div.callout-InProgress.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Extra.callout {
  border-left-color: #d5deed;
}
div.callout-Extra.callout-style-default > .callout-header {
  background-color: rgba(213, 222, 237, 0.13);
}
div.callout-Extra .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Extra.callout-style-default .callout-icon::before, div.callout-Extra.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-CodeToDo.callout {
  border-left-color: #eb4034;
}
div.callout-CodeToDo.callout-style-default > .callout-header {
  background-color: rgba(235, 64, 52, 0.13);
}
div.callout-CodeToDo .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-CodeToDo.callout-style-default .callout-icon::before, div.callout-CodeToDo.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Done.callout {
  border-left-color: #e8cc97;
}
div.callout-Done.callout-style-default > .callout-header {
  background-color: rgba(232, 204, 151, 0.13);
}
div.callout-Done .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Done.callout-style-default .callout-icon::before, div.callout-Done.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Rule.callout {
  border-left-color: #a1bced;
}
div.callout-Rule.callout-style-default > .callout-header {
  background-color: rgba(161, 188, 237, 0.13);
}
div.callout-Rule .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Rule.callout-style-default .callout-icon::before, div.callout-Rule.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Example.callout {
  border-left-color: #e8cc97;
}
div.callout-Example.callout-style-default > .callout-header {
  background-color: rgba(232, 204, 151, 0.13);
}
div.callout-Example .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Example.callout-style-default .callout-icon::before, div.callout-Example.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Principle.callout {
  border-left-color: #e3aab2;
}
div.callout-Principle.callout-style-default > .callout-header {
  background-color: rgba(227, 170, 178, 0.13);
}
div.callout-Principle .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Principle.callout-style-default .callout-icon::before, div.callout-Principle.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Exercise.callout {
  border-left-color: #ede29d;
}
div.callout-Exercise.callout-style-default > .callout-header {
  background-color: rgba(237, 226, 157, 0.13);
}
div.callout-Exercise .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Exercise.callout-style-default .callout-icon::before, div.callout-Exercise.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter_BlackScholes.html">Part IV: Black-Scholes and Extensions</a></li><li class="breadcrumb-item"><a href="./Chapter_Exotics.html"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Other Exotics</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Pricing and Hedging Derivative Securities: Theory and Methods</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/math-finance-book/book-code.git" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Options.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Options</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Futures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Futures and Swaps</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: Mathematical Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Intro_Binomial_Tree.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Brownian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Brownian Motion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Ito.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Ito Processes and Ito’s Formula</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_GBM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Geometric Brownian Motion</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: Arbitrage Pricing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Arbitrage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Foundations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Deltas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Delta Hedges, Replication, and PDEs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_DigitalsMeasures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Digitals and Measures</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Part IV: Black-Scholes and Extensions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_BlackScholes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Black-Scholes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Americans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">American Options</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FX.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">FX and Quantos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Merton.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Merton, Black, and Margrabe</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Asians.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Asians, Baskets, and Spreads</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Exotics.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Other Exotics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Part V: Alternative Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_GARCH.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">GARCH Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_StochasticVol.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Stochastic Volatility</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Jumps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Jumps</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_VarianceSwaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Variance Swaps</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Part VI: Numerical Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_MonteCarlo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Monte Carlo Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Binomial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Binomial and Trinomial Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_PDEs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">PDE Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Fourier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Fourier Transforms</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_MachineLearning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Machine Learning</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Part VII: Fixed Income</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FixedIncome.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Fixed-Income Concepts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FixedIncomeDerivatives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Fixed-Income Derivatives</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Vasicek.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Vasicek and Extensions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Survey.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Term Structure Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendix</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./AppendixA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Miscellaneous Facts about Continuous-Time Models</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter_BlackScholes.html">Part IV: Black-Scholes and Extensions</a></li><li class="breadcrumb-item"><a href="./Chapter_Exotics.html"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Other Exotics</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-c:exotics" class="quarto-section-identifier"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Other Exotics</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="e37f07ea" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display">
        <script type="text/javascript">
        window.PlotlyConfig = {MathJaxConfig: 'local'};
        if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
        </script>
        <script type="module">import "https://cdn.plot.ly/plotly-3.0.0.min"</script>
        
</div>
<div class="cell-output cell-output-display">
<script type="text/javascript" async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_SVG"></script>
</div>
</div>
<p>We study six classes of exotic options:</p>
<ul>
<li>Barrier options (knock-outs and knock-ins)</li>
<li>Lookback options</li>
<li>Compound options</li>
<li>Options of the max or min of two asset prices</li>
<li>Forward start options</li>
<li>Choosers</li>
</ul>
<section id="sec-s:barriers" class="level2" data-number="15.1">
<h2 data-number="15.1" class="anchored" data-anchor-id="sec-s:barriers"><span class="header-section-number">15.1</span> Barrier Options</h2>
<p> A down-and-out call pays the usual call value at maturity if and only if the stock price does not hit a specified lower bound during the lifetime of the option. If it does breach the lower barrier, then it is out. Conversely, a down-and-in call pays off only if the stock price does hit the lower bound. Up-and-out and up-and-in calls are defined similarly, and there are also put options of this sort. The out versions are called knock-outs and the in versions are called knock-ins.</p>
<p>Knock-ins can be priced from knock-outs and vice-versa. For example, the combination of a down-and-out call and a down-and-in call creates a standard European call, so the value of a down-and-in can be obtained by subtracting the value of a down-and-out from the value of a standard European call. Likewise, up-and-in calls can be valued by subtracting the value of an up-and-out from the value of a standard European call. Both knock-outs and knock-ins are of course less expensive than comparable standard options.</p>
<p>We will describe the pricing of a down-and-out call. The pricing of up-and-out calls and knock-out puts is similar. Often there are rebates associated with the knocking-out of a barrier option, but we will not include that feature here (see <a href="Chapter_PDEs.html#sec-s:finitedifferencebarriers" class="quarto-xref"><span>Section 22.7</span></a> however).</p>
<p>A down-and-out call provides a hedge against an increase in an asset price, just as does a standard call, for someone who is short the asset. The difference is that the down-and-out is knocked out when the asset price falls sufficiently. Presumably this is acceptable to the buyer because the need to hedge against high prices diminishes when the price falls. In fact, in this circumstance the buyer may want to establish a new hedge at a lower strike. However, absent re-hedging at a lower strike, the buyer of a knock-out call obviously faces the risk that the price may reverse course after falling to the knock-out boundary, leading to regret that the option was knocked out. The rationale for accepting this risk is that the knock-out is cheaper than a standard call. Thus, compared to a standard call, a down-and-out call provides cheaper but incomplete insurance.</p>
<p>The combination of a knock-out call and a knock-in call (or knock-out puts) with the same barrier and different strikes creates an option with a strike that is reset when the barrier is hit. This is a hedge that adjusts automatically to the market. An example is given in Probs.~<span class="math inline">\(\ref{e_standardknockout3}\)</span> and~<span class="math inline">\(\ref{e_standardknockout4}\)</span>.</p>
<section id="down-and-out-call-payoff" class="level3">
<h3 class="anchored" data-anchor-id="down-and-out-call-payoff">Down-and-Out Call Payoff</h3>
<p>Let <span class="math inline">\(L\)</span> denote the lower barrier for the down-and-out call and assume it has not yet been breached at the valuation date, which we are calling date <span class="math inline">\(0\)</span>. Denote the minimum stock price realized during the remaining life of the contract by <span class="math inline">\(z = \min_{0\leq t\leq T} S_t\)</span>. In practice, this minimum is calculated at discrete dates (for example, based on daily closing prices), but we will assume here that the stock price is monitored continuously for the purpose of calculating the minimum.</p>
<p>The down-and-out call will pay <span class="math inline">\(\max(0,S_T-K)\)</span> if <span class="math inline">\(z &gt; L\)</span> and 0 otherwise, at its maturity T.<br>
Let <span class="math display">\[
x = \begin{cases} 1 &amp; \text{if $S_T&gt;K$ and $z &gt; L$\;,}\\
0 &amp; \text{otherwise\;.} \end{cases}
\]</span> Then the value of the down-and-out call at maturity is <span class="math display">\[
xS_T - xK\; .
\]</span> ### Numeraires As in other cases, the value at date <span class="math inline">\(0\)</span> can be written as <span class="math display">\[
\mathrm{e}^{-qT}S_0\times\text{prob}^{V}(x=1) - \mathrm{e}^{-rT}K\times\text{prob}^{R}(x=1)\; ,
\]</span></p>
<p>where <span class="math inline">\(V_t = \mathrm{e}^{qt}S_t\)</span> and <span class="math inline">\(R_t=\mathrm{e}^{rt}\)</span>.</p>
</section>
<section id="calculating-probabilities" class="level3">
<h3 class="anchored" data-anchor-id="calculating-probabilities">Calculating Probabilities</h3>
<p>To calculate <span class="math inline">\(\text{prob}^{V}(x=1)\)</span> and <span class="math inline">\(\text{prob}^{R}(x=1)\)</span>, we consider two cases.</p>
<ol type="1">
<li>Suppose <span class="math inline">\(K&gt;L\)</span>. Define <span class="math display">\[
y = \begin{cases} 1 &amp; \text{if $S_T&gt;K$ and $z \leq L$}\\
0 &amp; \text{otherwise\;.} \end{cases}
\]</span></li>
</ol>
<p>The event <span class="math inline">\(S_T&gt;K\)</span> is equal to the union of the disjoint events <span class="math inline">\(x=1\)</span> and <span class="math inline">\(y=1\)</span>. Therefore, <span class="math display">\[\begin{align*}
\text{prob}^{V}(x=1) &amp;= \text{prob}^{V}(S_T\!&gt;\!K) - \text{prob}^{V}(y=1)\; ,\\
\text{prob}^{R}(x=1) &amp;= \text{prob}^{R}(S_T\!&gt;\!K) - \text{prob}^{R}(y=1)\;.
\end{align*}\]</span></p>
<p>As in the derivation of the Black-Scholes formula, we have <span id="eq-casea2"><span class="math display">\[
\text{prob}^{V}(S_T\!&gt;\!K) = \mathrm{N}(d_1) \quad \text{and} \quad \text{prob}^{R}(S_T\!&gt;\!K) = \mathrm{N}(d_2)\;,
\qquad(15.1)\]</span></span></p>
<p>where</p>
<p><span id="eq-casea3"><span class="math display">\[
d_1= \frac{\log\left(\frac{S_0}{K}\right)+\left(r-q+\frac{1}{2}\sigma^2\right)T}{\sigma\sqrt{T}}\; ,\qquad  d_2 = d_1-\sigma\sqrt{T}\;.
\qquad(15.2)\]</span></span></p>
<p>Furthermore , defining <span id="eq-casea5"><span class="math display">\[
d_1' = \frac{\log\left(\frac{L^2}{KS_0}\right)+\left(r-q+\frac{1}{2}\sigma^2\right)T}{\sigma\sqrt{T}}\;, \qquad d_2' = d_1'-\sigma\sqrt{T}\;,
\qquad(15.3)\]</span></span></p>
<p>it can be shown (see Appendix~<span class="math inline">\(\ref{a_minimum}\)</span>) that</p>
<p><span id="eq-casea4"><span class="math display">\[
\text{prob}^{V}(y=1) = \left(\frac{L}{S_0}\right)^{2\left(r-q+\frac{1}{2}\sigma^2\right)/\sigma^2}\mathrm{N}(d_1')\;,
\qquad(15.4)\]</span></span></p>
<p><span id="eq-casea41"><span class="math display">\[
\text{prob}^{R}(y=1) = \left(\frac{L}{S_0}\right)^{2\left(r-q-\frac{1}{2}\sigma^2\right)/\sigma^2}\mathrm{N}(d_2')\;.
\qquad(15.5)\]</span></span></p>
<ol start="2" type="1">
<li>Suppose <span class="math inline">\(K \leq L\)</span>. Then the condition <span class="math inline">\(S_T&gt;K\)</span> in the definition of the event <span class="math inline">\(x=1\)</span> is redundant: if <span class="math inline">\(z &gt; L \geq K\)</span>, then it is necessarily true that <span class="math inline">\(S_T&gt;K\)</span>. Therefore, the probability (under either numeraire) of the event <span class="math inline">\(x=1\)</span> is the probability that <span class="math inline">\(z &gt; L\)</span>. Define <span class="math display">\[y = \begin{cases} 1 &amp; \text{if $S_T&gt;L$ and $z \leq L$\;,}\\
0 &amp; \text{otherwise\;.} \end{cases}
\]</span></li>
</ol>
<p>The event <span class="math inline">\(S_T&gt;L\)</span> is the union of the disjoint events <span class="math inline">\(x=1\)</span> and <span class="math inline">\(y=1\)</span>. Therefore, as in the previous case (but now with <span class="math inline">\(K\)</span> replaced by <span class="math inline">\(L\)</span>), <span class="math display">\[\begin{align*}
\text{prob}^{V}(x=1) &amp;= \text{prob}^{V}(S_T\!&gt;\!L) - \text{prob}^{V}(y=1)\; ,\\
\text{prob}^{R}(x=1) &amp;= \text{prob}^{R}(S_T\!&gt;\!L) - \text{prob}^{R}(y=1)\;.
\end{align*}\]</span> Also as before, we know that <span id="eq-caseb2"><span class="math display">\[
\text{prob}^{V}(S_T\!&gt;\!L) = \mathrm{N}(d_1) \quad \text{and} \quad \text{prob}^{R}(S_T\!&gt;\!L) = \mathrm{N}(d_2)\;,
\qquad(15.6)\]</span></span></p>
<p>where now</p>
<p><span id="eq-caseb3"><span class="math display">\[
d_1= \frac{\log\left(\frac{S_0}{L}\right)+\left(r-q+\frac{1}{2}\sigma^2\right)T}{\sigma\sqrt{T}}\; ,\qquad  d_2 = d_1-\sigma\sqrt{T}\;.
\qquad(15.7)\]</span></span></p>
<p>Moreover, <span class="math inline">\(\text{prob}^{V}(y=1)\)</span> and <span class="math inline">\(\text{prob}^{R}(y=1)\)</span> are given by <a href="#eq-casea4" class="quarto-xref">Equation&nbsp;<span>15.4</span></a> - <a href="#eq-casea41" class="quarto-xref">Equation&nbsp;<span>15.5</span></a> but with <span class="math inline">\(K\)</span> replaced by <span class="math inline">\(L\)</span>, which means that <span id="eq-caseb5"><span class="math display">\[
d_1' = \frac{\log\left(\frac{L}{S_0}\right)+\left(r-q+\frac{1}{2}\sigma^2\right)T}{\sigma\sqrt{T}}\;, \qquad d_2'= d_1' - \sigma\sqrt{T}\;.
\qquad(15.8)\]</span></span></p>
</section>
<section id="down-and-out-call-pricing-formula" class="level3">
<h3 class="anchored" data-anchor-id="down-and-out-call-pricing-formula">Down-and-Out Call Pricing Formula</h3>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Calculation Rule
</div>
</div>
<div class="callout-body-container callout-body">
<p>The value of a continuously-sampled down-and-out call option with barrier <span class="math inline">\(L\)</span> is</p>
<p><span id="eq-downout100"><span class="math display">\[
\begin{multline}
\mathrm{e}^{-qT}S_0\left[\mathrm{N}(d_1)-\left(\frac{L}{S_0}\right)^{2\left(r-q+\frac{1}{2}\sigma^2\right)/\sigma^2}\mathrm{N}(d_1')\right]\\ - \mathrm{e}^{-rT}K\left[\mathrm{N}(d_2) - \left(\frac{L}{S_0}\right)^{2\left(r-q-\frac{1}{2}\sigma^2\right)/\sigma^2}\mathrm{N}(d_2')\right]\;,
\end{multline}
\qquad(15.9)\]</span></span></p>
<p>where</p>
<ol type="1">
<li>if <span class="math inline">\(K&gt;L\)</span>, <span class="math inline">\(d_1\)</span>, <span class="math inline">\(d_2\)</span> , <span class="math inline">\(d_1'\)</span> and <span class="math inline">\(d_2'\)</span> are defined in <a href="#eq-casea3" class="quarto-xref">Equation&nbsp;<span>15.2</span></a> - <a href="#eq-casea5" class="quarto-xref">Equation&nbsp;<span>15.3</span></a>,</li>
<li>if <span class="math inline">\(K\leq L\)</span>, <span class="math inline">\(d_1\)</span>, <span class="math inline">\(d_2\)</span>, <span class="math inline">\(d_1'\)</span> and <span class="math inline">\(d_2'\)</span> are defined in <a href="#eq-caseb3" class="quarto-xref">Equation&nbsp;<span>15.7</span></a> - <a href="#eq-caseb5" class="quarto-xref">Equation&nbsp;<span>15.8</span></a>.</li>
</ol>
</div>
</div>
<p>The following code computes the price of a down and out call option.</p>
<div id="cell-Down-And_Out_Call" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">def down_and_out_call(S, K, r, sigma, q, T, Barrier):</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">    if K &gt; Barrier:</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">        a = S / K</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">        b = Barrier * Barrier / (K * S)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">    else:</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">        a = S / Barrier</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">        b = Barrier / S</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">    d1 = (np.log(a) + (r - q + 0.5 * sigma ** 2) * T) / (sigma * np.sqrt(T))</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">    d2 = d1 - sigma * np.sqrt(T)</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">    d1prime = (np.log(b) + (r - q + 0.5 * sigma ** 2) * T) / (sigma * np.sqrt(T))</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">    d2prime = d1prime - sigma * np.sqrt(T)</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">    N1 = norm.cdf(d1)</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">    N2 = norm.cdf(d2)</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">    N1prime = norm.cdf(d1prime)</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">    N2prime = norm.cdf(d2prime)</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co">    x = 1 + 2 * (r - q) / (sigma ** 2)</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co">    y = x - 2</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">    q1 = N1 - (Barrier / S) ** x * N1prime</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">    q2 = N2 - (Barrier / S) ** y * N2prime</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">    return np.exp(-q * T) * S * q1 - np.exp(-r * T) * K * q2</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co">print("Down and Out Call:", down_and_out_call(S, K, r, sigma, q, T, 80))</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="down-and_out_call" class="cell-output cell-output-display" data-execution_count="2">
<pre><code>'\n\ndef down_and_out_call(S, K, r, sigma, q, T, Barrier):\n    if K &gt; Barrier:\n        a = S / K\n        b = Barrier * Barrier / (K * S)\n    else:\n        a = S / Barrier\n        b = Barrier / S\n\n    d1 = (np.log(a) + (r - q + 0.5 * sigma ** 2) * T) / (sigma * np.sqrt(T))\n    d2 = d1 - sigma * np.sqrt(T)\n    d1prime = (np.log(b) + (r - q + 0.5 * sigma ** 2) * T) / (sigma * np.sqrt(T))\n    d2prime = d1prime - sigma * np.sqrt(T)\n    N1 = norm.cdf(d1)\n    N2 = norm.cdf(d2)\n    N1prime = norm.cdf(d1prime)\n    N2prime = norm.cdf(d2prime)\n    x = 1 + 2 * (r - q) / (sigma ** 2)\n    y = x - 2\n    q1 = N1 - (Barrier / S) ** x * N1prime\n    q2 = N2 - (Barrier / S) ** y * N2prime\n\n    return np.exp(-q * T) * S * q1 - np.exp(-r * T) * K * q2\nprint("Down and Out Call:", down_and_out_call(S, K, r, sigma, q, T, 80))\n'</code></pre>
</div>
</div>
</section>
</section>
<section id="sec-s:lookbacks" class="level2" data-number="15.2">
<h2 data-number="15.2" class="anchored" data-anchor-id="sec-s:lookbacks"><span class="header-section-number">15.2</span> Lookbacks</h2>
<p> A floating-strike lookback call pays the difference between the asset price at maturity and the minimum price realized during the life of the contract. A floating-strike lookback put pays the difference between the maximum price over the life of the contract and the price at maturity. Thus, the floating-strike lookback call allows one to buy the asset at its minimum price, and the floating-strike lookback put allows one to sell the asset at its maximum price. Of course, one pays upfront for this opportunity to time the market. These options were first discussed by Goldman, Sosin and Gatto <span class="citation" data-cites="GSG">(<a href="#ref-GSG" role="doc-biblioref">Goldman, Sosin, and Gatto 1979</a>)</span>.</p>
<p>A fixed-strike lookback put pays the difference between a fixed strike price and the minimum price during the lifetime of the contract. Thus, a fixed-strike lookback put and a floating-strike lookback call are similar in one respect: both enable one to buy the asset at its minimum price. However, the put allows one to sell the asset at a fixed price whereas the call allows one to sell it at the terminal asset price. A fixed-strike lookback call pays the difference between the maximum price and a fixed strike price and is similar to a floating-strike lookback put in the sense that both enable one to sell the asset at its maximum price. Fixed-strike lookback options were first discussed by Conze and Viswanathan <span class="citation" data-cites="CV">(<a href="#ref-CV" role="doc-biblioref">Conze and Viswanathan 1991</a>)</span>. We will discuss the valuation of floating-strike lookback calls. As in the discussion of barrier options, we will assume that the price is continuously sampled for the purpose of computing the minimum.</p>
<section id="floating-strike-lookback-call-payoff" class="level3">
<h3 class="anchored" data-anchor-id="floating-strike-lookback-call-payoff">Floating-Strike Lookback Call Payoff</h3>
<p>As in the previous section, let <span class="math inline">\(z\)</span> denote the minimum stock price realized over the remaining lifetime of the contract. This is not necessarily the minimum stock price realized during the entire lifetime of the contract. Let <span class="math inline">\(S_{\min}\)</span> denote the minimum stock price realized during the lifetime of the contract up to and including date <span class="math inline">\(0\)</span>, which is the date at which we are valuing the contract. The minimum stock price during the entire lifetime of the contract will be the smaller of <span class="math inline">\(z\)</span> and <span class="math inline">\(S_{\text{min}}\)</span>. The payoff of the floating strike lookback call is <span class="math inline">\(S_T - \min\left(z, S_{\text{min}}\right)\)</span>.</p>
</section>
<section id="calculations" class="level3">
<h3 class="anchored" data-anchor-id="calculations">Calculations</h3>
<p>The value at date <span class="math inline">\(0\)</span> of the piece <span class="math inline">\(S_T\)</span> is simply <span class="math inline">\(\mathrm{e}^{-qT}S_0\)</span>. Using the result in Appendix~<span class="math inline">\(\ref{a_minimum}\)</span> on the distribution of <span class="math inline">\(z\)</span>, it can be shown (see, e.g., Musiela and Rutkowski <span class="citation" data-cites="MR">(<a href="#ref-MR" role="doc-biblioref">Musiela and Rutkowski 1997</a>)</span> for the details) that the value at date <span class="math inline">\(0\)</span> of receiving <span class="math display">\[
\min(z, S_{\text{min}})
\]</span> at date <span class="math inline">\(T\)</span> is <span class="math display">\[\begin{multline*}
\mathrm{e}^{-rT}S_{\text{min}}\mathrm{N}(d_2) -\frac{\sigma^2}{2(r-q)}\left(\frac{S_{\text{min}}}{S_0}\right)^{2(r-q)/\sigma^2}\mathrm{e}^{-rT}S_0\mathrm{N}(d_2') \\
+\left(1+ \frac{\sigma^2}{2(r-q)}\right)\mathrm{e}^{-qT}S_0\mathrm{N}(-d_1)\;.
\end{multline*}\]</span> where</p>
<p><span id="eq-fslc100a"><span class="math display">\[
d_1 = \frac{\log\left(\frac{S_0}{S_{\text{min}}}\right)+\left(r-q+\frac{1}{2}\sigma^2\right)T}{\sigma\sqrt{T}}\; , \qquad d_2 = d_1 - \sigma\sqrt{T}\;,
\qquad(15.10)\]</span></span></p>
<p><span id="eq-fslc100c"><span class="math display">\[
d_1' = \frac{\log\left(\frac{S_{\text{min}}}{S_0}\right)+\left(r-q+\frac{1}{2}\sigma^2\right)T}{\sigma\sqrt{T}}\;, \qquad d_2'=d_1' - \sigma\sqrt{T} \;.
\qquad(15.11)\]</span></span></p>
<p>Using the fact that <span class="math inline">\([1-\mathrm{N}(-d_1)]\mathrm{e}^{-qT}S_0=\mathrm{e}^{-qT}S_0\mathrm{N}(d_1)\)</span>, this implies:</p>
</section>
<section id="floating-strike-lookback-call-pricing-formula" class="level3">
<h3 class="anchored" data-anchor-id="floating-strike-lookback-call-pricing-formula">Floating-Strike Lookback Call Pricing Formula</h3>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">15.3</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>The value at date <span class="math inline">\(0\)</span> of a continuously-sampled floating-strike lookback call, given that the minimum price during the lifetime of the contract through date <span class="math inline">\(0\)</span> is <span class="math inline">\(S_{\text{min}}\)</span> and the remaining time to maturity is <span class="math inline">\(T\)</span>, is</p>
<p><span id="eq-fslc100"><span class="math display">\[
\begin{multline}
\mathrm{e}^{-qT}S_0\mathrm{N}(d_1)-\mathrm{e}^{-rT}S_{\text{min}}\mathrm{N}(d_2) \\+\frac{\sigma^2}{2(r-q)}\left(\frac{S_{\text{min}}}{S_0}\right)^{2(r-q)/\sigma^2}\mathrm{e}^{-rT}S_0\mathrm{N}(d_2') \\
-\frac{\sigma^2}{2(r-q)}\mathrm{e}^{-qT}S_0\mathrm{N}(-d_1)\;,
\end{multline}
\qquad(15.12)\]</span></span></p>
<p>where <span class="math inline">\(d_1\)</span>, <span class="math inline">\(d_2\)</span>, and <span class="math inline">\(d_2'\)</span> are defined in <a href="#eq-fslc100a" class="quarto-xref">Equation&nbsp;<span>15.10</span></a> - <a href="#eq-fslc100c" class="quarto-xref">Equation&nbsp;<span>15.11</span></a>.</p>
</div>
</div>
<p>The following program calculates the price of a floating strike lookback option.</p>
<div id="floating_strike_lookback" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> floating_strike_call(S, r, sigma, q, T, SMin):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    d1 <span class="op">=</span> (np.log(S <span class="op">/</span> SMin) <span class="op">+</span> (r <span class="op">-</span> q <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> sigma <span class="op">**</span> <span class="dv">2</span>) <span class="op">*</span> T) <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(T))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    d2 <span class="op">=</span> d1 <span class="op">-</span> sigma <span class="op">*</span> np.sqrt(T)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    d2prime <span class="op">=</span> (np.log(SMin <span class="op">/</span> S) <span class="op">+</span> (r <span class="op">-</span> q <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> sigma <span class="op">**</span> <span class="dv">2</span>) <span class="op">*</span> T) <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(T))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    N1 <span class="op">=</span> norm.cdf(d1)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    N2 <span class="op">=</span> norm.cdf(d2)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    N2prime <span class="op">=</span> norm.cdf(d2prime)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (r <span class="op">-</span> q) <span class="op">/</span> (sigma <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.exp(<span class="op">-</span>q <span class="op">*</span> T) <span class="op">*</span> S <span class="op">*</span> N1 <span class="op">-</span> np.exp(<span class="op">-</span>r <span class="op">*</span> T) <span class="op">*</span> SMin <span class="op">*</span> N2 <span class="op">+</span> (<span class="dv">1</span> <span class="op">/</span> x) <span class="op">*</span> (SMin <span class="op">/</span> S) <span class="op">**</span> x <span class="op">*</span> np.exp(<span class="op">-</span>r <span class="op">*</span> T) <span class="op">*</span> SMin <span class="op">*</span> N2prime <span class="op">-</span> (<span class="dv">1</span> <span class="op">/</span> x) <span class="op">*</span> np.exp(<span class="op">-</span>q <span class="op">*</span> T) <span class="op">*</span> S <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> N1)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.05</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>T<span class="op">=</span><span class="dv">1</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Floating Strike Call:", floating_strike_call(S, r, sigma, q, T, 90))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="compound-options" class="level2" data-number="15.4">
<h2 data-number="15.4" class="anchored" data-anchor-id="compound-options"><span class="header-section-number">15.4</span> Compound Options</h2>
<p>A compound option is an option on an option, for example a call option on a call option or a call on a put. These options are useful for hedging when there is some uncertainty about the need for hedging which may be resolved by the exercise date of the compound option. As speculative trades, they have the benefit of higher leverage than ordinary options. These options were first discussed by Geske <span class="citation" data-cites="Geske">(<a href="#ref-Geske" role="doc-biblioref">Geske 1979</a>)</span>.</p>
<section id="call-on-a-call-payoff" class="level3">
<h3 class="anchored" data-anchor-id="call-on-a-call-payoff">Call-on-a-Call Payoff</h3>
<p>Let the underlying call option have exercise price <span class="math inline">\(K'\)</span> and maturity <span class="math inline">\(T'\)</span>. Consider an option maturing at <span class="math inline">\(T&lt;T'\)</span> to purchase the underlying call at price <span class="math inline">\(K\)</span>.</p>
<p>Let <span class="math inline">\(C(t,S)\)</span> denote the value at date <span class="math inline">\(t\)</span> of the underlying call when the stock price is <span class="math inline">\(S\)</span> (i.e., <span class="math inline">\(C\)</span> is the Black-Scholes formula). It is of course rational to exercise the compound call at date <span class="math inline">\(T\)</span> if the value of the underlying call exceeds <span class="math inline">\(K\)</span>; i.e., if <span class="math inline">\(C(T,S_T)&gt;K\)</span>. Let <span class="math inline">\(S^*\)</span> denote the critical price such that <span class="math inline">\(C(T,S^*)=K\)</span>. To calculate <span class="math inline">\(S^*\)</span>, we need to solve</p>
<p><code>Black_Scholes_Call(S*,Kprime,r,sigma,q,Tprime-T) = K</code></p>
<p>for <span class="math inline">\(S^*\)</span>. We can do this by bisection or one of the other methods mentioned in <a href="Chapter_BlackScholes.html#sec-s:impliedvolatility" class="quarto-xref"><span>Section 10.8</span></a>. It is rational to exercise the compound option when <span class="math inline">\(S_T &gt; S^*\)</span>.</p>
<p>When <span class="math inline">\(S_T &gt; S^*\)</span>, exercise of the compound option generates a cash flow of <span class="math inline">\(-K\)</span> at date <span class="math inline">\(T\)</span>. There is a cash flow (of <span class="math inline">\(S_{T'}-K'\)</span>) at date <span class="math inline">\(T'\)</span> only if the compound call is exercised and the underlying call finishes in the money. This is equivalent to: <span id="eq-compound1"><span class="math display">\[
S_T &gt; S^* \quad\text{and}\quad S_{T'}&gt;K'\;.
\qquad(15.13)\]</span></span></p>
<p>Let <span class="math display">\[\begin{align*}
x&amp;= \begin{cases} 1 &amp;\text{if $S_T&gt;S^*$\;,}\\
                               0 &amp; \text{otherwise\;,}
        \end{cases}\\
y&amp;= \begin{cases} 1 &amp;\text{if $S_T&gt;S^*$ and $S_{T'}&gt;K'$\;,}\\
                               0 &amp; \text{otherwise\;.}
        \end{cases}
\end{align*}\]</span> The cash flows of the compound option are <span class="math inline">\(-xK\)</span> at date <span class="math inline">\(T\)</span> and <span class="math inline">\(yS_{T'}-yK'\)</span> at date <span class="math inline">\(T'\)</span>. We can value the compound option at date <span class="math inline">\(0\)</span> by valuing these separate cash flows.</p>
<p>The cash flow <span class="math inline">\(-xK\)</span> is the cash flow from being short <span class="math inline">\(K\)</span> digital options on the underlying asset with strike price <span class="math inline">\(S^*\)</span> and maturity <span class="math inline">\(T\)</span>. Therefore the value at date <span class="math inline">\(0\)</span> of this cash flow is <span class="math inline">\(-\mathrm{e}^{-rT}K\mathrm{N}(d_2)\)</span>, where <span id="eq-calloncalld1d2"><span class="math display">\[
d_1 = \frac{\log\left(\frac{S_0}{S^*}\right)+\left(r-q+\frac{1}{2}\sigma^2\right)T}{\sigma\sqrt{T}},  \qquad d_2 = d_1-\sigma\sqrt{T}\;.
\qquad(15.14)\]</span></span></p>
</section>
<section id="numeraires" class="level3">
<h3 class="anchored" data-anchor-id="numeraires">Numeraires</h3>
<p>The payoffs <span class="math inline">\(yS_T\)</span> and <span class="math inline">\(yK'\)</span> are similar to share digitals and digitals, respectively, except that the event <span class="math inline">\(y=1\)</span> is more complex than we have previously encountered. However, we know from the analysis of share digitals and digitals that the values at date <span class="math inline">\(0\)</span> of these payoffs are <span class="math display">\[
\mathrm{e}^{-q T'}S_0\times\text{prob}^V\!(y=1) \quad \text{and}\quad \mathrm{e}^{-rT'}K'\times\text{prob}^R(y=1)\; ,
\]</span> where <span class="math inline">\(V_t=\mathrm{e}^{qt}S_t\)</span> and <span class="math inline">\(R_t=\mathrm{e}^{rt}\)</span>.</p>
</section>
<section id="calculating-probabilities-1" class="level3">
<h3 class="anchored" data-anchor-id="calculating-probabilities-1">Calculating Probabilities</h3>
<p>We will calculate the two probabilities in terms of the bivariate normal distribution function.</p>
<ol type="1">
<li>The event <span class="math inline">\(y=1\)</span> is equivalent to <span class="math display">\[
\log S_0 + \left(r-q+\frac{1}{2}\sigma^2\right)T+\sigma B^*_T &gt; \log S^*
\]</span> and <span class="math display">\[
\log S_0 + \left(r-q+\frac{1}{2}\sigma^2\right)T'+\sigma B^*_{T'} &gt; \log K'\; ,
\]</span> where <span class="math inline">\(B^*\)</span> is a Brownian motion when the underlying asset (<span class="math inline">\(V\)</span>) is used as the numeraire. These conditions can be rearranged as</li>
</ol>
<p><span id="eq-new10"><span class="math display">\[-\frac{B^*_T}{\sqrt{T}}&lt;d_1 \quad \text{and} \quad - \frac{B^*_{T'}}{\sqrt{T'}}&lt;d_1'\;,
\qquad(15.15)\]</span></span></p>
<p>where <span class="math inline">\(d_1\)</span> is defined in <a href="#eq-calloncalld1d2" class="quarto-xref">Equation&nbsp;<span>15.14</span></a>, and <span id="eq-callcallds"><span class="math display">\[
d_1' = \frac{\log\left(\frac{S_0}{K'}\right)+\left(r-q+\frac{1}{2}\sigma^2\right)T'}{\sigma\sqrt{T'}}\;,
\qquad d_2'=d_1'-\sigma\sqrt{T'}\;.
\qquad(15.16)\]</span></span></p>
<p>The two standard normal variables on the left-hand sides in <a href="#eq-new10" class="quarto-xref">Equation&nbsp;<span>15.15</span></a> have a covariance equal to <span class="math display">\[
\frac{1}{\sqrt{TT'}}\mathrm{cov}(B_T,B_{T'}) = \frac{1}{\sqrt{TT'}}\mathrm{cov}(B_T,B_T) = \sqrt{\frac{T}{T'}}\; ,
\]</span></p>
<p>the first equality following from the fact that <span class="math inline">\(B_T\)</span> is independent of <span class="math inline">\(B_{T'}-B_T\)</span> and the second from the fact that the covariance of a random variable with itself is its variance. Hence, <span class="math inline">\(\text{prob}^V\!(y=1)\)</span> is the probability that <span class="math inline">\(a\leq d_1\)</span> and <span class="math inline">\(b\leq d_1'\)</span>, where <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> are standard normal random variables with covariance (= correlation coefficient) of <span class="math inline">\(\sqrt{T/T'}\)</span>. We will write this probability as <span class="math inline">\(\mathrm{M}\!\left(d_1,d_1',\sqrt{T/T'}\right)\)</span>. A program to approximate the bivariate normal distribution function <span class="math inline">\(\mathrm{M}\)</span> is provided later.</p>
<ol start="2" type="1">
<li>The calculation for <span class="math inline">\(\text{prob}^R(y=1)\)</span> is similar. The event <span class="math inline">\(y=1\)</span> is equivalent to <span class="math display">\[
\log S_0 + \left(r-q+\frac{1}{2}\sigma^2\right)T+\sigma B^*_T &gt; \log S^*\;,
\]</span> and <span class="math display">\[
\log S_0 + \left(r-q+\frac{1}{2}\sigma^2\right)T'+\sigma B^*_{T'} &gt; \log K'\; ,
\]</span> where <span class="math inline">\(B^*\)</span> now denotes a Brownian motion under the risk-neutral probability. These are equivalent to <span id="eq-new11000"><span class="math display">\[
-\frac{B^*_T}{\sqrt{T}}&lt;d_2 \quad \text{and} \quad - \frac{B^*_{T'}}{\sqrt{T'}} &lt; d_2'\;.
\qquad(15.17)\]</span></span></li>
</ol>
<p>Hence, <span class="math inline">\(\text{prob}^R(y=1)=\mathrm{M}\!\left(d_2,d_2',\sqrt{T/T'}\right)\)</span>.</p>
</section>
<section id="call-on-a-call-pricing-formula" class="level3">
<h3 class="anchored" data-anchor-id="call-on-a-call-pricing-formula">Call-on-a-Call Pricing Formula</h3>
<p>We conclude:</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">15.5</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>The value of a call on a call is</p>
<p><span id="eq-marketmodel5"><span class="math display">\[
\begin{multline}
-\mathrm{e}^{-rT}K\mathrm{N}(d_2) + \mathrm{e}^{-q T'}S_0\mathrm{M}\!\left(d_1,d_1',\sqrt{T/T'}\right)
\\- \mathrm{e}^{-rT'}K'\mathrm{M}\!\left(d_2,d_2',\sqrt{T/T'}\right)\;,
\end{multline}
\qquad(15.18)\]</span></span></p>
<p>where <span class="math inline">\(d_1\)</span> and <span class="math inline">\(d_2\)</span> are defined in <a href="#eq-calloncalld1d2" class="quarto-xref">Equation&nbsp;<span>15.14</span></a> and <span class="math inline">\(d_1'\)</span> and <span class="math inline">\(d_2'\)</span> are defined in <a href="#eq-callcallds" class="quarto-xref">Equation&nbsp;<span>15.16</span></a>.</p>
</div>
</div>
</section>
<section id="put-call-parity" class="level3">
<h3 class="anchored" data-anchor-id="put-call-parity">Put-Call Parity</h3>
<p>European compound options with the same underlyings and strikes satisfy put-call parity in the usual way: <span class="math display">\[
\text{Cash} + \text{Call} = \text{Underlying} + \text{Put}\; .
\]</span></p>
<p>The portfolio on each side of this equation gives the owner the maximum of the strike and the value of the underlying at the option maturity. In the case of options on calls, put-call parity is specifically <span class="math display">\[\begin{multline*}
\mathrm{e}^{-rT}K + \text{Value of call on call} \\= \text{Value of underlying call} + \text{Value of put on call}\; ,
\end{multline*}\]</span> where <span class="math inline">\(K\)</span> is the strike price of the compound options and <span class="math inline">\(T\)</span> is their maturity date. Likewise, for options on puts, we have <span class="math display">\[\begin{multline*}
\mathrm{e}^{-rT}K + \text{Value of call on put} \\= \text{Value of underlying put} + \text{Value of put on put}\; .
\end{multline*}\]</span> Thus, the value of a put on a call can be derived from the value of a call on a call. The value of a put on a put can be derived from the value of a call on a put, which we will now consider.</p>
</section>
<section id="call-on-a-put-pricing-formula" class="level3">
<h3 class="anchored" data-anchor-id="call-on-a-put-pricing-formula">Call-on-a-Put Pricing Formula</h3>
<p>Consider a call option maturing at <span class="math inline">\(T\)</span> with strike <span class="math inline">\(K\)</span> with the underlying being a put option with strike <span class="math inline">\(K'\)</span> and maturity <span class="math inline">\(T'&gt;T\)</span>. The underlying of the put is the asset with price <span class="math inline">\(S\)</span> and constant volatility <span class="math inline">\(\sigma\)</span>. The call on the put will never be in the money at <span class="math inline">\(T\)</span> and hence is worthless if <span class="math inline">\(K&gt; \mathrm{e}^{-r(T'-T)}K'\)</span>, because the maximum possible value of the put option at date <span class="math inline">\(T\)</span> is <span class="math inline">\(\mathrm{e}^{-r(T'-T)}K'\)</span>. So assume <span class="math inline">\(K&lt; \mathrm{e}^{-r(T'-T)}K'\)</span>.</p>
<p>Let <span class="math inline">\(S^*\)</span> again denote the critical value of the stock price such that the call is at the money at date <span class="math inline">\(T\)</span> when <span class="math inline">\(S_T=S^*\)</span>. This means that <span class="math inline">\(S^*\)</span> solves</p>
<p><code>Black_Scholes_Put(S*,Kprime,r,sigma,q,Tprime-T) = K.</code></p>
<p>We leave it as an exercise to confirm the following.</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">15.6</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>The value of a call on a put is</p>
<p><span id="eq-callonaput"><span class="math display">\[
\begin{multline}
-\mathrm{e}^{-rT}K\mathrm{N}(-d_2) + \mathrm{e}^{-rT'}K'\mathrm{M}\!\left(-d_2,-d_2',\sqrt{T/T'}\right) \\- \mathrm{e}^{-q T'}S_0\mathrm{M}\!\left(-d_1,-d_1',\sqrt{T/T'}\right) \;,
\end{multline}
\qquad(15.19)\]</span></span></p>
<p>where <span class="math inline">\(d_1\)</span> and <span class="math inline">\(d_2\)</span> are defined in <a href="#eq-calloncalld1d2" class="quarto-xref">Equation&nbsp;<span>15.14</span></a> and <span class="math inline">\(d_1'\)</span> and <span class="math inline">\(d_2'\)</span> are defined in <a href="#eq-callcallds" class="quarto-xref">Equation&nbsp;<span>15.16</span></a>.</p>
</div>
</div>
<p>We will use bisection to find the critical price <span class="math inline">\(S^*\)</span>. We can use <span class="math inline">\(e^{q(T'-T)}(K+K')\)</span> as an upper bound for <span class="math inline">\(S^*\)</span> and 0 as a lower bound.^[We set the value of the call to be zero when the stock price is zero. The upper bound works because (by put-call parity and the fact that the put value is nonnegative) <span class="math inline">\(C(T,S) \geq e^{-q(T'-T)}S-e^{-r(T'-T)}K'\)</span>. Therefore, when <span class="math inline">\(S = e^{q(T'-T)}(K+K')\)</span>, we have <span class="math inline">\(C(T,S) \geq K + K' - e^{-r(T'-T)}K' &gt; K\)</span>. }<br>
The following uses <span class="math inline">\(10^{-6}\)</span> as the error tolerance in the bisection.</p>
<div id="call_on_call" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> black_scholes_call(S, K, r, sigma, q, T):</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Inputs:</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">    S = initial stock price</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">    K = strike price</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">    r = risk-free rate</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">    sigma = volatility</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">    q = dividend yield</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">    T = time to maturity</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> sigma <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">max</span>(<span class="dv">0</span>, np.exp(<span class="op">-</span>q <span class="op">*</span> T) <span class="op">*</span> S <span class="op">-</span> np.exp(<span class="op">-</span>r <span class="op">*</span> T) <span class="op">*</span> K)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        d1 <span class="op">=</span> (np.log(S <span class="op">/</span> K) <span class="op">+</span> (r <span class="op">-</span> q <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> sigma <span class="op">**</span> <span class="dv">2</span>) <span class="op">*</span> T) <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(T))</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        d2 <span class="op">=</span> d1 <span class="op">-</span> sigma <span class="op">*</span> np.sqrt(T)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        N1 <span class="op">=</span> norm.cdf(d1)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        N2 <span class="op">=</span> norm.cdf(d2)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.exp(<span class="op">-</span>q <span class="op">*</span> T) <span class="op">*</span> S <span class="op">*</span> N1 <span class="op">-</span> np.exp(<span class="op">-</span>r <span class="op">*</span> T) <span class="op">*</span> K <span class="op">*</span> N2</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> call_on_call(S, Kc, Ku, r, sigma, q, Tc, Tu):</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    tol <span class="op">=</span> <span class="fl">1e-6</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    lower <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    upper <span class="op">=</span> np.exp(q <span class="op">*</span> (Tu <span class="op">-</span> Tc)) <span class="op">*</span> (Kc <span class="op">+</span> Ku)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    guess <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> lower <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> upper</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    flower <span class="op">=</span> <span class="op">-</span>Kc</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    fupper <span class="op">=</span> black_scholes_call(upper, Ku, r, sigma, q, Tu <span class="op">-</span> Tc) <span class="op">-</span> Kc</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    fguess <span class="op">=</span> black_scholes_call(guess, Ku, r, sigma, q, Tu <span class="op">-</span> Tc) <span class="op">-</span> Kc</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> upper <span class="op">-</span> lower <span class="op">&gt;</span> tol:</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> fupper <span class="op">*</span> fguess <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>            lower <span class="op">=</span> guess</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>            flower <span class="op">=</span> fguess</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>            guess <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> lower <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> upper</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>            fguess <span class="op">=</span> black_scholes_call(guess, Ku, r, sigma, q, Tu <span class="op">-</span> Tc) <span class="op">-</span> Kc</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>            upper <span class="op">=</span> guess</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>            fupper <span class="op">=</span> fguess</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>            guess <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> lower <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> upper</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>            fguess <span class="op">=</span> black_scholes_call(guess, Ku, r, sigma, q, Tu <span class="op">-</span> Tc) <span class="op">-</span> Kc</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    Sstar <span class="op">=</span> guess</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    d1 <span class="op">=</span> (np.log(S <span class="op">/</span> Sstar) <span class="op">+</span> (r <span class="op">-</span> q <span class="op">+</span> sigma <span class="op">**</span> <span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>) <span class="op">*</span> Tc) <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(Tc))</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    d2 <span class="op">=</span> d1 <span class="op">-</span> sigma <span class="op">*</span> np.sqrt(Tc)</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    d1prime <span class="op">=</span> (np.log(S <span class="op">/</span> Ku) <span class="op">+</span> (r <span class="op">-</span> q <span class="op">+</span> sigma <span class="op">**</span> <span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>) <span class="op">*</span> Tu) <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(Tu))</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    d2prime <span class="op">=</span> d1prime <span class="op">-</span> sigma <span class="op">*</span> np.sqrt(Tu)</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    rho <span class="op">=</span> np.sqrt(Tc <span class="op">/</span> Tu)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    N2 <span class="op">=</span> norm.cdf(d2)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    M1 <span class="op">=</span> binormal_prob(d1, d1prime, rho)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    M2 <span class="op">=</span> binormal_prob(d2, d2prime, rho)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span>np.exp(<span class="op">-</span>r <span class="op">*</span> Tc) <span class="op">*</span> Kc <span class="op">*</span> N2 <span class="op">+</span> np.exp(<span class="op">-</span>q <span class="op">*</span> Tu) <span class="op">*</span> S <span class="op">*</span> M1 <span class="op">-</span> np.exp(<span class="op">-</span>r <span class="op">*</span> Tu) <span class="op">*</span> Ku <span class="op">*</span> M2</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>Kc <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>Ku <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.05</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>Tc <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>Tu <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Call on Call:", call_on_call(S, Kc, Ku, r, sigma, q, Tc, Tu))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The implementation of the call-on-a-put formula is of course very similar to that of a call-on-a-call. One difference is that there is no obvious upper bound for <span class="math inline">\(S^*\)</span>, so we start with <span class="math inline">\(2K'\)</span> (= <code>2*K2</code>) and double this until the value of the put is below <span class="math inline">\(K\)</span>. We can take 0 again to be the lower bound. Recall that we assume <span class="math inline">\(K&lt;\mathrm{e}^{-r(T'-T)}K'\)</span> and the right-hand side of this is the value of the put at date <span class="math inline">\(T\)</span> when <span class="math inline">\(S_T=0\)</span>.</p>
<div id="call_on_put" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> black_scholes_put(S, K, r, sigma, q, T):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Inputs:</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">    S = initial stock price</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    K = strike price</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">    r = risk-free rate</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">    sigma = volatility</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">    q = dividend yield</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">    T = time to maturity</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> sigma <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">max</span>(<span class="dv">0</span>, np.exp(<span class="op">-</span>r <span class="op">*</span> T) <span class="op">*</span> K <span class="op">-</span> np.exp(<span class="op">-</span>q <span class="op">*</span> T) <span class="op">*</span> S)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        d1 <span class="op">=</span> (np.log(S <span class="op">/</span> K) <span class="op">+</span> (r <span class="op">-</span> q <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> sigma <span class="op">**</span> <span class="dv">2</span>) <span class="op">*</span> T) <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(T))</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        d2 <span class="op">=</span> d1 <span class="op">-</span> sigma <span class="op">*</span> np.sqrt(T)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        N1 <span class="op">=</span> norm.cdf(<span class="op">-</span>d1)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        N2 <span class="op">=</span> norm.cdf(<span class="op">-</span>d2)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.exp(<span class="op">-</span>r <span class="op">*</span> T) <span class="op">*</span> K <span class="op">*</span> N2 <span class="op">-</span> np.exp(<span class="op">-</span>q <span class="op">*</span> T) <span class="op">*</span> S <span class="op">*</span> N1</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> call_on_put(S, Kc, Ku, r, sigma, q, Tc, Tu):</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    tol <span class="op">=</span> <span class="fl">1e-6</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    lower <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    flower <span class="op">=</span> np.exp(<span class="op">-</span>r <span class="op">*</span> (Tu <span class="op">-</span> Tc)) <span class="op">*</span> Ku <span class="op">-</span> Kc</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    upper <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> Ku</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    fupper <span class="op">=</span> black_scholes_put(upper, Ku, r, sigma, q, Tu <span class="op">-</span> Tc) <span class="op">-</span> Kc</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> fupper <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        upper <span class="op">*=</span> <span class="dv">2</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        fupper <span class="op">=</span> black_scholes_put(upper, Ku, r, sigma, q, Tu <span class="op">-</span> Tc) <span class="op">-</span> Kc</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    guess <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> lower <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> upper</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    fguess <span class="op">=</span> black_scholes_put(guess, Ku, r, sigma, q, Tu <span class="op">-</span> Tc) <span class="op">-</span> Kc</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> upper <span class="op">-</span> lower <span class="op">&gt;</span> tol:</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> fupper <span class="op">*</span> fguess <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>            lower <span class="op">=</span> guess</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>            flower <span class="op">=</span> fguess</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>            guess <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> lower <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> upper</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>            fguess <span class="op">=</span> black_scholes_put(guess, Ku, r, sigma, q, Tu <span class="op">-</span> Tc) <span class="op">-</span> Kc</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>            upper <span class="op">=</span> guess</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>            fupper <span class="op">=</span> fguess</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>            guess <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> lower <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> upper</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>            fguess <span class="op">=</span> black_scholes_put(guess, Ku, r, sigma, q, Tu <span class="op">-</span> Tc) <span class="op">-</span> Kc</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    Sstar <span class="op">=</span> guess</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    d1 <span class="op">=</span> (np.log(S <span class="op">/</span> Sstar) <span class="op">+</span> (r <span class="op">-</span> q <span class="op">+</span> sigma <span class="op">**</span> <span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>) <span class="op">*</span> Tc) <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(Tc))</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    d2 <span class="op">=</span> d1 <span class="op">-</span> sigma <span class="op">*</span> np.sqrt(Tc)</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    d1prime <span class="op">=</span> (np.log(S <span class="op">/</span> Ku) <span class="op">+</span> (r <span class="op">-</span> q <span class="op">+</span> sigma <span class="op">**</span> <span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>) <span class="op">*</span> Tu) <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(Tu))</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    d2prime <span class="op">=</span> d1prime <span class="op">-</span> sigma <span class="op">*</span> np.sqrt(Tu)</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    rho <span class="op">=</span> np.sqrt(Tc <span class="op">/</span> Tu)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    N2 <span class="op">=</span> norm.cdf(<span class="op">-</span>d2)</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    M1 <span class="op">=</span> binormal_prob(<span class="op">-</span>d1, <span class="op">-</span>d1prime, rho)</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    M2 <span class="op">=</span> binormal_prob(<span class="op">-</span>d2, <span class="op">-</span>d2prime, rho)</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span>np.exp(<span class="op">-</span>r <span class="op">*</span> Tc) <span class="op">*</span> Kc <span class="op">*</span> N2 <span class="op">+</span> np.exp(<span class="op">-</span>r <span class="op">*</span> Tu) <span class="op">*</span> Ku <span class="op">*</span> M2 <span class="op">-</span> np.exp(<span class="op">-</span>q <span class="op">*</span> Tu) <span class="op">*</span> S <span class="op">*</span> M1</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>Kc <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>Ku <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.05</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>Tc <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>Tu <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Call on Put:", call_on_put(S, Kc, Ku, r, sigma, q, Tc, Tu))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="options-on-the-max-or-min" class="level2" data-number="15.7">
<h2 data-number="15.7" class="anchored" data-anchor-id="options-on-the-max-or-min"><span class="header-section-number">15.7</span> Options on the Max or Min</h2>
<p>We will consider here an option written on the maximum or minimum of two asset prices; for example, a call on the maximum pays <span class="math display">\[
\max(0,\max(S_1_T, S_2_T)-K) = \max(0,S_1_T-K,S_2_T-K)
\]</span> at maturity <span class="math inline">\(T\)</span>. There are also call options on <span class="math inline">\(\min(S_1_T, S_2_T)\)</span> and put options on the maximum and minimum of two (or more) asset prices. Pricing formulas for these options are due to Stulz <span class="citation" data-cites="Stulz">(<a href="#ref-Stulz" role="doc-biblioref">Stulz 1982</a>)</span>, who also discusses applications. We will assume the two assets have constant dividend yields <span class="math inline">\(q_i\)</span>, constant volatilities <span class="math inline">\(\sigma_i\)</span>, and a constant correlation <span class="math inline">\(\rho\)</span>.</p>
<section id="call-on-the-max-payoff" class="level3">
<h3 class="anchored" data-anchor-id="call-on-the-max-payoff">Call-on-the-Max Payoff</h3>
<p>To value the above option, define the random variables: <span class="math display">\[\begin{align*}
x&amp;= \begin{cases} 1 &amp; \text{if $S_1_T&gt;S_2_T$ and $S_1_T&gt;K$}\; ,\\
0 &amp; \text{otherwise}\;, \end{cases}\\
y&amp;= \begin{cases} 1 &amp; \text{if $S_2_T&gt; S_1_T$ and $S_2_T&gt;K$}\; ,\\
0 &amp; \text{otherwise}\;, \end{cases}\\
z&amp;= \begin{cases} 1 &amp; \text{if $S_1_T &gt; K$ or $S_2_T&gt; K$}\; ,\\
0 &amp; \text{otherwise}\;. \end{cases}
\end{align*}\]</span> Then the value of the option at maturity is <span class="math display">\[xS_1_T + yS_2_T - zK\; .\]</span> ### Numeraires Consider numeraires <span class="math inline">\(V_1_t = \mathrm{e}^{q_1t}S_1_t\)</span>, <span class="math inline">\(V_2_t=\mathrm{e}^{q_2t}S_2_t\)</span>, and <span class="math inline">\(R_t=\mathrm{e}^{rt}\)</span>. By familiar arguments, the value of the option at date <span class="math inline">\(0\)</span> is <span class="math display">\[\begin{multline*}
\mathrm{e}^{-q_1T}S_1_0\times\text{prob}^{V_1}(x=1) + \mathrm{e}^{-q_2T}S_2_0\times\text{prob}^{V_2}(y=1) \\- \mathrm{e}^{-rT}K\times\text{prob}^R(z=1)\; .
\end{multline*}\]</span></p>
</section>
<section id="calculating-probabilities-2" class="level3">
<h3 class="anchored" data-anchor-id="calculating-probabilities-2">Calculating Probabilities</h3>
<ol type="1">
<li>We will begin by calculating <span class="math inline">\(\text{prob}^{V_1}(x=1)\)</span>. From the second and third examples in <span class="quarto-unresolved-ref">?sec-s:girsanov</span>, the asset prices satisfy <span class="math display">\[\begin{align*}
\frac{\,\mathrm{d}S_1}{S_1} &amp;= (r-q_1+\sigma^2_1)\,\mathrm{d}t + \sigma_1\,\mathrm{d}B^*_{1}\; ,\\
\frac{\,\mathrm{d}S_2}{S_2} &amp;= (r-q_2+\rho\sigma_1\sigma_2)\,\mathrm{d}t + \sigma_2\,\mathrm{d}B^*_{2}\;,
\end{align*}\]</span> where <span class="math inline">\(B^*_{1}\)</span> and <span class="math inline">\(B^*_{2}\)</span> are Brownian motions when we use <span class="math inline">\(V_1\)</span> as the numeraire. Thus, <span class="math display">\[\begin{align*}
\log S_1_T &amp;= \log S_1_0 + \left(r-q_1+\frac{1}{2}\sigma_1^2\right)T +\sigma_1B^*_{1}_T\; ,\\
\log S_2_T &amp;= \log S_2_0 + \left(r-q_2+\rho\sigma_1\sigma_2-\frac{1}{2}\sigma_2^2\right)T +\sigma_2B^*_{2}_T\;.
\end{align*}\]</span> The condition <span class="math inline">\(\log S_1_T &gt; \log K\)</span> is therefore equivalent to</li>
</ol>
<p><span id="eq-max1"><span class="math display">\[
  -\frac{1}{\sqrt{T}}B^*_{1}_T &lt; d_{11}\;,
\qquad(15.20)\]</span></span></p>
<p>and the condition <span class="math inline">\(\log S_1_T&gt;\log S_2_T\)</span> is equivalent to <span id="eq-max2"><span class="math display">\[
\frac{\sigma_2B^*_{2}_T-\sigma_1B^*_{1}_T}{\sigma\sqrt{T}} &lt; d_1\;,
\qquad(15.21)\]</span></span></p>
<p>where <span id="eq-max2a"><span class="math display">\[
\sigma =\sqrt{\sigma_1^2-2\rho\sigma_1\sigma_2+\sigma_2^2}\;,
\qquad(15.22)\]</span></span></p>
<p>and</p>
<p><span id="eq-max4"><span class="math display">\[
d_1 = \frac{\log\left(\frac{S_1_0}{S_2_0}\right)+\left(q_2-q_1+\frac{1}{2}\sigma^2\right)T}{\sigma\sqrt{T}}\;, \qquad d_2 = d_1 - \sigma\sqrt{T}\;,
\qquad(15.23)\]</span></span></p>
<p><span id="eq-max3"><span class="math display">\[
d_{11}=\frac{\log\left(\frac{S_1_0}{K}\right)+\left(r-q_1+\frac{1}{2}\sigma_1^2\right)T}{\sigma_1\sqrt{T}}\;, \qquad d_{12} = d_{11} - \sigma_1\sqrt{T}\;.
\qquad(15.24)\]</span></span></p>
<p>The random variables on the left-hand sides of <a href="#eq-max1" class="quarto-xref">Equation&nbsp;<span>15.20</span></a> - <a href="#eq-max2" class="quarto-xref">Equation&nbsp;<span>15.21</span></a> have standard normal distributions and their correlation is <span class="math display">\[
\rho_1 = \frac{\sigma_1-\rho\sigma_2}{\sigma}\; .
\]</span> Therefore, <span class="math display">\[\begin{equation*}
\text{prob}^{V_1}(x=1) = \mathrm{M}(d_{11},d_1,\rho_1)\;,
\end{equation*}\]</span> where <span class="math inline">\(\mathrm{M}\)</span> again denotes the bivariate normal distribution function.</p>
<ol start="2" type="1">
<li>The probability <span class="math inline">\(\text{prob}^{V_2}(y=1)\)</span> is exactly symmetric to <span class="math inline">\(\text{prob}^{V_1}(x=1)\)</span>, with the roles of <span class="math inline">\(S_1\)</span> and <span class="math inline">\(S_2\)</span> interchanged. Note that the mirror image of <span class="math inline">\(d_1\)</span> defined in <a href="#eq-max4" class="quarto-xref">Equation&nbsp;<span>15.23</span></a> is <span class="math display">\[
\frac{\log\left(\frac{S_2_0}{S_1_0}\right)+\left(q_1-q_2+\frac{1}{2}\sigma^2\right)T}{\sigma\sqrt{T}}\; ,
\]</span> which equals <span class="math inline">\(-d_2\)</span>. Therefore, <span class="math display">\[\begin{equation*}
\text{prob}^{V_2}(y=1) = \mathrm{M}(d_{21},-d_2,\rho_2)\;,
\end{equation*}\]</span> where <span id="eq-max31"><span class="math display">\[
d_{21}=\frac{\log\left(\frac{S_2_0}{K}\right)+\left(r-q_2+\frac{1}{2}\sigma_2^2\right)T}{\sigma_2\sqrt{T}},\qquad d_{22} = d_{21}-\sigma_2\sqrt{T}\;,
\qquad(15.25)\]</span></span></li>
</ol>
<p>and <span class="math display">\[
\rho_2 = \frac{\sigma_2-\rho\sigma_1}{\sigma}\; .
\]</span> 3. As usual, we have <span class="math display">\[\begin{align*}
\log S_1_T &amp;= \log S_1_0 + \left(r-q_1-\frac{1}{2}\sigma_1^2\right)T +\sigma_1B^*_{1}_T\; ,\\
\log S_2_T &amp;= \log S_2_0 + \left(r-q_2-\frac{1}{2}\sigma_2^2\right)T +\sigma_2B^*_{2}_T\;,
\end{align*}\]</span> where <span class="math inline">\(B^*_{1}\)</span> and <span class="math inline">\(B^*_{2}\)</span> now denote Brownian motions under the risk-neutral probability. The event <span class="math inline">\(z=1\)</span> is the complement of the event <span class="math display">\[
S_1_T\leq K \quad \text{and} \quad S_2_T\leq K\; ,
\]</span> which is equivalent to</p>
<p><span id="eq-max32"><span class="math display">\[
\frac{1}{\sqrt{T}}B^*_{1}_T &lt; -d_{12}\;,
\qquad(15.26)\]</span></span></p>
<p>and <span id="eq-max42"><span class="math display">\[
\frac{1}{\sqrt{T}}B^*_{2}_T &lt; -d_{22}\;.
\qquad(15.27)\]</span></span></p>
<p>The random variables on the left-hand sides of <a href="#eq-max32" class="quarto-xref">Equation&nbsp;<span>15.26</span></a> and <a href="#eq-max42" class="quarto-xref">Equation&nbsp;<span>15.27</span></a> are standard normals and have correlation <span class="math inline">\(\rho\)</span>. Therefore, <span class="math display">\[\begin{equation*}
\text{prob}^{R}(z=1) = 1- \mathrm{M}(-d_{12},-d_{22},\rho)\;.
\end{equation*}\]</span></p>
</section>
<section id="call-on-the-max-pricing-formula" class="level3">
<h3 class="anchored" data-anchor-id="call-on-the-max-pricing-formula">Call-on-the-Max Pricing Formula</h3>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">15.8</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>The value of a call option on the maximum of two risky asset prices with volatilities <span class="math inline">\(\sigma_1\)</span> and <span class="math inline">\(\sigma_2\)</span> and correlation <span class="math inline">\(\rho\)</span> is</p>
<p><span id="eq-callonmaxformula"><span class="math display">\[
\begin{multline}
\mathrm{e}^{-q_1T}S_1_0\mathrm{M}\!\left(d_{11},d_1,\frac{\sigma_1-\rho\sigma_2}{\sigma}\right) + \mathrm{e}^{-q_2T}S_2_0\mathrm{M}\!\left(d_{21},-d_2,\frac{\sigma_2-\rho\sigma_1}{\sigma}\right)\\+ \mathrm{e}^{-rT}K\mathrm{M}(-d_{12},-d_{22},\rho) - \mathrm{e}^{-rT}K\;,
\end{multline}
\qquad(15.28)\]</span></span></p>
<p>where <span class="math inline">\(\sigma\)</span> is defined in <a href="#eq-max2a" class="quarto-xref">Equation&nbsp;<span>15.22</span></a> and <span class="math inline">\(d_1\)</span>, <span class="math inline">\(d_2\)</span>, <span class="math inline">\(d_{11}\)</span>, <span class="math inline">\(d_{12}\)</span>, <span class="math inline">\(d_{21}\)</span> and <span class="math inline">\(d_{22}\)</span> are defined in <a href="#eq-max4" class="quarto-xref">Equation&nbsp;<span>15.23</span></a> - <a href="#eq-max3" class="quarto-xref">Equation&nbsp;<span>15.24</span></a>.</p>
</div>
</div>
<p>The following code shows how to compute the price of a Call on the Max.</p>
<div id="call_on_max" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> call_on_max(S1, S2, K, r, sig1, sig2, rho, q1, q2, T):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    sigma <span class="op">=</span> np.sqrt(sig2 <span class="op">**</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> rho <span class="op">*</span> sig1 <span class="op">*</span> sig2 <span class="op">+</span> sig1 <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    d1 <span class="op">=</span> (np.log(S1 <span class="op">/</span> S2) <span class="op">+</span> (q2 <span class="op">-</span> q1 <span class="op">+</span> sigma <span class="op">**</span> <span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>) <span class="op">*</span> T) <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(T))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    d2 <span class="op">=</span> d1 <span class="op">-</span> sigma <span class="op">*</span> np.sqrt(T)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    d11 <span class="op">=</span> (np.log(S1 <span class="op">/</span> K) <span class="op">+</span> (r <span class="op">-</span> q1 <span class="op">+</span> sig1 <span class="op">**</span> <span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>) <span class="op">*</span> T) <span class="op">/</span> (sig1 <span class="op">*</span> np.sqrt(T))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    d12 <span class="op">=</span> d11 <span class="op">-</span> sig1 <span class="op">*</span> np.sqrt(T)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    d21 <span class="op">=</span> (np.log(S2 <span class="op">/</span> K) <span class="op">+</span> (r <span class="op">-</span> q2 <span class="op">+</span> sig2 <span class="op">**</span> <span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>) <span class="op">*</span> T) <span class="op">/</span> (sig2 <span class="op">*</span> np.sqrt(T))</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    d22 <span class="op">=</span> d21 <span class="op">-</span> sig2 <span class="op">*</span> np.sqrt(T)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    rho1 <span class="op">=</span> (sig1 <span class="op">-</span> rho <span class="op">*</span> sig2) <span class="op">/</span> sigma</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    rho2 <span class="op">=</span> (sig2 <span class="op">-</span> rho <span class="op">*</span> sig1) <span class="op">/</span> sigma</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    M1 <span class="op">=</span> binormal_prob(d11, d1, rho1)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    M2 <span class="op">=</span> binormal_prob(d21, <span class="op">-</span>d2, rho2)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    M3 <span class="op">=</span> binormal_prob(<span class="op">-</span>d12, <span class="op">-</span>d22, rho)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.exp(<span class="op">-</span>q1 <span class="op">*</span> T) <span class="op">*</span> S1 <span class="op">*</span> M1 <span class="op">+</span> np.exp(<span class="op">-</span>q2 <span class="op">*</span> T) <span class="op">*</span> S2 <span class="op">*</span> M2 <span class="op">+</span> np.exp(<span class="op">-</span>r <span class="op">*</span> T) <span class="op">*</span> K <span class="op">*</span> M3 <span class="op">-</span> np.exp(<span class="op">-</span>r <span class="op">*</span> T) <span class="op">*</span> K</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>S1 <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>S2<span class="op">=</span> <span class="dv">100</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.05</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>sigma1 <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>sigma2 <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>q1 <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>q2<span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>T<span class="op">=</span><span class="dv">1</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>rho<span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Call on Max:", call_on_max(S1, S2, K, r, sigma1, sigma2, rho, q1, q2, T))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="forward-start-options" class="level2" data-number="15.9">
<h2 data-number="15.9" class="anchored" data-anchor-id="forward-start-options"><span class="header-section-number">15.9</span> Forward-Start Options</h2>
<p>A forward-start option is an option for which the strike price is set equal to the stock price at some later date. In essence, it is issued at the later date, with the strike price set at the money. For example, an executive may know that he is to be given an option grant at some later date with the strike price set equal to the stock price at that date.</p>
<section id="forward-start-call-payoff" class="level3">
<h3 class="anchored" data-anchor-id="forward-start-call-payoff">Forward-Start Call Payoff</h3>
<p>A forward-start call is defined by its maturity date <span class="math inline">\(T'\)</span> and the date <span class="math inline">\(T&lt;T'\)</span> at which the strike price is set. The value of a forward-start call at maturity is <span class="math display">\[\max(0,S_{T'}-S_T)\; .\]</span> Let <span class="math display">\[x= \begin{cases} 1 &amp;\text{if $S_{T'}&gt;S_T$\;,}\\
                               0 &amp; \text{otherwise\;.}
        \end{cases}
\]</span> Then, the value of the call at maturity can be written as <span class="math display">\[xS_{T'}-xS_T\; .\]</span> ### Numeraires</p>
<ol type="1">
<li>Use <span class="math inline">\(V_t=\mathrm{e}^{qt}S_t\)</span> as numeraire to price the payoff <span class="math inline">\(xS_{T'}\)</span>. From the fundamental pricing <a href="Chapter_Arbitrage.html#eq-formula" class="quarto-xref">Equation&nbsp;<span>7.28</span></a>, the value at date <span class="math inline">\(0\)</span> is <span class="math display">\[\mathrm{e}^{-qT'}S_0\\E^V[x] = \mathrm{e}^{-qT'}S_0\times \text{prob}^V\!(S_{T'}&gt;S_T)\; .\]</span></li>
<li>To price the payoff <span class="math inline">\(xS_T\)</span>, use the following portfolio as numeraire:<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>purchase <span class="math inline">\(\mathrm{e}^{-qT}\)</span> shares of the stock at date <span class="math inline">\(0\)</span> and reinvest dividends until date <span class="math inline">\(T\)</span>. This will result in the ownership of one share at date <span class="math inline">\(T\)</span>, worth <span class="math inline">\(S_T\)</span> dollars. At date <span class="math inline">\(T\)</span>, sell the share and invest the proceeds in the risk-free asset and hold this position until date <span class="math inline">\(T'\)</span>. At date <span class="math inline">\(T'\)</span>, the portfolio will be worth <span class="math inline">\(\mathrm{e}^{r(T'-T)}S_T\)</span>. Let <span class="math inline">\(Z_t\)</span> denote the value of this portfolio for each <span class="math inline">\(0\leq t\leq T'\)</span>. The fundamental pricing <a href="Chapter_Arbitrage.html#eq-formula" class="quarto-xref">Equation&nbsp;<span>7.28</span></a> implies that the value of receiving <span class="math inline">\(xS_T\)</span> at date <span class="math inline">\(T'\)</span> is <span class="math display">\[\begin{align*}
Z_0\\E^Z\left[ \frac{xS_T}{Z_{T'}}\right] &amp;=
\mathrm{e}^{-qT}S_0\\E^Z\left[ \frac{xS_T}{\mathrm{e}^{r(T'-T)}S_T}\right]\\&amp;= \mathrm{e}^{-qT-r(T'-T)}S_0\\E^Z[x] \\&amp;= \mathrm{e}^{-qT-r(T'-T)}S_0 \times\text{prob}^Z(S_{T'}&gt;S_T)\;.
\end{align*}\]</span></li>
</ol>
</section>
<section id="calculating-probabilities-3" class="level3">
<h3 class="anchored" data-anchor-id="calculating-probabilities-3">Calculating Probabilities</h3>
<ol type="1">
<li>As in the case of a share digital, we know that <span class="math display">\[
\log S_t = \log S_0 + \left(r-q +\frac{1}{2}\sigma^2\right)t + \sigma B^*_t
\]</span> for all <span class="math inline">\(t&gt;0\)</span>, where <span class="math inline">\(B^*\)</span> is a Brownian motion when <span class="math inline">\(V\)</span> is used as the numeraire. Taking <span class="math inline">\(t=T'\)</span> and <span class="math inline">\(t=T\)</span> and subtracting yields <span class="math display">\[\log S_{T'}-\log S_T = \left(r-q +\frac{1}{2}\sigma^2\right)(T'-T) + \sigma \left[B^*_{T'}-B^*_T\right]\; .\]</span> Hence, <span class="math inline">\(S_{T'}&gt;S_T\)</span> if and only if <span class="math display">\[-\frac{B^*_{T'}-B^*_T}{\sqrt{T'-T}} &lt; \frac{\left(r-q +\frac{1}{2}\sigma^2\right)(T'-T)}{\sigma\sqrt{T'-T}}\; .\]</span> The random variable on the left hand side is a standard normal, so <span class="math display">\[
\text{prob}^V\!(S_{T'}&gt;S_T) = \mathrm{N}(d_1)\; ,
\]</span> where</li>
</ol>
<p><span id="eq-forwardstart_d1"><span class="math display">\[
d_1 = \frac{\left(r-q +\frac{1}{2}\sigma^2\right)(T'-T)}{\sigma\sqrt{T'-T}} =\frac{\left(r-q +\frac{1}{2}\sigma^2\right)\sqrt{T'-T}}{\sigma}\;.
\qquad(15.29)\]</span></span></p>
<ol start="2" type="1">
<li>To calculate the probability <span class="math inline">\(\text{prob}^Z(S_{T'}&gt;S_T)\)</span>, note that between <span class="math inline">\(T\)</span> and <span class="math inline">\(T'\)</span>, the portfolio with price <span class="math inline">\(Z\)</span> earns the risk-free rate <span class="math inline">\(r\)</span>. The same argument presented in <span class="quarto-unresolved-ref">?sec-s:girsanov</span> shows that between <span class="math inline">\(T\)</span> and <span class="math inline">\(T'\)</span> we have <span class="math display">\[
\frac{\,\mathrm{d}S}{S} = (r-q)\,\mathrm{d}t + \sigma\,\mathrm{d}B^*\; ,
\]</span> where now <span class="math inline">\(B^*\)</span> denotes a Brownian motion when <span class="math inline">\(Z\)</span> is used as the numeraire. This implies as usual that <span class="math display">\[
\,\mathrm{d}\log S = \left(r-q-\frac{1}{2}\sigma^2\right)\,\mathrm{d}t + \sigma\,\mathrm{d}B^*\; ,
\]</span> which means that <span class="math display">\[
\log S_{T'} - \log S_T = \left(r-q-\frac{1}{2}\sigma^2\right)(T'-T) + \sigma(B^*_{T'}-B^*_T)\; .
\]</span> Hence, <span class="math inline">\(S_{T'}&gt;S_T\)</span> if and only if <span class="math display">\[
-\frac{B^*_{T'}-B^*_T}{\sqrt{T'-T}} &lt; \frac{\left(r-q -\frac{1}{2}\sigma^2\right)(T'-T)}{\sigma\sqrt{T'-T}}\; .
\]</span> As before, the random variable on the left hand side is a standard normal, so <span class="math display">\[
\text{prob}^Z(S_{T'}&gt;S_T) = \mathrm{N}(d_2)\; ,
\]</span> where <span id="eq-forwardstart_d2"><span class="math display">\[
d_2 = \frac{\left(r-q -\frac{1}{2}\sigma^2\right)\sqrt{T'-T}}{\sigma}=d_1-\sigma\sqrt{T'-T}\;.
\qquad(15.30)\]</span></span></li>
</ol>
</section>
<section id="forward-start-call-pricing-formula" class="level3">
<h3 class="anchored" data-anchor-id="forward-start-call-pricing-formula">Forward-Start Call Pricing Formula</h3>
<p>Combining these results, we have:</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">15.10</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>The value of a forward-start call at date <span class="math inline">\(0\)</span> is <span id="eq-fstrikecall"><span class="math display">\[
\mathrm{e}^{-qT'}S_0\mathrm{N}(d_1) - \mathrm{e}^{-qT-r(T'-T)}S_0\mathrm{N}(d_2)\;,
\qquad(15.31)\]</span></span></p>
<p>where <span class="math inline">\(d_1\)</span> and <span class="math inline">\(d_2\)</span> are defined in <a href="#eq-forwardstart_d1" class="quarto-xref">Equation&nbsp;<span>15.29</span></a> - <a href="#eq-forwardstart_d2" class="quarto-xref">Equation&nbsp;<span>15.30</span></a>.</p>
</div>
</div>
</section>
<section id="put-call-parity-1" class="level3">
<h3 class="anchored" data-anchor-id="put-call-parity-1">Put-Call Parity</h3>
<p>Forward-strike calls and puts satisfy a somewhat unusual form of put-call parity. The usual put-call parity is of the form: <span class="math display">\[
\text{Call} \;+\; \text{Cash} \quad = \quad \text{Put} \;+ \;\text{Underlying}\; .
\]</span></p>
<p>The amount of cash is the amount that will accumulate to the exercise price at maturity; i.e., it is <span class="math inline">\(\mathrm{e}^{-rT'}K\)</span>. For forward-start calls and puts, the effective exercise price is <span class="math inline">\(S_T\)</span>, which is not known at date <span class="math inline">\(0\)</span>. However, the portfolio used as numeraire to value the second part of the payoff will be worth <span class="math inline">\(\mathrm{e}^{r(T'-T)}S_T\)</span> at date <span class="math inline">\(T'\)</span>, and by following the same strategy but starting with <span class="math inline">\(\mathrm{e}^{-r(T'-T)-qT}\)</span> instead of <span class="math inline">\(\mathrm{e}^{-qT}\)</span> shares, we will have <span class="math inline">\(S_T\)</span> dollars at date <span class="math inline">\(T'\)</span>. The date–0 value of this portfolio should replace Cash in the above. Thus:</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">15.11</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Put-call parity for forward-start calls and puts is <span id="eq-fstrikeparity"><span class="math display">\[
\text{Call Price} \;+\; \mathrm{e}^{-r(T'-T)-qT}S_0 = \text{Put Price} \;+\; \mathrm{e}^{-qT'}S_0\;.
\qquad(15.32)\]</span></span></p>
<p>The new features in the option pricing formulas in this chapter are the use of the bivariate normal distribution function and sometimes the need to compute a critical (at-the-money) value of the underlying asset price. We will compute the critical values by bisection, in the same way that we computed implied volatilities for the Black-Scholes formula in <a href="Chapter_BlackScholes.html" class="quarto-xref"><span>Chapter 10</span></a>.</p>
<p>The following is a fast approximation of the bivariate cumulative normal distribution function, accurate to six decimal places, due to Drezner <span class="citation" data-cites="Drezner">(<a href="#ref-Drezner" role="doc-biblioref">Drezner 1978</a>)</span>). For given numbers <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>, this function gives the probability that <span class="math inline">\(\xi_1&lt;a\)</span> and <span class="math inline">\(\xi_2&lt;b\)</span> where <span class="math inline">\(\xi_1\)</span> and <span class="math inline">\(\xi_2\)</span> are standard normal random variables with a given correlation <span class="math inline">\(\rho\)</span>, which we must input.</p>
<div id="binormal_prob" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> binormal_prob(a, b, rho):</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.array([<span class="fl">0.24840615</span>, <span class="fl">0.39233107</span>, <span class="fl">0.21141819</span>, <span class="fl">0.03324666</span>, <span class="fl">0.00082485334</span>])</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> np.array([<span class="fl">0.10024215</span>, <span class="fl">0.48281397</span>, <span class="fl">1.0609498</span>, <span class="fl">1.7797294</span>, <span class="fl">2.6697604</span>])</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    a1 <span class="op">=</span> a <span class="op">/</span> np.sqrt(<span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> rho <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    b1 <span class="op">=</span> b <span class="op">/</span> np.sqrt(<span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> rho <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> a <span class="op">&lt;=</span> <span class="dv">0</span> <span class="kw">and</span> b <span class="op">&lt;=</span> <span class="dv">0</span> <span class="kw">and</span> rho <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        total_sum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                z1 <span class="op">=</span> a1 <span class="op">*</span> (<span class="dv">2</span> <span class="op">*</span> y[i] <span class="op">-</span> a1)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                Z2 <span class="op">=</span> b1 <span class="op">*</span> (<span class="dv">2</span> <span class="op">*</span> y[j] <span class="op">-</span> b1)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                z3 <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> rho <span class="op">*</span> (y[i] <span class="op">-</span> a1) <span class="op">*</span> (y[j] <span class="op">-</span> b1)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                total_sum <span class="op">+=</span> x[i] <span class="op">*</span> x[j] <span class="op">*</span> np.exp(z1 <span class="op">+</span> Z2 <span class="op">+</span> z3)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> total_sum <span class="op">*</span> np.sqrt(<span class="dv">1</span> <span class="op">-</span> rho <span class="op">**</span> <span class="dv">2</span>) <span class="op">/</span> np.pi</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> a <span class="op">&lt;=</span> <span class="dv">0</span> <span class="kw">and</span> b <span class="op">&gt;=</span> <span class="dv">0</span> <span class="kw">and</span> rho <span class="op">&gt;=</span> <span class="dv">0</span>:</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> norm.cdf(a) <span class="op">-</span> binormal_prob(a, <span class="op">-</span>b, <span class="op">-</span>rho)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> a <span class="op">&gt;=</span> <span class="dv">0</span> <span class="kw">and</span> b <span class="op">&lt;=</span> <span class="dv">0</span> <span class="kw">and</span> rho <span class="op">&gt;=</span> <span class="dv">0</span>:</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> norm.cdf(b) <span class="op">-</span> binormal_prob(<span class="op">-</span>a, b, <span class="op">-</span>rho)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> a <span class="op">&gt;=</span> <span class="dv">0</span> <span class="kw">and</span> b <span class="op">&gt;=</span> <span class="dv">0</span> <span class="kw">and</span> rho <span class="op">&lt;=</span> <span class="dv">0</span>:</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        total_sum <span class="op">=</span> norm.cdf(a) <span class="op">+</span> norm.cdf(b)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> total_sum <span class="op">-</span> <span class="dv">1</span> <span class="op">+</span> binormal_prob(<span class="op">-</span>a, <span class="op">-</span>b, rho)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> a <span class="op">*</span> b <span class="op">*</span> rho <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        rho1 <span class="op">=</span> (rho <span class="op">*</span> a <span class="op">-</span> b) <span class="op">*</span> np.sign(a) <span class="op">/</span> np.sqrt(a <span class="op">**</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> rho <span class="op">*</span> a <span class="op">*</span> b <span class="op">+</span> b <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        rho2 <span class="op">=</span> (rho <span class="op">*</span> b <span class="op">-</span> a) <span class="op">*</span> np.sign(b) <span class="op">/</span> np.sqrt(a <span class="op">**</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> rho <span class="op">*</span> a <span class="op">*</span> b <span class="op">+</span> b <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        Delta <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> np.sign(a) <span class="op">*</span> np.sign(b)) <span class="op">/</span> <span class="dv">4</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> binormal_prob(a, <span class="dv">0</span>, rho1) <span class="op">+</span> binormal_prob(b, <span class="dv">0</span>, rho2) <span class="op">-</span> Delta</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="co"># print("BiNormalProb:", binormal_prob(0.1, 0.2, 0.3))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Notice that this function calls itself. This is an example of recursion.</p>
<p>The forward-start call pricing formula is of the same form as the Black-Scholes, Margrabe, Black, and Merton formulas. We can compute it with our <code>Generic_Option</code> pricing function.</p>
<div id="forward_start_call" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generic_option(P1, P2, sigma, T):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Inputs:</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">    P1 = present value of asset to be received</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">    P2 = present value of asset to be delivered</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">    sigma = volatility</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">    T = time to maturity</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> (np.log(P1 <span class="op">/</span> P2) <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> sigma <span class="op">**</span> <span class="dv">2</span> <span class="op">*</span> T) <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(T))</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> x <span class="op">-</span> sigma <span class="op">*</span> np.sqrt(T)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    N1 <span class="op">=</span> norm.cdf(x)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    N2 <span class="op">=</span> norm.cdf(y)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> P1 <span class="op">*</span> N1 <span class="op">-</span> P2 <span class="op">*</span> N2</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> forward_start_call(S, r, sigma, q, Tset, TCall):</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    P1 <span class="op">=</span> np.exp(<span class="op">-</span>q <span class="op">*</span> TCall) <span class="op">*</span> S</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    P2 <span class="op">=</span> np.exp(<span class="op">-</span>q <span class="op">*</span> Tset <span class="op">-</span> r <span class="op">*</span> (TCall <span class="op">-</span> Tset)) <span class="op">*</span> S</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> generic_option(P1, P2, sigma, TCall <span class="op">-</span> Tset)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.05</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>Div <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>TDiv <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>TCall <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Forward Start Call:", forward_start_call(S, r, sigma, q, 0.5, TCall))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</section>
</section>
<section id="sec-s:choosers" class="level2" data-number="15.12">
<h2 data-number="15.12" class="anchored" data-anchor-id="sec-s:choosers"><span class="header-section-number">15.12</span> Choosers</h2>
<p>A chooser option allows the holder to choose whether the option will be a put or call at some fixed date before the option maturity. Let <span class="math inline">\(T\)</span> denote the date at which the choice is made, <span class="math inline">\(T_c\)</span> the date at which the call expires, <span class="math inline">\(T_p\)</span> the date at which the put expires, <span class="math inline">\(K_c\)</span> the exercise price of the call, and <span class="math inline">\(K_p\)</span> the exercise price of the put, where <span class="math inline">\(0&lt;T&lt;T_c\)</span> and <span class="math inline">\(0&lt;T&lt;T_p\)</span>. A simple chooser has <span class="math inline">\(T_c=T_p\)</span> and <span class="math inline">\(K_c=K_p\)</span>. A chooser is similar in spirit to a straddle: it is a bet on volatility without making a bet on direction. A simple chooser must be cheaper than a straddle with the same exercise price and maturity <span class="math inline">\(T'=T_c=T_p\)</span>, because a straddle is always in the money at maturity, whereas a simple chooser has the same value as the straddle if it is in the money but is only in the money at <span class="math inline">\(T'\)</span> when the choice made at <span class="math inline">\(T\)</span> turns out to have been the best one.</p>
<section id="chooser-payoff" class="level3">
<h3 class="anchored" data-anchor-id="chooser-payoff">Chooser Payoff</h3>
<p>The value of the chooser at date <span class="math inline">\(T\)</span> will be the larger of the call and put prices. Let <span class="math inline">\(S^*\)</span> denote the stock price at which the call and put have the same value. We can find <span class="math inline">\(S^*\)</span> by solving</p>
<p><code>Black_Scholes_Call(S*,Kc,r,sigma,q,Tc-T) = Black_Scholes_Put(S*,Kp,r,sigma,q,Tp-T).</code></p>
<p>For a simple chooser with <span class="math inline">\(K_c=K_p=K\)</span> and <span class="math inline">\(T_c=T_p=T'\)</span>, we can find <span class="math inline">\(S^*\)</span> from the put-call parity relation at <span class="math inline">\(T\)</span>, leading to <span class="math inline">\(S^*=\mathrm{e}^{(q-r)(T'-T)}K.\)</span></p>
<p>The call will be chosen when <span class="math inline">\(S_T&gt;S^*\)</span> and it finishes in the money if <span class="math inline">\(S(T_c)&gt;K_c\)</span> at date <span class="math inline">\(T_c\)</span>, so the payoff of the chooser is <span class="math inline">\(S(T_c)-K_c\)</span> when <span class="math display">\[S_T&gt;S^* \quad \text{and}\quad S(T_c)&gt;K_c\;.
\]</span> The payoff is <span class="math inline">\(K_p-S(T_p)\)</span> at date <span class="math inline">\(T_p\)</span> when <span class="math display">\[
S_T&lt;S^* \quad \text{and}\quad S(T_p)&lt;K_p\;.
\]</span> Let <span class="math display">\[\begin{align*}
x&amp;= \begin{cases} 1 &amp;\text{if $S_T&gt;S^* $ and $S(T_c)&gt;K_c$\;,}\\
                               0 &amp; \text{otherwise\;.}
        \end{cases}\\
y&amp;= \begin{cases} 1 &amp;\text{if $S_T&lt;S^*$ and $S(T_p)&lt;K_p$\;,}\\
                               0 &amp; \text{otherwise\;.}
        \end{cases}
\end{align*}\]</span> Then the payoff of the chooser is <span class="math inline">\(xS(T_c)-xK_c\)</span> at date <span class="math inline">\(T_c\)</span> and <span class="math inline">\(yK_p-yS(T_p)\)</span> at date <span class="math inline">\(T_p\)</span>.</p>
</section>
<section id="numeraires-1" class="level3">
<h3 class="anchored" data-anchor-id="numeraires-1">Numeraires</h3>
<p>As in the analysis of compound options, the value of the chooser at date <span class="math inline">\(0\)</span> must be</p>
<p><span id="eq-chooser1"><span class="math display">\[
\begin{multline}
\mathrm{e}^{-q T_c}S_0\times\text{prob}^V\!(x=1) \;- \;\mathrm{e}^{-rT_c}K_c\times\text{prob}^R(x=1)
\\+\; \mathrm{e}^{-rT_p}K_p\times\text{prob}^R(y=1) \;- \;\mathrm{e}^{-q T_p}S_0\times\text{prob}^V\!(y=1)\;,
\end{multline}
\qquad(15.33)\]</span></span></p>
<p>where we use <span class="math inline">\(V_t=\mathrm{e}^{qt}S_t\)</span> and <span class="math inline">\(R_t=\mathrm{e}^{rt}\)</span> as numeraires.</p>
</section>
<section id="chooser-pricing-formula" class="level3">
<h3 class="anchored" data-anchor-id="chooser-pricing-formula">Chooser Pricing Formula</h3>
<p><a href="#eq-chooser1" class="quarto-xref">Equation&nbsp;<span>15.33</span></a> and calculations similar to those of the previous two sections lead us to:</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">15.13</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>The value of a chooser option is</p>
<p><span id="eq-chooser2"><span class="math display">\[
\begin{multline}
\mathrm{e}^{-q T_c}S_0\mathrm{M}\!\left(d_1,d_{1c},\sqrt{T/T_c}\right) - \mathrm{e}^{-rT_c}K_c\mathrm{M}\!\left(d_2,d_{2c},\sqrt{T/T_c}\right)\\ +\mathrm{e}^{-rT_p}K_p\mathrm{M}\!\left(-d_2,-d_{2p} , \sqrt{T/T_p}\right) \\- \mathrm{e}^{-q T_p}S_0\mathrm{M}\!\left(-d_1 ,-d_{1p} ,\sqrt{T/T_p}\right)\;,
\end{multline}
\qquad(15.34)\]</span></span></p>
<p>where <span class="math display">\[\begin{equation*}
\begin{array}{ll}
d_1 = \frac{\log\left(\frac{S_0}{S^*}\right)+\left(r-q+\frac{1}{2}\sigma^2\right)T}{\sigma\sqrt{T}}\;,
&amp; \qquad d_2=d_1-\sigma\sqrt{T}\;,\\
&amp;\\
d_{1c} = \frac{\log\left(\frac{S_0}{K_c}\right)+\left(r-q+\frac{1}{2}\sigma^2\right)T_c}{\sigma\sqrt{T_c}}\;,
&amp; \qquad d_{2c}=d_{1c}-\sigma\sqrt{T_c}\;,\\
&amp;\\d_{1p} = \frac{\log\left(\frac{S_0}{K_p}\right)+\left(r-q+\frac{1}{2}\sigma^2\right)T_p}{\sigma\sqrt{T_p}}\;,
&amp; \qquad d_{2p}=d_{1p}-\sigma\sqrt{T_p}\;.
\end{array}
\end{equation*}\]</span></p>
</div>
</div>
<p>To implement the bisection to compute <span class="math inline">\(S^*\)</span>, we can take zero as a lower bound and <span class="math inline">\(K_c+K_p\)</span> as an upper bound.^[We take the call value to be zero and the put value to be <span class="math inline">\(\mathrm{e}^{-r(T_p-T)}K_p\)</span> at date <span class="math inline">\(T\)</span> when the stock price is zero. To see why the upper bound works, note that when the stock price is <span class="math inline">\(S\)</span> at date <span class="math inline">\(T\)</span>, the call is worth at least <span class="math inline">\(S^*-K_c\)</span> and the put is worth no more than <span class="math inline">\(K_p\)</span>; i.e, <span class="math inline">\(C \geq S-K_c\)</span> and <span class="math inline">\(P \leq K_p\)</span>. Therefore, <span class="math inline">\(C-P \geq S-K_c-K_p\)</span>. Hence when <span class="math inline">\(S=K_c+K_p\)</span>, we have <span class="math inline">\(C-P\geq 0\)</span>. }</p>
<div id="choosers_option" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> chooser(S, Kc, Kp, r, sigma, q, T, Tc, Tp):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    tol <span class="op">=</span> <span class="fl">1e-6</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    lower <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    upper <span class="op">=</span> np.exp(q <span class="op">*</span> Tc) <span class="op">*</span> (Kc <span class="op">+</span> Kp)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    guess <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> Kc <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> Kp</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    flower <span class="op">=</span> <span class="op">-</span>np.exp(<span class="op">-</span>r <span class="op">*</span> (Tp <span class="op">-</span> T)) <span class="op">*</span> Kp</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    fupper <span class="op">=</span> black_scholes_call(upper, Kc, r, sigma, q, Tc <span class="op">-</span> T) <span class="op">-</span> black_scholes_put(upper, Kp, r, sigma, q, Tp <span class="op">-</span> T)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    fguess <span class="op">=</span> black_scholes_call(guess, Kc, r, sigma, q, Tc <span class="op">-</span> T) <span class="op">-</span> black_scholes_put(guess, Kp, r, sigma, q, Tp <span class="op">-</span> T)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> upper <span class="op">-</span> lower <span class="op">&gt;</span> tol:</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> fupper <span class="op">*</span> fguess <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>            lower <span class="op">=</span> guess</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>            flower <span class="op">=</span> fguess</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>            guess <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> lower <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> upper</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            fguess <span class="op">=</span> black_scholes_call(guess, Kc, r, sigma, q, Tc <span class="op">-</span> T) <span class="op">-</span> black_scholes_put(guess, Kp, r, sigma, q, Tp <span class="op">-</span> T)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>            upper <span class="op">=</span> guess</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>            fupper <span class="op">=</span> fguess</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>            guess <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> lower <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> upper</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>            fguess <span class="op">=</span> black_scholes_call(guess, Kc, r, sigma, q, Tc <span class="op">-</span> T) <span class="op">-</span> black_scholes_put(guess, Kp, r, sigma, q, Tp <span class="op">-</span> T)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    Sstar <span class="op">=</span> guess</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    d1 <span class="op">=</span> (np.log(S <span class="op">/</span> Sstar) <span class="op">+</span> (r <span class="op">-</span> q <span class="op">+</span> sigma <span class="op">**</span> <span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>) <span class="op">*</span> T) <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(T))</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    d2 <span class="op">=</span> d1 <span class="op">-</span> sigma <span class="op">*</span> np.sqrt(T)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    d1c <span class="op">=</span> (np.log(S <span class="op">/</span> Kc) <span class="op">+</span> (r <span class="op">-</span> q <span class="op">+</span> sigma <span class="op">**</span> <span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>) <span class="op">*</span> Tc) <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(Tc))</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    d2c <span class="op">=</span> d1c <span class="op">-</span> sigma <span class="op">*</span> np.sqrt(Tc)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    d1p <span class="op">=</span> (np.log(S <span class="op">/</span> Kp) <span class="op">+</span> (r <span class="op">-</span> q <span class="op">+</span> sigma <span class="op">**</span> <span class="dv">2</span> <span class="op">/</span> <span class="dv">2</span>) <span class="op">*</span> Tp) <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(Tp))</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    d2p <span class="op">=</span> d1p <span class="op">-</span> sigma <span class="op">*</span> np.sqrt(Tp)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    rhoc <span class="op">=</span> np.sqrt(T <span class="op">/</span> Tc)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    rhop <span class="op">=</span> np.sqrt(T <span class="op">/</span> Tp)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    M1c <span class="op">=</span> binormal_prob(d1, d1c, rhoc)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    M2c <span class="op">=</span> binormal_prob(d2, d2c, rhoc)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    M1p <span class="op">=</span> binormal_prob(<span class="op">-</span>d1, <span class="op">-</span>d1p, rhop)</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    M2p <span class="op">=</span> binormal_prob(<span class="op">-</span>d2, <span class="op">-</span>d2p, rhop)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.exp(<span class="op">-</span>q <span class="op">*</span> Tc) <span class="op">*</span> S <span class="op">*</span> M1c <span class="op">-</span> np.exp(<span class="op">-</span>r <span class="op">*</span> Tc) <span class="op">*</span> Kc <span class="op">*</span> M2c <span class="op">+</span> np.exp(<span class="op">-</span>r <span class="op">*</span> Tp) <span class="op">*</span> Kp <span class="op">*</span> M2p <span class="op">-</span> np.exp(<span class="op">-</span>q <span class="op">*</span> Tp) <span class="op">*</span> S <span class="op">*</span> M1p</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>Kc <span class="op">=</span> <span class="dv">80</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>Kp <span class="op">=</span> <span class="dv">80</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.05</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>Tc <span class="op">=</span> <span class="fl">1.5</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>Tp <span class="op">=</span> <span class="fl">1.5</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>T<span class="op">=</span><span class="dv">1</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Chooser Option:", chooser(S, Kc, Kp, r, sigma, q, T, Tc, Tp))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="section-7" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="section-7"></h2>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Intuitively, the value of a forward-start call option should be lower the closer is the date <span class="math inline">\(T\)</span> at which the strike is set to the date <span class="math inline">\(T'\)</span> at which the option matures, because then the option has less time to maturity after being created at <span class="math inline">\(T\)</span>. Create a Python program to confirm this. Allow the user to input <span class="math inline">\(S\)</span>, <span class="math inline">\(r\)</span>, <span class="math inline">\(\sigma\)</span>, <span class="math inline">\(q\)</span>, and <span class="math inline">\(T'\)</span>. Compute and plot the value of the option for <span class="math inline">\(T=0.1T'\)</span>, <span class="math inline">\(T=0.2T'\)</span>, , <span class="math inline">\(T=0.9T'\)</span>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create a Python program to demonstrate the additional leverage of a call-on-a-call relative to a standard call. Allow the user to input <span class="math inline">\(S\)</span>, <span class="math inline">\(r\)</span>, <span class="math inline">\(\sigma\)</span>, <span class="math inline">\(q\)</span>, and <span class="math inline">\(T'\)</span>. Use the <code>Black-Scholes_Call</code> function to compute and output the value <span class="math inline">\(C\)</span> of a European call with strike <span class="math inline">\(K'=S\)</span> (i.e., the call is at the money) and maturity <span class="math inline">\(T'\)</span>. Use the <code>Call_on_Call</code> function to compute and output the value of a call option on the call with strike <span class="math inline">\(K=C\)</span> (i.e., the call-on-a-call is at the money) and maturity <span class="math inline">\(T=0.5T'\)</span>. Compute the percentage returns the standard European call and the call-on-a-call would experience if the stock price <span class="math inline">\(S\)</span> instantaneously increased by 10%.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create a Python program to illustrate the early exercise premium for an American call on a stock paying a discrete dividend. Allow the user to input <span class="math inline">\(S\)</span>, <span class="math inline">\(r\)</span>, <span class="math inline">\(\sigma\)</span>, and <span class="math inline">\(T'\)</span>. Take the date of the dividend payment to be <span class="math inline">\(T=0.5T'\)</span> and take the strike price to be <span class="math inline">\(K=S\)</span>. As discussed in <a href="Chapter_Americans.html#sec-s:discrete" class="quarto-xref"><span>Section 11.3</span></a>, the value of a European call is given by the Black-Scholes formula with <span class="math inline">\(S-\mathrm{e}^{-rT}D\)</span> being the initial asset price and <span class="math inline">\(q=0\)</span> being the constant dividend yield. Use the function <code>American_Call_Dividend</code> to compute the value of an American call for dividends <span class="math inline">\(D=.1S\)</span>, <span class="math inline">\(D=.9S\)</span>. Subtract the value of the European call with the same dividend to obtain the early exercise premium. Plot the early exercise premium against the dividend <span class="math inline">\(D\)</span>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create a Python function to value a simple chooser (a chooser option in which <span class="math inline">\(K_c=K_p\)</span> and <span class="math inline">\(T_c=T_p\)</span>) using put-call parity to compute <span class="math inline">\(S^*\)</span> as mentioned in <a href="#sec-s:choosers" class="quarto-xref"><span>Section 15.12</span></a>. Verify that the function gives the same result as the function <code>Chooser</code>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create a Python code to compare the cost of a simple chooser to that of a straddle (straddle = call + put with same strike and maturity). Allow the user to input <span class="math inline">\(S\)</span>, <span class="math inline">\(r\)</span>, <span class="math inline">\(\sigma\)</span>, <span class="math inline">\(q\)</span>, and <span class="math inline">\(T'\)</span>. Take the time to maturity of the underlying call and put to be <span class="math inline">\(T'\)</span> for both the chooser and the straddle. Take the strike prices to be <span class="math inline">\(K=S\)</span>. Take the time the choice must be made for the chooser to be <span class="math inline">\(T=0.5T'\)</span>. Compute the cost of the chooser and the cost of the straddle.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>A stock has fallen in price and you are attempting to persuade a client that it is now a good buy. The client believes it may fall further before bouncing back and hence is inclined to postpone a decision. To convince the client to buy now, you offer to deliver the stock to him at the end of two months at which time he will pay you the lowest price it trades during the two months plus a fee for your costs. The stock is not expected to pay a dividend during the next two months. Assuming the stock actually satisfies the Black-Scholes assumptions, find a formula for the minimum fee that you would require. (Hint: It is almost in <a href="#sec-s:lookbacks" class="quarto-xref"><span>Section 15.2</span></a>.) Create a Python program allowing the user to input <span class="math inline">\(S\)</span>, <span class="math inline">\(r\)</span>, and <span class="math inline">\(\sigma\)</span> and computing the minimum fee.</p>
</div>
</div>
</div>
<div id="exr-e_standardknockout" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 15.1</strong></span> Suppose you must purchase 100 units of an asset at the end of a year. Create a Python program simulating the asset price and comparing the quality of the following hedges (assuming 100 contracts of each):</p>
<ol type="1">
<li>a standard European call,</li>
<li>a down-and-out call in which the knock-out barrier is 10% below the current price of the asset.</li>
</ol>
<p>Take both options to be at the money at the beginning of the year. Allow the user to input <span class="math inline">\(S\)</span>, <span class="math inline">\(r\)</span>, <span class="math inline">\(\sigma\)</span> and <span class="math inline">\(q\)</span>. Generate 500 simulated end-of-year costs (net of the option values at maturity) for each hedging strategy and create histogram charts to visually compare the hedges. Note: to create histograms, you will need the Data Analysis add-in, which may be need to be loaded (click Tools/Add Ins).</p>
</div>
<div id="exr-e_standardknockout2" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 15.2</strong></span> Compute the prices of the options in the previous exercise. Modify the simulations to compare the end-of-year costs including the costs of the options, adding interest on the option prices to put everything on an end-of-year basis.</p>
</div>
<div id="exr-e_standardknockout3" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 15.3</strong></span> Modify <a href="#exr-e_standardknockout" class="quarto-xref">Exercise&nbsp;<span>15.1</span></a> by including a third hedge: a combination of a down-and-out call as in part (b) of <a href="#exr-e_standardknockout" class="quarto-xref">Exercise&nbsp;<span>15.1</span></a> and a down-and-in call with knockout barrier and strike 10% below the current price of the asset. Note that this combination forms a call option with strike that is reset when the underlying asset price hits a barrier.</p>
</div>
<div id="exr-e_standardknockout4" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 15.4</strong></span> Modify <a href="#exr-e_standardknockout2" class="quarto-xref">Exercise&nbsp;<span>15.2</span></a> by including the hedge in <a href="#exr-e_standardknockout3" class="quarto-xref">Exercise&nbsp;<span>15.3</span></a>. Value the down-and-in call using the function <code>Down_And_Out_Call</code> and the fact that a down-and-out and down-and-in with the same strikes and barriers form a standard option.</p>
</div>
<div id="exr-e_averagehedge" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 15.5</strong></span> Each week you purchase 100 units of an asset, and you want to hedge your total quarterly (13-week) cost. Create a Python program simulating the asset price and comparing the quality of the following hedges:</p>
<ol type="1">
<li>a standard European call maturing at the end of the quarter (<span class="math inline">\(T=0.25\)</span>) on 1300 units of the asset,</li>
<li>13 call options maturing at the end of each week of the quarter, each written on 100 units of the asset, and</li>
<li>a discretely sampled average-price call with maturity <span class="math inline">\(T=0.25\)</span> written on 1300 units of the asset, where the sampling is at the end of each week.<br>
</li>
<li>a discretely sampled geometric-average-price call with maturity <span class="math inline">\(T=0.25\)</span> written on 1300 units of the asset, where the sampling is at the end of each week.</li>
</ol>
<p>Allow the user to input <span class="math inline">\(S\)</span>, <span class="math inline">\(r\)</span>, <span class="math inline">\(\sigma\)</span> and <span class="math inline">\(q\)</span>. Assume all of the options are at the money at the beginning of the quarter (<span class="math inline">\(K=S\)</span>). Compare the hedges as in <a href="#exr-e_standardknockout" class="quarto-xref">Exercise&nbsp;<span>15.1</span></a>.</p>
</div>
<div id="exr-e_averagehedge2" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 15.6</strong></span> In the setting of the previous problem, compute the prices of the options in parts (a), (b) and (d). Modify the simulations in the previous problem to compare the end-of-quarter costs including the costs of the options (adding interest on the option prices to put everything on an end-of-quarter basis).</p>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Using the put-call parity relation, derive a formula for the value of a forward-start put.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Derive <a href="#eq-callonaput" class="quarto-xref">Equation&nbsp;<span>15.19</span></a> for the value of a call on a put.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Complete the derivation of <a href="#eq-chooser2" class="quarto-xref">Equation&nbsp;<span>15.34</span></a> for the value of a chooser option.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Derive a formula for the value of a put option on the maximum of two risky asset prices.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Using the result of the preceding exercise and Margrabe’s formula, verify that calls and puts (having the same strike <span class="math inline">\(K\)</span> and maturity <span class="math inline">\(T\)</span>) on the maximum of two risky asset prices satisfy the following put-call parity relation: <span class="math display">\[\begin{multline*}
\mathrm{e}^{-rT}K + \text{Value of call on max} \\
= \mathrm{e}^{-q_2T}S_2_0 + \text{Value of option to exchange asset 2 for asset 1} \\+ \text{Value of put on max}\;.
\end{multline*}\]</span></p>
</div>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-CV" class="csl-entry" role="listitem">
Conze, A., and Viswanathan. 1991. <span>“Path Dependent Options: The Case of Lookback Options.”</span> <em>Journal of Finance</em> 46: 1893–1907.
</div>
<div id="ref-Drezner" class="csl-entry" role="listitem">
Drezner, Z. 1978. <span>“Computation of the Bivariate Normal Integral.”</span> <em>Mathematics of Computation</em> 32: 277–79.
</div>
<div id="ref-Geske" class="csl-entry" role="listitem">
Geske, R. 1979. <span>“The Valuation of Compound Options.”</span> <em>Journal of Financial Economics</em> 7: 63–81.
</div>
<div id="ref-GSG" class="csl-entry" role="listitem">
Goldman, M., H. Sosin, and M. Gatto. 1979. <span>“Path Dependent Options: ‘Buy at the Low, Sell at the High.”</span> <em>’ Journal of Finance</em> 34: 1111–27.
</div>
<div id="ref-MR" class="csl-entry" role="listitem">
Musiela, M., and M. Rutkowski. 1997. <em>Martingale Methods in Financial Modeling</em>. Springer, Berlin Heidelberg New York.
</div>
<div id="ref-Stulz" class="csl-entry" role="listitem">
Stulz, R. 1982. <span>“Options on the Minimum or Maximum of Two Risky Assets: Analysis and Applications.”</span> <em>Journal of Financial Economics</em> 10: 161–85.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>We are going to use equation~<a href="Chapter_Arbitrage.html#eq-probSnumeraire" class="quarto-xref">Equation&nbsp;<span>7.23</span></a> at date <span class="math inline">\(T'\)</span> to define the probabilities, because it will not be known until date <span class="math inline">\(T'\)</span> whether the event <span class="math inline">\(S_{T'}&gt;S_T\)</span> is true. Thus, we need the price of a numeraire asset at date <span class="math inline">\(T'\)</span>. We would like this price to be a constant times <span class="math inline">\(S_T\)</span>, which is what we will obtain. An equivalent numeraire is to make a smaller investment in the same portfolio: start with <span class="math inline">\(\mathrm{e}^{-r(T'-T)-qT}\)</span> shares. This results in a final value of <span class="math inline">\(S_T\)</span> at date <span class="math inline">\(T'\)</span>. As will be seen, this is useful for deriving the put-call parity relation for forward-start options.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Chapter_Asians.html" class="pagination-link" aria-label="Asians, Baskets, and Spreads">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Asians, Baskets, and Spreads</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Chapter_GARCH.html" class="pagination-link" aria-label="GARCH Models">
        <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">GARCH Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions"><ul><li><a href="https://github.com/math-finance-book/book-code.git/blob/main/Chapter_Exotics.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div></div></footer></body></html>