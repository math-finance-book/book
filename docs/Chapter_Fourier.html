<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>17&nbsp; Fourier Transforms – Pricing and Hedging Derivative Securities: Theory and Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Chapter_FixedIncome.html" rel="next">
<link href="./Chapter_FiniteDifferences.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2486e1f0a3ee9ee1fc393803a1361cdb.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-6561bbde787c299e21493071c8edc6ff.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-bb6b93f51bf5a7975605005bd985cc1c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter_MonteCarlo.html">Part V: Numerical Methods</a></li><li class="breadcrumb-item"><a href="./Chapter_Fourier.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Fourier Transforms</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Pricing and Hedging Derivative Securities: Theory and Methods</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/math-finance-book/book-code.git" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Options</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Futures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Futures and Swaps</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Arbitrage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Arbitrage Pricing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_OptionPricing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Pricing Digitals</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: Mathematical Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Brownian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Brownian Motion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Ito.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Ito’s Formula</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Girsanov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Girsanov’s Theorem</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_PDEs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Martingale Representation and PDEs</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: Black-Scholes and Extensions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_BlackScholes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Black-Scholes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FX.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Foreign Exchange</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Merton.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Merton, Black, and Margrabe</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Exotics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Exotic Options</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Part IV: Alternative Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Vol.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Stochastic Volatility</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Part V: Numerical Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_MonteCarlo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Monte Carlo Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Binomial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Binomial and Trinomial Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FiniteDifferences.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Finite Difference Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Fourier.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Fourier Transforms</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Part VI: Fixed Income</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FixedIncome.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Fixed-Income Concepts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FixedIncomeDerivatives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Fixed-Income Derivatives</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Vasicek.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">The Extended Vasicek Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Survey.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Term Structure Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendix</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./AppendixA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Miscellaneous Facts about Continuous-Time Models</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter_MonteCarlo.html">Part V: Numerical Methods</a></li><li class="breadcrumb-item"><a href="./Chapter_Fourier.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Fourier Transforms</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-c_fouriertrasform" class="quarto-section-identifier"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Fourier Transforms</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2" data-number="17.1">
<h2 data-number="17.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">17.1</span> Introduction</h2>
<p>The Fourier Transform has become an essential tool in option pricing, particularly for complex models like those with stochastic volatility and Lévy processes including variance gamma and jump diffusion processes. In this chapter, we will explore how the Fourier Transform simplifies the pricing of derivative securities, examine its advantages, and provide analytical examples and Python code for practical illustration.</p>
<p>The key reason for using Fourier Transforms in option pricing is that they allow us to solve pricing problems more efficiently in the frequency domain rather than the time domain. Specifically, Fourier methods:</p>
<ol type="1">
<li><strong>Handle Non-Gaussian Processes</strong>: Many real-world asset price models involve jumps or stochastic volatility, which may lead to non-Gaussian distributions of returns. Fourier Transforms allow us to handle these models efficiently.</li>
<li><strong>Use Characteristic Functions</strong>: The Fourier Transform is closely related to the characteristic function of the underlying asset price. Many stochastic processes have closed-form characteristic functions without explicit distribution functions. Using the closed-form characteristic functions simplifies the integration required in risk-neutral valuation.</li>
<li><strong>Conduct Fast Numerical Computation</strong>: By leveraging Fast Fourier Transform (FFT) algorithms, we can calculate option prices for a wide range of strikes and maturities quickly.</li>
<li><strong>Simplify Complex Problems</strong>: Many option pricing models lead to complex partial differential equations (PDEs). The Fourier Transform helps transform these PDEs into simpler algebraic equations.</li>
</ol>
<p>In this chapter, we’ll focus on the first three and demonstrate these advantages through theory, examples, and Python code.</p>
</section>
<section id="section-1-theoretical-foundation" class="level2" data-number="17.2">
<h2 data-number="17.2" class="anchored" data-anchor-id="section-1-theoretical-foundation"><span class="header-section-number">17.2</span> Section 1: Theoretical Foundation</h2>
<p>The Fourier transform of a function <span class="math inline">\(f(x)\)</span>, denoted as <span class="math inline">\(\hat{f}(u)\)</span>, is given by:</p>
<p><span class="math display">\[
\hat{f}(u) = \int_{-\infty}^{\infty} e^{-iux} f(x) \, dx,
\]</span> where <span class="math inline">\(i=\sqrt{-1}\)</span> and <span class="math inline">\(u\)</span> is termed ``frequency.’’</p>
<p>In the context of option pricing using the <strong>Fourier Transform</strong>, our goal is to transform option payoff into the frequency domain (via the Fourier transform), which allows for efficient option pricing using techniques like the <strong>Fast Fourier Transform (FFT)</strong>.</p>
<p>To apply the Fourier transform, we often work with the <strong>logarithm of the asset price</strong>, <span class="math inline">\(X_T = \ln(S_T)\)</span>, instead of the asset price <span class="math inline">\(S_T\)</span> directly. This is done because log-prices simplify the structure of the characteristic function (which is essential in the Fourier method). The payoff of a European call with strike price <span class="math inline">\(K\)</span> at maturity <span class="math inline">\(T\)</span> becomes:</p>
<p><span class="math display">\[
C(X_T) = \max(e^{X_T} - K, 0)
\]</span></p>
<p>We now take the Fourier transform of this function with respect to <span class="math inline">\(x = X_T\)</span> (the log-price), leading to the formula for <span class="math inline">\(\hat{C}(u)\)</span>, which is:</p>
<p><span class="math display">\[
\hat{C}(u) = \int_{-\infty}^{\infty} e^{-iux} \max(e^x - K, 0) \, dx
\]</span></p>
<p>To compute this transform explicitly, we split the payoff function into two regions: - When <span class="math inline">\(x &lt; \ln(K)\)</span>, the payoff is zero because <span class="math inline">\(S_T &lt; K\)</span>. - When <span class="math inline">\(x \geq \ln(K)\)</span>, the payoff is <span class="math inline">\(e^x - K\)</span> because <span class="math inline">\(S_T \geq K\)</span>.</p>
<p>Thus, the integral for <span class="math inline">\(\hat{C}(u)\)</span> becomes:</p>
<p><span class="math display">\[
\hat{C}(u) = \int_{\ln(K)}^{\infty} e^{-iux} (e^x - K) \, dx
\]</span></p>
<p>This integral can be computed analytically and results in a closed-form expression for <span class="math inline">\(\hat{C}(u)\)</span>. The final result is:</p>
<p><span class="math display">\[
\hat{C}(u) = \frac{K^{1 - iu}}{iu(1 + iu)}
\]</span></p>
<p>In essence, <span class="math inline">\(\hat{C}(u)\)</span> is the representation of the call option’s payoff in the <strong>frequency domain</strong>. It captures how different frequencies (or Fourier modes) contribute to the option price. Once the Fourier transform is applied to the payoff function, this <span class="math inline">\(\hat{C}(u)\)</span> can be combined with the <strong>characteristic function</strong> of the underlying asset’s price process to calculate the option price.</p>
<p>The characteristic function <span class="math inline">\(\phi_{X}(u)\)</span> of a random variable <span class="math inline">\(X\)</span> is defined as:</p>
<p><span class="math display">\[
\phi_{X}(u) = \mathbb{E}[e^{i u X}].
\]</span> The characteristic function uniquely defines the probability distribution of <span class="math inline">\(X\)</span> and can be used to recover the density function via the inverse Fourier Transform.</p>
<p>The final step in the pricing process involves integrating the product of <span class="math inline">\(\hat{C}(u)\)</span> and the characteristic function of the log-returns of the asset (under the risk-neutral probability) to recover the option price in the original domain (time or price space).</p>
<p>Once <span class="math inline">\(\hat{C}(u)\)</span> is computed, the price of the option can be calculated using the <strong>Fourier inversion formula</strong>. The general formula for the call option price <span class="math inline">\(C(K)\)</span> at time <span class="math inline">\(0\)</span> is:</p>
<p><span id="eq-FTpricing"><span class="math display">\[
C(K) = \frac{e^{-rT}}{2\pi} \int_{-\infty}^{\infty} e^{-iuk} \hat{C}(u) \phi_X(u) \, du,
\qquad(17.1)\]</span></span> where <span class="math inline">\(\phi_X(u)\)</span> is the <strong>characteristic function</strong> of the log-price process at time <span class="math inline">\(T\)</span>, <span class="math inline">\(k = \ln(K)\)</span> is the log-strike, and <span class="math inline">\(\hat{C}(u)\)</span> is the Fourier transform of the payoff function.</p>
<p>By evaluating this integral (typically done numerically), we recover the option price. This illustrate the main idea behind the appilcation of Fourier transform in pricing options.</p>
<p>Unfortunately, the Fast Fourier Transform (FFT) cannot be used to evaluate the pricing integral <a href="#eq-FTpricing" class="quarto-xref">Equation&nbsp;<span>17.1</span></a>, since the integrand is singular at the required evaluation point <span class="math inline">\(u = 0\)</span>. Given the considerable speed advantages of the FFT, we introduce the Carr-Madan method <span class="citation" data-cites="CarrMadan">(<a href="#ref-CarrMadan" role="doc-biblioref">Carr and Madan 1999</a>)</span> that can leverage the efficiency of the FFT.</p>
</section>
<section id="the-carr-madan-method" class="level2" data-number="17.3">
<h2 data-number="17.3" class="anchored" data-anchor-id="the-carr-madan-method"><span class="header-section-number">17.3</span> The Carr-Madan Method</h2>
<p>The key idea behind the Carr-Madan Method is to express the option price as an integral in Fourier space and then discretize it for the FFT numerical evaluation.</p>
<section id="step-1-modify-the-payoff-function" class="level3">
<h3 class="anchored" data-anchor-id="step-1-modify-the-payoff-function">Step 1: Modify the Payoff Function</h3>
<p>Let <span class="math inline">\(k\)</span> denote the log of the strike price <span class="math inline">\(K\)</span>, and let <span class="math inline">\(C(k)\)</span> be the desired value of a <span class="math inline">\(T\)</span>-maturity call option with strike exp(k). Let the risk-neutral density of the <span class="math inline">\(s=\ln(S)\)</span> be <span class="math inline">\(q(s)\)</span>. The initial call value <span class="math inline">\(C(k)\)</span> is related to the risk-neutral density <span class="math inline">\(q(s)\)</span> by</p>
<p><span class="math display">\[
C(k) = \int_{k}^\infty e^{-r T} (e^s-e^k) q(s)\, ds.
\]</span></p>
<p>Because <span class="math inline">\(C(k)\)</span> approaches <span class="math inline">\(S_0\)</span> as <span class="math inline">\(k\)</span> tends to <span class="math inline">\(-\infty\)</span>, the call pricing function of <span class="math inline">\(k\)</span> is not square integrable. To ensure the square integrability of the Fourier Transform, we first modify the option’s payoff function by introducing a dampening factor <span class="math inline">\(\alpha &gt; 0\)</span>:</p>
<p><span class="math display">\[
\tilde{C}(k) = e^{\alpha k} C(k).
\]</span> This modification ensures that the transformed function decays sufficiently fast at infinity.</p>
</section>
<section id="step-2-express-the-modified-price-as-an-integral" class="level3">
<h3 class="anchored" data-anchor-id="step-2-express-the-modified-price-as-an-integral">Step 2: Express the Modified Price as an Integral</h3>
<p>By the fourier inversion theorem, the modified call price can be written as:</p>
<p><span id="eq-carrmadan"><span class="math display">\[
C(k) = \frac{e^{-\alpha k}}{2\pi} \int_{-\infty}^\infty e^{-i u k} \phi_{C}(u)\, du = \frac{e^{-\alpha k}}{\pi} \int_{0}^\infty e^{-i u k} \phi_{C}(u)\, du,
\qquad(17.2)\]</span></span> where <span class="math inline">\(\phi_{C}(u)\)</span> is the Fourier Transform of the option <span class="math inline">\(C(k)\)</span> and the second equality follows because <span class="math inline">\(\phi_{C}(u)\)</span> is odd in its imaginary part and even in its real part.</p>
</section>
<section id="step-3-derive-the-fourier-transform-of-the-payoff" class="level3">
<h3 class="anchored" data-anchor-id="step-3-derive-the-fourier-transform-of-the-payoff">Step 3: Derive the Fourier Transform of the Payoff</h3>
<p>The Fourier Transform <span class="math inline">\(\phi_{C}(u)\)</span> is given by:</p>
<p><span class="math display">\[
\phi_{C}(u) = \int_{-\infty}^\infty e^{i u k} e^{\alpha k}e^{-r T} (e^{s} - e^{k})^+q(s) \, ds.
\]</span></p>
<p>By simplifying and rearranging terms, we obtain:</p>
<p><span class="math display">\[
\phi_{C}(u) = \frac{e^{-rT}\phi_{S}(u - i (\alpha + 1))}{(\alpha + i u)(\alpha + i u + 1)},
\]</span> where <span class="math inline">\(\phi_{S}(u)\)</span> is the characteristic function of <span class="math inline">\(\ln S\)</span>.</p>
</section>
<section id="step-4-discretize-the-integral-for-fft" class="level3">
<h3 class="anchored" data-anchor-id="step-4-discretize-the-integral-for-fft">Step 4: Discretize the Integral for FFT</h3>
<p>The FFT is an efficient algorithm for computing the sum <span class="math display">\[
g(m)=\sum_{j=1}^{N} \exp\left(-i \frac{2\pi}{N}(j-1) (m-1)\right)y(j), m=1,...,N,
\]</span> where <span class="math inline">\(N\)</span> is typically a power of 2 and <span class="math inline">\(y(\cdot)\)</span> is some given function. The algorithm reduces the number of multiplications in the required <span class="math inline">\(N\)</span> summations from an order of <span class="math inline">\(N^2\)</span> to that of <span class="math inline">\(N \log_2(N)\)</span>, a very significant reduction. We present in this section the details for writing the integration (5) as an application of the summation (16). To improve the accuracy of the approximation, we can combine it with the Simpson’s rule.</p>
<p><strong>Simpson’s Rule:</strong> We divide the integration interval <span class="math inline">\([a, b]\)</span> into <span class="math inline">\(N\)</span> subintervals, where <span class="math inline">\(N\)</span> is an even number. Let <span class="math inline">\(h = \frac{b - a}{N}\)</span> be the width of each subinterval. The function <span class="math inline">\(f(x)\)</span> is evaluated at equally spaced points <span class="math inline">\(x_1, x_2, x_3, \dots, x_{N+1}\)</span>, where <span class="math inline">\(x_j = a+(j-1) h\)</span>.</p>
<p>The Simpson’s Rule formula is: <span class="math display">\[
\int_a^b f(x) \, dx \approx \frac{h}{3} \left[ f(x_1) + 4 \sum_{j=2,4,6,\dots}^{N-1} f(x_j) + 2 \sum_{j=1,3,5,\dots}^{N-2} f(x_j) + f(x_{N+1}) \right].
\]</span> Combinig the FFT with the Simpson’s rule, we have <span id="eq-FFTSimpson"><span class="math display">\[
g(m)=\sum_{j=1}^{N} \exp\left(-i \frac{2\pi}{N}(j-1) (m-1)\right)y(j)w(j), m=1,...,N,
\qquad(17.3)\]</span></span> where <span class="math inline">\(w(j)=4\)</span> if <span class="math inline">\(j\)</span> is even, <span class="math inline">\(w(j)=2\)</span> if <span class="math inline">\(j\)</span> is odd, and <span class="math inline">\(w(1)=w(N+1)=1\)</span>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>To apply the FFT <a href="#eq-FFTSimpson" class="quarto-xref">Equation&nbsp;<span>17.3</span></a>, we discretize the integral <a href="#eq-carrmadan" class="quarto-xref">Equation&nbsp;<span>17.2</span></a> over <span class="math inline">\(u\)</span>:</p>
<ul>
<li>Define <span class="math inline">\(u_j = \eta (j-1)\)</span>, where <span class="math inline">\(\eta\)</span> is the spacing between points and $j = 1, 2, , N $.</li>
<li>Similarly, define <span class="math inline">\(k_m = -b + \lambda \, (m-1)\)</span>, where <span class="math display">\[
\lambda = \frac{2\pi}{N \eta}
\]</span> is the spacing in log-strike space, <span class="math display">\[
b=\frac{N \lambda}{2}
\]</span> is the integration upper limit of <span class="math inline">\(k\)</span>, and <span class="math inline">\(m = 1, 2,  \dots, N\)</span>.</li>
</ul>
<p>The integral <a href="#eq-carrmadan" class="quarto-xref">Equation&nbsp;<span>17.2</span></a> becomes a sum:</p>
<p><span class="math display">\[
\tilde{C}(k_m) \approx \frac{e^{-\alpha k_m}}{\pi} \sum_{j=1}^{N} \exp\left(-i \frac{2\pi}{N} (j-1)\, (m-1) \right) e^{i u_j b} \phi_{C}(u_j)  \eta.
\]</span> To further improve the efficiency, we use Simpson’s rule to choose the weights of each term to arrive at <span id="eq-carrmadanFFT"><span class="math display">\[
\tilde{C}(k_m) \approx \frac{e^{-\alpha k_m}}{\pi} \sum_{j=1}^{N} \exp\left(-i \frac{2\pi}{N} (j-1)\, (m-1) \right) e^{i u_j b} \phi_{C}(u_j) \frac{\eta}{3}(3+(-1)^{j}-\delta_{j-1}),
\qquad(17.4)\]</span></span> where <span class="math inline">\(\delta_n=1\)</span> is equal to 1 if and only if <span class="math inline">\(n=0\)</span>. <a href="#eq-carrmadanFFT" class="quarto-xref">Equation&nbsp;<span>17.4</span></a> can be efficiently computed using the FFT method.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
</section>
<section id="implementation-steps" class="level3">
<h3 class="anchored" data-anchor-id="implementation-steps">Implementation Steps</h3>
<section id="set-the-parameters" class="level4">
<h4 class="anchored" data-anchor-id="set-the-parameters">1. Set the Parameters</h4>
<ul>
<li>Choose <span class="math inline">\(N\)</span>, the number of FFT points (preferably a power of 2 for computational efficiency).</li>
<li>Set the dampening factor <span class="math inline">\(\alpha\)</span> to ensure convergence.</li>
<li>Determine <span class="math inline">\(\eta\)</span> and <span class="math inline">\(\lambda\)</span> based on <span class="math inline">\(N\)</span> and the desired range of strikes.</li>
</ul>
</section>
<section id="compute-the-characteristic-function" class="level4">
<h4 class="anchored" data-anchor-id="compute-the-characteristic-function">2. Compute the Characteristic Function</h4>
<p>For a given model (e.g., Black-Scholes, Heston), compute the characteristic function <span class="math inline">\(\phi_{S_T}(u)\)</span> of <span class="math inline">\(\ln S_T\)</span>.</p>
</section>
<section id="calculate-the-fourier-transform-of-the-call-payoff" class="level4">
<h4 class="anchored" data-anchor-id="calculate-the-fourier-transform-of-the-call-payoff">3. Calculate the Fourier Transform of the Call Payoff</h4>
<p>Compute <span class="math inline">\(\phi_{C}(u_j)\)</span> using:</p>
<p><span class="math display">\[
\phi_{C}(u_j) = \frac{e^{-r T}\phi_{S_T}(u_j - i (\alpha + 1))}{(\alpha + i u_j)(\alpha + i u_j + 1)}.
\]</span></p>
</section>
<section id="apply-the-fft-eq-carrmadanfft-to-get-the-option-price." class="level4">
<h4 class="anchored" data-anchor-id="apply-the-fft-eq-carrmadanfft-to-get-the-option-price.">4. Apply the FFT <a href="#eq-carrmadanFFT" class="quarto-xref">Equation&nbsp;<span>17.4</span></a> to get the option price.</h4>
</section>
</section>
</section>
<section id="applications-of-the-carr-madan-method" class="level2" data-number="17.4">
<h2 data-number="17.4" class="anchored" data-anchor-id="applications-of-the-carr-madan-method"><span class="header-section-number">17.4</span> Applications of the Carr-Madan Method</h2>
<section id="pricing-a-european-call-option-under-the-black-scholes-model" class="level3">
<h3 class="anchored" data-anchor-id="pricing-a-european-call-option-under-the-black-scholes-model">Pricing a European Call Option under the Black-Scholes Model</h3>
<p>In the Black-Scholes model, the asset price follows a geometric Brownian motion, and the log-price <span class="math inline">\(X_T = \ln(S_T)\)</span> is normally distributed with mean <span class="math inline">\((r - \frac{\sigma^2}{2})T\)</span> and variance <span class="math inline">\(\sigma^2 T\)</span>. The characteristic function for the log-price <span class="math inline">\(X_T\)</span> is:</p>
<p><span class="math display">\[
\phi_T(u) = \exp\left(iu \left(\ln(S_0) + \left(r -q-\frac{\sigma^2}{2}\right)T\right) - \frac{1}{2} \sigma^2 T u^2 \right),
\]</span> where <span class="math inline">\(S_0\)</span> is the initial asset price, <span class="math inline">\(r\)</span> is the risk-free rate, <span class="math inline">\(\sigma\)</span> is the volatility of the asset, <span class="math inline">\(T\)</span> is the time to maturity, and <span class="math inline">\(u\)</span> is the complex Fourier variable.</p>
<p>The following code implements the Carr-Madan method, which uses the FFT to price European call options by transforming the characteristic function of the Black-Scholes model into the frequency domain. The option prices are then obtained by applying Simpson’s Rule for integration and FFT for efficient computation. These prices are compared to those obtained using the Black-Scholes formula. The code also visualizes the comparison and the differences between the two methods. The results suggest that the Carr-Madan method yields an accurate call price.</p>
<div id="b5012254" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="b5012254"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="b5012254-1"><a href="#b5012254-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="b5012254-2"><a href="#b5012254-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy.fft <span class="im">import</span> fft</span>
<span id="b5012254-3"><a href="#b5012254-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="b5012254-4"><a href="#b5012254-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="b5012254-5"><a href="#b5012254-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-6"><a href="#b5012254-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Market and option parameters</span></span>
<span id="b5012254-7"><a href="#b5012254-7" aria-hidden="true" tabindex="-1"></a>S0 <span class="op">=</span> <span class="dv">100</span>  <span class="co"># Initial stock price</span></span>
<span id="b5012254-8"><a href="#b5012254-8" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> np.linspace(<span class="dv">60</span>, <span class="dv">140</span>, <span class="dv">81</span>)  <span class="co"># Strike prices from 60 to 140</span></span>
<span id="b5012254-9"><a href="#b5012254-9" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="fl">0.1</span>  <span class="co"># Time to maturity</span></span>
<span id="b5012254-10"><a href="#b5012254-10" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.05</span>  <span class="co"># Risk-free rate</span></span>
<span id="b5012254-11"><a href="#b5012254-11" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="fl">0.02</span>  <span class="co"># Dividend yield</span></span>
<span id="b5012254-12"><a href="#b5012254-12" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.2</span>  <span class="co"># Volatility</span></span>
<span id="b5012254-13"><a href="#b5012254-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-14"><a href="#b5012254-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Carr-Madan method parameters</span></span>
<span id="b5012254-15"><a href="#b5012254-15" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">1.5</span>  <span class="co"># Damping factor (&gt; 0)</span></span>
<span id="b5012254-16"><a href="#b5012254-16" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">2</span><span class="op">**</span><span class="dv">16</span>  <span class="co"># Number of FFT points (must be even for Simpson's Rule)</span></span>
<span id="b5012254-17"><a href="#b5012254-17" aria-hidden="true" tabindex="-1"></a>eta <span class="op">=</span> <span class="fl">0.05</span>  <span class="co"># Spacing in the frequency domain (smaller for higher accuracy)</span></span>
<span id="b5012254-18"><a href="#b5012254-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-19"><a href="#b5012254-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure N is even for Simpson's Rule</span></span>
<span id="b5012254-20"><a href="#b5012254-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> N <span class="op">%</span> <span class="dv">2</span> <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="b5012254-21"><a href="#b5012254-21" aria-hidden="true" tabindex="-1"></a>    N <span class="op">+=</span> <span class="dv">1</span></span>
<span id="b5012254-22"><a href="#b5012254-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-23"><a href="#b5012254-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the grid in the frequency domain (v)</span></span>
<span id="b5012254-24"><a href="#b5012254-24" aria-hidden="true" tabindex="-1"></a>v <span class="op">=</span> np.arange(N) <span class="op">*</span> eta  <span class="co"># v_j = j * eta</span></span>
<span id="b5012254-25"><a href="#b5012254-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-26"><a href="#b5012254-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the grid in the log-strike domain (k)</span></span>
<span id="b5012254-27"><a href="#b5012254-27" aria-hidden="true" tabindex="-1"></a>lambda_ <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> np.pi) <span class="op">/</span> (N <span class="op">*</span> eta)</span>
<span id="b5012254-28"><a href="#b5012254-28" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> N <span class="op">*</span> lambda_ <span class="op">/</span> <span class="dv">2</span>  <span class="co"># Upper limit for k</span></span>
<span id="b5012254-29"><a href="#b5012254-29" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="op">-</span>b <span class="op">+</span> lambda_ <span class="op">*</span> np.arange(N)  <span class="co"># k_i = -b + i * lambda</span></span>
<span id="b5012254-30"><a href="#b5012254-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-31"><a href="#b5012254-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-32"><a href="#b5012254-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> phi(u):</span>
<span id="b5012254-33"><a href="#b5012254-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Characteristic function of log(S_T) under the Black-Scholes model."""</span></span>
<span id="b5012254-34"><a href="#b5012254-34" aria-hidden="true" tabindex="-1"></a>    mu <span class="op">=</span> np.log(S0) <span class="op">+</span> (r <span class="op">-</span> q <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> sigma<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> T</span>
<span id="b5012254-35"><a href="#b5012254-35" aria-hidden="true" tabindex="-1"></a>    variance <span class="op">=</span> sigma<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> T</span>
<span id="b5012254-36"><a href="#b5012254-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.exp(<span class="ot">1j</span> <span class="op">*</span> u <span class="op">*</span> mu <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> variance <span class="op">*</span> u<span class="op">**</span><span class="dv">2</span>)</span>
<span id="b5012254-37"><a href="#b5012254-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-38"><a href="#b5012254-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-39"><a href="#b5012254-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjustment to the characteristic function for damping</span></span>
<span id="b5012254-40"><a href="#b5012254-40" aria-hidden="true" tabindex="-1"></a>u <span class="op">=</span> v <span class="op">-</span> (alpha <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="ot">1j</span></span>
<span id="b5012254-41"><a href="#b5012254-41" aria-hidden="true" tabindex="-1"></a>psi <span class="op">=</span> np.exp(<span class="op">-</span>r <span class="op">*</span> T) <span class="op">*</span> phi(u) <span class="op">/</span> (alpha<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> alpha <span class="op">-</span> v<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="ot">1j</span> <span class="op">*</span> (<span class="dv">2</span> <span class="op">*</span> alpha <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> v)</span>
<span id="b5012254-42"><a href="#b5012254-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-43"><a href="#b5012254-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   Simpson's Rule weights</span></span>
<span id="b5012254-44"><a href="#b5012254-44" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> np.ones(N)</span>
<span id="b5012254-45"><a href="#b5012254-45" aria-hidden="true" tabindex="-1"></a>w[<span class="dv">0</span>] <span class="op">=</span> w[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="b5012254-46"><a href="#b5012254-46" aria-hidden="true" tabindex="-1"></a>w[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>:<span class="dv">2</span>] <span class="op">=</span> <span class="dv">4</span>  <span class="co"># Weights for odd indices</span></span>
<span id="b5012254-47"><a href="#b5012254-47" aria-hidden="true" tabindex="-1"></a>w[<span class="dv">2</span>:<span class="op">-</span><span class="dv">1</span>:<span class="dv">2</span>] <span class="op">=</span> <span class="dv">2</span>  <span class="co"># Weights for even indices</span></span>
<span id="b5012254-48"><a href="#b5012254-48" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> w <span class="op">*</span> (eta <span class="op">/</span> <span class="dv">3</span>)</span>
<span id="b5012254-49"><a href="#b5012254-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-50"><a href="#b5012254-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to be transformed with   weights</span></span>
<span id="b5012254-51"><a href="#b5012254-51" aria-hidden="true" tabindex="-1"></a>fft_input <span class="op">=</span> psi <span class="op">*</span> np.exp(<span class="ot">1j</span> <span class="op">*</span> v <span class="op">*</span> b) <span class="op">*</span> w</span>
<span id="b5012254-52"><a href="#b5012254-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-53"><a href="#b5012254-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the FFT</span></span>
<span id="b5012254-54"><a href="#b5012254-54" aria-hidden="true" tabindex="-1"></a>fft_output <span class="op">=</span> fft(fft_input)</span>
<span id="b5012254-55"><a href="#b5012254-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-56"><a href="#b5012254-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the option prices</span></span>
<span id="b5012254-57"><a href="#b5012254-57" aria-hidden="true" tabindex="-1"></a>C_k <span class="op">=</span> np.exp(<span class="op">-</span>alpha <span class="op">*</span> k) <span class="op">/</span> np.pi <span class="op">*</span> np.real(fft_output)</span>
<span id="b5012254-58"><a href="#b5012254-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-59"><a href="#b5012254-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert strikes to log-strikes</span></span>
<span id="b5012254-60"><a href="#b5012254-60" aria-hidden="true" tabindex="-1"></a>log_K <span class="op">=</span> np.log(K)</span>
<span id="b5012254-61"><a href="#b5012254-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-62"><a href="#b5012254-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpolate the option prices at desired strikes</span></span>
<span id="b5012254-63"><a href="#b5012254-63" aria-hidden="true" tabindex="-1"></a>call_prices_fft <span class="op">=</span> np.interp(log_K, k, C_k)</span>
<span id="b5012254-64"><a href="#b5012254-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-65"><a href="#b5012254-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-66"><a href="#b5012254-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Black-Scholes formula for European call options</span></span>
<span id="b5012254-67"><a href="#b5012254-67" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> black_scholes_call(S0, K, T, r, sigma, q):</span>
<span id="b5012254-68"><a href="#b5012254-68" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Black-Scholes formula for European call options."""</span></span>
<span id="b5012254-69"><a href="#b5012254-69" aria-hidden="true" tabindex="-1"></a>    d1 <span class="op">=</span> (np.log(S0 <span class="op">/</span> K) <span class="op">+</span> (r <span class="op">-</span> q <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> sigma<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> T) <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(T))</span>
<span id="b5012254-70"><a href="#b5012254-70" aria-hidden="true" tabindex="-1"></a>    d2 <span class="op">=</span> d1 <span class="op">-</span> sigma <span class="op">*</span> np.sqrt(T)</span>
<span id="b5012254-71"><a href="#b5012254-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.exp(<span class="op">-</span>q <span class="op">*</span> T) <span class="op">*</span> S0 <span class="op">*</span> norm.cdf(d1) <span class="op">-</span> K <span class="op">*</span> np.exp(<span class="op">-</span>r <span class="op">*</span> T) <span class="op">*</span> norm.cdf(d2)</span>
<span id="b5012254-72"><a href="#b5012254-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-73"><a href="#b5012254-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-74"><a href="#b5012254-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute Black-Scholes prices</span></span>
<span id="b5012254-75"><a href="#b5012254-75" aria-hidden="true" tabindex="-1"></a>call_prices_bs <span class="op">=</span> black_scholes_call(S0, K, T, r, sigma, q)</span>
<span id="b5012254-76"><a href="#b5012254-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-77"><a href="#b5012254-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot comparison</span></span>
<span id="b5012254-78"><a href="#b5012254-78" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="b5012254-79"><a href="#b5012254-79" aria-hidden="true" tabindex="-1"></a>plt.plot(K, call_prices_fft, label<span class="op">=</span><span class="st">"Carr-Madan FFT Price"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="b5012254-80"><a href="#b5012254-80" aria-hidden="true" tabindex="-1"></a>plt.plot(K, call_prices_bs, label<span class="op">=</span><span class="st">"Black-Scholes Price"</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="b5012254-81"><a href="#b5012254-81" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Strike Price K"</span>)</span>
<span id="b5012254-82"><a href="#b5012254-82" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Option Price"</span>)</span>
<span id="b5012254-83"><a href="#b5012254-83" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Comparison of Carr-Madan FFT and Black-Scholes Prices"</span>)</span>
<span id="b5012254-84"><a href="#b5012254-84" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="b5012254-85"><a href="#b5012254-85" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="b5012254-86"><a href="#b5012254-86" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="b5012254-87"><a href="#b5012254-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="b5012254-88"><a href="#b5012254-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Optionally, plot the absolute difference</span></span>
<span id="b5012254-89"><a href="#b5012254-89" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="b5012254-90"><a href="#b5012254-90" aria-hidden="true" tabindex="-1"></a>plt.plot(K, np.<span class="bu">abs</span>(call_prices_fft <span class="op">-</span> call_prices_bs), label<span class="op">=</span><span class="st">"Absolute Difference"</span>)</span>
<span id="b5012254-91"><a href="#b5012254-91" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Strike Price K"</span>)</span>
<span id="b5012254-92"><a href="#b5012254-92" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Price Difference"</span>)</span>
<span id="b5012254-93"><a href="#b5012254-93" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Absolute Difference between Carr-Madan FFT and Black-Scholes Prices"</span>)</span>
<span id="b5012254-94"><a href="#b5012254-94" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="b5012254-95"><a href="#b5012254-95" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="b5012254-96"><a href="#b5012254-96" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter_Fourier_files/figure-html/cell-2-output-1.png" width="808" height="523" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter_Fourier_files/figure-html/cell-2-output-2.png" width="846" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="pricing-a-european-call-option-under-the-heston-1993-model" class="level3">
<h3 class="anchored" data-anchor-id="pricing-a-european-call-option-under-the-heston-1993-model">Pricing a European Call Option under the Heston (1993) Model</h3>
<p>In the Heston stochastic volatility model <span class="citation" data-cites="Heston">(<a href="#ref-Heston" role="doc-biblioref">Heston 1993</a>)</span>, the dynamics of the asset price <span class="math inline">\(S_t\)</span> and its variance <span class="math inline">\(v_t\)</span> are given by the following stochastic differential equations (SDEs):</p>
<p><span class="math display">\[
dS_t = \mu S_t dt + \sqrt{v_t} S_t dW_t^S
\]</span> <span class="math display">\[
dv_t = \kappa(\theta - v_t)dt + \sigma \sqrt{v_t} dW_t^v
\]</span></p>
<p>Where <span class="math inline">\(v_t\)</span> is the stochastic variance, <span class="math inline">\(\kappa\)</span> is the rate at which <span class="math inline">\(v_t\)</span> reverts to the long-term mean <span class="math inline">\(\theta\)</span>, <span class="math inline">\(\sigma\)</span> is the volatility of volatility, <span class="math inline">\(W_t^S\)</span> and <span class="math inline">\(W_t^v\)</span> are two Wiener processes with correlation coefficient <span class="math inline">\(\rho\)</span>.</p>
<p>The characteristic function is more complex and involves solving a system of differential equations. The characteristic function of <span class="math inline">\(\ln(S_t)\)</span> for the Heston model is given by (for derivation details, see Heston (1993)):</p>
<p><span class="math display">\[
\begin{multline}
\phi(u) = \exp\left\{ i u \left( \ln(S_0) + (r-q) T \right) + \frac{\kappa \theta}{\sigma^2} \left[ (b - d) T - 2 \ln\left( \frac{1 - g e^{-d T}}{1 - g} \right) \right]\\ + \frac{b - d}{\sigma^2} \left( \frac{1 - e^{-d T}}{1 - g e^{-d T}} \right) v_0 \right\},
\end{multline}
\]</span> where <span class="math display">\[
\begin{aligned}
b &amp;= \kappa +\lambda- \rho \sigma i u, \\
d &amp;= \sqrt{( \rho \sigma i u - b )^2 + \sigma^2 (i u + u^2)}, \\
g &amp;= \frac{b - d}{b + d}, \\
\end{aligned}
\]</span> <span class="math inline">\(v_0\)</span> is the initial variance (volatility squared), <span class="math inline">\(q\)</span> is the dividend yield, <span class="math inline">\(\theta\)</span> is the long-term mean of the variance, <span class="math inline">\(\kappa\)</span> is the rate at which the variance reverts to <span class="math inline">\(\theta\)</span>, <span class="math inline">\(\rho\)</span> is the correlation between the asset price and its volatility, <span class="math inline">\(\sigma\)</span> is the volatility of volatility, and <span class="math inline">\(\lambda\)</span> is the volatility risk premium.</p>
<p>The following Python code implements the Carr-Madan method to price a European call option under the Heston Model and compare it to the prices obtained from simulation. The results suggest that the Carr-Madan method yields almost the same prices as those from Monte Carlo simulation. In addition, the Carr-Madan method runs hundreds of times faster than simulation.</p>
<div id="4cc88f46" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="4cc88f46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="4cc88f46-1"><a href="#4cc88f46-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="4cc88f46-2"><a href="#4cc88f46-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="4cc88f46-3"><a href="#4cc88f46-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="4cc88f46-4"><a href="#4cc88f46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-5"><a href="#4cc88f46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="4cc88f46-6"><a href="#4cc88f46-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Define Heston Model Parameters</span></span>
<span id="4cc88f46-7"><a href="#4cc88f46-7" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="4cc88f46-8"><a href="#4cc88f46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-9"><a href="#4cc88f46-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Market parameters</span></span>
<span id="4cc88f46-10"><a href="#4cc88f46-10" aria-hidden="true" tabindex="-1"></a>S0 <span class="op">=</span> <span class="dv">100</span>  <span class="co"># Initial stock price</span></span>
<span id="4cc88f46-11"><a href="#4cc88f46-11" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.05</span>  <span class="co"># Risk-free interest rate</span></span>
<span id="4cc88f46-12"><a href="#4cc88f46-12" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="fl">0.02</span>  <span class="co"># Dividend yield</span></span>
<span id="4cc88f46-13"><a href="#4cc88f46-13" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="fl">1.0</span>  <span class="co"># Time to maturity (in years)</span></span>
<span id="4cc88f46-14"><a href="#4cc88f46-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-15"><a href="#4cc88f46-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Heston model parameters</span></span>
<span id="4cc88f46-16"><a href="#4cc88f46-16" aria-hidden="true" tabindex="-1"></a>kappa <span class="op">=</span> <span class="fl">1.5</span>  <span class="co"># Speed of mean reversion of variance</span></span>
<span id="4cc88f46-17"><a href="#4cc88f46-17" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> <span class="fl">0.04</span>  <span class="co"># Long-term variance</span></span>
<span id="4cc88f46-18"><a href="#4cc88f46-18" aria-hidden="true" tabindex="-1"></a>sigma_v <span class="op">=</span> <span class="fl">0.3</span>  <span class="co"># Volatility of variance (vol of vol)</span></span>
<span id="4cc88f46-19"><a href="#4cc88f46-19" aria-hidden="true" tabindex="-1"></a>rho <span class="op">=</span> <span class="op">-</span><span class="fl">0.7</span>  <span class="co"># Correlation between asset and variance</span></span>
<span id="4cc88f46-20"><a href="#4cc88f46-20" aria-hidden="true" tabindex="-1"></a>v0 <span class="op">=</span> <span class="fl">0.04</span>  <span class="co"># Initial variance</span></span>
<span id="4cc88f46-21"><a href="#4cc88f46-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-22"><a href="#4cc88f46-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Carr-Madan parameters (Enhanced)</span></span>
<span id="4cc88f46-23"><a href="#4cc88f46-23" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">1.5</span>  <span class="co"># Dampening factor (&gt; 0)</span></span>
<span id="4cc88f46-24"><a href="#4cc88f46-24" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">2</span><span class="op">**</span><span class="dv">16</span>  <span class="co"># Number of FFT points (power of 2)</span></span>
<span id="4cc88f46-25"><a href="#4cc88f46-25" aria-hidden="true" tabindex="-1"></a>eta <span class="op">=</span> <span class="fl">0.25</span>  <span class="co"># Spacing of the grid in Fourier space</span></span>
<span id="4cc88f46-26"><a href="#4cc88f46-26" aria-hidden="true" tabindex="-1"></a>lambda_ <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> np.pi) <span class="op">/</span> (N <span class="op">*</span> eta)  <span class="co"># Spacing in log-strike space</span></span>
<span id="4cc88f46-27"><a href="#4cc88f46-27" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> N <span class="op">*</span> lambda_ <span class="op">/</span> <span class="dv">2</span>  <span class="co"># Upper bound of log-strike</span></span>
<span id="4cc88f46-28"><a href="#4cc88f46-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-29"><a href="#4cc88f46-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Monte Carlo simulation parameters (Enhanced)</span></span>
<span id="4cc88f46-30"><a href="#4cc88f46-30" aria-hidden="true" tabindex="-1"></a>num_paths <span class="op">=</span> <span class="dv">100000</span>  <span class="co"># Number of simulated paths</span></span>
<span id="4cc88f46-31"><a href="#4cc88f46-31" aria-hidden="true" tabindex="-1"></a>num_steps <span class="op">=</span> <span class="dv">500</span>  <span class="co"># Number of time steps</span></span>
<span id="4cc88f46-32"><a href="#4cc88f46-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-33"><a href="#4cc88f46-33" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="4cc88f46-34"><a href="#4cc88f46-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Define the Heston Characteristic Function</span></span>
<span id="4cc88f46-35"><a href="#4cc88f46-35" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="4cc88f46-36"><a href="#4cc88f46-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-37"><a href="#4cc88f46-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-38"><a href="#4cc88f46-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> heston_char_func(u, T, kappa, theta, sigma_v, rho, v0, r, q, S0):</span>
<span id="4cc88f46-39"><a href="#4cc88f46-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="4cc88f46-40"><a href="#4cc88f46-40" aria-hidden="true" tabindex="-1"></a><span class="co">    Characteristic function of log(S_T) under the Heston model.</span></span>
<span id="4cc88f46-41"><a href="#4cc88f46-41" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="4cc88f46-42"><a href="#4cc88f46-42" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="ot">1j</span></span>
<span id="4cc88f46-43"><a href="#4cc88f46-43" aria-hidden="true" tabindex="-1"></a>    sigma <span class="op">=</span> sigma_v</span>
<span id="4cc88f46-44"><a href="#4cc88f46-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-45"><a href="#4cc88f46-45" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> np.sqrt((rho <span class="op">*</span> sigma <span class="op">*</span> i <span class="op">*</span> u <span class="op">-</span> kappa) <span class="op">**</span> <span class="dv">2</span> <span class="op">+</span> sigma<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> (i <span class="op">*</span> u <span class="op">+</span> u<span class="op">**</span><span class="dv">2</span>))</span>
<span id="4cc88f46-46"><a href="#4cc88f46-46" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> (kappa <span class="op">-</span> rho <span class="op">*</span> sigma <span class="op">*</span> i <span class="op">*</span> u <span class="op">-</span> d) <span class="op">/</span> (kappa <span class="op">-</span> rho <span class="op">*</span> sigma <span class="op">*</span> i <span class="op">*</span> u <span class="op">+</span> d)</span>
<span id="4cc88f46-47"><a href="#4cc88f46-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-48"><a href="#4cc88f46-48" aria-hidden="true" tabindex="-1"></a>    exp_dT <span class="op">=</span> np.exp(<span class="op">-</span>d <span class="op">*</span> T)</span>
<span id="4cc88f46-49"><a href="#4cc88f46-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-50"><a href="#4cc88f46-50" aria-hidden="true" tabindex="-1"></a>    C <span class="op">=</span> (np.log(S0) <span class="op">+</span> (r <span class="op">-</span> q) <span class="op">*</span> T) <span class="op">*</span> i <span class="op">*</span> u <span class="op">+</span> (kappa <span class="op">*</span> theta <span class="op">/</span> sigma<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> (</span>
<span id="4cc88f46-51"><a href="#4cc88f46-51" aria-hidden="true" tabindex="-1"></a>        (kappa <span class="op">-</span> rho <span class="op">*</span> sigma <span class="op">*</span> i <span class="op">*</span> u <span class="op">-</span> d) <span class="op">*</span> T <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> np.log((<span class="dv">1</span> <span class="op">-</span> g <span class="op">*</span> exp_dT) <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> g))</span>
<span id="4cc88f46-52"><a href="#4cc88f46-52" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="4cc88f46-53"><a href="#4cc88f46-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-54"><a href="#4cc88f46-54" aria-hidden="true" tabindex="-1"></a>    D <span class="op">=</span> ((kappa <span class="op">-</span> rho <span class="op">*</span> sigma <span class="op">*</span> i <span class="op">*</span> u <span class="op">-</span> d) <span class="op">/</span> sigma<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> (</span>
<span id="4cc88f46-55"><a href="#4cc88f46-55" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">1</span> <span class="op">-</span> exp_dT) <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> g <span class="op">*</span> exp_dT)</span>
<span id="4cc88f46-56"><a href="#4cc88f46-56" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="4cc88f46-57"><a href="#4cc88f46-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-58"><a href="#4cc88f46-58" aria-hidden="true" tabindex="-1"></a>    phi <span class="op">=</span> np.exp(C <span class="op">+</span> D <span class="op">*</span> v0)</span>
<span id="4cc88f46-59"><a href="#4cc88f46-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> phi</span>
<span id="4cc88f46-60"><a href="#4cc88f46-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-61"><a href="#4cc88f46-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-62"><a href="#4cc88f46-62" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="4cc88f46-63"><a href="#4cc88f46-63" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Carr-Madan Option Pricing Function (Enhanced)</span></span>
<span id="4cc88f46-64"><a href="#4cc88f46-64" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="4cc88f46-65"><a href="#4cc88f46-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-66"><a href="#4cc88f46-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-67"><a href="#4cc88f46-67" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> carr_madan_call_price(S0, r, q, T, kappa, theta, sigma_v, rho, v0, alpha, N, eta):</span>
<span id="4cc88f46-68"><a href="#4cc88f46-68" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="4cc88f46-69"><a href="#4cc88f46-69" aria-hidden="true" tabindex="-1"></a><span class="co">    Calculate the European call option prices using Carr-Madan method under Heston model.</span></span>
<span id="4cc88f46-70"><a href="#4cc88f46-70" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="4cc88f46-71"><a href="#4cc88f46-71" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="ot">1j</span></span>
<span id="4cc88f46-72"><a href="#4cc88f46-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 1: Compute the modified characteristic function</span></span>
<span id="4cc88f46-73"><a href="#4cc88f46-73" aria-hidden="true" tabindex="-1"></a>    u <span class="op">=</span> np.arange(N) <span class="op">*</span> eta  <span class="co"># u values</span></span>
<span id="4cc88f46-74"><a href="#4cc88f46-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-75"><a href="#4cc88f46-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Avoid division by zero</span></span>
<span id="4cc88f46-76"><a href="#4cc88f46-76" aria-hidden="true" tabindex="-1"></a>    u[<span class="dv">0</span>] <span class="op">=</span> <span class="fl">1e-22</span></span>
<span id="4cc88f46-77"><a href="#4cc88f46-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-78"><a href="#4cc88f46-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Characteristic function with dampening factor</span></span>
<span id="4cc88f46-79"><a href="#4cc88f46-79" aria-hidden="true" tabindex="-1"></a>    phi <span class="op">=</span> (</span>
<span id="4cc88f46-80"><a href="#4cc88f46-80" aria-hidden="true" tabindex="-1"></a>        np.exp(<span class="op">-</span>r <span class="op">*</span> T)</span>
<span id="4cc88f46-81"><a href="#4cc88f46-81" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span> heston_char_func(</span>
<span id="4cc88f46-82"><a href="#4cc88f46-82" aria-hidden="true" tabindex="-1"></a>            u <span class="op">-</span> (alpha <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> i, T, kappa, theta, sigma_v, rho, v0, r, q, S0</span>
<span id="4cc88f46-83"><a href="#4cc88f46-83" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="4cc88f46-84"><a href="#4cc88f46-84" aria-hidden="true" tabindex="-1"></a>        <span class="op">/</span> (alpha<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> alpha <span class="op">-</span> u<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> i <span class="op">*</span> (<span class="dv">2</span> <span class="op">*</span> alpha <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> u)</span>
<span id="4cc88f46-85"><a href="#4cc88f46-85" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="4cc88f46-86"><a href="#4cc88f46-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-87"><a href="#4cc88f46-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 2: Apply Simpson's Rule weights</span></span>
<span id="4cc88f46-88"><a href="#4cc88f46-88" aria-hidden="true" tabindex="-1"></a>    SimpsonW <span class="op">=</span> np.ones(N)</span>
<span id="4cc88f46-89"><a href="#4cc88f46-89" aria-hidden="true" tabindex="-1"></a>    SimpsonW[<span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="4cc88f46-90"><a href="#4cc88f46-90" aria-hidden="true" tabindex="-1"></a>    SimpsonW[<span class="dv">1</span> : N <span class="op">-</span> <span class="dv">1</span> : <span class="dv">2</span>] <span class="op">=</span> <span class="dv">4</span></span>
<span id="4cc88f46-91"><a href="#4cc88f46-91" aria-hidden="true" tabindex="-1"></a>    SimpsonW[<span class="dv">2</span> : N <span class="op">-</span> <span class="dv">2</span> : <span class="dv">2</span>] <span class="op">=</span> <span class="dv">2</span></span>
<span id="4cc88f46-92"><a href="#4cc88f46-92" aria-hidden="true" tabindex="-1"></a>    SimpsonW[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="4cc88f46-93"><a href="#4cc88f46-93" aria-hidden="true" tabindex="-1"></a>    SimpsonW <span class="op">=</span> SimpsonW <span class="op">*</span> (eta <span class="op">/</span> <span class="dv">3</span>)</span>
<span id="4cc88f46-94"><a href="#4cc88f46-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-95"><a href="#4cc88f46-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 3: Compute the FFT</span></span>
<span id="4cc88f46-96"><a href="#4cc88f46-96" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> phi <span class="op">*</span> np.exp(i <span class="op">*</span> b <span class="op">*</span> u) <span class="op">*</span> SimpsonW</span>
<span id="4cc88f46-97"><a href="#4cc88f46-97" aria-hidden="true" tabindex="-1"></a>    fft_x <span class="op">=</span> np.fft.fft(x)</span>
<span id="4cc88f46-98"><a href="#4cc88f46-98" aria-hidden="true" tabindex="-1"></a>    fft_x <span class="op">=</span> np.real(fft_x)</span>
<span id="4cc88f46-99"><a href="#4cc88f46-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-100"><a href="#4cc88f46-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 4: Recover the call prices</span></span>
<span id="4cc88f46-101"><a href="#4cc88f46-101" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="op">-</span>b <span class="op">+</span> np.arange(N) <span class="op">*</span> lambda_</span>
<span id="4cc88f46-102"><a href="#4cc88f46-102" aria-hidden="true" tabindex="-1"></a>    K <span class="op">=</span> np.exp(k)</span>
<span id="4cc88f46-103"><a href="#4cc88f46-103" aria-hidden="true" tabindex="-1"></a>    call_prices <span class="op">=</span> np.exp(<span class="op">-</span>alpha <span class="op">*</span> k) <span class="op">/</span> np.pi <span class="op">*</span> fft_x</span>
<span id="4cc88f46-104"><a href="#4cc88f46-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-105"><a href="#4cc88f46-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> K, call_prices</span>
<span id="4cc88f46-106"><a href="#4cc88f46-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-107"><a href="#4cc88f46-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-108"><a href="#4cc88f46-108" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="4cc88f46-109"><a href="#4cc88f46-109" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Monte Carlo Simulation Function (Enhanced)</span></span>
<span id="4cc88f46-110"><a href="#4cc88f46-110" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="4cc88f46-111"><a href="#4cc88f46-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-112"><a href="#4cc88f46-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-113"><a href="#4cc88f46-113" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> heston_simulation(</span>
<span id="4cc88f46-114"><a href="#4cc88f46-114" aria-hidden="true" tabindex="-1"></a>    S0, v0, r, q, T, kappa, theta, sigma_v, rho, num_paths, num_steps</span>
<span id="4cc88f46-115"><a href="#4cc88f46-115" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="4cc88f46-116"><a href="#4cc88f46-116" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="4cc88f46-117"><a href="#4cc88f46-117" aria-hidden="true" tabindex="-1"></a><span class="co">    Simulate asset price paths under the Heston model using antithetic variates.</span></span>
<span id="4cc88f46-118"><a href="#4cc88f46-118" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="4cc88f46-119"><a href="#4cc88f46-119" aria-hidden="true" tabindex="-1"></a>    dt <span class="op">=</span> T <span class="op">/</span> num_steps</span>
<span id="4cc88f46-120"><a href="#4cc88f46-120" aria-hidden="true" tabindex="-1"></a>    sqrt_dt <span class="op">=</span> np.sqrt(dt)</span>
<span id="4cc88f46-121"><a href="#4cc88f46-121" aria-hidden="true" tabindex="-1"></a>    np.random.seed(<span class="dv">0</span>)  <span class="co"># For reproducibility</span></span>
<span id="4cc88f46-122"><a href="#4cc88f46-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-123"><a href="#4cc88f46-123" aria-hidden="true" tabindex="-1"></a>    num_paths_half <span class="op">=</span> num_paths <span class="op">//</span> <span class="dv">2</span></span>
<span id="4cc88f46-124"><a href="#4cc88f46-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-125"><a href="#4cc88f46-125" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize arrays</span></span>
<span id="4cc88f46-126"><a href="#4cc88f46-126" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> np.zeros((num_paths, num_steps <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="4cc88f46-127"><a href="#4cc88f46-127" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> np.zeros((num_paths, num_steps <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="4cc88f46-128"><a href="#4cc88f46-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-129"><a href="#4cc88f46-129" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set initial values</span></span>
<span id="4cc88f46-130"><a href="#4cc88f46-130" aria-hidden="true" tabindex="-1"></a>    S[:, <span class="dv">0</span>] <span class="op">=</span> S0</span>
<span id="4cc88f46-131"><a href="#4cc88f46-131" aria-hidden="true" tabindex="-1"></a>    v[:, <span class="dv">0</span>] <span class="op">=</span> v0</span>
<span id="4cc88f46-132"><a href="#4cc88f46-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-133"><a href="#4cc88f46-133" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cholesky decomposition for correlated Brownian motions</span></span>
<span id="4cc88f46-134"><a href="#4cc88f46-134" aria-hidden="true" tabindex="-1"></a>    cov_matrix <span class="op">=</span> np.array([[<span class="fl">1.0</span>, rho], [rho, <span class="fl">1.0</span>]])</span>
<span id="4cc88f46-135"><a href="#4cc88f46-135" aria-hidden="true" tabindex="-1"></a>    L <span class="op">=</span> np.linalg.cholesky(cov_matrix)</span>
<span id="4cc88f46-136"><a href="#4cc88f46-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-137"><a href="#4cc88f46-137" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, num_steps <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="4cc88f46-138"><a href="#4cc88f46-138" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Generate standard normal random variables</span></span>
<span id="4cc88f46-139"><a href="#4cc88f46-139" aria-hidden="true" tabindex="-1"></a>        Z <span class="op">=</span> np.random.randn(num_paths_half, <span class="dv">2</span>)</span>
<span id="4cc88f46-140"><a href="#4cc88f46-140" aria-hidden="true" tabindex="-1"></a>        Z_antithetic <span class="op">=</span> <span class="op">-</span>Z  <span class="co"># Antithetic variates</span></span>
<span id="4cc88f46-141"><a href="#4cc88f46-141" aria-hidden="true" tabindex="-1"></a>        Z_full <span class="op">=</span> np.vstack((Z, Z_antithetic))</span>
<span id="4cc88f46-142"><a href="#4cc88f46-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-143"><a href="#4cc88f46-143" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Correlated random variables</span></span>
<span id="4cc88f46-144"><a href="#4cc88f46-144" aria-hidden="true" tabindex="-1"></a>        dW <span class="op">=</span> np.dot(Z_full, L.T) <span class="op">*</span> sqrt_dt</span>
<span id="4cc88f46-145"><a href="#4cc88f46-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-146"><a href="#4cc88f46-146" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update variance process using full truncation Euler scheme</span></span>
<span id="4cc88f46-147"><a href="#4cc88f46-147" aria-hidden="true" tabindex="-1"></a>        v_prev <span class="op">=</span> v[:, t <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="4cc88f46-148"><a href="#4cc88f46-148" aria-hidden="true" tabindex="-1"></a>        sqrt_v_prev <span class="op">=</span> np.sqrt(np.maximum(v_prev, <span class="dv">0</span>))</span>
<span id="4cc88f46-149"><a href="#4cc88f46-149" aria-hidden="true" tabindex="-1"></a>        dv <span class="op">=</span> (</span>
<span id="4cc88f46-150"><a href="#4cc88f46-150" aria-hidden="true" tabindex="-1"></a>            kappa <span class="op">*</span> (theta <span class="op">-</span> np.maximum(v_prev, <span class="dv">0</span>)) <span class="op">*</span> dt</span>
<span id="4cc88f46-151"><a href="#4cc88f46-151" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> sigma_v <span class="op">*</span> sqrt_v_prev <span class="op">*</span> dW[:, <span class="dv">1</span>]</span>
<span id="4cc88f46-152"><a href="#4cc88f46-152" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="4cc88f46-153"><a href="#4cc88f46-153" aria-hidden="true" tabindex="-1"></a>        v[:, t] <span class="op">=</span> np.maximum(v_prev <span class="op">+</span> dv, <span class="dv">0</span>)  <span class="co"># Ensure variance is non-negative</span></span>
<span id="4cc88f46-154"><a href="#4cc88f46-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-155"><a href="#4cc88f46-155" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update asset price</span></span>
<span id="4cc88f46-156"><a href="#4cc88f46-156" aria-hidden="true" tabindex="-1"></a>        S_prev <span class="op">=</span> S[:, t <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="4cc88f46-157"><a href="#4cc88f46-157" aria-hidden="true" tabindex="-1"></a>        S[:, t] <span class="op">=</span> S_prev <span class="op">*</span> np.exp(</span>
<span id="4cc88f46-158"><a href="#4cc88f46-158" aria-hidden="true" tabindex="-1"></a>            (r <span class="op">-</span> q <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> np.maximum(v_prev, <span class="dv">0</span>)) <span class="op">*</span> dt <span class="op">+</span> sqrt_v_prev <span class="op">*</span> dW[:, <span class="dv">0</span>]</span>
<span id="4cc88f46-159"><a href="#4cc88f46-159" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="4cc88f46-160"><a href="#4cc88f46-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-161"><a href="#4cc88f46-161" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return asset prices at maturity</span></span>
<span id="4cc88f46-162"><a href="#4cc88f46-162" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> S[:, <span class="op">-</span><span class="dv">1</span>]</span>
<span id="4cc88f46-163"><a href="#4cc88f46-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-164"><a href="#4cc88f46-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-165"><a href="#4cc88f46-165" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> heston_option_pricing(</span>
<span id="4cc88f46-166"><a href="#4cc88f46-166" aria-hidden="true" tabindex="-1"></a>    S0, v0, r, q, T, kappa, theta, sigma_v, rho, num_paths, num_steps, K_values</span>
<span id="4cc88f46-167"><a href="#4cc88f46-167" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="4cc88f46-168"><a href="#4cc88f46-168" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="4cc88f46-169"><a href="#4cc88f46-169" aria-hidden="true" tabindex="-1"></a><span class="co">    Price European call options using Monte Carlo simulation under the Heston model.</span></span>
<span id="4cc88f46-170"><a href="#4cc88f46-170" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="4cc88f46-171"><a href="#4cc88f46-171" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simulate asset prices at maturity</span></span>
<span id="4cc88f46-172"><a href="#4cc88f46-172" aria-hidden="true" tabindex="-1"></a>    S_T <span class="op">=</span> heston_simulation(</span>
<span id="4cc88f46-173"><a href="#4cc88f46-173" aria-hidden="true" tabindex="-1"></a>        S0, v0, r, q, T, kappa, theta, sigma_v, rho, num_paths, num_steps</span>
<span id="4cc88f46-174"><a href="#4cc88f46-174" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="4cc88f46-175"><a href="#4cc88f46-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-176"><a href="#4cc88f46-176" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize array for call prices</span></span>
<span id="4cc88f46-177"><a href="#4cc88f46-177" aria-hidden="true" tabindex="-1"></a>    call_prices <span class="op">=</span> np.zeros_like(K_values)</span>
<span id="4cc88f46-178"><a href="#4cc88f46-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-179"><a href="#4cc88f46-179" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Discount factor</span></span>
<span id="4cc88f46-180"><a href="#4cc88f46-180" aria-hidden="true" tabindex="-1"></a>    discount_factor <span class="op">=</span> np.exp(<span class="op">-</span>r <span class="op">*</span> T)</span>
<span id="4cc88f46-181"><a href="#4cc88f46-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-182"><a href="#4cc88f46-182" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate option prices for each strike price</span></span>
<span id="4cc88f46-183"><a href="#4cc88f46-183" aria-hidden="true" tabindex="-1"></a>    payoffs_matrix <span class="op">=</span> np.maximum(S_T[:, np.newaxis] <span class="op">-</span> K_values, <span class="dv">0</span>)</span>
<span id="4cc88f46-184"><a href="#4cc88f46-184" aria-hidden="true" tabindex="-1"></a>    call_prices <span class="op">=</span> discount_factor <span class="op">*</span> np.mean(payoffs_matrix, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="4cc88f46-185"><a href="#4cc88f46-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-186"><a href="#4cc88f46-186" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> call_prices</span>
<span id="4cc88f46-187"><a href="#4cc88f46-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-188"><a href="#4cc88f46-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-189"><a href="#4cc88f46-189" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="4cc88f46-190"><a href="#4cc88f46-190" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Calculate Option Prices Using Both Methods</span></span>
<span id="4cc88f46-191"><a href="#4cc88f46-191" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="4cc88f46-192"><a href="#4cc88f46-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-193"><a href="#4cc88f46-193" aria-hidden="true" tabindex="-1"></a><span class="co"># Carr-Madan method</span></span>
<span id="4cc88f46-194"><a href="#4cc88f46-194" aria-hidden="true" tabindex="-1"></a>start_time_cm <span class="op">=</span> time.time()</span>
<span id="4cc88f46-195"><a href="#4cc88f46-195" aria-hidden="true" tabindex="-1"></a>K_cm, call_prices_cm <span class="op">=</span> carr_madan_call_price(</span>
<span id="4cc88f46-196"><a href="#4cc88f46-196" aria-hidden="true" tabindex="-1"></a>    S0, r, q, T, kappa, theta, sigma_v, rho, v0, alpha, N, eta</span>
<span id="4cc88f46-197"><a href="#4cc88f46-197" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="4cc88f46-198"><a href="#4cc88f46-198" aria-hidden="true" tabindex="-1"></a>end_time_cm <span class="op">=</span> time.time()</span>
<span id="4cc88f46-199"><a href="#4cc88f46-199" aria-hidden="true" tabindex="-1"></a>time_cm <span class="op">=</span> end_time_cm <span class="op">-</span> start_time_cm</span>
<span id="4cc88f46-200"><a href="#4cc88f46-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-201"><a href="#4cc88f46-201" aria-hidden="true" tabindex="-1"></a><span class="co"># Select strike prices between 60 and 140</span></span>
<span id="4cc88f46-202"><a href="#4cc88f46-202" aria-hidden="true" tabindex="-1"></a>K_indices <span class="op">=</span> np.where((K_cm <span class="op">&gt;=</span> <span class="dv">60</span>) <span class="op">&amp;</span> (K_cm <span class="op">&lt;=</span> <span class="dv">140</span>))</span>
<span id="4cc88f46-203"><a href="#4cc88f46-203" aria-hidden="true" tabindex="-1"></a>K_cm <span class="op">=</span> K_cm[K_indices]</span>
<span id="4cc88f46-204"><a href="#4cc88f46-204" aria-hidden="true" tabindex="-1"></a>call_prices_cm <span class="op">=</span> call_prices_cm[K_indices]</span>
<span id="4cc88f46-205"><a href="#4cc88f46-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-206"><a href="#4cc88f46-206" aria-hidden="true" tabindex="-1"></a><span class="co"># Monte Carlo simulation</span></span>
<span id="4cc88f46-207"><a href="#4cc88f46-207" aria-hidden="true" tabindex="-1"></a>K_mc <span class="op">=</span> np.linspace(<span class="dv">60</span>, <span class="dv">140</span>, <span class="dv">81</span>)</span>
<span id="4cc88f46-208"><a href="#4cc88f46-208" aria-hidden="true" tabindex="-1"></a>start_time_mc <span class="op">=</span> time.time()</span>
<span id="4cc88f46-209"><a href="#4cc88f46-209" aria-hidden="true" tabindex="-1"></a>call_prices_mc <span class="op">=</span> heston_option_pricing(</span>
<span id="4cc88f46-210"><a href="#4cc88f46-210" aria-hidden="true" tabindex="-1"></a>    S0, v0, r, q, T, kappa, theta, sigma_v, rho, num_paths, num_steps, K_mc</span>
<span id="4cc88f46-211"><a href="#4cc88f46-211" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="4cc88f46-212"><a href="#4cc88f46-212" aria-hidden="true" tabindex="-1"></a>end_time_mc <span class="op">=</span> time.time()</span>
<span id="4cc88f46-213"><a href="#4cc88f46-213" aria-hidden="true" tabindex="-1"></a>time_mc <span class="op">=</span> end_time_mc <span class="op">-</span> start_time_mc</span>
<span id="4cc88f46-214"><a href="#4cc88f46-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-215"><a href="#4cc88f46-215" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="4cc88f46-216"><a href="#4cc88f46-216" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Compute Price Differences</span></span>
<span id="4cc88f46-217"><a href="#4cc88f46-217" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="4cc88f46-218"><a href="#4cc88f46-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-219"><a href="#4cc88f46-219" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpolate Carr-Madan prices to match K_mc</span></span>
<span id="4cc88f46-220"><a href="#4cc88f46-220" aria-hidden="true" tabindex="-1"></a>call_prices_cm_interp <span class="op">=</span> np.interp(K_mc, K_cm, call_prices_cm)</span>
<span id="4cc88f46-221"><a href="#4cc88f46-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-222"><a href="#4cc88f46-222" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute price differences</span></span>
<span id="4cc88f46-223"><a href="#4cc88f46-223" aria-hidden="true" tabindex="-1"></a>price_differences <span class="op">=</span> np.<span class="bu">abs</span>(call_prices_cm_interp <span class="op">-</span> call_prices_mc)</span>
<span id="4cc88f46-224"><a href="#4cc88f46-224" aria-hidden="true" tabindex="-1"></a>max_diff <span class="op">=</span> np.<span class="bu">max</span>(price_differences)</span>
<span id="4cc88f46-225"><a href="#4cc88f46-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-226"><a href="#4cc88f46-226" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="4cc88f46-227"><a href="#4cc88f46-227" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Plot the Option Prices</span></span>
<span id="4cc88f46-228"><a href="#4cc88f46-228" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="4cc88f46-229"><a href="#4cc88f46-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-230"><a href="#4cc88f46-230" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="4cc88f46-231"><a href="#4cc88f46-231" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="4cc88f46-232"><a href="#4cc88f46-232" aria-hidden="true" tabindex="-1"></a>    K_mc, call_prices_cm_interp, label<span class="op">=</span><span class="st">"Carr-Madan Method"</span>, color<span class="op">=</span><span class="st">"blue"</span>, linewidth<span class="op">=</span><span class="dv">2</span></span>
<span id="4cc88f46-233"><a href="#4cc88f46-233" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="4cc88f46-234"><a href="#4cc88f46-234" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="4cc88f46-235"><a href="#4cc88f46-235" aria-hidden="true" tabindex="-1"></a>    K_mc,</span>
<span id="4cc88f46-236"><a href="#4cc88f46-236" aria-hidden="true" tabindex="-1"></a>    call_prices_mc,</span>
<span id="4cc88f46-237"><a href="#4cc88f46-237" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">"Monte Carlo Simulation"</span>,</span>
<span id="4cc88f46-238"><a href="#4cc88f46-238" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"red"</span>,</span>
<span id="4cc88f46-239"><a href="#4cc88f46-239" aria-hidden="true" tabindex="-1"></a>    linestyle<span class="op">=</span><span class="st">"--"</span>,</span>
<span id="4cc88f46-240"><a href="#4cc88f46-240" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="4cc88f46-241"><a href="#4cc88f46-241" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="4cc88f46-242"><a href="#4cc88f46-242" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Strike Price K"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="4cc88f46-243"><a href="#4cc88f46-243" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Option Price"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="4cc88f46-244"><a href="#4cc88f46-244" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"European Call Option Prices under Heston Model"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="4cc88f46-245"><a href="#4cc88f46-245" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="4cc88f46-246"><a href="#4cc88f46-246" aria-hidden="true" tabindex="-1"></a>plt.legend(fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="4cc88f46-247"><a href="#4cc88f46-247" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="4cc88f46-248"><a href="#4cc88f46-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-249"><a href="#4cc88f46-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-250"><a href="#4cc88f46-250" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="4cc88f46-251"><a href="#4cc88f46-251" aria-hidden="true" tabindex="-1"></a><span class="co"># 8. Plot Price Differences</span></span>
<span id="4cc88f46-252"><a href="#4cc88f46-252" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="4cc88f46-253"><a href="#4cc88f46-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-254"><a href="#4cc88f46-254" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="4cc88f46-255"><a href="#4cc88f46-255" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="4cc88f46-256"><a href="#4cc88f46-256" aria-hidden="true" tabindex="-1"></a>    K_mc,</span>
<span id="4cc88f46-257"><a href="#4cc88f46-257" aria-hidden="true" tabindex="-1"></a>    price_differences,</span>
<span id="4cc88f46-258"><a href="#4cc88f46-258" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">"Price Difference (Carr-Madan - MC)"</span>,</span>
<span id="4cc88f46-259"><a href="#4cc88f46-259" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"green"</span>,</span>
<span id="4cc88f46-260"><a href="#4cc88f46-260" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="4cc88f46-261"><a href="#4cc88f46-261" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="4cc88f46-262"><a href="#4cc88f46-262" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Strike Price K"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="4cc88f46-263"><a href="#4cc88f46-263" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Price Difference"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="4cc88f46-264"><a href="#4cc88f46-264" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Price Differences between Carr-Madan and Monte Carlo Methods"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="4cc88f46-265"><a href="#4cc88f46-265" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="4cc88f46-266"><a href="#4cc88f46-266" aria-hidden="true" tabindex="-1"></a>plt.legend(fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="4cc88f46-267"><a href="#4cc88f46-267" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="4cc88f46-268"><a href="#4cc88f46-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-269"><a href="#4cc88f46-269" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="4cc88f46-270"><a href="#4cc88f46-270" aria-hidden="true" tabindex="-1"></a><span class="co"># 9. Report Computation Times and Maximum Price Difference</span></span>
<span id="4cc88f46-271"><a href="#4cc88f46-271" aria-hidden="true" tabindex="-1"></a><span class="co"># -----------------------------</span></span>
<span id="4cc88f46-272"><a href="#4cc88f46-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="4cc88f46-273"><a href="#4cc88f46-273" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Computation Time (Carr-Madan Method): </span><span class="sc">{</span>time_cm<span class="sc">:.2f}</span><span class="ss"> seconds"</span>)</span>
<span id="4cc88f46-274"><a href="#4cc88f46-274" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Computation Time (Monte Carlo Simulation): </span><span class="sc">{</span>time_mc<span class="sc">:.2f}</span><span class="ss"> seconds"</span>)</span>
<span id="4cc88f46-275"><a href="#4cc88f46-275" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Maximum Price Difference: </span><span class="sc">{</span>max_diff<span class="sc">:.6f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter_Fourier_files/figure-html/cell-3-output-1.png" width="813" height="533" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter_Fourier_files/figure-html/cell-3-output-2.png" width="834" height="533" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Computation Time (Carr-Madan Method): 0.06 seconds
Computation Time (Monte Carlo Simulation): 6.02 seconds
Maximum Price Difference: 0.024669</code></pre>
</div>
</div>
</section>
<section id="pricing-options-when-stock-price-follows-a-lévy-process" class="level3">
<h3 class="anchored" data-anchor-id="pricing-options-when-stock-price-follows-a-lévy-process">Pricing Options When Stock Price Follows a Lévy Process</h3>
<p>A <strong>Lévy process</strong> is a type of stochastic process with stationary, independent increments, generalizing Brownian motion and Poisson processes. It is widely used in various fields like finance, physics, and stochastic modeling due to its ability to model random jumps and continuous changes over time.</p>
<p>Key Properties of a Lévy Process:</p>
<ol type="1">
<li><p><strong>Independent Increments</strong>: The changes (increments) in the process over non-overlapping time intervals are independent. For example, the change in the process from time <span class="math inline">\(t_1\)</span> to <span class="math inline">\(t_2\)</span> is independent of the change from time <span class="math inline">\(t_3\)</span> to <span class="math inline">\(t_4\)</span> if <span class="math inline">\(t_1 \leq t_2 \leq t_3 \leq t_4\)</span>.</p></li>
<li><p><strong>Stationary Increments</strong>: The distribution of the increment of the process depends only on the length of the time interval, not the specific time at which the interval starts. That is, the increment between times <span class="math inline">\(t\)</span> and <span class="math inline">\(t+s\)</span> has the same distribution as the increment between times 0 and <span class="math inline">\(s\)</span>.</p></li>
<li><p><strong>Stochastic Continuity</strong>: For every <span class="math inline">\(\epsilon &gt; 0\)</span> and <span class="math inline">\(t \geq 0\)</span>, the probability that the change in the process over a small interval <span class="math inline">\(h\)</span> becomes large tends to zero as <span class="math inline">\(h \to 0\)</span>. Formally, <span class="math display">\[ \lim_{h \to 0} P(|X(t+h) - X(t)| \geq \epsilon) = 0.
\]</span></p></li>
<li><p><strong>Initial Condition</strong>: Typically, a Lévy process starts at zero, <span class="math inline">\(X(0) = 0\)</span>.</p></li>
</ol>
<p>Examples of Lévy Processes:</p>
<ul>
<li><strong>Brownian Motion (Wiener Process)</strong>: A Lévy process with continuous paths and normally distributed increments.</li>
<li><strong>Poisson Process</strong>: A Lévy process where the increments represent the number of jumps (events) in a given time period, with the number of jumps following a Poisson distribution.</li>
<li><strong>Jump Diffusion Process</strong>: A Lévy process where jumps occur at random times, with the size of each jump following a specified distribution.</li>
<li><strong>Variance Gamma</strong>: A Lévy process characterized by heavy-tailed distributions, often used to model extreme events or large movements (jumps).</li>
</ul>
<p>The characteristic function of any Lévy process <span class="math inline">\(X(t)\)</span> can be expressed using the <strong>Lévy-Khintchine formula</strong>: <span class="math display">\[
\mathbb{E}[e^{itX(t)}] = e^{t\psi(t)},
\]</span> where <span class="math inline">\(\psi(t)\)</span> is called the <strong>Lévy exponent</strong> and has the form: <span class="math display">\[
\psi(t) = i\gamma t - \frac{1}{2} \sigma^2 t^2 + \int_{\mathbb{R}} \left( e^{itx} - 1 - itx \mathbf{1}_{|x| &lt; 1} \right) \nu(dx).
\]</span></p>
<p>In this formula, <span class="math inline">\(\gamma\)</span> is the drift term (linear component), <span class="math inline">\(\sigma^2\)</span> is the variance of the continuous Gaussian component, <span class="math inline">\(\nu\)</span> is the <strong>Lévy measure</strong>, which controls the intensity and size of jumps.</p>
<p>Lévy processes can thus combine continuous movements, such as Brownian motion, with jumps, providing a powerful framework for modeling both smooth and abrupt changes in time series.</p>
<p><strong>Pricing Options in the Variance Gamma Model</strong></p>
<p>Let <span class="math inline">\(S(t)\)</span> represent the stock price at time <span class="math inline">\(t\)</span>. Under the risk-neutral probability <span class="math inline">\(\mathbb{Q}\)</span>, the stock price evolves as:</p>
<p><span class="math display">\[
S(t) = S(0) \exp(X(t)),
\]</span> where <span class="math inline">\(X(t)\)</span> is a variance gamma process: <span class="math display">\[
X(t) = \left( (r - q) - \frac{1}{2} \sigma^2 - \frac{1}{\nu} \log\left(1 - \theta \nu - \frac{1}{2} \sigma^2 \nu \right) \right)t + \sigma W(G(t))
\]</span> where <span class="math inline">\(r\)</span> is the risk-free rate, <span class="math inline">\(q\)</span> is the dividend yield, <span class="math inline">\(\sigma\)</span> is the volatility parameter, <span class="math inline">\(G(t)\)</span> is a Gamma process with mean rate <span class="math inline">\(t\)</span> and variance rate <span class="math inline">\(\nu\)</span>, <span class="math inline">\(\theta\)</span> controls the drift of the VG process, <span class="math inline">\(\nu\)</span> is the variance rate of the Gamma process, and <span class="math inline">\(W(t)\)</span> is a standard Brownian motion under the risk-neutral probability <span class="math inline">\(\mathbb{Q}\)</span>.</p>
<p>The characteristic function of <span class="math inline">\(\log(S(t))\)</span> under the risk-neutral probability is:</p>
<p><span class="math display">\[
\phi_{\log(S(t))}^{\mathbb{Q}}(u) = e^{iu \log(S(0))} \left( \frac{1}{1 - iu \theta_{\mathbb{Q}} \nu + \frac{1}{2} \sigma^2 u^2 \nu} \right)^{t/\nu},
\]</span> where <span class="math display">\[
\theta_{\mathbb{Q}} = (r - q) - \frac{1}{2} \sigma^2 - \frac{1}{\nu} \log\left(1 - \theta \nu - \frac{1}{2} \sigma^2 \nu \right).
\]</span></p>
<p>The following Python code implements the Carr-Madan method to price a European call option under the Variance Gamma Model and compare it to the prices obtained from simulation. The results suggest that the Carr-Madan method yields almost the same prices as those from Monte Carlo simulation. In addition, the Carr-Madan method runs hundreds of times faster than simulation.</p>
<div id="888fefdd" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="888fefdd"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="888fefdd-1"><a href="#888fefdd-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="888fefdd-2"><a href="#888fefdd-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy.fft <span class="im">import</span> fft</span>
<span id="888fefdd-3"><a href="#888fefdd-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="888fefdd-4"><a href="#888fefdd-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="888fefdd-5"><a href="#888fefdd-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-6"><a href="#888fefdd-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Market and option parameters</span></span>
<span id="888fefdd-7"><a href="#888fefdd-7" aria-hidden="true" tabindex="-1"></a>S0 <span class="op">=</span> <span class="dv">100</span>  <span class="co"># Initial stock price</span></span>
<span id="888fefdd-8"><a href="#888fefdd-8" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.05</span>  <span class="co"># Risk-free rate</span></span>
<span id="888fefdd-9"><a href="#888fefdd-9" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="fl">0.0</span>  <span class="co"># Dividend yield</span></span>
<span id="888fefdd-10"><a href="#888fefdd-10" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="fl">1.0</span>  <span class="co"># Time to maturity</span></span>
<span id="888fefdd-11"><a href="#888fefdd-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-12"><a href="#888fefdd-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance Gamma parameters</span></span>
<span id="888fefdd-13"><a href="#888fefdd-13" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.12</span>  <span class="co"># Volatility parameter</span></span>
<span id="888fefdd-14"><a href="#888fefdd-14" aria-hidden="true" tabindex="-1"></a>nu <span class="op">=</span> <span class="fl">0.2</span>  <span class="co"># Variance rate of the Gamma process</span></span>
<span id="888fefdd-15"><a href="#888fefdd-15" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> <span class="op">-</span><span class="fl">0.14</span>  <span class="co"># Drift parameter</span></span>
<span id="888fefdd-16"><a href="#888fefdd-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-17"><a href="#888fefdd-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Strike prices</span></span>
<span id="888fefdd-18"><a href="#888fefdd-18" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> np.linspace(<span class="dv">60</span>, <span class="dv">140</span>, <span class="dv">81</span>)  <span class="co"># Strike prices from 60 to 140</span></span>
<span id="888fefdd-19"><a href="#888fefdd-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-20"><a href="#888fefdd-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Carr-Madan method parameters</span></span>
<span id="888fefdd-21"><a href="#888fefdd-21" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">5.0</span>  <span class="co"># Damping factor (&gt; 0), increased for better convergence</span></span>
<span id="888fefdd-22"><a href="#888fefdd-22" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">2</span><span class="op">**</span><span class="dv">14</span>  <span class="co"># Number of FFT points (must be even for Simpson's Rule)</span></span>
<span id="888fefdd-23"><a href="#888fefdd-23" aria-hidden="true" tabindex="-1"></a>eta <span class="op">=</span> <span class="fl">0.05</span>  <span class="co"># Spacing in the frequency domain, decreased for better accuracy</span></span>
<span id="888fefdd-24"><a href="#888fefdd-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-25"><a href="#888fefdd-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure N is even for Simpson's Rule</span></span>
<span id="888fefdd-26"><a href="#888fefdd-26" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> N <span class="op">%</span> <span class="dv">2</span> <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="888fefdd-27"><a href="#888fefdd-27" aria-hidden="true" tabindex="-1"></a>    N <span class="op">+=</span> <span class="dv">1</span></span>
<span id="888fefdd-28"><a href="#888fefdd-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-29"><a href="#888fefdd-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Start timing the Carr-Madan method</span></span>
<span id="888fefdd-30"><a href="#888fefdd-30" aria-hidden="true" tabindex="-1"></a>start_time_fft <span class="op">=</span> time.time()</span>
<span id="888fefdd-31"><a href="#888fefdd-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-32"><a href="#888fefdd-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the grid in the frequency domain (v)</span></span>
<span id="888fefdd-33"><a href="#888fefdd-33" aria-hidden="true" tabindex="-1"></a>v <span class="op">=</span> np.arange(N) <span class="op">*</span> eta  <span class="co"># v_j = j * eta</span></span>
<span id="888fefdd-34"><a href="#888fefdd-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-35"><a href="#888fefdd-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the grid in the log-strike domain (k)</span></span>
<span id="888fefdd-36"><a href="#888fefdd-36" aria-hidden="true" tabindex="-1"></a>lambda_ <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> np.pi) <span class="op">/</span> (N <span class="op">*</span> eta)</span>
<span id="888fefdd-37"><a href="#888fefdd-37" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> N <span class="op">*</span> lambda_ <span class="op">/</span> <span class="dv">2</span>  <span class="co"># Upper limit for k</span></span>
<span id="888fefdd-38"><a href="#888fefdd-38" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="op">-</span>b <span class="op">+</span> lambda_ <span class="op">*</span> np.arange(N)  <span class="co"># k_i = -b + i * lambda</span></span>
<span id="888fefdd-39"><a href="#888fefdd-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-40"><a href="#888fefdd-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-41"><a href="#888fefdd-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> phi(u):</span>
<span id="888fefdd-42"><a href="#888fefdd-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="888fefdd-43"><a href="#888fefdd-43" aria-hidden="true" tabindex="-1"></a><span class="co">    characteristic function of log(S_T) under the Variance Gamma model.</span></span>
<span id="888fefdd-44"><a href="#888fefdd-44" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="888fefdd-45"><a href="#888fefdd-45" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="ot">1j</span></span>
<span id="888fefdd-46"><a href="#888fefdd-46" aria-hidden="true" tabindex="-1"></a>    omega <span class="op">=</span> (<span class="dv">1</span> <span class="op">/</span> nu) <span class="op">*</span> np.log(<span class="dv">1</span> <span class="op">-</span> theta <span class="op">*</span> nu <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> sigma<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> nu)</span>
<span id="888fefdd-47"><a href="#888fefdd-47" aria-hidden="true" tabindex="-1"></a>    drift <span class="op">=</span> r <span class="op">-</span> q <span class="op">-</span> omega</span>
<span id="888fefdd-48"><a href="#888fefdd-48" aria-hidden="true" tabindex="-1"></a>    phi_u <span class="op">=</span> np.exp(i <span class="op">*</span> u <span class="op">*</span> (np.log(S0) <span class="op">+</span> drift <span class="op">*</span> T)) <span class="op">*</span> (</span>
<span id="888fefdd-49"><a href="#888fefdd-49" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span> <span class="op">-</span> i <span class="op">*</span> theta <span class="op">*</span> nu <span class="op">*</span> u <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> sigma<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> nu <span class="op">*</span> u<span class="op">**</span><span class="dv">2</span></span>
<span id="888fefdd-50"><a href="#888fefdd-50" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">**</span> (<span class="op">-</span>T <span class="op">/</span> nu)</span>
<span id="888fefdd-51"><a href="#888fefdd-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> phi_u</span>
<span id="888fefdd-52"><a href="#888fefdd-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-53"><a href="#888fefdd-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-54"><a href="#888fefdd-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjusted characteristic function</span></span>
<span id="888fefdd-55"><a href="#888fefdd-55" aria-hidden="true" tabindex="-1"></a>u <span class="op">=</span> v <span class="op">-</span> (alpha <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="ot">1j</span></span>
<span id="888fefdd-56"><a href="#888fefdd-56" aria-hidden="true" tabindex="-1"></a>psi <span class="op">=</span> (np.exp(<span class="op">-</span>r <span class="op">*</span> T) <span class="op">*</span> phi(u)) <span class="op">/</span> (alpha<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> alpha <span class="op">-</span> v<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="ot">1j</span> <span class="op">*</span> (<span class="dv">2</span> <span class="op">*</span> alpha <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> v)</span>
<span id="888fefdd-57"><a href="#888fefdd-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-58"><a href="#888fefdd-58" aria-hidden="true" tabindex="-1"></a><span class="co">#   Simpson's Rule weights</span></span>
<span id="888fefdd-59"><a href="#888fefdd-59" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> np.ones(N)</span>
<span id="888fefdd-60"><a href="#888fefdd-60" aria-hidden="true" tabindex="-1"></a>w[<span class="dv">0</span>] <span class="op">=</span> w[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="888fefdd-61"><a href="#888fefdd-61" aria-hidden="true" tabindex="-1"></a>w[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>:<span class="dv">2</span>] <span class="op">=</span> <span class="dv">4</span>  <span class="co"># Weights for odd indices</span></span>
<span id="888fefdd-62"><a href="#888fefdd-62" aria-hidden="true" tabindex="-1"></a>w[<span class="dv">2</span>:<span class="op">-</span><span class="dv">1</span>:<span class="dv">2</span>] <span class="op">=</span> <span class="dv">2</span>  <span class="co"># Weights for even indices</span></span>
<span id="888fefdd-63"><a href="#888fefdd-63" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> w <span class="op">*</span> (eta <span class="op">/</span> <span class="dv">3</span>)</span>
<span id="888fefdd-64"><a href="#888fefdd-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-65"><a href="#888fefdd-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to be transformed</span></span>
<span id="888fefdd-66"><a href="#888fefdd-66" aria-hidden="true" tabindex="-1"></a>fft_input <span class="op">=</span> psi <span class="op">*</span> np.exp(<span class="op">-</span><span class="ot">1j</span> <span class="op">*</span> v <span class="op">*</span> b) <span class="op">*</span> w  <span class="co">#   sign in exponential term</span></span>
<span id="888fefdd-67"><a href="#888fefdd-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-68"><a href="#888fefdd-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the FFT</span></span>
<span id="888fefdd-69"><a href="#888fefdd-69" aria-hidden="true" tabindex="-1"></a>fft_output <span class="op">=</span> fft(fft_input)</span>
<span id="888fefdd-70"><a href="#888fefdd-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-71"><a href="#888fefdd-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the option prices</span></span>
<span id="888fefdd-72"><a href="#888fefdd-72" aria-hidden="true" tabindex="-1"></a>C_k <span class="op">=</span> np.exp(<span class="op">-</span>alpha <span class="op">*</span> k) <span class="op">/</span> np.pi <span class="op">*</span> np.real(fft_output)</span>
<span id="888fefdd-73"><a href="#888fefdd-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-74"><a href="#888fefdd-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert log-strike grid to strike prices</span></span>
<span id="888fefdd-75"><a href="#888fefdd-75" aria-hidden="true" tabindex="-1"></a>K_fft <span class="op">=</span> np.exp(k)</span>
<span id="888fefdd-76"><a href="#888fefdd-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-77"><a href="#888fefdd-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpolate the option prices at desired strikes</span></span>
<span id="888fefdd-78"><a href="#888fefdd-78" aria-hidden="true" tabindex="-1"></a>call_prices_fft <span class="op">=</span> np.interp(K, K_fft, C_k)</span>
<span id="888fefdd-79"><a href="#888fefdd-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-80"><a href="#888fefdd-80" aria-hidden="true" tabindex="-1"></a><span class="co"># End timing the Carr-Madan method</span></span>
<span id="888fefdd-81"><a href="#888fefdd-81" aria-hidden="true" tabindex="-1"></a>end_time_fft <span class="op">=</span> time.time()</span>
<span id="888fefdd-82"><a href="#888fefdd-82" aria-hidden="true" tabindex="-1"></a>time_fft <span class="op">=</span> end_time_fft <span class="op">-</span> start_time_fft</span>
<span id="888fefdd-83"><a href="#888fefdd-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-84"><a href="#888fefdd-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-85"><a href="#888fefdd-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Monte Carlo simulation with variance reduction</span></span>
<span id="888fefdd-86"><a href="#888fefdd-86" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> vg_process_mc(S0, T, r, q, sigma, theta, nu, M):</span>
<span id="888fefdd-87"><a href="#888fefdd-87" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="888fefdd-88"><a href="#888fefdd-88" aria-hidden="true" tabindex="-1"></a><span class="co">    Monte Carlo simulation for the Variance Gamma process with antithetic variates.</span></span>
<span id="888fefdd-89"><a href="#888fefdd-89" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="888fefdd-90"><a href="#888fefdd-90" aria-hidden="true" tabindex="-1"></a>    np.random.seed(<span class="dv">0</span>)  <span class="co"># For reproducibility</span></span>
<span id="888fefdd-91"><a href="#888fefdd-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-92"><a href="#888fefdd-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simulate Gamma process</span></span>
<span id="888fefdd-93"><a href="#888fefdd-93" aria-hidden="true" tabindex="-1"></a>    N_sim <span class="op">=</span> T <span class="op">/</span> nu</span>
<span id="888fefdd-94"><a href="#888fefdd-94" aria-hidden="true" tabindex="-1"></a>    G <span class="op">=</span> np.random.gamma(N_sim, nu, M)</span>
<span id="888fefdd-95"><a href="#888fefdd-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-96"><a href="#888fefdd-96" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Antithetic variates for Z</span></span>
<span id="888fefdd-97"><a href="#888fefdd-97" aria-hidden="true" tabindex="-1"></a>    Z <span class="op">=</span> np.random.randn(M)</span>
<span id="888fefdd-98"><a href="#888fefdd-98" aria-hidden="true" tabindex="-1"></a>    Z_antithetic <span class="op">=</span> <span class="op">-</span>Z</span>
<span id="888fefdd-99"><a href="#888fefdd-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-100"><a href="#888fefdd-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># VG process for original Z</span></span>
<span id="888fefdd-101"><a href="#888fefdd-101" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> theta <span class="op">*</span> G <span class="op">+</span> sigma <span class="op">*</span> np.sqrt(G) <span class="op">*</span> Z</span>
<span id="888fefdd-102"><a href="#888fefdd-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># VG process for antithetic Z</span></span>
<span id="888fefdd-103"><a href="#888fefdd-103" aria-hidden="true" tabindex="-1"></a>    X_antithetic <span class="op">=</span> theta <span class="op">*</span> G <span class="op">+</span> sigma <span class="op">*</span> np.sqrt(G) <span class="op">*</span> Z_antithetic</span>
<span id="888fefdd-104"><a href="#888fefdd-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-105"><a href="#888fefdd-105" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adjusted drift to ensure martingale</span></span>
<span id="888fefdd-106"><a href="#888fefdd-106" aria-hidden="true" tabindex="-1"></a>    omega <span class="op">=</span> (<span class="dv">1</span> <span class="op">/</span> nu) <span class="op">*</span> np.log(<span class="dv">1</span> <span class="op">-</span> theta <span class="op">*</span> nu <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> sigma<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> nu)</span>
<span id="888fefdd-107"><a href="#888fefdd-107" aria-hidden="true" tabindex="-1"></a>    drift <span class="op">=</span> (r <span class="op">-</span> q <span class="op">-</span> omega) <span class="op">*</span> T  <span class="co">#   drift</span></span>
<span id="888fefdd-108"><a href="#888fefdd-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-109"><a href="#888fefdd-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simulate stock prices at maturity</span></span>
<span id="888fefdd-110"><a href="#888fefdd-110" aria-hidden="true" tabindex="-1"></a>    ST <span class="op">=</span> S0 <span class="op">*</span> np.exp(drift <span class="op">+</span> X)</span>
<span id="888fefdd-111"><a href="#888fefdd-111" aria-hidden="true" tabindex="-1"></a>    ST_antithetic <span class="op">=</span> S0 <span class="op">*</span> np.exp(drift <span class="op">+</span> X_antithetic)</span>
<span id="888fefdd-112"><a href="#888fefdd-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-113"><a href="#888fefdd-113" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine the two sets of simulated prices</span></span>
<span id="888fefdd-114"><a href="#888fefdd-114" aria-hidden="true" tabindex="-1"></a>    ST_combined <span class="op">=</span> np.concatenate((ST, ST_antithetic))</span>
<span id="888fefdd-115"><a href="#888fefdd-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-116"><a href="#888fefdd-116" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ST_combined</span>
<span id="888fefdd-117"><a href="#888fefdd-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-118"><a href="#888fefdd-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-119"><a href="#888fefdd-119" aria-hidden="true" tabindex="-1"></a>M <span class="op">=</span> <span class="dv">500000</span>  <span class="co"># Number of simulations (total simulations will be 1,000,000 with antithetic variates)</span></span>
<span id="888fefdd-120"><a href="#888fefdd-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-121"><a href="#888fefdd-121" aria-hidden="true" tabindex="-1"></a><span class="co"># Start timing the Monte Carlo method</span></span>
<span id="888fefdd-122"><a href="#888fefdd-122" aria-hidden="true" tabindex="-1"></a>start_time_mc <span class="op">=</span> time.time()</span>
<span id="888fefdd-123"><a href="#888fefdd-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-124"><a href="#888fefdd-124" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate stock prices</span></span>
<span id="888fefdd-125"><a href="#888fefdd-125" aria-hidden="true" tabindex="-1"></a>ST_combined <span class="op">=</span> vg_process_mc(S0, T, r, q, sigma, theta, nu, M)</span>
<span id="888fefdd-126"><a href="#888fefdd-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-127"><a href="#888fefdd-127" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute payoffs</span></span>
<span id="888fefdd-128"><a href="#888fefdd-128" aria-hidden="true" tabindex="-1"></a>payoffs <span class="op">=</span> np.maximum(ST_combined[:, np.newaxis] <span class="op">-</span> K, <span class="dv">0</span>)</span>
<span id="888fefdd-129"><a href="#888fefdd-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-130"><a href="#888fefdd-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Discounted option prices</span></span>
<span id="888fefdd-131"><a href="#888fefdd-131" aria-hidden="true" tabindex="-1"></a>call_prices_mc <span class="op">=</span> np.exp(<span class="op">-</span>r <span class="op">*</span> T) <span class="op">*</span> np.mean(payoffs, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="888fefdd-132"><a href="#888fefdd-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-133"><a href="#888fefdd-133" aria-hidden="true" tabindex="-1"></a><span class="co"># End timing the Monte Carlo method</span></span>
<span id="888fefdd-134"><a href="#888fefdd-134" aria-hidden="true" tabindex="-1"></a>end_time_mc <span class="op">=</span> time.time()</span>
<span id="888fefdd-135"><a href="#888fefdd-135" aria-hidden="true" tabindex="-1"></a>time_mc <span class="op">=</span> end_time_mc <span class="op">-</span> start_time_mc</span>
<span id="888fefdd-136"><a href="#888fefdd-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-137"><a href="#888fefdd-137" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the price differences</span></span>
<span id="888fefdd-138"><a href="#888fefdd-138" aria-hidden="true" tabindex="-1"></a>price_differences <span class="op">=</span> call_prices_fft <span class="op">-</span> call_prices_mc</span>
<span id="888fefdd-139"><a href="#888fefdd-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-140"><a href="#888fefdd-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-141"><a href="#888fefdd-141" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot comparison</span></span>
<span id="888fefdd-142"><a href="#888fefdd-142" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="888fefdd-143"><a href="#888fefdd-143" aria-hidden="true" tabindex="-1"></a>plt.plot(K, call_prices_fft, label<span class="op">=</span><span class="st">"Carr-Madan FFT Price (VG)"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="888fefdd-144"><a href="#888fefdd-144" aria-hidden="true" tabindex="-1"></a>plt.plot(K, call_prices_mc, label<span class="op">=</span><span class="st">"Monte Carlo Price (VG)"</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="888fefdd-145"><a href="#888fefdd-145" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Strike Price K"</span>)</span>
<span id="888fefdd-146"><a href="#888fefdd-146" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Option Price"</span>)</span>
<span id="888fefdd-147"><a href="#888fefdd-147" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Comparison of Carr-Madan FFT and Monte Carlo Prices (VG)"</span>)</span>
<span id="888fefdd-148"><a href="#888fefdd-148" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="888fefdd-149"><a href="#888fefdd-149" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="888fefdd-150"><a href="#888fefdd-150" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="888fefdd-151"><a href="#888fefdd-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-152"><a href="#888fefdd-152" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the differences in prices</span></span>
<span id="888fefdd-153"><a href="#888fefdd-153" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="888fefdd-154"><a href="#888fefdd-154" aria-hidden="true" tabindex="-1"></a>plt.plot(K, price_differences, label<span class="op">=</span><span class="st">"Price Difference (FFT - MC)"</span>)</span>
<span id="888fefdd-155"><a href="#888fefdd-155" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Strike Price K"</span>)</span>
<span id="888fefdd-156"><a href="#888fefdd-156" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Price Difference"</span>)</span>
<span id="888fefdd-157"><a href="#888fefdd-157" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Difference in Option Prices between Carr-Madan FFT and Monte Carlo (VG)"</span>)</span>
<span id="888fefdd-158"><a href="#888fefdd-158" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="888fefdd-159"><a href="#888fefdd-159" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="888fefdd-160"><a href="#888fefdd-160" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="888fefdd-161"><a href="#888fefdd-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-162"><a href="#888fefdd-162" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the maximum absolute difference</span></span>
<span id="888fefdd-163"><a href="#888fefdd-163" aria-hidden="true" tabindex="-1"></a>max_difference <span class="op">=</span> np.<span class="bu">max</span>(np.<span class="bu">abs</span>(price_differences))</span>
<span id="888fefdd-164"><a href="#888fefdd-164" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Maximum Absolute Price Difference: </span><span class="sc">{</span>max_difference<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="888fefdd-165"><a href="#888fefdd-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="888fefdd-166"><a href="#888fefdd-166" aria-hidden="true" tabindex="-1"></a><span class="co"># Print computational times</span></span>
<span id="888fefdd-167"><a href="#888fefdd-167" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Computational Time (Carr-Madan FFT): </span><span class="sc">{</span>time_fft<span class="sc">:.6f}</span><span class="ss"> seconds"</span>)</span>
<span id="888fefdd-168"><a href="#888fefdd-168" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Computational Time (Monte Carlo): </span><span class="sc">{</span>time_mc<span class="sc">:.6f}</span><span class="ss"> seconds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter_Fourier_files/figure-html/cell-4-output-1.png" width="821" height="523" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter_Fourier_files/figure-html/cell-4-output-2.png" width="829" height="523" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Maximum Absolute Price Difference: 0.010150
Computational Time (Carr-Madan FFT): 0.024817 seconds
Computational Time (Monte Carlo): 0.791801 seconds</code></pre>
</div>
</div>
<p><strong>Pricing Options in a Jump Diffusion Model</strong></p>
<p>A jump diffusion process is a type of stochastic process that extends a standard diffusion process, such as Brownian motion, by including random jumps. This model <span class="citation" data-cites="MertonJD">(e.g., <a href="#ref-MertonJD" role="doc-biblioref">Merton 1976</a>)</span> is widely used in financial mathematics to capture sudden, discontinuous changes in asset prices, interest rates, or other time series that are not explained by continuous diffusive processes alone.</p>
<p>Let <span class="math inline">\(S(t)\)</span> represent the stock price at time <span class="math inline">\(t\)</span>, and under the risk-neutral probability <span class="math inline">\(\mathbb{Q}\)</span>, the stock price follows a jump diffusion process. The stock price dynamics can be described by:</p>
<p><span class="math display">\[
dS(t) = (r - q) S(t) dt + \sigma S(t) dW(t) + S(t) dJ(t)
\]</span></p>
<p>where <span class="math inline">\(r\)</span> is the risk-free rate, <span class="math inline">\(q\)</span> is the continuous dividend yield, <span class="math inline">\(\sigma\)</span> is the volatility of the Brownian motion component, <span class="math inline">\(W(t)\)</span> is a standard Brownian motion under the risk-neutral probability, and the jump process <span class="math inline">\(J(t)\)</span> follows: <span class="math display">\[
J(t) = \sum_{i=1}^{N(t)} (Y_i - 1),
\]</span> where <span class="math inline">\(N(t)\)</span> is a Poisson process with intensity <span class="math inline">\(\lambda\)</span>, representing the number of jumps up to time <span class="math inline">\(t\)</span>, and <span class="math inline">\(Y_i\)</span> is the jump size, often modeled as a random variable from a log-normal distribution such that <span class="math inline">\(\log(Y_i) \sim \mathcal{N}(\mu_J, \sigma_J^2)\)</span>.</p>
<p>Thus, the stock price is driven by both the diffusion term (due to the Brownian motion) and the jump term (due to the Poisson process).</p>
<p>The solution to the stochastic differential equation (SDE) for <span class="math inline">\(S(t)\)</span> can be expressed as:</p>
<p><span class="math display">\[
S(t) = S(0) \exp\left( (r - q - \frac{1}{2}\sigma^2)t + \sigma W(t) + \sum_{i=1}^{N(t)} \log(Y_i) \right)
\]</span></p>
<p>This shows that the stock price incorporates both continuous changes (via the <span class="math inline">\(W(t)\)</span> term) and discrete jumps (via the <span class="math inline">\(\sum_{i=1}^{N(t)} \log(Y_i)\)</span> term).</p>
<p>The characteristic function of <span class="math inline">\(\log(S(t))\)</span> under the risk-neutral probability is:</p>
<p><span class="math display">\[
\phi_{\log(S(t))}^{\mathbb{Q}}(u) = e^{iu \log(S(0))} \exp\left( iu (r - q - \frac{1}{2} \sigma^2) t - \frac{1}{2} u^2 \sigma^2 t \right)
\cdot \exp\left( \lambda t \left( \exp\left( iu \mu_J - \frac{1}{2} u^2 \sigma_J^2 \right) - 1 \right) \right)
\]</span></p>
<p>This formula captures both the diffusion (Brownian motion) and jump components, making it applicable for more accurate modeling of stock prices that experience sudden jumps in addition to continuous fluctuations.</p>
<p>The following Python code implements the Carr-Madan method to price a European call option under the Jump Diffusion Model and compare it to the prices obtained from simulation. The results suggest that the Carr-Madan method yields almost the same prices as those from Monte Carlo simulation. In addition, the Carr-Madan method runs hundreds of times faster than simulation.</p>
<div id="cdf6355e" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cdf6355e"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cdf6355e-1"><a href="#cdf6355e-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cdf6355e-2"><a href="#cdf6355e-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy.fft <span class="im">import</span> fft</span>
<span id="cdf6355e-3"><a href="#cdf6355e-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cdf6355e-4"><a href="#cdf6355e-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cdf6355e-5"><a href="#cdf6355e-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cdf6355e-6"><a href="#cdf6355e-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-7"><a href="#cdf6355e-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Market and option parameters</span></span>
<span id="cdf6355e-8"><a href="#cdf6355e-8" aria-hidden="true" tabindex="-1"></a>S0 <span class="op">=</span> <span class="dv">100</span>  <span class="co"># Initial stock price</span></span>
<span id="cdf6355e-9"><a href="#cdf6355e-9" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.05</span>  <span class="co"># Risk-free rate</span></span>
<span id="cdf6355e-10"><a href="#cdf6355e-10" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="fl">0.0</span>  <span class="co"># Dividend yield</span></span>
<span id="cdf6355e-11"><a href="#cdf6355e-11" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="fl">0.1</span>  <span class="co"># Time to maturity</span></span>
<span id="cdf6355e-12"><a href="#cdf6355e-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-13"><a href="#cdf6355e-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Volatility</span></span>
<span id="cdf6355e-14"><a href="#cdf6355e-14" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.2</span>  <span class="co"># Volatility of diffusion component</span></span>
<span id="cdf6355e-15"><a href="#cdf6355e-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-16"><a href="#cdf6355e-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Jump parameters</span></span>
<span id="cdf6355e-17"><a href="#cdf6355e-17" aria-hidden="true" tabindex="-1"></a>lam <span class="op">=</span> <span class="fl">0.1</span>  <span class="co"># Jump intensity (lambda)</span></span>
<span id="cdf6355e-18"><a href="#cdf6355e-18" aria-hidden="true" tabindex="-1"></a>mu_j <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>  <span class="co"># Mean of jump size (mu_J)</span></span>
<span id="cdf6355e-19"><a href="#cdf6355e-19" aria-hidden="true" tabindex="-1"></a>sigma_j <span class="op">=</span> <span class="fl">0.3</span>  <span class="co"># Standard deviation of jump size (sigma_J)</span></span>
<span id="cdf6355e-20"><a href="#cdf6355e-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-21"><a href="#cdf6355e-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculated parameter kappa</span></span>
<span id="cdf6355e-22"><a href="#cdf6355e-22" aria-hidden="true" tabindex="-1"></a>kappa <span class="op">=</span> np.exp(mu_j <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> sigma_j<span class="op">**</span><span class="dv">2</span>) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cdf6355e-23"><a href="#cdf6355e-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-24"><a href="#cdf6355e-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Strike prices</span></span>
<span id="cdf6355e-25"><a href="#cdf6355e-25" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> np.linspace(<span class="dv">60</span>, <span class="dv">140</span>, <span class="dv">81</span>)  <span class="co"># Strike prices from 60 to 140</span></span>
<span id="cdf6355e-26"><a href="#cdf6355e-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-27"><a href="#cdf6355e-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Carr-Madan method parameters</span></span>
<span id="cdf6355e-28"><a href="#cdf6355e-28" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">1.5</span>  <span class="co"># Damping factor (&gt; 0)</span></span>
<span id="cdf6355e-29"><a href="#cdf6355e-29" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">2</span><span class="op">**</span><span class="dv">16</span>  <span class="co"># Number of FFT points (must be even for Simpson's Rule)</span></span>
<span id="cdf6355e-30"><a href="#cdf6355e-30" aria-hidden="true" tabindex="-1"></a>eta <span class="op">=</span> <span class="fl">0.05</span>  <span class="co"># Spacing in the frequency domain (smaller for higher accuracy)</span></span>
<span id="cdf6355e-31"><a href="#cdf6355e-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-32"><a href="#cdf6355e-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure N is even for Simpson's Rule</span></span>
<span id="cdf6355e-33"><a href="#cdf6355e-33" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> N <span class="op">%</span> <span class="dv">2</span> <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cdf6355e-34"><a href="#cdf6355e-34" aria-hidden="true" tabindex="-1"></a>    N <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cdf6355e-35"><a href="#cdf6355e-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-36"><a href="#cdf6355e-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Start timing the Carr-Madan method</span></span>
<span id="cdf6355e-37"><a href="#cdf6355e-37" aria-hidden="true" tabindex="-1"></a>start_time_fft <span class="op">=</span> time.time()</span>
<span id="cdf6355e-38"><a href="#cdf6355e-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-39"><a href="#cdf6355e-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the grid in the frequency domain (v)</span></span>
<span id="cdf6355e-40"><a href="#cdf6355e-40" aria-hidden="true" tabindex="-1"></a>v <span class="op">=</span> np.arange(N) <span class="op">*</span> eta  <span class="co"># v_j = j * eta</span></span>
<span id="cdf6355e-41"><a href="#cdf6355e-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-42"><a href="#cdf6355e-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the grid in the log-strike domain (k)</span></span>
<span id="cdf6355e-43"><a href="#cdf6355e-43" aria-hidden="true" tabindex="-1"></a>lambda_ <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> np.pi) <span class="op">/</span> (N <span class="op">*</span> eta)</span>
<span id="cdf6355e-44"><a href="#cdf6355e-44" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> N <span class="op">*</span> lambda_ <span class="op">/</span> <span class="dv">2</span>  <span class="co"># Upper limit for k</span></span>
<span id="cdf6355e-45"><a href="#cdf6355e-45" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="op">-</span>b <span class="op">+</span> lambda_ <span class="op">*</span> np.arange(N)  <span class="co"># k_i = -b + i * lambda</span></span>
<span id="cdf6355e-46"><a href="#cdf6355e-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-47"><a href="#cdf6355e-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-48"><a href="#cdf6355e-48" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> phi(u):</span>
<span id="cdf6355e-49"><a href="#cdf6355e-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cdf6355e-50"><a href="#cdf6355e-50" aria-hidden="true" tabindex="-1"></a><span class="co">    Characteristic function of log(S_T) under the Merton Jump-Diffusion model.</span></span>
<span id="cdf6355e-51"><a href="#cdf6355e-51" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cdf6355e-52"><a href="#cdf6355e-52" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="ot">1j</span></span>
<span id="cdf6355e-53"><a href="#cdf6355e-53" aria-hidden="true" tabindex="-1"></a>    mu <span class="op">=</span> np.log(S0) <span class="op">+</span> (r <span class="op">-</span> q <span class="op">-</span> lam <span class="op">*</span> kappa <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> sigma<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> T</span>
<span id="cdf6355e-54"><a href="#cdf6355e-54" aria-hidden="true" tabindex="-1"></a>    variance <span class="op">=</span> sigma<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> T</span>
<span id="cdf6355e-55"><a href="#cdf6355e-55" aria-hidden="true" tabindex="-1"></a>    phi_jump <span class="op">=</span> lam <span class="op">*</span> T <span class="op">*</span> (np.exp(i <span class="op">*</span> u <span class="op">*</span> mu_j <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> sigma_j<span class="op">**</span><span class="dv">2</span> <span class="op">*</span> u<span class="op">**</span><span class="dv">2</span>) <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cdf6355e-56"><a href="#cdf6355e-56" aria-hidden="true" tabindex="-1"></a>    cf <span class="op">=</span> np.exp(i <span class="op">*</span> u <span class="op">*</span> mu <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> variance <span class="op">*</span> u<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> phi_jump)</span>
<span id="cdf6355e-57"><a href="#cdf6355e-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cf</span>
<span id="cdf6355e-58"><a href="#cdf6355e-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-59"><a href="#cdf6355e-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-60"><a href="#cdf6355e-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjusted characteristic function</span></span>
<span id="cdf6355e-61"><a href="#cdf6355e-61" aria-hidden="true" tabindex="-1"></a>u <span class="op">=</span> v <span class="op">-</span> (alpha <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="ot">1j</span></span>
<span id="cdf6355e-62"><a href="#cdf6355e-62" aria-hidden="true" tabindex="-1"></a>psi <span class="op">=</span> np.exp(<span class="op">-</span>r <span class="op">*</span> T) <span class="op">*</span> phi(u) <span class="op">/</span> (alpha<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> alpha <span class="op">-</span> v<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="ot">1j</span> <span class="op">*</span> (<span class="dv">2</span> <span class="op">*</span> alpha <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> v)</span>
<span id="cdf6355e-63"><a href="#cdf6355e-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-64"><a href="#cdf6355e-64" aria-hidden="true" tabindex="-1"></a><span class="co">#   Simpson's Rule weights</span></span>
<span id="cdf6355e-65"><a href="#cdf6355e-65" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> np.ones(N)</span>
<span id="cdf6355e-66"><a href="#cdf6355e-66" aria-hidden="true" tabindex="-1"></a>w[<span class="dv">0</span>] <span class="op">=</span> w[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cdf6355e-67"><a href="#cdf6355e-67" aria-hidden="true" tabindex="-1"></a>w[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>:<span class="dv">2</span>] <span class="op">=</span> <span class="dv">4</span>  <span class="co"># Weights for odd indices</span></span>
<span id="cdf6355e-68"><a href="#cdf6355e-68" aria-hidden="true" tabindex="-1"></a>w[<span class="dv">2</span>:<span class="op">-</span><span class="dv">1</span>:<span class="dv">2</span>] <span class="op">=</span> <span class="dv">2</span>  <span class="co"># Weights for even indices</span></span>
<span id="cdf6355e-69"><a href="#cdf6355e-69" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> w <span class="op">*</span> (eta <span class="op">/</span> <span class="dv">3</span>)</span>
<span id="cdf6355e-70"><a href="#cdf6355e-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-71"><a href="#cdf6355e-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to be transformed</span></span>
<span id="cdf6355e-72"><a href="#cdf6355e-72" aria-hidden="true" tabindex="-1"></a>fft_input <span class="op">=</span> psi <span class="op">*</span> np.exp(<span class="op">-</span><span class="ot">1j</span> <span class="op">*</span> v <span class="op">*</span> b) <span class="op">*</span> w</span>
<span id="cdf6355e-73"><a href="#cdf6355e-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-74"><a href="#cdf6355e-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the FFT</span></span>
<span id="cdf6355e-75"><a href="#cdf6355e-75" aria-hidden="true" tabindex="-1"></a>fft_output <span class="op">=</span> fft(fft_input)</span>
<span id="cdf6355e-76"><a href="#cdf6355e-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-77"><a href="#cdf6355e-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the option prices</span></span>
<span id="cdf6355e-78"><a href="#cdf6355e-78" aria-hidden="true" tabindex="-1"></a>C_k <span class="op">=</span> np.exp(<span class="op">-</span>alpha <span class="op">*</span> k) <span class="op">/</span> np.pi <span class="op">*</span> np.real(fft_output)</span>
<span id="cdf6355e-79"><a href="#cdf6355e-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-80"><a href="#cdf6355e-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert log-strike grid to strike prices</span></span>
<span id="cdf6355e-81"><a href="#cdf6355e-81" aria-hidden="true" tabindex="-1"></a>K_fft <span class="op">=</span> np.exp(k)</span>
<span id="cdf6355e-82"><a href="#cdf6355e-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-83"><a href="#cdf6355e-83" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpolate the option prices at desired strikes</span></span>
<span id="cdf6355e-84"><a href="#cdf6355e-84" aria-hidden="true" tabindex="-1"></a>call_prices_fft <span class="op">=</span> np.interp(K, K_fft, C_k)</span>
<span id="cdf6355e-85"><a href="#cdf6355e-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-86"><a href="#cdf6355e-86" aria-hidden="true" tabindex="-1"></a><span class="co"># End timing the Carr-Madan method</span></span>
<span id="cdf6355e-87"><a href="#cdf6355e-87" aria-hidden="true" tabindex="-1"></a>end_time_fft <span class="op">=</span> time.time()</span>
<span id="cdf6355e-88"><a href="#cdf6355e-88" aria-hidden="true" tabindex="-1"></a>time_fft <span class="op">=</span> end_time_fft <span class="op">-</span> start_time_fft</span>
<span id="cdf6355e-89"><a href="#cdf6355e-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-90"><a href="#cdf6355e-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-91"><a href="#cdf6355e-91" aria-hidden="true" tabindex="-1"></a><span class="co"># Monte Carlo simulation</span></span>
<span id="cdf6355e-92"><a href="#cdf6355e-92" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> merton_jump_diffusion_mc(S0, K, T, r, q, sigma, lam, mu_j, sigma_j, M):</span>
<span id="cdf6355e-93"><a href="#cdf6355e-93" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cdf6355e-94"><a href="#cdf6355e-94" aria-hidden="true" tabindex="-1"></a><span class="co">    Monte Carlo simulation for European call option under Merton jump-diffusion model.</span></span>
<span id="cdf6355e-95"><a href="#cdf6355e-95" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cdf6355e-96"><a href="#cdf6355e-96" aria-hidden="true" tabindex="-1"></a>    np.random.seed(<span class="dv">0</span>)  <span class="co"># For reproducibility</span></span>
<span id="cdf6355e-97"><a href="#cdf6355e-97" aria-hidden="true" tabindex="-1"></a>    drift <span class="op">=</span> (r <span class="op">-</span> q <span class="op">-</span> lam <span class="op">*</span> kappa <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> sigma<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> T</span>
<span id="cdf6355e-98"><a href="#cdf6355e-98" aria-hidden="true" tabindex="-1"></a>    diffusion <span class="op">=</span> sigma <span class="op">*</span> np.sqrt(T) <span class="op">*</span> np.random.randn(M)</span>
<span id="cdf6355e-99"><a href="#cdf6355e-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-100"><a href="#cdf6355e-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simulate number of jumps for each path</span></span>
<span id="cdf6355e-101"><a href="#cdf6355e-101" aria-hidden="true" tabindex="-1"></a>    N_jumps <span class="op">=</span> np.random.poisson(lam <span class="op">*</span> T, M)</span>
<span id="cdf6355e-102"><a href="#cdf6355e-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-103"><a href="#cdf6355e-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simulate jump sizes</span></span>
<span id="cdf6355e-104"><a href="#cdf6355e-104" aria-hidden="true" tabindex="-1"></a>    sum_Y <span class="op">=</span> np.zeros(M)</span>
<span id="cdf6355e-105"><a href="#cdf6355e-105" aria-hidden="true" tabindex="-1"></a>    idx <span class="op">=</span> np.where(N_jumps <span class="op">&gt;</span> <span class="dv">0</span>)[<span class="dv">0</span>]</span>
<span id="cdf6355e-106"><a href="#cdf6355e-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> idx:</span>
<span id="cdf6355e-107"><a href="#cdf6355e-107" aria-hidden="true" tabindex="-1"></a>        Y_i <span class="op">=</span> np.random.normal(mu_j, sigma_j, N_jumps[i])</span>
<span id="cdf6355e-108"><a href="#cdf6355e-108" aria-hidden="true" tabindex="-1"></a>        sum_Y[i] <span class="op">=</span> np.<span class="bu">sum</span>(Y_i)</span>
<span id="cdf6355e-109"><a href="#cdf6355e-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-110"><a href="#cdf6355e-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute log stock price at maturity</span></span>
<span id="cdf6355e-111"><a href="#cdf6355e-111" aria-hidden="true" tabindex="-1"></a>    ln_ST <span class="op">=</span> np.log(S0) <span class="op">+</span> drift <span class="op">+</span> diffusion <span class="op">+</span> sum_Y</span>
<span id="cdf6355e-112"><a href="#cdf6355e-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-113"><a href="#cdf6355e-113" aria-hidden="true" tabindex="-1"></a>    ST <span class="op">=</span> np.exp(ln_ST)</span>
<span id="cdf6355e-114"><a href="#cdf6355e-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-115"><a href="#cdf6355e-115" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute payoff for each simulation</span></span>
<span id="cdf6355e-116"><a href="#cdf6355e-116" aria-hidden="true" tabindex="-1"></a>    payoffs <span class="op">=</span> np.maximum(ST[:, np.newaxis] <span class="op">-</span> K, <span class="dv">0</span>)</span>
<span id="cdf6355e-117"><a href="#cdf6355e-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-118"><a href="#cdf6355e-118" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Discount back</span></span>
<span id="cdf6355e-119"><a href="#cdf6355e-119" aria-hidden="true" tabindex="-1"></a>    C_MC <span class="op">=</span> np.exp(<span class="op">-</span>r <span class="op">*</span> T) <span class="op">*</span> np.mean(payoffs, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cdf6355e-120"><a href="#cdf6355e-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-121"><a href="#cdf6355e-121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> C_MC</span>
<span id="cdf6355e-122"><a href="#cdf6355e-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-123"><a href="#cdf6355e-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-124"><a href="#cdf6355e-124" aria-hidden="true" tabindex="-1"></a>M <span class="op">=</span> <span class="dv">100000</span>  <span class="co"># Number of simulations</span></span>
<span id="cdf6355e-125"><a href="#cdf6355e-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-126"><a href="#cdf6355e-126" aria-hidden="true" tabindex="-1"></a><span class="co"># Start timing the Monte Carlo method</span></span>
<span id="cdf6355e-127"><a href="#cdf6355e-127" aria-hidden="true" tabindex="-1"></a>start_time_mc <span class="op">=</span> time.time()</span>
<span id="cdf6355e-128"><a href="#cdf6355e-128" aria-hidden="true" tabindex="-1"></a>call_prices_mc <span class="op">=</span> merton_jump_diffusion_mc(S0, K, T, r, q, sigma, lam, mu_j, sigma_j, M)</span>
<span id="cdf6355e-129"><a href="#cdf6355e-129" aria-hidden="true" tabindex="-1"></a>end_time_mc <span class="op">=</span> time.time()</span>
<span id="cdf6355e-130"><a href="#cdf6355e-130" aria-hidden="true" tabindex="-1"></a>time_mc <span class="op">=</span> end_time_mc <span class="op">-</span> start_time_mc</span>
<span id="cdf6355e-131"><a href="#cdf6355e-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-132"><a href="#cdf6355e-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the price differences</span></span>
<span id="cdf6355e-133"><a href="#cdf6355e-133" aria-hidden="true" tabindex="-1"></a>price_differences <span class="op">=</span> call_prices_fft <span class="op">-</span> call_prices_mc</span>
<span id="cdf6355e-134"><a href="#cdf6355e-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-135"><a href="#cdf6355e-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-136"><a href="#cdf6355e-136" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot comparison</span></span>
<span id="cdf6355e-137"><a href="#cdf6355e-137" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cdf6355e-138"><a href="#cdf6355e-138" aria-hidden="true" tabindex="-1"></a>plt.plot(K, call_prices_fft, label<span class="op">=</span><span class="st">"Carr-Madan FFT Price "</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="cdf6355e-139"><a href="#cdf6355e-139" aria-hidden="true" tabindex="-1"></a>plt.plot(K, call_prices_mc, label<span class="op">=</span><span class="st">"Monte Carlo Price (JD)"</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cdf6355e-140"><a href="#cdf6355e-140" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Strike Price K"</span>)</span>
<span id="cdf6355e-141"><a href="#cdf6355e-141" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Option Price"</span>)</span>
<span id="cdf6355e-142"><a href="#cdf6355e-142" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Comparison of Carr-Madan FFT and Monte Carlo Prices (JD)"</span>)</span>
<span id="cdf6355e-143"><a href="#cdf6355e-143" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cdf6355e-144"><a href="#cdf6355e-144" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cdf6355e-145"><a href="#cdf6355e-145" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cdf6355e-146"><a href="#cdf6355e-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-147"><a href="#cdf6355e-147" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the differences in prices</span></span>
<span id="cdf6355e-148"><a href="#cdf6355e-148" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cdf6355e-149"><a href="#cdf6355e-149" aria-hidden="true" tabindex="-1"></a>plt.plot(K, price_differences, label<span class="op">=</span><span class="st">"Price Difference (FFT - MC)"</span>)</span>
<span id="cdf6355e-150"><a href="#cdf6355e-150" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Strike Price K"</span>)</span>
<span id="cdf6355e-151"><a href="#cdf6355e-151" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Price Difference"</span>)</span>
<span id="cdf6355e-152"><a href="#cdf6355e-152" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Difference in Option Prices between Carr-Madan FFT and Monte Carlo (JD)"</span>)</span>
<span id="cdf6355e-153"><a href="#cdf6355e-153" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cdf6355e-154"><a href="#cdf6355e-154" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cdf6355e-155"><a href="#cdf6355e-155" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cdf6355e-156"><a href="#cdf6355e-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-157"><a href="#cdf6355e-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cdf6355e-158"><a href="#cdf6355e-158" aria-hidden="true" tabindex="-1"></a><span class="co"># Print computational times</span></span>
<span id="cdf6355e-159"><a href="#cdf6355e-159" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Computational Time (Carr-Madan FFT): </span><span class="sc">{</span>time_fft<span class="sc">:.6f}</span><span class="ss"> seconds"</span>)</span>
<span id="cdf6355e-160"><a href="#cdf6355e-160" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Computational Time (Monte Carlo): </span><span class="sc">{</span>time_mc<span class="sc">:.6f}</span><span class="ss"> seconds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter_Fourier_files/figure-html/cell-5-output-1.png" width="808" height="523" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter_Fourier_files/figure-html/cell-5-output-2.png" width="840" height="523" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Computational Time (Carr-Madan FFT): 0.033638 seconds
Computational Time (Monte Carlo): 0.081035 seconds</code></pre>
</div>
</div>
</section>
</section>
<section id="exercises" class="level2" data-number="17.5">
<h2 data-number="17.5" class="anchored" data-anchor-id="exercises"><span class="header-section-number">17.5</span> Exercises</h2>
<div id="exr-nolabel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 17.1</strong></span> Create a Python code to compare the Carr-Madan method with the direct Fourier Transform method using <a href="#eq-FTpricing" class="quarto-xref">Equation&nbsp;<span>17.1</span></a> for pricing in-the-money, at-the-money, and out-of-the-money European call options in terms of speed and accuracy in the Black-Scholes model.</p>
</div>
<div id="exr-nolabel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 17.2</strong></span> Create a Python code to let users input all the parameter values in the jump diffusion model and use the Carr-Madan method to price European put options in this model.</p>
</div>
<div id="exr-nolabel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 17.3</strong></span> Create a Python code to let users input all the parameter values in the Heston model and use the Carr-Madan method to price European put options in this model.</p>
</div>
<div id="exr-nolabel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 17.4</strong></span> Create a Python code to show how the speed and accuracy change as one varies the damping factor <span class="math inline">\(\alpha\)</span> and the strike price spacing <span class="math inline">\(\eta\)</span> in the jump diffusion model.</p>
</div>
</section>
<section id="references" class="level2" data-number="17.6">
<h2 data-number="17.6" class="anchored" data-anchor-id="references"><span class="header-section-number">17.6</span> References</h2>
<ol type="1">
<li>Carr, P., &amp; Madan, D. B. (1999). <em>Option valuation using the fast Fourier transform</em>. Journal of Computational Finance, 2(4), 61-73.</li>
<li>Black, F., &amp; Scholes, M. (1973). <em>The pricing of options and corporate liabilities</em>. Journal of Political Economy, 81(3), 637-654.</li>
</ol>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-CarrMadan" class="csl-entry" role="listitem">
Carr, P., and D. B. Madan. 1999. <span>“Option Valuation Using the Fast Fourier Transform.”</span> <em>Journal of Computational Finance</em> 2: 61–73.
</div>
<div id="ref-Heston" class="csl-entry" role="listitem">
Heston, S. 1993. <span>“A Closed-Form Solution for Options with Stochastic Volatility with Applications to Bond and Currency Options.”</span> <em>Review of Financial Studies</em> 6: 327–44.
</div>
<div id="ref-MertonJD" class="csl-entry" role="listitem">
Merton, R. 1976. <span>“Option Pricing When Underlying Stock Returns Are Discontinuous.”</span> <em>Journal of Financial Economics</em> 3: 125–44.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>NOte that because for FFT to work efficiently, we need <span class="math inline">\(N\)</span> to be even, but for the Simpson’s rule, we need even number of <strong>subintervals</strong>, i.e., <span class="math inline">\(N\)</span> to be odd. In practice, we choose <span class="math inline">\(N\)</span> to be even and ignore the last point evaluation for the Simpson’s weight <span class="math inline">\(w(N+1)\)</span>. When the spacing interval is small, the error from this omission is small.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>For options with very short maturities, the pricing errors for close-to-money options because the value approaches the non-analytic intrinsic value. Adjusting the Fourier transform parameter values (e.g., <span class="math inline">\(N\)</span> and <span class="math inline">\(\eta\)</span>) may be necessary.<br>
An alternative method proposed by Carr and Madan (1999) may also be used. See Carr and Madan (1999) for details. <a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Chapter_FiniteDifferences.html" class="pagination-link" aria-label="Finite Difference Methods">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Finite Difference Methods</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Chapter_FixedIncome.html" class="pagination-link" aria-label="Fixed-Income Concepts">
        <span class="nav-page-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Fixed-Income Concepts</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions"><ul><li><a href="https://github.com/math-finance-book/book-code.git/blob/main/Chapter_Fourier.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div></div></footer></body></html>