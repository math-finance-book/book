<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>27&nbsp; Vasicek and Extensions – Pricing and Hedging Derivative Securities: Theory and Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Chapter_Survey.html" rel="next">
<link href="./Chapter_FixedIncomeDerivatives.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-933f24a0c1e0be8a62c2179459603458.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-217607b4065b1a3128a07792af3f8e33.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>



<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

<script type="text/javascript">

window.PlotlyConfig = {MathJaxConfig: 'local'};

if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}

if (typeof require !== 'undefined') {

require.undef("plotly");

requirejs.config({

    paths: {

        'plotly': ['https://cdn.plot.ly/plotly-2.35.2.min']

    }

});

require(['plotly'], function(Plotly) {

    window._Plotly = Plotly;

});

}

</script>



<style>
div.callout-CodeToDo.callout {
  border-left-color: #eb4034;
}
div.callout-CodeToDo.callout-style-default > .callout-header {
  background-color: rgba(235, 64, 52, 0.13);
}
div.callout-CodeToDo .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-CodeToDo.callout-style-default .callout-icon::before, div.callout-CodeToDo.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Rule.callout {
  border-left-color: #a1bced;
}
div.callout-Rule.callout-style-default > .callout-header {
  background-color: rgba(161, 188, 237, 0.13);
}
div.callout-Rule .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Rule.callout-style-default .callout-icon::before, div.callout-Rule.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Extra.callout {
  border-left-color: #d5deed;
}
div.callout-Extra.callout-style-default > .callout-header {
  background-color: rgba(213, 222, 237, 0.13);
}
div.callout-Extra .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Extra.callout-style-default .callout-icon::before, div.callout-Extra.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Example.callout {
  border-left-color: #e8cc97;
}
div.callout-Example.callout-style-default > .callout-header {
  background-color: rgba(232, 204, 151, 0.13);
}
div.callout-Example .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Example.callout-style-default .callout-icon::before, div.callout-Example.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Done.callout {
  border-left-color: #e8cc97;
}
div.callout-Done.callout-style-default > .callout-header {
  background-color: rgba(232, 204, 151, 0.13);
}
div.callout-Done .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Done.callout-style-default .callout-icon::before, div.callout-Done.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-InProgress.callout {
  border-left-color: #eaacf2;
}
div.callout-InProgress.callout-style-default > .callout-header {
  background-color: rgba(234, 172, 242, 0.13);
}
div.callout-InProgress .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-InProgress.callout-style-default .callout-icon::before, div.callout-InProgress.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Exercise.callout {
  border-left-color: #ede29d;
}
div.callout-Exercise.callout-style-default > .callout-header {
  background-color: rgba(237, 226, 157, 0.13);
}
div.callout-Exercise .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Exercise.callout-style-default .callout-icon::before, div.callout-Exercise.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-WritingToDo.callout {
  border-left-color: #a7f2d8;
}
div.callout-WritingToDo.callout-style-default > .callout-header {
  background-color: rgba(167, 242, 216, 0.13);
}
div.callout-WritingToDo .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-WritingToDo.callout-style-default .callout-icon::before, div.callout-WritingToDo.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Principle.callout {
  border-left-color: #e3aab2;
}
div.callout-Principle.callout-style-default > .callout-header {
  background-color: rgba(227, 170, 178, 0.13);
}
div.callout-Principle .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Principle.callout-style-default .callout-icon::before, div.callout-Principle.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter_FixedIncome.html">Part VII: Fixed Income</a></li><li class="breadcrumb-item"><a href="./Chapter_Vasicek.html"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Vasicek and Extensions</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Pricing and Hedging Derivative Securities: Theory and Methods</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/math-finance-book/book-code.git" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Options.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Options</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Futures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Futures and Swaps</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: Mathematical Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Intro_Binomial_Tree.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Brownian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Brownian Motion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Ito.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Ito Processes and Ito’s Formula</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_GBM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Geometric Brownian Motion</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: Arbitrage Pricing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Arbitrage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Foundations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Deltas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Delta Hedges, Replication, and PDEs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_DigitalsMeasures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Digitals and Measures</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Part IV: Black-Scholes and Extensions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_BlackScholes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Black-Scholes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Americans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">American Options</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FX.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">FX and Quantos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Merton.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Merton, Black, and Margrabe</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Asians.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Asians, Baskets, and Spreads</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Exotics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Other Exotics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Part V: Alternative Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_GARCH.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">GARCH Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_StochasticVol.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Stochastic Volatility</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Jumps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Jumps</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_VarianceSwaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Variance Swaps</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Part VI: Numerical Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_MonteCarlo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Monte Carlo Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Binomial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Binomial and Trinomial Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_PDEs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">PDE Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Fourier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Fourier Transforms</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_MachineLearning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Machine Learning</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Part VII: Fixed Income</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FixedIncome.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Fixed-Income Concepts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FixedIncomeDerivatives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Fixed-Income Derivatives</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Vasicek.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Vasicek and Extensions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Survey.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Term Structure Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendix</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./AppendixA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Miscellaneous Facts about Continuous-Time Models</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter_FixedIncome.html">Part VII: Fixed Income</a></li><li class="breadcrumb-item"><a href="./Chapter_Vasicek.html"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Vasicek and Extensions</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-c:vasicek" class="quarto-section-identifier"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Vasicek and Extensions</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="baf3c55e" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display">
<script type="text/javascript" async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_SVG"></script>
</div>
</div>
<!--\chaptermark{The Extended Vasicek Model}-->
<p>In the preceding chapter, we presented models for valuing swaptions, caps, and floors based on assumptions that certain forward rates have constant volatilities. As noted, the assumptions used to value swaptions on the one hand and caps and floors on the other are inconsistent. Because the values of fixed-income derivatives are derived from the yield curve, one can obtain a consistent model by developing a model of how the yield curve will evolve over time. In this chapter, we will give a fairly full account of one popular and relatively simple model. The next chapter contains much briefer descriptions of other models.</p>
<p>We will begin by describing the basic Vasicek model. The extended Vasicek model (of which there are several versions) includes time-dependent parameters, so that it can be fit to the yield curve at the time it is used and possibly also to other market variables, such as cap prices or yield volatilities.</p>
<section id="sec-s:vasicek1" class="level2" data-number="27.1">
<h2 data-number="27.1" class="anchored" data-anchor-id="sec-s:vasicek1"><span class="header-section-number">27.1</span> The Short Rate and Discount Bond Prices</h2>
<p>An assumption of the Vasicek model and related models discussed in the next chapter is that there is an instantaneously risk-free rate. Letting <span class="math inline">\(r_s\)</span> denote this rate at date <span class="math inline">\(s\)</span>, the meaning of this assumption, as discussed in <a href="Chapter_Arbitrage.html" class="quarto-xref"><span>Chapter 7</span></a>, is that there is an asset with price process <span class="math display">\[
R_t = \exp\left(\int_0^t r_s\,\mathrm{d}s\right)\;.
\]</span> The instantaneous rate of return on this asset is <span class="math display">\[
\frac{\,\mathrm{d}R_t}{R_t} = r_t\,\mathrm{d}t\;.
\]</span></p>
<p>There is no random term (of the form <span class="math inline">\(\sigma\,\mathrm{d}B\)</span>) in this rate of return; thus, we view the return as known at date <span class="math inline">\(t\)</span>, whence the name instantaneously risk-free. If there were another instantaneously risk-free asset with rate of return <span class="math inline">\(\hat{r}_t\)</span> which differed from <span class="math inline">\(r_t\)</span> on a non-negligible set of dates and states of the world, there would be an arbitrage opportunity. Hence, we will assume there is a unique instantaneously risk-free rate. We will call this rate the short rate. The interpretation of the price <span class="math inline">\(R_t\)</span> is that it is the amount that would be accumulated by date <span class="math inline">\(t\)</span>, beginning with $1 at date <span class="math inline">\(0\)</span> and continuously rolling over the investment in the instantaneously risk-free asset. It is conceptually similar to the net asset value of a money market fund, so <span class="math inline">\(R\)</span> is sometimes called the price of a money market account. We will also call it an accumulation factor.</p>
<p>The probability measure associated with <span class="math inline">\(R\)</span> being the numeraire is called the risk-neutral probability, just as when the short rate is constant. Under the risk-neutral probability, the price <span class="math inline">\(P(t,u)\)</span> at date <span class="math inline">\(t\)</span> of a discount bond maturing at <span class="math inline">\(u\)</span> must be <span id="eq-basicbondprice"><span class="math display">\[
P(t,u) = R_t \\E^R_t \left[\frac{1}{R(u)}\right] = \\E^R_t \left[ \exp\left(-\int_t^u r_s\,\mathrm{d}s\right)\right]\;,
\qquad(27.1)\]</span></span></p>
<p>the first equality being a result of our fundamental pricing <a href="Chapter_Arbitrage.html#eq-formula" class="quarto-xref">Equation&nbsp;<span>7.28</span></a> and the fact that the discount bond pays $1 at maturity and the second equality following from the definition of <span class="math inline">\(R\)</span>. Thus, a model for the evolution of the short rate under the risk-neutral probability implies a model for discount bond prices and hence the yield curve.</p>
</section>
<section id="sec-s:vasicek" class="level2" data-number="27.2">
<h2 data-number="27.2" class="anchored" data-anchor-id="sec-s:vasicek"><span class="header-section-number">27.2</span> The Vasicek Model</h2>
<p>In the basic Vasicek <span class="citation" data-cites="Vasicek">(<a href="#ref-Vasicek" role="doc-biblioref">Vasicek 1977</a>)</span> model, it is assumed that <span id="eq-vasicek"><span class="math display">\[
\,\mathrm{d}r_t = \kappa\big[\theta-r_t\big]\,\mathrm{d}t+\sigma\,\mathrm{d}B_t
\qquad(27.2)\]</span></span></p>
<p>for constants <span class="math inline">\(\kappa\geq 0\)</span>, <span class="math inline">\(\theta\)</span>, and <span class="math inline">\(\sigma\)</span>, where <span class="math inline">\(B\)</span> is a Brownian motion under the risk-neutral probability. In this model, <span class="math inline">\(\theta\)</span> is the long-run mean of the short rate process and <span class="math inline">\(\kappa\)</span> is interpreted as the rate of mean reversion. When <span class="math inline">\(r_t &gt;\theta\)</span>, the drift term will be negative and push <span class="math inline">\(r\)</span> down towards <span class="math inline">\(\theta\)</span>. Likewise, when <span class="math inline">\(r_t &lt;\theta\)</span>, the drift term will be positive and push <span class="math inline">\(r\)</span> up towards <span class="math inline">\(\theta\)</span>. The rate at which <span class="math inline">\(r\)</span> drifts towards <span class="math inline">\(\theta\)</span> is obviously determined by <span class="math inline">\(\kappa\)</span>. <strong>We are going to depart from our convention and call <span class="math inline">\(\sigma\)</span> the volatility of the short rate</strong> even though <span class="math inline">\(\sigma^2\,\mathrm{d}t\)</span> is the instantaneous variance of <span class="math inline">\(\,\mathrm{d}r\)</span> rather than <span class="math inline">\(\,\mathrm{d}r/r\)</span>.</p>
<p>The short rate is normally distributed in the Vasicek model. Given information at date <span class="math inline">\(t\)</span>—i.e., knowledge of <span class="math inline">\(r_t\)</span>—then, if <span class="math inline">\(\kappa&gt;0\)</span>, the rate <span class="math inline">\(r_s\)</span> for <span class="math inline">\(s&gt;t\)</span> is normally distributed with mean<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> <span id="eq-vasicekmean"><span class="math display">\[
\theta + \mathrm{e}^{-\!\kappa (s-t)}\big[r_t-\theta\big]
\qquad(27.3)\]</span></span></p>
<p>and variance <span id="eq-vasicekvariance"><span class="math display">\[
\frac{\sigma^2\left(1-\mathrm{e}^{-2\kappa(s-t)}\right)}{2\kappa}\;.
\qquad(27.4)\]</span></span></p>
<p>For any <span class="math inline">\(r_t\)</span>, the mean converges to <span class="math inline">\(\theta\)</span> at long horizons (i.e., as <span class="math inline">\(s \rightarrow \infty\)</span>), justifying the interpretation of <span class="math inline">\(\theta\)</span> as the long run mean. In fact, the mean converges exponentially to <span class="math inline">\(\theta\)</span> at rate <span class="math inline">\(\kappa\)</span>. The variance at long horizons is <span class="math inline">\(\sigma^2/2\kappa\)</span>. On the other hand, if <span class="math inline">\(\kappa=0\)</span>, then the short rate is a Brownian motion with volatility <span class="math inline">\(\sigma\)</span>. The mean of <span class="math inline">\(r_s\)</span> is <span class="math inline">\(r_t\)</span> for <span class="math inline">\(s&gt;t\)</span>, and the variance of <span class="math inline">\(r_s\)</span> is <span class="math inline">\((s-t)\sigma^2\)</span>. Thus, the uncertainty at long horizons, as measured by the variance, is unbounded when <span class="math inline">\(\kappa=0\)</span>. Whether <span class="math inline">\(\kappa\)</span> is positive or not, an implication of the normal distribution is that there is a positive probability of the short rate <span class="math inline">\(r_s\)</span> being negative at any date <span class="math inline">\(s&gt;t\)</span>, which should not be the case for (nominal) interest rates. However, the probability of negative rates over any given horizon will be small if the variance is sufficiently small. From <a href="#eq-vasicekvariance" class="quarto-xref">Equation&nbsp;<span>27.4</span></a>, we see that, when <span class="math inline">\(\kappa&gt;0\)</span>, the variance will be small if either the volatility <span class="math inline">\(\sigma\)</span> is small or the rate of mean reversion <span class="math inline">\(\kappa\)</span> is large.</p>
<p>These facts about the distribution of the short rate demonstrate the importance of assuming mean reversion (<span class="math inline">\(\kappa&gt;0\)</span>). If <span class="math inline">\(\kappa=0\)</span>, the short rate (because it is a Brownian motion) has the property that for any real number <span class="math inline">\(K\)</span>, with probability one there will be some date <span class="math inline">\(s&gt;t\)</span> such that <span class="math inline">\(r_s&gt;K\)</span>, irrespective of the starting position <span class="math inline">\(r_t\)</span>. Likewise, there will be some date <span class="math inline">\(s'&gt;t\)</span> such that <span class="math inline">\(r(s')&lt;-K\)</span>. Thus, the short rate wanders off in both directions in an unbounded way. This property may be reasonable for the logarithm of a stock price, because a stock price may become arbitrarily high or arbitrarily close to zero (implying that the logarithm is unbounded both above and below). However, it is not reasonable for an interest rate, which should exhibit more stability. The assumption of mean reversion (<span class="math inline">\(\kappa&gt;0\)</span>) provides this stability, guaranteeing that the uncertainty at long horizons is bounded and that on average the short rate will converge back to a finite long-run mean. Nevertheless, we will give results in this chapter for the case <span class="math inline">\(\kappa=0\)</span>, because this is a particularly simple model and because it is the basic building block for what is called the continuous-time Ho-Lee model. The actual Ho-Lee model, which is a binomial model, will be discussed in the following chapter.</p>
<p>The relative simplicity of the Vasicek model stems from the fact that under assumption <a href="#eq-vasicek" class="quarto-xref">Equation&nbsp;<span>27.2</span></a> the accumulation factor <span class="math inline">\(R\)</span> is lognormally distributed. Specifically, at any date <span class="math inline">\(t\)</span> and given any date <span class="math inline">\(u&gt;t\)</span>, the random variable <span class="math display">\[
\int_t^u r_s\,\mathrm{d}s
\]</span> is normally distributed. Its mean and variance depend on the parameters <span class="math inline">\(\kappa\)</span>, <span class="math inline">\(\theta\)</span>, and <span class="math inline">\(\sigma\)</span> and the length of the time interval <span class="math inline">\(u-t\)</span>. The mean also depends on the short rate <span class="math inline">\(r_t\)</span> at date <span class="math inline">\(t\)</span>. Therefore, the discount bond price depends on the same things.</p>
<p>We will now present an explicit formula for discount bond prices, based on the fundamental <a href="#eq-basicbondprice" class="quarto-xref">Equation&nbsp;<span>27.1</span></a>. By taking the Ito differential of <span class="math inline">\(r_s\)</span> in the following, one can verify that it is the solution of the Vasicek model <a href="#eq-vasicek" class="quarto-xref">Equation&nbsp;<span>27.2</span></a>:^[<a href="#eq-vasicek_sol" class="quarto-xref">Equation&nbsp;<span>27.5</span></a> implies the distributional properties of <span class="math inline">\(r_s\)</span> stated earlier. The integral <span class="math inline">\(\int_t^s \mathrm{e}^{-\!\kappa (s-y)} \,\mathrm{d}B(y)\)</span> is normally distributed with mean zero; therefore equation~<a href="#eq-vasicek_sol" class="quarto-xref">Equation&nbsp;<span>27.5</span></a> shows that the mean of <span class="math inline">\(r_s\)</span> in the case <span class="math inline">\(\kappa&gt;0\)</span> is as given in <a href="#eq-vasicekmean" class="quarto-xref">Equation&nbsp;<span>27.3</span></a>. The variance is computed, following the rules in <span class="quarto-unresolved-ref">?sec-c:continuoustime</span>, as <span class="math inline">\(\int_t^s \mathrm{e}^{-2\kappa (s-y)}\,\mathrm{d}y\)</span>, which simplifies to the formula given in <a href="#eq-vasicekvariance" class="quarto-xref">Equation&nbsp;<span>27.4</span></a>.} <span id="eq-vasicek_sol"><span class="math display">\[
r_s =  \theta - \mathrm{e}^{-\!\kappa (s-t)}\big[\theta-r_t\big]+ \sigma
\int_t^s \mathrm{e}^{-\!\kappa (s-y)} \,\mathrm{d}B(y).
\qquad(27.5)\]</span></span></p>
<p>If <span class="math inline">\(\kappa=0\)</span>, this simplifies to <span id="eq-vasicek_sol2"><span class="math display">\[
r_s = r_t + \sigma\int_t^s\,\mathrm{d}B(y)= r_t + \sigma[B_s-B_t]\;.
\qquad(27.6)\]</span></span></p>
<p>These equations imply the following.</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">27.3</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the Vasicek model, consider dates <span class="math inline">\(t&lt;u\)</span> and define <span class="math inline">\(\tau=u-t\)</span>. Given the short rate <span class="math inline">\(r_t\)</span> at date <span class="math inline">\(t\)</span>, the discount bond price has the form</p>
<p><span id="eq-vasicekbond"><span class="math display">\[
P(t,u) = \exp\left(-a(\tau)-b(\tau)r_t\right)\;,
\qquad(27.7)\]</span></span></p>
<p>where, if <span class="math inline">\(\kappa=0\)</span>,</p>
<p><span id="eq-vasicek_ak0"><span class="math display">\[
a(\tau)=-\sigma^2\tau^3/6\;,
\qquad(27.8)\]</span></span></p>
<p><span id="eq-vasicek_bk0"><span class="math display">\[
b(\tau) = \tau\;,
\qquad(27.9)\]</span></span></p>
<p>and, if <span class="math inline">\(\kappa&gt;0\)</span>, <span id="eq-vasicek_a1111"><span class="math display">\[
a(\tau)= \theta\tau-\frac{\theta}{\kappa}\left(1-\mathrm{e}^{-\kappa\tau}\right)-\frac{\sigma^2}{4\kappa^3}\left(2\kappa\tau -\mathrm{e}^{-2\kappa\tau}+4\mathrm{e}^{-\kappa\tau}-3\right)\;,
\qquad(27.10)\]</span></span></p>
<p><span id="eq-vasicekb1111"><span class="math display">\[
b(\tau)= \frac{1}{\kappa}\left(1-\mathrm{e}^{-\kappa\tau}\right)\;.
\qquad(27.11)\]</span></span></p>
</div>
</div>
<div class="callout callout-style-default callout-Extra no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Theory Extra
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>##</p>
<p>We will end this section with a proof of <a href="#eq-vasicekbond" class="quarto-xref">Equation&nbsp;<span>27.7</span></a> - <a href="#eq-vasicekb1111" class="quarto-xref">Equation&nbsp;<span>27.11</span></a> in the case <span class="math inline">\(\kappa=0\)</span>. The formula for <span class="math inline">\(\kappa&gt;0\)</span> can be established by the same reasoning, the calculations being only slightly more complicated. From <a href="#eq-vasicek_sol2" class="quarto-xref">Equation&nbsp;<span>27.6</span></a>, we have <span class="math display">\[\begin{align*}
\int_t^u r_s\,\mathrm{d}s &amp; = \int_t^u \left[r_t+\sigma \int_t^s \,\mathrm{d}B(y)\right]\,\mathrm{d}s\\
&amp;=\tau\, r_t+\sigma \int_t^u \left\{\int_t^s \,\mathrm{d}B(y) \right\} \,\mathrm{d}s\; .
\end{align*}\]</span> We can change the order of integration in the double integral above to obtain <span class="math display">\[\begin{align*}
\int_t^u \left\{\int_t^s \,\mathrm{d}B(y) \right\} \,\mathrm{d}s &amp;=\int_t^u \left\{\int_y^u \,\mathrm{d}s\,\right\} \,\mathrm{d}B(y)\\
&amp;=\int_t^u (u-y)\,\mathrm{d}B(y)\;.
\end{align*}\]</span> Given the information at date <span class="math inline">\(t\)</span>, this is a normally distributed random variable with mean zero and variance equal to <span class="math display">\[
\int_t^u (u-y)^2\,\mathrm{d}y = \frac{\tau^3}{3}\;.
\]</span> Therefore, <span class="math inline">\(\int_t^u r_s\,\mathrm{d}s\)</span> is normally distributed with mean <span class="math inline">\(\tau\, r_t\)</span> and variance <span class="math inline">\(\sigma^2\tau^3/3\)</span>. We now use the fact that if <span class="math inline">\(x\)</span> is normally distributed with mean <span class="math inline">\(\mu\)</span> and variance <span class="math inline">\(\sigma^2\)</span>, then the mean of <span class="math inline">\(\mathrm{e}^x\)</span> is <span class="math inline">\(\mathrm{e}^{\mu+\sigma/2}\)</span>. Substituting this into <a href="#eq-basicbondprice" class="quarto-xref">Equation&nbsp;<span>27.1</span></a> gives the result.</p>
</div>
</div>
</div>
</section>
<section id="estimating-the-vasicek-model" class="level2" data-number="27.4">
<h2 data-number="27.4" class="anchored" data-anchor-id="estimating-the-vasicek-model"><span class="header-section-number">27.4</span> Estimating the Vasicek Model</h2>
<p>One way to choose the parameters <span class="math inline">\(\kappa\)</span>, <span class="math inline">\(\theta\)</span> and <span class="math inline">\(\sigma\)</span> of the Vasicek model is to imply them from market bond prices and <a href="#eq-vasicekbond" class="quarto-xref">Equation&nbsp;<span>27.7</span></a> - <a href="#eq-vasicekb1111" class="quarto-xref">Equation&nbsp;<span>27.11</span></a>. This is analogous to implying the volatility of a stock from market option prices and the Black-Scholes formula. This can also be viewed as an alternative to fitting a cubic spline, as discussed in <a href="Chapter_FixedIncome.html" class="quarto-xref"><span>Chapter 25</span></a>. Rather than selecting the parameters of the cubic spline to provide the best approximation to market bond prices, one can choose the Vasicek parameters <span class="math inline">\(\kappa\)</span>, <span class="math inline">\(\theta\)</span> and <span class="math inline">\(\sigma\)</span>. The <a href="#eq-basicbondprice" class="quarto-xref">Equation&nbsp;<span>27.1</span></a> will then give prices of discount bonds of all maturities.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>An alternative procedure is to estimate the parameters from historical data on the short rate. The short rate is a theoretical construct and one must choose some proxy to use for empirical work, for example, the Federal Funds rate, or the yield of a short-term (typically one-month or three-month) Treasury bill. One also needs to use a proxy for the short rate when implying the parameters from market bond prices as described in the previous paragraph (or one could view the short rate as one of the parameters to be implied).</p>
<p>An issue that arises when estimating the model from historical data is that the Vasicek <a href="#eq-vasicek" class="quarto-xref">Equation&nbsp;<span>27.2</span></a> characterizes the evolution of the short rate relative to a Brownian motion under the risk-neutral probability, whereas the historical data is governed by the actual measure. Vasicek <span class="citation" data-cites="Vasicek">(<a href="#ref-Vasicek" role="doc-biblioref">Vasicek 1977</a>)</span> actually assumed that <a href="#eq-vasicek" class="quarto-xref">Equation&nbsp;<span>27.2</span></a> holds relative to a Brownian motion under the actual probability measure. We will write his assumption as <span id="eq-vasicekactual"><span class="math display">\[
\,\mathrm{d}r_t = \kappa^*[\theta^*-r_t]\,\mathrm{d}t + \sigma^*\,\mathrm{d}B^*_t\;,
\qquad(27.12)\]</span></span></p>
<p>where <span class="math inline">\(\kappa^*\)</span>, <span class="math inline">\(\theta^*\)</span>, <span class="math inline">\(\sigma^*\)</span> are constants and <span class="math inline">\(B^*\)</span> is a Brownian motion under the actual probability measure.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> Vasicek then assumed a constant market price of risk <span class="math inline">\(\lambda\)</span> and deduced that^[The price of risk is the new drift of <span class="math inline">\(B^*\)</span> when we change from the actual measure to the risk-neutral probability. See Appendix~<span class="math inline">\(\ref{a_girsanov].}\)</span> <span id="eq-vasicekpriceofrisk"><span class="math display">\[
\,\mathrm{d}r_t = \kappa^*[\theta^*-r_t]\,\mathrm{d}t + \sigma^*\lambda\,\mathrm{d}t + \sigma^*\,\mathrm{d}B_t\;,
\qquad(27.13)\]</span></span></p>
<p>where <span class="math inline">\(B\)</span> is a Brownian motion under the risk-neutral probability. This is the same as <a href="#eq-vasicek" class="quarto-xref">Equation&nbsp;<span>27.2</span></a> when we define <span class="math inline">\(\kappa=\kappa^*\)</span>, <span class="math inline">\(\sigma=\sigma^*\)</span>, and <span class="math inline">\(\theta = \theta^*+\sigma^*\lambda/\kappa^*\)</span>. This means that the mean-reversion and volatility parameters are the same under the actual and risk-neutral probabilitys, whereas the long-run mean parameters <span class="math inline">\(\theta\)</span> and <span class="math inline">\(\theta^*\)</span> are related via the market price of risk. Thus, to estimate <span class="math inline">\(\kappa\)</span>, <span class="math inline">\(\theta\)</span> and <span class="math inline">\(\sigma\)</span> in <a href="#eq-vasicek" class="quarto-xref">Equation&nbsp;<span>27.2</span></a>, we could estimate <span class="math inline">\(\kappa^*=\kappa\)</span>, <span class="math inline">\(\sigma^*=\sigma\)</span>, and <span class="math inline">\(\theta^*\)</span> from <a href="#eq-vasicekactual" class="quarto-xref">Equation&nbsp;<span>27.12</span></a> and historical data and then choose <span class="math inline">\(\theta\)</span> to best fit market bond prices.</p>
<p>We can estimate the parameters of <a href="#eq-vasicekactual" class="quarto-xref">Equation&nbsp;<span>27.12</span></a> by linear regression. Suppose we have data on a proxy for the short rate at dates <span class="math inline">\(t_0, t_1, \ldots, t_N\)</span>, with <span class="math inline">\(t_{i}-t_{i-1}=\Delta t\)</span> for each <span class="math inline">\(i\)</span>. The solution <a href="#eq-vasicek_sol" class="quarto-xref">Equation&nbsp;<span>27.5</span></a> of the Vasicek <a href="#eq-vasicek" class="quarto-xref">Equation&nbsp;<span>27.2</span></a> for the short rate, adapted to <a href="#eq-vasicekactual" class="quarto-xref">Equation&nbsp;<span>27.12</span></a>, implies the following equation for the changes in the short rate: <span class="math display">\[\begin{multline*}
r_{t_i} - r_{t_{i-1}} = \left(1- \mathrm{e}^{-\!\kappa^* \Delta t}\right)\theta^* -\left(1- \mathrm{e}^{-\!\kappa^* \Delta t}\right)r_{t_{i-1}} \\+ \sigma^*
\int_{t_{i-1}}^{t_i} \mathrm{e}^{-\!\kappa^* (t_i-a)} \,\mathrm{d}B^*(a)\; .
\end{multline*}\]</span> We can write this as <span class="math display">\[
r_{t_i} - r_{t_{i-1}} = a + b\,r_{t_{i-1}} + \varepsilon
\]</span> where <span class="math inline">\(\varepsilon\)</span> is a normally distributed random variable, independent of <span class="math inline">\(r_{t_{i-1}}\)</span>, with mean zero and variance <span class="math display">\[
\sigma^{*2}
\int_{t_{i-1}}^{t_i} \mathrm{e}^{-2\kappa^* (t_i-a)}\,\mathrm{d}a = \frac{\sigma^{*2}\left(1-\mathrm{e}^{-2\kappa^*\Delta t}\right)}{2\kappa^*}\;.
\]</span> We can estimate <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span> and the variance of <span class="math inline">\(\varepsilon\)</span> by linear regression and then obtain <span class="math inline">\(\kappa^*\)</span>, <span class="math inline">\(\theta^*\)</span> and <span class="math inline">\(\sigma^*\)</span> from the equations <span class="math display">\[\begin{align*}
a&amp; = \left(1- \mathrm{e}^{-\!\kappa^* \Delta t}\right)\theta^*\; ,\\
b&amp;= -\left(1- \mathrm{e}^{-\!\kappa^* \Delta t}\right)\; ,\\
\text{var}(\varepsilon) &amp;= \frac{\sigma^{*2}\left(1-\mathrm{e}^{-2\kappa^*\Delta t}\right)}{2\kappa^*}\;.
\end{align*}\]</span></p>
</section>
<section id="sec-s:vasicekhedging" class="level2" data-number="27.5">
<h2 data-number="27.5" class="anchored" data-anchor-id="sec-s:vasicekhedging"><span class="header-section-number">27.5</span> Hedging in the Vasicek Model</h2>
<p>Because the Brownian motion driving the short rate also drives all the discount bond prices, the bond prices are (instantaneously) perfectly correlated in the Vasicek model (and also in the extensions we will consider next). This is true in any model in which there is a single factor, such as the short rate, that determines all bond prices. The volatilities of the bond returns determine the hedge ratios for hedging one bond with another.</p>
<p><a href="#eq-vasicekbond" class="quarto-xref">Equation&nbsp;<span>27.7</span></a> and Ito’s formula (the rule that, if <span class="math inline">\(P=\mathrm{e}^X\)</span>, then <span class="math inline">\(\,\mathrm{d}P/P = dX + (dX)^2/2\)</span>) imply that for any date <span class="math inline">\(t\)</span> and any fixed maturity date <span class="math inline">\(u&gt;t\)</span>, we have <span id="eq-vasicekbondreturn"><span class="math display">\[
\frac{\,\mathrm{d}P(t,u)}{P(t,u)} = r_t\,\mathrm{d}t - \sigma b(u\!-\!t)\,\mathrm{d}B_t\;.
\qquad(27.14)\]</span></span></p>
<p>Because <span class="math inline">\(B\)</span> is a Brownian motion under the risk-neutral probability, this equation implies that the expected rate of return on a discount bond under the risk-neutral probability is the short rate. This is not a surprise, because it is true for every asset under the risk-neutral probability. What is important in this equation is that the volatility is a non-random function of the date <span class="math inline">\(t\)</span>, given the maturity <span class="math inline">\(u\)</span>.</p>
<p>As an example, consider hedging a short two-year bond with a long position in a one-year bond at some date <span class="math inline">\(t\)</span>.<br>
According to <a href="#eq-vasicekbondreturn" class="quarto-xref">Equation&nbsp;<span>27.14</span></a>, the change in the value of the short position in the two-year bond will be <span class="math display">\[
-P(t,t+2)r_t\,\mathrm{d}t-P(t,t+2)\sigma b(2)\,\mathrm{d}B_t
\]</span></p>
<p>Suppose we hold <span class="math inline">\(x\)</span> units of the one-year bond as a hedge and borrow <span class="math display">\[
xP(t,t+1)-P(t,t+2)
\]</span></p>
<p>dollars at the instantaneously risk-free rate to finance the hedge. Then the change in the value of the portfolio will be <span class="math display">\[\begin{multline*}
xP(t,t+1)r_t\,\mathrm{d}t+xP(t,t+1)\sigma b(1)\,\mathrm{d}B_t \\- P(t,t+2)r_t\,\mathrm{d}t-P(t,t+2)\sigma b(2)\,\mathrm{d}B_t \\- [xP(t,t+1)-P(t,t+2)]\,r\,\mathrm{d}t \\= xP(t,t+1)\sigma b(1) \,\mathrm{d}B_t -P(t,t+2)\sigma b(2)\,\mathrm{d}B_t\;,
\end{multline*}\]</span> so a perfect hedge is obtained by setting <span class="math display">\[
x = \frac{b(2)P(t,t+2)}{b(1)P(t,t+1)}\;.
\]</span> In the case <span class="math inline">\(\kappa=0\)</span>, this simplifies to <span class="math inline">\(x=2P(t,t+2)/P(t,t+1)\)</span>, which means that the dollar value <span class="math inline">\(xP(t,t+1)\)</span> of the holding in the one-year bond is twice the dollar value of the short position in the two-year bond. One holds twice as much of the one-year bond, because it is half as volatile as the two-year bond in this model.</p>
<p>By this same reasoning, one can compute a perfect hedge for any discount bond by using another discount bond of any maturity. In fact, one can hedge any term structure derivative in this model by investing the right amount in a bond of any maturity. This is clearly overly simplistic, and such arbitrary hedges would not be used in practice.</p>
<p>There is a close connection between hedging in this model and duration hedging, as discussed in <a href="Chapter_FixedIncome.html#sec-s:duration" class="quarto-xref"><span>Section 25.4</span></a>. To see this, consider a coupon bond that at date <span class="math inline">\(t\)</span> has remaining cash flows <span class="math inline">\(C_1, \ldots, C_n\)</span> at dates <span class="math inline">\(t+\tau_1 &lt; \cdots &lt; t+\tau_n\)</span> and price <span class="math inline">\(P_t\)</span>. Its price should satisfy <span class="math display">\[
P_t = \sum_{j=1}^n C_jP(t,t+\tau_j)\;.
\]</span> In the Vasicek model, the random part of the change in the price of the coupon bond is <span class="math display">\[
-\sigma\left(\sum_{j=1}^n b(\tau_j)C_jP(t,t+\tau_j)\right)\,\mathrm{d}B_t \; ,
\]</span> and the random part of the return is <span id="eq-vasicekcouponreturn"><span class="math display">\[
-\sigma\left(\sum_{j=1}^n \frac{b(\tau_j)C_jP(t,t+\tau_j)}{P_t}\right)\,\mathrm{d}B_t\;.
\qquad(27.15)\]</span></span></p>
<p>Consider the case <span class="math inline">\(\kappa=0\)</span>. Then <span class="math inline">\(b(\tau_j)=\tau_j\)</span>, so the random part of the return of the coupon bond is <span class="math display">\[
-\sigma\left(\sum_{j=1}^n \frac{\tau_jC_jP(t,t+\tau_j)}{P_t}\right)\,\mathrm{d}B_t\;.
\]</span> The factor in parentheses is Duration<span class="math inline">\('\)</span> defined in <a href="Chapter_FixedIncome.html#eq-newduration100" class="quarto-xref">Equation&nbsp;<span>25.11</span></a>. Denoting it now as <span class="math inline">\(D_t\)</span> and recognizing that the expected rate of return of the bond must be the short rate, we have, in the Vasicek model with <span class="math inline">\(\kappa=0\)</span>, <span class="math display">\[
\frac{\,\mathrm{d}P_t}{P_t} = r_t\,\mathrm{d}t - \sigma D_t\,\mathrm{d}B_t\;.
\]</span> It follows that in this model one can hedge any fixed-income liability by holding enough of any coupon bond such that the dollar value multiplied by its duration equals the dollar value of the liability multiplied by its duration. In <a href="Chapter_FixedIncome.html#sec-s:duration" class="quarto-xref"><span>Section 25.4</span></a>, we noted that duration matching works for parallel shifts in the yield curve. Later, we will see that in the Vasicek model with <span class="math inline">\(\kappa=0\)</span> only parallel shifts in the yield curve are possible. Therefore, it should not be surprising that duration matching works in this model.</p>
<p>In the case <span class="math inline">\(\kappa&gt;0\)</span>, one can interpret the volatility of the coupon bond similarly. The analogue to duration for this model is the weighted average of the function <span class="math inline">\(b(\tau_j)\)</span> of the times to maturity, as <a href="#eq-vasicekcouponreturn" class="quarto-xref">Equation&nbsp;<span>27.15</span></a> shows. The weights again are the fractions of the bond value that each cash flow contributes.</p>
</section>
<section id="extensions-of-the-vasicek-model" class="level2" data-number="27.6">
<h2 data-number="27.6" class="anchored" data-anchor-id="extensions-of-the-vasicek-model"><span class="header-section-number">27.6</span> Extensions of the Vasicek Model</h2>
<p>To fit the model to current market conditions at the time the model is being used, the parameters <span class="math inline">\(\kappa\)</span>, <span class="math inline">\(\theta\)</span> and <span class="math inline">\(\sigma\)</span> can be taken to be time-dependent. The model with time-dependent parameters is studied in Hull and White <span class="citation" data-cites="HW">(<a href="#ref-HW" role="doc-biblioref">Hull and White 1990</a>)</span> and is usually called the Hull-White model. It is convenient to denote by <span class="math inline">\(\theta_t\)</span> the time-dependent function replacing the constant <span class="math inline">\(\kappa\theta\)</span> in the definition of the Vasicek model <a href="#eq-vasicek" class="quarto-xref">Equation&nbsp;<span>27.2</span></a>; that is, we redefine as <span class="math inline">\(\theta\)</span> what was previously <span class="math inline">\(\kappa\theta\)</span>.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> As usual, we will let date <span class="math inline">\(0\)</span> be the date at which we are using the model. The model is then, for <span class="math inline">\(t&gt;0\)</span>, <span id="eq-hw500"><span class="math display">\[
\,\mathrm{d}r_t = \theta_t\,\mathrm{d}t - \kappa_tr_t\,\mathrm{d}t + \sigma_t\,\mathrm{d}B_t\;.
\qquad(27.16)\]</span></span></p>
<p>We will focus on the simplest case, in which <span class="math inline">\(\kappa\)</span> and <span class="math inline">\(\sigma\)</span> are constants, deferring discussion of the general case to the last section of this chapter. The general case is quite similar, with the formulas being only slightly more complicated. So, we assume now that <span id="eq-hw5000"><span class="math display">\[
\,\mathrm{d}r_t = \theta_t\,\mathrm{d}t - \kappa r_t\,\mathrm{d}t + \sigma \,\mathrm{d}B_t\;.
\qquad(27.17)\]</span></span></p>
<p>for a non-random function <span class="math inline">\(\theta\)</span>.<br>
We will call this model with <span class="math inline">\(\kappa&gt;0\)</span> the Hull-White model. The model with <span class="math inline">\(\kappa=0\)</span> (i.e., in the absence of mean reversion) is called the continuous-time Ho-Lee model. We will refer to the general case <a href="#eq-hw500" class="quarto-xref">Equation&nbsp;<span>27.16</span></a> as the general Hull-White model, and we will discuss it in <a href="#sec-s:generalHW" class="quarto-xref"><span>Section 27.16</span></a>. In the Hull-White model, we can interpret <span class="math inline">\(\theta_t/\kappa\)</span> as a time-varying long-run mean of the short rate process, because we have <span class="math display">\[\,\mathrm{d}r_t = \kappa\left[ \frac{\theta_t}{\kappa} - r_t\right]\,\mathrm{d}t + \sigma\,\mathrm{d}B_t\; .\]</span> One can show by the following by directly differentiating.</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">27.7</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the Hull-White model,</p>
<p><span id="eq-vasicekextension_sol"><span class="math display">\[
r_s = \phi_s + \hat{r}_s\;,
\qquad(27.18)\]</span></span></p>
<p>where</p>
<p><span id="eq-phi102"><span class="math display">\[
\phi_s =  \int_0^s\mathrm{e}^{-\kappa(s-y)}\theta(y)\,\mathrm{d}y\;,
\qquad(27.19)\]</span></span></p>
<p>and <span id="eq-rhat102"><span class="math display">\[
\hat{r}_s = \mathrm{e}^{-\kappa s}r_0+\sigma\int_0^s\mathrm{e}^{-\kappa(s-y)}\,\mathrm{d}B(y)\;.
\qquad(27.20)\]</span></span></p>
<p>When <span class="math inline">\(\kappa=0\)</span> (the continuous-time Ho-Lee model), these formulas simplify to <span id="eq-phi103"><span class="math display">\[
\phi_s =  \int_0^s\theta(y)\,\mathrm{d}y\;.
\qquad(27.21)\]</span></span></p>
<p>and <span id="eq-rhat103"><span class="math display">\[
\hat{r}_s = r_0+\sigma B_s\;.
\qquad(27.22)\]</span></span></p>
</div>
</div>
<p>Note that <a href="#eq-rhat102" class="quarto-xref">Equation&nbsp;<span>27.20</span></a> and <a href="#eq-rhat103" class="quarto-xref">Equation&nbsp;<span>27.22</span></a> imply <span id="eq-rhat10001"><span class="math display">\[
\,\mathrm{d}\hat{r}_t = -\kappa \hat{r}_t\,\mathrm{d}t + \sigma\,\mathrm{d}B_t\; ,
\qquad(27.23)\]</span></span></p>
<p>where <span class="math inline">\(\kappa=0\)</span> for <a href="#eq-rhat103" class="quarto-xref">Equation&nbsp;<span>27.22</span></a>. Thus, <span class="math inline">\(\hat{r}\)</span> is a Vasicek short-rate process having a long-run mean of zero.</p>
<p>The virtue of the expression for <span class="math inline">\(r\)</span> given in <a href="#eq-vasicekextension_sol" class="quarto-xref">Equation&nbsp;<span>27.18</span></a> - <a href="#eq-rhat103" class="quarto-xref">Equation&nbsp;<span>27.22</span></a> is that the basic bond pricing <a href="#eq-basicbondprice" class="quarto-xref">Equation&nbsp;<span>27.1</span></a> now gives us</p>
<p><span class="math display">\[
P(t,u) = \\E^R_t \left[ \exp\left(-\int_t^u r_s\,\mathrm{d}s\right)\right]
\]</span> <span class="math display">\[
= \\E^R_t \left[ \exp\left(-\int_t^u \phi_s + \hat{r}_s\,\mathrm{d}s\right)\right]
\]</span> <span class="math display">\[
= \\E^R_t \left[ \exp\left(-\int_t^u \phi_s\,\mathrm{d}s\right)\exp\left(-\int_t^u  \hat{r}_s\,\mathrm{d}s\right)\right]
\]</span> <span id="eq-vasicekpullsout"><span class="math display">\[
= \exp\left(-\int_t^u \phi_s\,\mathrm{d}s\right)\\E^R_t \left[ \exp\left(-\int_t^u \hat{r}_s\,\mathrm{d}s\right)\right]\;.
\qquad(27.24)\]</span></span></p>
<p>Thus, the non-random part <span class="math inline">\(\phi_s\)</span> of the short-rate process pulls out of the expectation in the pricing formula. Furthermore, we have already calculated the expectation in <a href="#eq-vasicekpullsout" class="quarto-xref">Equation&nbsp;<span>27.24</span></a> because it is the discount bond price in the Vasicek model with a long-run mean of zero. This yields the following.</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">27.8</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Consider dates <span class="math inline">\(t&lt;u\)</span> and define <span class="math inline">\(\tau=u-t\)</span>. The price at date <span class="math inline">\(t\)</span> of a discount bond maturing at date <span class="math inline">\(u\)</span> in the extended Vasicek model is</p>
<p><span id="eq-extendedvasicekbond"><span class="math display">\[
P(t,u) = \exp\left(-\int_t^u \phi_s\,\mathrm{d}s-a(\tau)-b(\tau)\hat{r}_t\right)\;,
\qquad(27.25)\]</span></span></p>
<p>where, in the continuous-time Ho-Lee model,</p>
<p><span id="eq-extendedvasicekbond_ak0"><span class="math display">\[
a(\tau)=-\sigma^2\tau^3/6\;,
\qquad(27.26)\]</span></span></p>
<p><span id="eq-extendedvasicekbond_bk0"><span class="math display">\[
b(\tau) = \tau\;,
\qquad(27.27)\]</span></span></p>
<p>and, in the Hull-White model, <span id="eq-extendedvasicek_a"><span class="math display">\[
a(\tau)= -\frac{\sigma^2}{4\kappa^3}\left(2\kappa\tau -\mathrm{e}^{-2\kappa\tau}+4\mathrm{e}^{-\kappa\tau}-3\right)\;,
\qquad(27.28)\]</span></span></p>
<p><span id="eq-extendedvasicek_b"><span class="math display">\[
b(\tau)= \frac{1}{\kappa}\left(1-\mathrm{e}^{-\kappa\tau}\right)\;.
\qquad(27.29)\]</span></span></p>
</div>
</div>
<p>Using the fact that the expected rate of return on a discount bond must be the short rate under the risk-neutral probability, we obtain from <a href="#eq-extendedvasicekbond" class="quarto-xref">Equation&nbsp;<span>27.25</span></a> and <a href="#eq-rhat10001" class="quarto-xref">Equation&nbsp;<span>27.23</span></a> that, for each fixed maturity date <span class="math inline">\(u\)</span>, <span id="eq-extendedvasicekbondreturn"><span class="math display">\[
\frac{\,\mathrm{d}P(t,u)}{P(t,u)} = r_t\,\mathrm{d}t - \sigma b(\tau)\,\mathrm{d}B_t\;.
\qquad(27.30)\]</span></span></p>
<p>Thus, the volatilities are determined by the function <span class="math inline">\(b\)</span>, just as in the basic Vasicek model. The computation of hedge ratios is therefore analogous to the computations presented in <a href="#sec-s:vasicekhedging" class="quarto-xref"><span>Section 27.5</span></a> for the basic Vasicek model. In fact, the volatilities of discount bond returns in the Hull-White model are the same as in the Vasicek model with <span class="math inline">\(\kappa&gt;0\)</span>, and the volatilities in the continuous-time Ho-Lee model are the same as in the Vasicek model with <span class="math inline">\(\kappa=0\)</span>.</p>
</section>
<section id="sec-s:vasicek_fitting" class="level2" data-number="27.9">
<h2 data-number="27.9" class="anchored" data-anchor-id="sec-s:vasicek_fitting"><span class="header-section-number">27.9</span> Fitting Discount Bond Prices and Forward Rates</h2>
<p>It is simple to fit the Hull-White model and continuous-time Ho-Lee model to market discount bond prices by choosing the function <span class="math inline">\(\phi\)</span>. We will use the superscript mkt to denote market prices. Letting date <span class="math inline">\(0\)</span> denote the date at which we are fitting the model, we want to have <span class="math display">\[
P^{\text{mkt}}(0,u) = P(0,u)
\]</span> for all maturities <span class="math inline">\(u\)</span>, where <span class="math inline">\(P(0,u)\)</span> denotes the model prices given in <a href="#eq-extendedvasicekbond" class="quarto-xref">Equation&nbsp;<span>27.25</span></a> as <span class="math display">\[
P(0,u) = \exp\left(-\int_0^u \phi_s\,\mathrm{d}s-a(u)-b(u)r_0\right)\;.
\]</span> The functions <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> depend on <span class="math inline">\(\kappa\)</span> and <span class="math inline">\(\sigma\)</span>, but we regard them now as having already been chosen. Therefore, to match the model prices to market prices, we simply have to set <span id="eq-vasicekcalibration101"><span class="math display">\[
\exp\left(-\int_0^u \phi_s\right) = \exp\left(a(u)+b(u)r_0\right)P^{\text{mkt}}(0,u)\;.
\qquad(27.31)\]</span></span></p>
<p>Usually we will only need to solve <a href="#eq-vasicekcalibration101" class="quarto-xref">Equation&nbsp;<span>27.31</span></a> for a finite number of maturities <span class="math inline">\(u\)</span> in order to calibrate the model sufficiently. We will illustrate this in the analysis of coupon bond options in <a href="#sec-s:vasicek_swaptions" class="quarto-xref"><span>Section 27.13</span></a>. However, the equation can be solved in principle for each maturity <span class="math inline">\(u\)</span> as follows: take the natural logarithm of both sides, multiply by minus 1, and differentiate with respect to <span class="math inline">\(u\)</span> to obtain <span id="eq-extendedvasicekforwards1"><span class="math display">\[
\phi(u) = -\frac{\partial a(u)}{\partial u} - \frac{\partial b(u)}{\partial u}r_0 - \frac{ \partial \log P^{\text{mkt}}(0,u)}{\partial u}\;.
\qquad(27.32)\]</span></span></p>
<p><a href="#eq-extendedvasicekforwards1" class="quarto-xref">Equation&nbsp;<span>27.32</span></a> gives the solution of the model for <span class="math inline">\(\phi(u)\)</span>, and it also has an important interpretation. We can obviously rearrange it as <span id="eq-extendedvasicekforwards"><span class="math display">\[
\phi(u) +\frac{\partial a(u)}{\partial u} + \frac{\partial b(u)}{\partial u}r_0 = -\frac{ \partial \log P^{\text{mkt}}(0,u)}{\partial u}\;.
\qquad(27.33)\]</span></span></p>
<p>The expression <span class="math display">\[
-\frac{\partial \log P^{\text{mkt}}(0,u)}{\partial u}
\]</span> is the <em>market</em> instantaneous forward rate at date <span class="math inline">\(0\)</span> for maturity <span class="math inline">\(u\)</span>. The left-hand side of <a href="#eq-extendedvasicekforwards" class="quarto-xref">Equation&nbsp;<span>27.33</span></a> is equal to <span class="math display">\[
-\frac{\partial \log P(0,u)}{\partial u}\; ,
\]</span> and hence is the <em>model</em> instantaneous forward rate at date <span class="math inline">\(0\)</span> for maturity <span class="math inline">\(u\)</span>.<br>
Therefore, fitting the model to the yield curve is equivalent to fitting model forward rates to market forward rates.^[To understand the interpretation of the derivatives of the log bond prices as forward rates, consider the market prices <span class="math inline">\(P^{\text{mkt}}(0,u)\)</span>. Recall from our discussion in <a href="Chapter_FixedIncomeDerivatives.html#sec-s:forwardrates" class="quarto-xref"><span>Section 26.2</span></a> that to lock in at date <span class="math inline">\(0\)</span> the rate of interest on a $1 loan from dates <span class="math inline">\(u\)</span> to <span class="math inline">\(u'\)</span>, one can buy a unit of the discount bond maturing at <span class="math inline">\(u\)</span> and raise the funds <span class="math inline">\(P^{\text{mkt}}(0,u)\)</span> required by short-selling <span class="math inline">\(P^{\text{mkt}}(0,u)/P^{\text{mkt}}(0,u')\)</span> units of the bond maturing at <span class="math inline">\(u'\)</span>, which leads to an obligation of <span class="math inline">\(P^{\text{mkt}}(0,u)/P^{\text{mkt}}(0,u')\)</span> dollars at date <span class="math inline">\(u'\)</span>. The continuously compounded forward rate for the loan between dates <span class="math inline">\(u\)</span> and <span class="math inline">\(u'\)</span> is therefore <span class="math inline">\(x\)</span> defined by <span class="math display">\[
\mathrm{e}^{(u'-u)x} = \frac{P^{\text{mkt}}(0,u)}{P^{\text{mkt}}(0,u')}\;.
\]</span> Equivalently, <span class="math display">\[
x = \frac{\log P^{\text{mkt}}(0,u) -\log P^{\text{mkt}}(0,u')}{u'-u} = - \frac{\log P^{\text{mkt}}(0,u') -\log P^{\text{mkt}}(0,u)}{u'-u}\;.
\]</span> As we make the maturity of the loan shorter, with <span class="math inline">\(u' \rightarrow u\)</span>, the limit of the above (the forward rate for an instantaneous loan) is by definition the derivative (the usual calculus derivative) of <span class="math inline">\(-\log P^{\text{mkt}}(0,u)\)</span>.}</p>
<p>It is very important to note that if we choose the function <span class="math inline">\(\phi_t\)</span> at date <span class="math inline">\(0\)</span> to match the market, then when we want to recalibrate the model at some later date to match the market at that date, we will have to select a different <span class="math inline">\(\phi\)</span> function at the later date. In other words, we use a model today that we know we will discard as incorrect tomorrow. The <span class="math inline">\(\phi\)</span> function (as well as the <span class="math inline">\(\kappa\)</span> and <span class="math inline">\(\sigma\)</span> functions in the general Hull-White model) is continually discarded and refit to match the market. This is an unpleasant reality, but it is not really too different from using implied volatilities in the Black-Scholes formula. We know that the implied volatility curve changes over time, so the volatility we use tomorrow may well be different from the volatility we use today. No model is every a literally correct description of the real world. As has been said, the test of the pudding is in the tasting. The test of a model is whether it generates reasonably correct values and hedges. This is an empirical question, and it is not equivalent to the question of whether the assumptions of the model are correct.</p>
</section>
<section id="sec-s:vasicek_discounts" class="level2" data-number="27.10">
<h2 data-number="27.10" class="anchored" data-anchor-id="sec-s:vasicek_discounts"><span class="header-section-number">27.10</span> Discount Bond Options, Caps and Floors</h2>
<p>We can use Black’s formula to value discount bond options in the Vasicek model and in its extensions. As explained in the previous chapter, caps and floors are portfolios of discount bond options, so the values of caps (floors) can be computed by summing the values of the individual caplets (floorlets). The reason we can apply Black’s formula is that the volatility of the forward price of a discount bond is non-random in the Vasicek model and its extensions.</p>
<p>Consider valuing at date <span class="math inline">\(0\)</span> an option maturing at date <span class="math inline">\(T\)</span> on a discount bond maturing at <span class="math inline">\(u&gt;T\)</span>. Because forward must equal spot at maturity, an option written on a forward contract maturing at <span class="math inline">\(T\)</span> is equivalent.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. The forward price of the discount bond at date <span class="math inline">\(t \leq T\)</span> for a forward contract maturing at <span class="math inline">\(T\)</span> is given by <span class="math display">\[
F_t =\frac{P(t,u)}{P(t,T)}\;.
\]</span> From Ito’s formula and the equation~<a href="#eq-extendedvasicekbondreturn" class="quarto-xref">Equation&nbsp;<span>27.30</span></a> for the discount bond returns, we have <span class="math display">\[\begin{align*}
\frac{\,\mathrm{d}F_t}{F_t} &amp;= \text{something}\,\mathrm{d}t + \frac{\,\mathrm{d}P(t,u)}{P(t,u)} - \frac{\,\mathrm{d}P(t,T)}{P(t,T)}\\
&amp;= \text{something}\,\mathrm{d}t -\sigma[b(u-t)-b(T-t)]\,\mathrm{d}B_t\;.
\end{align*}\]</span> Thus, the volatility depends on the non-random function <span class="math inline">\(b\)</span>.</p>
<p>In the continuous-time Ho-Lee model, we have <span class="math display">\[
b(u-t)-b(T-t) = u-T\;.
\]</span> Therefore, the forward price has a constant volatility equal to <span class="math inline">\((u-T)\sigma\)</span>. In the Hull-White model, we have <span class="math display">\[
b(u-t)-b(T-t) = \frac{1}{\kappa}\left(\mathrm{e}^{-\kappa(T-t)}-\mathrm{e}^{-\kappa(u-t)}\right) = \frac{\left(\mathrm{e}^{-\kappa T} - \mathrm{e}^{-\kappa u}\right)\mathrm{e}^{\kappa t}}{\kappa} \;.
\]</span> Thus, the volatility is time varying (it depends on <span class="math inline">\(t\)</span>), so we compute the average volatility as in <span class="quarto-unresolved-ref">?sec-s:timevaryingvolatility</span> and <a href="Chapter_Merton.html#sec-s:volatility" class="quarto-xref"><span>Section 13.15</span></a>. Specifically,</p>
<p><span class="math display">\[
\sigma_{\text{avg}} = \frac{\sigma\left(\mathrm{e}^{-\kappa T} - \mathrm{e}^{-\kappa u}\right)}{\kappa} \sqrt{\frac{1}{T}\int_0^T \mathrm{e}^{2\kappa t}\,\mathrm{d}t}
\]</span> <span id="eq-vasiceksigmaavg"><span class="math display">\[
=\frac{\sigma\left(\mathrm{e}^{-\kappa T} - \mathrm{e}^{-\kappa u}\right)}{\kappa}\sqrt{\frac{\mathrm{e}^{2\kappa T}-1}{2\kappa T}}\;.
\qquad(27.34)\]</span></span></p>
<p>Substituting <span class="math inline">\(P^{\text{mkt}}(0,u)/P^{\text{mkt}}(0,T)\)</span> as the forward price of the discount bond maturing at <span class="math inline">\(u\)</span> in Black’s formula gives the following.</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">27.11</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Consider an option with exercise price <span class="math inline">\(K\)</span> maturing at date <span class="math inline">\(T\)</span> on a discount bond maturing at date <span class="math inline">\(u&gt;T\)</span>. In the extended Vasicek model, the values at date <span class="math inline">\(0\)</span> of such options are</p>
<p><span id="eq-vasicekdiscountcall"><span class="math display">\[
\text{Call Price} =P^{\text{mkt}}(0,u)\mathrm{N}(d_1) - P^{\text{mkt}}(0,T)K\mathrm{N}(d_2)\;,
\qquad(27.35)\]</span></span></p>
<p><span id="eq-vasicekdiscountput"><span class="math display">\[
\text{Put Price} = P^{\text{mkt}}(0,T)K\mathrm{N}(-d_2)-P^{\text{mkt}}(0,u)\mathrm{N}(-d_1)\;,
\qquad(27.36)\]</span></span></p>
<p>where</p>
<p><span id="eq-vasicekdiscountcall_d1"><span class="math display">\[
d_1 = \frac{\log P^{\text{mkt}}(0,u) - \log\left(P^{\text{mkt}}(0,T)K\right) +\frac{1}{2}\sigma_{\text{avg}}^2T}{
\sigma_{\text{avg}}\sqrt{T}}\;,
\qquad(27.37)\]</span></span></p>
<p><span id="eq-vasicekdiscountcall_d2"><span class="math display">\[
d_2 = d_1 - \sigma_{\text{avg}}\sqrt{T}\;.
\qquad(27.38)\]</span></span></p>
<p>The volatility <span class="math inline">\(\sigma_{\text{avg}}\)</span> is defined as <span class="math inline">\(\sigma_{\text{avg}} = (u-T)\sigma\)</span> in the continuous-time Ho-Lee model and according to <a href="#eq-vasiceksigmaavg" class="quarto-xref">Equation&nbsp;<span>27.34</span></a> in the Hull-White model.</p>
</div>
</div>
<p>As our notation indicates, the discount bond prices appearing in these formulas should be taken to be the market prices of the bonds at the date the options are valued, rather than the model prices. Of course, if we have fit the model to the market prices of discount bonds, there is no distinction. Using model prices that are different from market prices would be similar to inputting a stock price in the Black-Scholes formula obtained from a discounted-cash-flow analysis rather than using the market price of the stock. This is not something that one would normally do.</p>
<p>Because the discount bond volatilities are the same in the continuous-time Ho-Lee model as in the basic Vasicek model with <span class="math inline">\(\kappa=0\)</span> and are the same in the Hull-White model as in the basic Vasicek model with <span class="math inline">\(\kappa&gt;0\)</span>, the formulas for the values of discount bond options are the same in the corresponding models. These extensions of the basic Vasicek model permit one to match model bond prices to market bond prices, but they have no effect on the values of discount bond options, provided we remember to use the market prices in <a href="#eq-vasicekdiscountcall" class="quarto-xref">Equation&nbsp;<span>27.35</span></a> - <a href="#eq-vasicekdiscountcall_d2" class="quarto-xref">Equation&nbsp;<span>27.38</span></a>.</p>
<p>Rather than calculating <span class="math inline">\(\sigma_{\text{avg}}\)</span> from the volatility <span class="math inline">\(\sigma\)</span> of the short rate and the constant <span class="math inline">\(\kappa\)</span> or function <span class="math inline">\(\kappa_t\)</span>, we will treat <span class="math inline">\(\sigma_{\text{avg}}\)</span> as an input into the option pricing formulas. This is necessary if one wants to use (i.e., invert) the following functions to imply <span class="math inline">\(\sigma_{\text{avg}}\)</span> from market prices and then used the implied <span class="math inline">\(\sigma_{\text{avg}}\)</span> to calibrate the model.</p>
<div id="discount_bond_option" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> black_call(F, K, P, sigma, T):</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    d1 <span class="op">=</span> (np.log(F <span class="op">/</span> K) <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> sigma <span class="op">**</span> <span class="dv">2</span> <span class="op">*</span> T) <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(T))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    d2 <span class="op">=</span> d1 <span class="op">-</span> sigma <span class="op">*</span> np.sqrt(T)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> P <span class="op">*</span> (F <span class="op">*</span> norm.cdf(d1) <span class="op">-</span> K <span class="op">*</span> norm.cdf(d2))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> black_put(F, K, P, sigma, T):</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    d1 <span class="op">=</span> (np.log(F <span class="op">/</span> K) <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> sigma <span class="op">**</span> <span class="dv">2</span> <span class="op">*</span> T) <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(T))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    d2 <span class="op">=</span> d1 <span class="op">-</span> sigma <span class="op">*</span> np.sqrt(T)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> P <span class="op">*</span> (K <span class="op">*</span> norm.cdf(<span class="op">-</span>d2) <span class="op">-</span> F <span class="op">*</span> norm.cdf(<span class="op">-</span>d1))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> vasicek_discount_bond_call(Underlying, K, MatDisc, sigavg, T):</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    F <span class="op">=</span> Underlying <span class="op">/</span> MatDisc</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> black_call(F, K, MatDisc, sigavg, T)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> vasicek_discount_bond_put(Underlying, K, MatDisc, sigavg, T):</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    F <span class="op">=</span> Underlying <span class="op">/</span> MatDisc</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> black_put(F, K, MatDisc, sigavg, T)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>Underlying <span class="op">=</span> <span class="fl">0.9</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="fl">0.9</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>MatDisc <span class="op">=</span> <span class="fl">0.88</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>sigavg <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Vasicek Discount Bond Call:"</span>, vasicek_discount_bond_call(Underlying, K, MatDisc, sigavg, T))</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Vasicek Discount Bond Put:"</span>, vasicek_discount_bond_put(Underlying, K, MatDisc, sigavg, T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Vasicek Discount Bond Call: 0.13463704635261298
Vasicek Discount Bond Put: 0.026637046352613162</code></pre>
</div>
</div>
<p>As noted before, these option pricing formulas can be used to value caplets and floorlets. A caplet with reset date <span class="math inline">\(t_i\)</span> and payment date <span class="math inline">\(t_{i+1}\)</span> is equivalent, as discussed in <a href="Chapter_FixedIncomeDerivatives.html#sec-s:caps2" class="quarto-xref"><span>Section 26.9</span></a>, to <span class="math inline">\(1+\bar{R}\,\Delta\)</span> put options maturing at <span class="math inline">\(t_i\)</span> on the discount bond maturing at <span class="math inline">\(t_{i+1}\)</span>, with the exercise price of each option being <span class="math inline">\(1/(1+\bar{R}\,\Delta t)\)</span>. When we make these substitutions in the above formulas (and the same for floorlets) we obtain the following.</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">27.12</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Consider a caplet and a floorlet with reset date <span class="math inline">\(t_i\)</span> and payment date <span class="math inline">\(t_{i+1}\)</span>. Define <span class="math inline">\(\Delta t = t_{i+1}-t_i\)</span>. Let <span class="math inline">\(\bar{R}\)</span> denote the cap and floor rate. In the extended Vasicek model, the values at date <span class="math inline">\(0\)</span> of the caplet and floorlet are as follows.</p>
<p><span id="eq-vasicekfloorlet"><span class="math display">\[
\text{Floorlet Price} =(1+\bar{R}\,\Delta t)P^{\text{mkt}}(0,t_{i+1})\mathrm{N}(d_1) - P^{\text{mkt}}(0,t_i)\mathrm{N}(d_2)\;,
\qquad(27.39)\]</span></span></p>
<p><span id="eq-vasicekcaplet"><span class="math display">\[
\text{Caplet Price} = P^{\text{mkt}}(0,t_i)\mathrm{N}(-d_2)-(1+\bar{R}\,\Delta t)P^{\text{mkt}}(0,t_{i+1})\mathrm{N}(-d_1)\;,
\qquad(27.40)\]</span></span></p>
<p>where</p>
<p><span id="eq-vasicekcaplet_d1"><span class="math display">\[
d_1 = \frac{\log\left((1+\bar{R}\,\Delta t)P^{\text{mkt}}(0,t_{i+1})\right) -\log P^{\text{mkt}}(0,t_i)  +\frac{1}{2}\sigma_{\text{avg}}^2t_i}{
\sigma_{\text{avg}}\sqrt{t_i}}\;,
\qquad(27.41)\]</span></span></p>
<p><span id="eq-vasicekcaplet_d2"><span class="math display">\[
d_2 = d_1 - \sigma_{\text{avg}}\sqrt{t_i}\;,
\qquad(27.42)\]</span></span></p>
<p>The volatility <span class="math inline">\(\sigma_{\text{avg}}\)</span> is defined as <span class="math inline">\(\sigma\,\Delta t\)</span> in the continuous-time Ho-Lee model and as <span id="eq-vasicekvbacap"><span class="math display">\[
\sigma_{\text{avg}} = \frac{\sigma \mathrm{e}^{-\kappa t_i}\left(1- \mathrm{e}^{-\kappa \,\Delta t}\right) }{\kappa}\sqrt{\frac{\mathrm{e}^{2\kappa t_i}-1}{2\kappa t_i}}
\qquad(27.43)\]</span></span> in the Hull-White model.</p>
</div>
</div>
<p>A reasonable way to choose the parameter <span class="math inline">\(\sigma\)</span> in the continuous-time Ho-Lee model and the parameters <span class="math inline">\(\kappa\)</span> and <span class="math inline">\(\sigma\)</span> in the Hull-White model would be to fit the model as well as possible to market prices of caps and/or floors. The function <span class="math inline">\(\phi_t\)</span> can then be chosen as discussed in the preceding section.</p>
<p>We also used Black’s formula to value caplets and floorlets in <a href="Chapter_FixedIncomeDerivatives.html#sec-s:valuingcaps" class="quarto-xref"><span>Section 26.4</span></a>. However, the formulas in this section and the formulas in <a href="Chapter_FixedIncomeDerivatives.html#sec-s:valuingcaps" class="quarto-xref"><span>Section 26.4</span></a> give different values, because they are based on different assumptions. In the Vasicek model and its extensions, the forward price <span class="math display">\[
F_t = \frac{P(t,t_{i+1})}{P(t,t_i)}
\]</span> of the discount bond corresponding to the caplet with payment date <span class="math inline">\(t_{i+1}\)</span> has a non-random volatility, and this is the assumption on which <a href="#eq-vasicekfloorlet" class="quarto-xref">Equation&nbsp;<span>27.39</span></a> - <a href="#eq-vasicekcaplet" class="quarto-xref">Equation&nbsp;<span>27.40</span></a> is based. In <a href="Chapter_FixedIncomeDerivatives.html#sec-s:valuingcaps" class="quarto-xref"><span>Section 26.4</span></a>, we assumed the forward LIBOR rate had a non-random volatility. The definition~<a href="Chapter_FixedIncomeDerivatives.html#eq-forward2" class="quarto-xref">Equation&nbsp;<span>26.2</span></a> of the forward rate is <span class="math display">\[
R_i_t = \frac{P(t,t_i)}{P(t,t_{i+1})} - 1 = \frac{1}{F_t}-1\;.\]</span> If the forward price has a non-random volatility, then the forward rate is the sum of a variable (<span class="math inline">\(1/F_t\)</span>) with a constant volatility and a constant (<span class="math inline">\(-1\)</span>) and hence will have a random volatility. Likewise, if the forward rate has a non-random volatility, then the forward price will have a random volatility. Therefore, the assumptions of the two models are inconsistent.</p>
<div id="vasicek_cap" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> vasicek_cap(P0, P, rbar, sigavg, N, t0, dt):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    K <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> rbar <span class="op">*</span> dt)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> t0 <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        cap_value <span class="op">=</span> P[<span class="dv">0</span>] <span class="op">*</span> <span class="bu">max</span>(<span class="dv">0</span>, <span class="dv">1</span> <span class="op">/</span> P[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">1</span> <span class="op">-</span> rbar <span class="op">*</span> dt)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        MatDisc <span class="op">=</span> P0</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        Underlying <span class="op">=</span> P[<span class="dv">0</span>]</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        cap_value <span class="op">=</span> vasicek_discount_bond_put(Underlying, K, MatDisc, sigavg[<span class="dv">0</span>], t0)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, N):</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        MatDisc <span class="op">=</span> P[i <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        Underlying <span class="op">=</span> P[i]</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        mat <span class="op">=</span> t0 <span class="op">+</span> i <span class="op">*</span> dt</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        cap_value <span class="op">+=</span> vasicek_discount_bond_put(Underlying, K, MatDisc, sigavg[i], mat)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="dv">1</span> <span class="op">+</span> rbar <span class="op">*</span> dt) <span class="op">*</span> cap_value</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>P0 <span class="op">=</span> <span class="fl">0.95</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> [<span class="fl">0.92</span>, <span class="fl">0.89</span>, <span class="fl">0.85</span>, <span class="fl">0.80</span>]</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>rbar <span class="op">=</span> <span class="fl">0.03</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>t0 <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Vasicek Cap:"</span>, vasicek_cap(P0, P, rbar, [<span class="fl">0.2</span>, <span class="fl">0.18</span>, <span class="fl">0.15</span>, <span class="fl">0.12</span>], N, t0, dt))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Vasicek Cap: 0.2915227189677007</code></pre>
</div>
</div>
</section>
<section id="sec-s:vasicek_swaptions" class="level2" data-number="27.13">
<h2 data-number="27.13" class="anchored" data-anchor-id="sec-s:vasicek_swaptions"><span class="header-section-number">27.13</span> Coupon Bond Options and Swaptions</h2>
<p>In this section, we will discuss the valuation of coupon bond options in the extended Vasicek models. As discussed in <a href="Chapter_FixedIncomeDerivatives.html#sec-s:swaptionscouponbondoptions" class="quarto-xref"><span>Section 26.10</span></a>, swaptions are equivalent to options on coupon bonds, so the valuation methods can also be applied to swaptions.</p>
<p>Consider a bond paying a coupon of $<span class="math inline">\(c\)</span> at dates <span class="math inline">\(t_1, t_2, \ldots, t_N\)</span> and its face value of $1 at date <span class="math inline">\(t_N\)</span>. Consider a European call option on the bond maturing at date <span class="math inline">\(T\)</span>. In the case of a European swaption, all of the coupon payment dates occur after the option maturity (<span class="math inline">\(t_i &gt; T\)</span> for <span class="math inline">\(i=1,\ldots,N\)</span>), and the coupon is taken to be <span class="math inline">\(c=\bar{R}\,\Delta t\)</span>, where <span class="math inline">\(\bar{R}\)</span> is the swap rate. In the case of an option on a coupon bond, some of the coupons may occur before the option maturity, but naturally the value of the option depends only on the coupons that occur after the option matures, because those are the only coupons to which an exerciser of the option would be entitled. By focusing only on those coupons, we can take <span class="math inline">\(t_i &gt; T\)</span> for <span class="math inline">\(i=1,\ldots,N\)</span>.</p>
<p>A coupon bond is a portfolio of discount bonds, so an option on a coupon bond is an option on a portfolio of discount bonds. In general, an option on a portfolio is worth less than a portfolio of options, so an option on a coupon bond should be worth less than a portfolio of discount bond options. However, in any single-factor model, it is possible to define the strike prices of the discount bond options so that the option on the coupon bond is worth exactly the same as a portfolio of discount bond options.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> This reduces the valuation problem for coupon bond options to the problem of valuing discount bond options, which we have already solved for this model. We will use the same technique in <a href="#sec-s:captions" class="quarto-xref"><span>Section 27.14</span></a> to value options on caps (captions) and options on floors (floortions).</p>
<p>As shown in <a href="#eq-extendedvasicekbond" class="quarto-xref">Equation&nbsp;<span>27.25</span></a>, the single factor that determines all discount bond prices in this model is the random variable <span class="math inline">\(\hat{r}\)</span>. We let <span class="math inline">\(r^*\)</span> denote the value of <span class="math inline">\(\hat{r}_T\)</span> such that, according to the model, the coupon bond option will be at the money at maturity when <span class="math inline">\(\hat{r}_T=r^*\)</span>. Being at the money means of course that <span id="eq-swaptions101"><span class="math display">\[
\sum_{i=1}^N cP(T,t_i) + P(T,t_N) = K\;.
\qquad(27.44)\]</span></span></p>
<p>Thus, based on <a href="#eq-extendedvasicekbond" class="quarto-xref">Equation&nbsp;<span>27.25</span></a> for the discount bond prices, we define <span class="math inline">\(r^*\)</span> by</p>
<p><span id="eq-swaptions102"><span class="math display">\[
\begin{multline}
\sum_{i=1}^N c\exp\left(-\int_T^{t_i} \phi_s\,\mathrm{d}s-a(t_i-T)-b(t_i-T)r^*\right) \\+ \exp\left(-\int_T^{t_N} \phi_s\,\mathrm{d}s-a(t_N-T)-b(t_N-T)r^*\right) = K\;.
\end{multline}
\qquad(27.45)\]</span></span></p>
<p>According to the model, if <span class="math inline">\(\hat{r}_T\)</span> is lower than <span class="math inline">\(r^*\)</span>, then the bond prices will be higher and the call option will be in the money; conversely, if <span class="math inline">\(\hat{r}_T\)</span> is higher than <span class="math inline">\(r^*\)</span>, then the bond prices will be lower and the call option will be out of the money.</p>
<p>For <span class="math inline">\(i=1,\ldots,N\)</span>, define <span class="math inline">\(K_i\)</span> to be the model value of the discount bond price <span class="math inline">\(P(T,t_i)\)</span> when <span class="math inline">\(\hat{r}_T=r^*\)</span>. In other words, define <span class="math inline">\(K_i\)</span> as <span id="eq-swaptions103"><span class="math display">\[
K_i = \exp\left(-\int_T^{t_i} \phi_s\,\mathrm{d}s-a(t_i-T)-b(t_i-T)r^*\right)\;.
\qquad(27.46)\]</span></span></p>
<p>Note that equations <a href="#eq-swaptions102" class="quarto-xref">Equation&nbsp;<span>27.45</span></a> and <a href="#eq-swaptions103" class="quarto-xref">Equation&nbsp;<span>27.46</span></a> imply <span id="eq-swaption100000"><span class="math display">\[
\sum_{i=1}^N cK_i + K_N = K\; .
\qquad(27.47)\]</span></span></p>
<p>Consider for each <span class="math inline">\(i\)</span> (<span class="math inline">\(i=1,\ldots,N\)</span>) a hypothetical call option maturing at <span class="math inline">\(T\)</span> with the underlying for the option being the discount bond maturing at <span class="math inline">\(t_i\)</span>. Let <span class="math inline">\(K_i\)</span> be the exercise price of option <span class="math inline">\(i\)</span>. According to the model, the value of the underlying at date <span class="math inline">\(T\)</span> for option <span class="math inline">\(i\)</span> will be <span class="math display">\[
P(T,t_i) = \exp\left(-\int_T^{t_i} \phi_s\,\mathrm{d}s-a(t_i-T)-b(t_i-T)\hat{r}_T\right)\;.
\]</span> By the definition of <span class="math inline">\(K_i\)</span>, therefore, option <span class="math inline">\(i\)</span> will be in the money if and only if <span class="math inline">\(\hat{r}_T &lt; r^*\)</span>. Thus, all of the options are in (or out) of the money in the same circumstances.</p>
<p>Now consider the portfolio consisting of <span class="math inline">\(c\)</span> units of option <span class="math inline">\(i\)</span> for <span class="math inline">\(i=1,\ldots,N-1\)</span> and <span class="math inline">\(1+c\)</span> units of option <span class="math inline">\(N\)</span>. According to the model, the value of the portfolio will be zero at date <span class="math inline">\(T\)</span> if <span class="math inline">\(\hat{r}_T \geq r^*\)</span>, and, if <span class="math inline">\(\hat{r}_T&lt;r^*\)</span>, it follows from <a href="#eq-swaption100000" class="quarto-xref">Equation&nbsp;<span>27.47</span></a> that the value of the portfolio will be <span class="math display">\[
\sum_{i=1}^{N-1}c\big[P(t,t_i)-K_i\big]+ (1+c)\big[P(t,T_N)-K_N\big]
= \sum_{i=1}^NcP(t,t_i)+ P(t,T_N) - K,
\]</span> which is the intrinsic value of the coupon bond option when <span class="math inline">\(r_T&lt;r^*\)</span>. Therefore, according to the model, the coupon bond option is equivalent to this portfolio of discount bond options. We can value the discount bond options from the formulas in the previous section and then value the portfolio and hence the coupon bond option by summing. The same type of reasoning also allows us to value put options on coupon bonds.</p>
<p>The only issue in implementing this method is that we need to compute the exercise prices <span class="math inline">\(K_i\)</span>. Of course, we define them by <a href="#eq-swaptions103" class="quarto-xref">Equation&nbsp;<span>27.46</span></a>, given <span class="math inline">\(r^*\)</span>. To do this requires that we calculate the factor <span id="eq-vasicekfactor100"><span class="math display">\[
\exp\left(-\int_T^{t_i} \phi_s\,\mathrm{d}s\right),
\qquad(27.48)\]</span></span></p>
<p>by fitting the model to market bond prices, as discussed in <a href="#sec-s:vasicek_fitting" class="quarto-xref"><span>Section 27.9</span></a>. We will explain this more explicitly in the next paragraph. In order to apply equation~<a href="#eq-swaptions103" class="quarto-xref">Equation&nbsp;<span>27.46</span></a>, we need to compute <span class="math inline">\(r^*\)</span>, which is given by equation~<a href="#eq-swaptions102" class="quarto-xref">Equation&nbsp;<span>27.45</span></a>. We can solve~<a href="#eq-swaptions102" class="quarto-xref">Equation&nbsp;<span>27.45</span></a> for <span class="math inline">\(r^*\)</span> by bisection or some other root-finding method. Again, we need to know the factors <a href="#eq-vasicekfactor100" class="quarto-xref">Equation&nbsp;<span>27.48</span></a> in order to solve this equation.</p>
<p>To compute the factors <a href="#eq-vasicekfactor100" class="quarto-xref">Equation&nbsp;<span>27.48</span></a>, we use <a href="#eq-vasicekcalibration101" class="quarto-xref">Equation&nbsp;<span>27.31</span></a>. We repeat it here twice, for maturity dates <span class="math inline">\(t_i\)</span> and <span class="math inline">\(T\)</span>: <span class="math display">\[\begin{align*}
\exp\left(-\int_0^{t_i} \phi_s\,\mathrm{d}s\right) &amp;= \exp\left(a_{t_i}+b_{t_i}r_0\right)P^{\text{mkt}}(0,t_i)\; ,\\
\exp\left(-\int_0^{T} \phi_s\,\mathrm{d}s\right) &amp;= \exp\left(a_T+b_Tr_0\right)P^{\text{mkt}}(0,T)\;.
\end{align*}\]</span> If we divide the top equation by the bottom, then on the left-hand side we obtain <span class="math display">\[\begin{align*}
\frac{\exp\left(-\int_0^{t_i} \phi_s\,\mathrm{d}s\right)}{\exp\left(-\int_0^{T} \phi_s\,\mathrm{d}s\right)} &amp;= \exp\left(-\int_0^{t_i} \phi_s\,\mathrm{d}s + \int_0^{T} \phi_s\,\mathrm{d}s\right) \\
&amp;= \exp\left(-\int_T^{t_i} \phi_s\,\mathrm{d}s\right)\; ,
\end{align*}\]</span> which is the number we want. Hence, we obtain by dividing the right-hand sides of the above equations: <span id="eq-swaptions104"><span class="math display">\[
\exp\left(-\int_T^{t_i} \phi_s\,\mathrm{d}s\right) = \exp\left\{a_{t_i}-a_T + [b_{t_i}-b_T]r_0\right\}\frac{P^{\text{mkt}}(0,t_i)}{P^{\text{mkt}}(0,T)}\;.
\qquad(27.49)\]</span></span></p>
<div id="hw_coupon_bond_call" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hwa(sigma, kappa, tau):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span>sigma <span class="op">**</span> <span class="dv">2</span> <span class="op">*</span> (<span class="dv">2</span> <span class="op">*</span> kappa <span class="op">*</span> tau <span class="op">-</span> np.exp(<span class="op">-</span><span class="dv">2</span> <span class="op">*</span> kappa <span class="op">*</span> tau) <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> np.exp(<span class="op">-</span>kappa <span class="op">*</span> tau) <span class="op">-</span> <span class="dv">3</span>) <span class="op">/</span> (<span class="dv">4</span> <span class="op">*</span> kappa <span class="op">**</span> <span class="dv">3</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hwb(kappa, tau):</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (<span class="dv">1</span> <span class="op">-</span> np.exp(<span class="op">-</span>kappa <span class="op">*</span> tau)) <span class="op">/</span> kappa</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hwsigavg(sigma, kappa, T, u):</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">max</span>((sigma <span class="op">*</span> (np.exp(<span class="op">-</span>kappa <span class="op">*</span> T) <span class="op">-</span> np.exp(<span class="op">-</span>kappa <span class="op">*</span> u)) <span class="op">/</span> kappa) <span class="op">*</span> np.sqrt((np.exp(<span class="dv">2</span> <span class="op">*</span> kappa <span class="op">*</span> T) <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> kappa <span class="op">*</span> T)),<span class="fl">0.001</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hw_coup_bond(Coup, N, t1, dt, Cal, r, sigma, kappa, T):</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        tau <span class="op">=</span> t1 <span class="op">+</span> i <span class="op">*</span> dt <span class="op">-</span> T</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        a <span class="op">=</span> hwa(sigma, kappa, tau)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> hwb(kappa, tau)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        x <span class="op">+=</span> Coup <span class="op">*</span> Cal[i] <span class="op">*</span> np.exp(<span class="op">-</span>a <span class="op">-</span> b <span class="op">*</span> r)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    tau <span class="op">=</span> t1 <span class="op">+</span> (N <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> dt <span class="op">-</span> T</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> hwa(sigma, kappa, tau)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> hwb(kappa, tau)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    x <span class="op">+=</span> (<span class="dv">1</span> <span class="op">+</span> Coup) <span class="op">*</span> Cal[N <span class="op">-</span> <span class="dv">1</span>] <span class="op">*</span> np.exp(<span class="op">-</span>a <span class="op">-</span> b <span class="op">*</span> r)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hw_coup_bond_call(Coup, N, t1, dt, K, MatDisc, P, r, sigma, kappa, T):</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    tol <span class="op">=</span> <span class="fl">1e-8</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    Cal <span class="op">=</span> np.zeros(N)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    aT <span class="op">=</span> hwa(sigma, kappa, T)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    bT <span class="op">=</span> hwb(kappa, T)</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        tau <span class="op">=</span> t1 <span class="op">+</span> i <span class="op">*</span> dt</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>        a <span class="op">=</span> hwa(sigma, kappa, tau)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> hwb(kappa, tau)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>        Cal[i] <span class="op">=</span> np.exp(a <span class="op">-</span> aT <span class="op">+</span> (b <span class="op">-</span> bT) <span class="op">*</span> r) <span class="op">*</span> P[i] <span class="op">/</span> MatDisc</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    lower <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    flower <span class="op">=</span> hw_coup_bond(Coup, N, t1, dt, Cal, lower, sigma, kappa, T) <span class="op">-</span> K</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> flower <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>        lower <span class="op">-=</span> <span class="dv">1</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>        flower <span class="op">=</span> hw_coup_bond(Coup, N, t1, dt, Cal, lower, sigma, kappa, T) <span class="op">-</span> K</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    upper <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    fupper <span class="op">=</span> hw_coup_bond(Coup, N, t1, dt, Cal, upper, sigma, kappa, T) <span class="op">-</span> K</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> fupper <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>        upper <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>        fupper <span class="op">=</span> hw_coup_bond(Coup, N, t1, dt, Cal, upper, sigma, kappa, T) <span class="op">-</span> K</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    guess <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> (lower <span class="op">+</span> upper)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    fguess <span class="op">=</span> hw_coup_bond(Coup, N, t1, dt, Cal, guess, sigma, kappa, T) <span class="op">-</span> K</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> upper <span class="op">-</span> lower <span class="op">&gt;</span> tol:</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> fupper <span class="op">*</span> fguess <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>            lower <span class="op">=</span> guess</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>            flower <span class="op">=</span> fguess</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>            upper <span class="op">=</span> guess</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>            fupper <span class="op">=</span> fguess</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>        guess <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> (lower <span class="op">+</span> upper)</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>        fguess <span class="op">=</span> hw_coup_bond(Coup, N, t1, dt, Cal, guess, sigma, kappa, T) <span class="op">-</span> K</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>    rstar <span class="op">=</span> guess</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>        tau <span class="op">=</span> t1 <span class="op">+</span> i <span class="op">*</span> dt <span class="op">-</span> T</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>        a <span class="op">=</span> hwa(sigma, kappa, tau)</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> hwb(kappa, tau)</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>        strike <span class="op">=</span> Cal[i] <span class="op">*</span> np.exp(<span class="op">-</span>a <span class="op">-</span> b <span class="op">*</span> rstar)</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>        sigavg <span class="op">=</span> hwsigavg(sigma, kappa, T, T <span class="op">+</span> tau)</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>        x <span class="op">+=</span> Coup <span class="op">*</span> vasicek_discount_bond_call(P[i], strike, MatDisc, sigavg, T)</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>    tau <span class="op">=</span> t1 <span class="op">+</span> (N <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> dt <span class="op">-</span> T</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> hwa(sigma, kappa, tau)</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> hwb(kappa, tau)</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>    strike <span class="op">=</span> Cal[N <span class="op">-</span> <span class="dv">1</span>] <span class="op">*</span> np.exp(<span class="op">-</span>a <span class="op">-</span> b <span class="op">*</span> rstar)</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>    sigavg <span class="op">=</span> hwsigavg(sigma, kappa, T, T <span class="op">+</span> tau)</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>    x <span class="op">+=</span> (<span class="dv">1</span> <span class="op">+</span> Coup) <span class="op">*</span> vasicek_discount_bond_call(P[N <span class="op">-</span> <span class="dv">1</span>], strike, MatDisc, sigavg, T)</span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>Underlying <span class="op">=</span> <span class="fl">0.95</span></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="fl">0.9</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>MatDisc <span class="op">=</span> <span class="fl">0.88</span></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>sigavg <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>P0 <span class="op">=</span> <span class="fl">0.95</span></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> [<span class="fl">0.92</span>, <span class="fl">0.89</span>, <span class="fl">0.85</span>, <span class="fl">0.80</span>]</span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>rbar <span class="op">=</span> <span class="fl">0.03</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>t0 <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>Coup <span class="op">=</span> <span class="fl">0.03</span></span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>kappa <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"HW Coupon Bond Call:"</span>, hw_coup_bond_call(Coup, N, t0, dt, K, MatDisc, P, r, sigma, kappa, T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>HW Coupon Bond Call: 0.11555572997069366</code></pre>
</div>
</div>
</section>
<section id="sec-s:captions" class="level2" data-number="27.14">
<h2 data-number="27.14" class="anchored" data-anchor-id="sec-s:captions"><span class="header-section-number">27.14</span> Captions and Floortions</h2>
<p>In this section, we will consider options on caps and floors, which are sometimes called captions and floortions respectively. For specificity, we will consider a call option on a cap. A cap is a portfolio of caplets, and each caplet is a call option on a spot rate. Therefore a call option on a cap is a call option on a portfolio of calls on spot rates and hence is a bet on (or insurance against) high spot rates.</p>
<p>Of course, high spot rates are equivalent to low bond prices, so a call on a cap can also be seen as a bet on low bond prices. We will actually take this latter approach and view a cap as a portfolio of put options on discount bonds, as in <a href="#sec-s:vasicek_discounts" class="quarto-xref"><span>Section 27.10</span></a>. This means that we will analyze a call option on a cap as a call on a portfolio of puts. We will use the trick of the previous section and reduce this call on a portfolio of puts to a portfolio of calls on puts. Each call on a put is a compound option and can be valued as in <a href="Chapter_Exotics.html" class="quarto-xref"><span>Chapter 15</span></a>. The assumptions made in <a href="Chapter_Exotics.html" class="quarto-xref"><span>Chapter 15</span></a> for compound options are valid here, because the forward prices of the discount bonds (which are the underlyings for the puts) have non-random volatilities in the extended Vasicek models.</p>
<p>Consider a cap with reset dates <span class="math inline">\(t_0,\ldots t_{N-1}\)</span> and payment dates <span class="math inline">\(t_1,\ldots, t_N\)</span>, with <span class="math inline">\(t_{i+1}-t_i=\Delta t\)</span> for each <span class="math inline">\(i\)</span>. Let <span class="math inline">\(\bar{R}\)</span> denote the fixed rate on the cap. We consider a call option on the cap maturing at date <span class="math inline">\(T \leq t_0\)</span> and having exercise price <span class="math inline">\(K\)</span>. In the model, the value of the cap at the option maturity will depend on the random variable <span class="math inline">\(\hat{r}_T\)</span>. As in the previous section, we will let <span class="math inline">\(r^*\)</span> denote the value of <span class="math inline">\(\hat{r}_T\)</span> such that the call option on the cap is at the money at date <span class="math inline">\(T\)</span> when <span class="math inline">\(\hat{r}_T=r^*\)</span>. If <span class="math inline">\(\hat{r}_T&gt;r^*\)</span> then the cap will be more valuable, so the call will be in the money; conversely if <span class="math inline">\(\hat{r}_T&lt;r^*\)</span> the call will be out of the money. Also, similar again to the previous section, we will let <span class="math inline">\(K_i\)</span> denote the value of the caplet with reset date <span class="math inline">\(t_i\)</span> and payment date <span class="math inline">\(t_{i+1}\)</span> (<span class="math inline">\(i=0,\ldots,N-1\)</span>) when <span class="math inline">\(\hat{r}_T=r^*\)</span>. We consider hypothetical call options on the individual caplets with exercise prices <span class="math inline">\(K_i\)</span>. If <span class="math inline">\(\hat{r}_T&gt;r^*\)</span>, then, according to the model, all of the calls on the caplets will be in the money, and the sum of their values will equal the value of the call on the cap. On the other hand, if <span class="math inline">\(\hat{r}_T&lt;r^*\)</span> then all of the calls on the caplets will be out of the money, as will be the call on the cap. Thus, the value of the call on the cap is the sum of the values of the calls on the caplets.<br>
In order to apply the methods developed in <a href="Chapter_Exotics.html" class="quarto-xref"><span>Chapter 15</span></a> for valuing compound options to value the calls on the caplets (i.e., the calls on puts on discount bonds), all we need to do is to calculate the rate <span class="math inline">\(r^*\)</span> and the exercise prices <span class="math inline">\(K_i\)</span>. We will explain this only briefly.</p>
<p>Consider the caplet with payment date <span class="math inline">\(t_{i+1}\)</span>. According to the valuation <a href="#eq-vasicekcaplet" class="quarto-xref">Equation&nbsp;<span>27.40</span></a>, the value of the caplet at date <span class="math inline">\(T\)</span>, when there is a remaining time to maturity of <span class="math inline">\(t_i-T\)</span>, will be<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
<p><span id="eq-captions1"><span class="math display">\[
\text{Caplet Value at Date $T$} = P(T,t_{i})N(-d_2) - (1+\bar{R}\Delta t)P(T,t_{i+1})N(-d_1)\;,
\qquad(27.50)\]</span></span></p>
<p>where</p>
<p><span id="eq-captions2"><span class="math display">\[
d_1 = \frac{\log\left((1+\bar{R}\Delta t)P(T,t_{i+1})\right) - \log P(T,t_{i})+\frac{1}{2}\sigma_{\text{avg}}^2(t_{i}-T)}{
\sigma_{\text{avg}}\sqrt{t_{i}-T}}\;,
\qquad(27.51)\]</span></span></p>
<p><span id="eq-captions3"><span class="math display">\[
d_2 = d_1 - \sigma_{\text{avg}}\sqrt{t_{i}-T}\;.
\qquad(27.52)\]</span></span></p>
<p>Here <span class="math inline">\(\sigma_{\text{avg}}\)</span> denotes the average volatility of the forward price of the discount bond between the option valuation date <span class="math inline">\(T\)</span> and the option maturity date <span class="math inline">\(t_{i}\)</span>. This shows that the values of the caplets and hence the value of the cap depend on the discount bond prices at date <span class="math inline">\(T\)</span>, which, according to the model, depend on <span class="math inline">\(\hat{r}_T\)</span>. One can use bisection or some other root-finding method again to find the value of <span class="math inline">\(\hat{r}_T\)</span> such that, according to the model, the value of the cap will be <span class="math inline">\(K\)</span> at date <span class="math inline">\(T\)</span>. Substituting this value of <span class="math inline">\(\hat{r}_T\)</span> into the bond pricing <a href="#eq-extendedvasicekbond" class="quarto-xref">Equation&nbsp;<span>27.25</span></a> - <a href="#eq-extendedvasicek_b" class="quarto-xref">Equation&nbsp;<span>27.29</span></a> and then substituting the bond prices <span class="math inline">\(P(T,t_{i})\)</span> and <span class="math inline">\(P(T,t_{i+1})\)</span> into <a href="#eq-captions1" class="quarto-xref">Equation&nbsp;<span>27.50</span></a> - <a href="#eq-captions3" class="quarto-xref">Equation&nbsp;<span>27.52</span></a>, we define <span class="math inline">\(K_i\)</span> as the caplet value in <a href="#eq-captions1" class="quarto-xref">Equation&nbsp;<span>27.50</span></a>.</p>
</section>
<section id="sec-s:HW_yields" class="level2" data-number="27.15">
<h2 data-number="27.15" class="anchored" data-anchor-id="sec-s:HW_yields"><span class="header-section-number">27.15</span> Yields and Yield Volatilities</h2>
<p>We are denoting the price at date <span class="math inline">\(t\)</span> of a discount bond maturing at <span class="math inline">\(u\)</span>, with remaining time to maturity of <span class="math inline">\(\tau = u-t\)</span>, as <span class="math inline">\(P(t,u)\)</span>. However, as in <a href="Chapter_FixedIncome.html#sec-s:yieldcurve" class="quarto-xref"><span>Section 25.1</span></a>, we will denote the corresponding yield as <span class="math inline">\(y(t,\tau)\)</span>. The yield is defined as <span class="math display">\[
y(t,\tau) = \frac{-\log P(t,u)}{\tau}\;.
\]</span> In the extended Vasicek model, the yield is given by the bond pricing <a href="#eq-vasicekbond" class="quarto-xref">Equation&nbsp;<span>27.7</span></a> as <span class="math display">\[
y(t,\tau) = \frac{\int_t^{t+\tau} \phi_s\,\mathrm{d}s + a(\tau) + b(\tau)\hat{r}_t}{\tau}\;.
\]</span> Note that the component <span class="math display">\[
\frac{a(\tau) + b(\tau)\hat{r}_t}{\tau}
\]</span> of the yield <span class="math inline">\(y(t,t+\tau)\)</span> is independent of <span class="math inline">\(t\)</span>, except for its dependence on <span class="math inline">\(\hat{r}_t\)</span>. For example, in the continuous-time Ho-Lee model, this component equals <span class="math display">\[
-\frac{\sigma^2\tau^2}{6} + \hat{r}_t\;.
\]</span> This is a decreasing function of the time to maturity <span class="math inline">\(\tau\)</span> with intercept equal to <span class="math inline">\(\hat{r}_t\)</span>. At a different date <span class="math inline">\(t\)</span>, this component of the yield curve would be the same, except for having a different intercept.^[Note that this part decreases to <span class="math inline">\(-\infty\)</span> at long maturities (<span class="math inline">\(\tau \rightarrow \infty\)</span>), which is very strange for yields, which should be nonnegative. To compensate for this strange behavior, one needs the part <span class="math display">\[
\frac{1}{\tau}\int_t^{t+\tau} \phi_s\,\mathrm{d}s\; ,
\]</span> which is the average of <span class="math inline">\(\phi_s\)</span> between <span class="math inline">\(t\)</span> and <span class="math inline">\(t+\tau\)</span> to be growing sufficiently with <span class="math inline">\(\tau\)</span>. This phenomenon is a consequence of the absence of mean reversion.} This is the reason for the statement in <a href="#sec-s:vasicekhedging" class="quarto-xref"><span>Section 27.5</span></a> that only parallel shifts in the yield curve are possible in this model (and hence duration hedging works in the model).</p>
<p>The volatility at date <span class="math inline">\(t\)</span> of the yield at a fixed maturity <span class="math inline">\(\tau\)</span> is^[By volatility here we mean the instantaneous standard deviation of <span class="math inline">\(\,\mathrm{d}y(t,\tau)\)</span> not the instantaneous standard deviation of <span class="math inline">\(\,\mathrm{d}y(t,\tau)/y(t,\tau)\)</span>.} <span class="math inline">\(\sigma b(\tau)/\tau\)</span>. In the continuous-time Ho-Lee model, this is <span class="math inline">\(\sigma\)</span> and in the Hull-White model it is <span class="math inline">\(\sigma\left(1-\mathrm{e}^{-\kappa\tau}\right)/(\kappa\tau)\)</span>. In <a href="#sec-s:vasicek_discounts" class="quarto-xref"><span>Section 27.10</span></a> we mentioned that one might choose the parameter <span class="math inline">\(\sigma\)</span> in the Ho-Lee model and the parameters <span class="math inline">\(\sigma\)</span> and <span class="math inline">\(\kappa\)</span> in the Hull-White model to fit cap or floor prices as well as possible. An alternative would be to choose them to match estimated yield volatilities. Of course the fit to either cap prices or yield volatilities will be of limited quality, given that there is only one or two parameters in these models. On the other hand, an exact fit can be obtained with the general Hull-White model.</p>
</section>
<section id="sec-s:generalHW" class="level2" data-number="27.16">
<h2 data-number="27.16" class="anchored" data-anchor-id="sec-s:generalHW"><span class="header-section-number">27.16</span> The General Hull-White Model</h2>
<p>We will briefly discuss the general Hull-White model, in which <span id="eq-hw600"><span class="math display">\[
\,\mathrm{d}r_t = \theta_t\,\mathrm{d}t -\kappa_tr_t\,\mathrm{d}t + \sigma_t\,\mathrm{d}B_t\;.
\qquad(27.53)\]</span></span></p>
<p>By differentiating the following, one can see that the short rate <span class="math inline">\(r\)</span> in the general Hull-White model satisfies</p>
<p><span id="eq-hw601"><span class="math display">\[
r_s = \phi_s + \hat{r}_s\;,
\qquad(27.54)\]</span></span></p>
<p>where <span id="eq-phi101"><span class="math display">\[
\phi_s =  \int_0^s\exp\left(-\int_y^s\kappa(x)\,\mathrm{d}x\right)\theta(y)\,\mathrm{d}y\;.
\qquad(27.55)\]</span></span></p>
<p>and <span id="eq-rhat101"><span class="math display">\[
\hat{r}_s = \exp\left(-\int_0^s\kappa(x)\,\mathrm{d}x\right)r_0+\int_0^s\exp\left(-\int_y^s\kappa(x)\,\mathrm{d}x\right)\sigma(y)\,\mathrm{d}B(y)\;.
\qquad(27.56)\]</span></span></p>
<p>As before, discount bond prices are <span id="eq-hw602"><span class="math display">\[
P(t,u) = \exp\left(-\int_t^u \phi_s\,\mathrm{d}s\right)\\E^R_t \left[ \exp\left(-\int_t^u \hat{r}_s\,\mathrm{d}s\right)\right]\;.
\qquad(27.57)\]</span></span></p>
<p>Moreover, <a href="#eq-rhat101" class="quarto-xref">Equation&nbsp;<span>27.56</span></a> implies, for <span class="math inline">\(s&gt;t\)</span>,</p>
<p><span id="eq-rhat1001"><span class="math display">\[
\hat{r}_s = \exp\left(-\int_t^s\kappa(x)\,\mathrm{d}x\right)\,\hat{r}_t+\int_t^s\exp\left(-\int_y^s\kappa(x)\,\mathrm{d}x\right)\sigma(y)\,\mathrm{d}B(y)\;.
\qquad(27.58)\]</span></span></p>
<p>Using this fact, the expectation in <a href="#eq-hw602" class="quarto-xref">Equation&nbsp;<span>27.57</span></a> can be calculated as before as the expectation of the exponential of a normally distributed random variable, leading to the result</p>
<p><span id="eq-hw603"><span class="math display">\[
P(t,u) = \exp\left(-\int_t^u \phi_s\,\mathrm{d}s-a(t,u)-b(t,u)\hat{r}_t\right)\;,
\qquad(27.59)\]</span></span></p>
<p>where</p>
<p><span class="math display">\[
b(t,u) = \int_t^u \exp\left(-\int_t^s\kappa(x)\,\mathrm{d}x\right)\,\mathrm{d}s\; ,
\]</span> <span class="math display">\[
a(t,u) =  -\frac{1}{2}\int_t^u b(y,u)^2\sigma(y)^2\,\mathrm{d}y\;.
\]</span></p>
<p>Note that the functions <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> now depend on the date <span class="math inline">\(t\)</span> of valuation and the date <span class="math inline">\(u\)</span> of maturity rather than being determined entirely by the time to maturity <span class="math inline">\(u-t\)</span>. Note also that we can write</p>
<p><span class="math display">\[
b(t,u) = \exp\left(\int_0^t\kappa(x)\,\mathrm{d}x\right)\int_t^u\exp\left(-\int_0^s\kappa(x)\,\mathrm{d}x\right)\,\mathrm{d}s
\]</span> <span class="math display">\[
= \exp\left(\int_0^t\kappa(x)\,\mathrm{d}x\right)
\]</span> <span class="math display">\[
\qquad \times\left[\int_0^u\exp\left(-\int_0^s\kappa(x)\,\mathrm{d}x\right)\,\mathrm{d}s - \int_0^t\exp\left(-\int_0^s\kappa(x)\,\mathrm{d}x\right)\,\mathrm{d}s\right]
\]</span> <span id="eq-hw2btu"><span class="math display">\[
=\exp\left(\int_0^t\kappa(x)\,\mathrm{d}x\right)\big(b(0,u)-b(0,t)\big)\;.
\qquad(27.60)\]</span></span></p>
<p>Therefore, we can recover the functions <span class="math inline">\(b(t,u)\)</span> and <span class="math inline">\(a(t,u)\)</span> from the functions <span class="math inline">\(b(0,t)\)</span>, <span class="math inline">\(\exp\left(\int_0^t\kappa(x)\,\mathrm{d}x\right)\)</span>, and <span class="math inline">\(\sigma_t\)</span>.</p>
<p>The returns of discount bonds satisfy <span id="eq-extendedvasicekbondreturn2"><span class="math display">\[
\frac{\,\mathrm{d}P(t,u)}{P(t,u)} = r_t\,\mathrm{d}t - \sigma_t b(t,u)\,\mathrm{d}B_t\;.
\qquad(27.61)\]</span></span></p>
<p>Hence, hedge ratios, which depend on relative volatilities, are determined by the function <span class="math inline">\(b\)</span> as before. Given the functions <span class="math inline">\(\kappa\)</span> and <span class="math inline">\(\sigma\)</span>, the model can be calibrated to market discount bond prices by choosing the function <span class="math inline">\(\phi\)</span> exactly as discussed in <a href="#sec-s:vasicek_fitting" class="quarto-xref"><span>Section 27.9</span></a>.</p>
<p>The pricing of fixed-income derivatives discussed in <a href="#sec-s:vasicek_discounts" class="quarto-xref"><span>Section 27.10</span></a> - <span class="math inline">\(\ref{s_captions}\)</span> was based on forward prices of discount bonds having non-random volatilities. This is true also in the general Hull-White model. Given dates <span class="math inline">\(t&lt;T&lt;u\)</span>, the forward price at date <span class="math inline">\(t\)</span> of the discount bond maturing at date <span class="math inline">\(u\)</span>, when the forward contract matures at <span class="math inline">\(T\)</span>, is, as before, <span class="math inline">\(F_t=P(t,u)/P(t,T)\)</span>. In the general Hull-White model, we have <span class="math display">\[\begin{align*}
\frac{\,\mathrm{d}F_t}{F_t} &amp;= \text{something}\,\mathrm{d}t + \frac{\,\mathrm{d}P(t,u)}{P(t,u)} - \frac{\,\mathrm{d}P(t,T)}{P(t,T)}\\
&amp;= \text{something}\,\mathrm{d}t -\sigma_t[b(t,u)-b(t,T)]\,\mathrm{d}B_t\\
&amp;= \text{something}\,\mathrm{d}t -\sigma_t\exp\left(\int_0^t\kappa(x)\,\mathrm{d}x\right)\big[b(0,u)-b(0,T)\big]\,\mathrm{d}B_t\;.
\end{align*}\]</span> Thus, the average volatility, from date <span class="math inline">\(0\)</span> to date T, is <span class="math display">\[\sigma_{\text{avg}} = \big[b(0,u)-b(0,T)\big]\sqrt{\frac{1}{T}\int_0^T \sigma_t^2\exp\left(2\int_0^t\kappa(x)\,\mathrm{d}x\right)\,\mathrm{d}t}\; .\]</span> With this substitution, the pricing of fixed-income derivatives is the same as in the basic Hull-White model discussed in <a href="#sec-s:vasicek_discounts" class="quarto-xref"><span>Section 27.10</span></a>–<a href="#sec-s:captions" class="quarto-xref"><span>Section 27.14</span></a>.</p>
<p>The advantage of the general Hull-White model is that it allows more flexibility in fitting the model to current market conditions. This may (though there is certainly no guarantee) provide better pricing and hedging of interest-rate derivatives. Hull and White suggest choosing the volatility function <span class="math inline">\(\sigma\)</span> to fit anticipated future volatilities of the short rate and choosing the mean-reversion function <span class="math inline">\(\kappa\)</span> to fit market cap/floor prices or yield volatilities.<br>
We will assume that the volatility function <span class="math inline">\(\sigma\)</span> has been chosen, and we will describe how to choose the mean-reversion function to fit the model to estimated yield volatilities or cap prices. As usual, we let date <span class="math inline">\(0\)</span> denote the date at which we are fitting the model.</p>
<p>The simplest approach is to take the function <span class="math inline">\(\kappa_t\)</span> to be piecewise constant. Consider dates <span class="math inline">\(0=t_0 &lt; t_1 &lt; \cdots t_M\)</span> with <span class="math inline">\(t_i-t_{i-1}=\Delta t\)</span> for each <span class="math inline">\(i\)</span>. For valuing a swaption, for example, we would want <span class="math inline">\(t_M\)</span> to be the sum of the time to maturity of the swaption and the length of the swap. Thus, we are fitting the model until the end of the swap underlying the swaption. We want to find numbers <span class="math inline">\(\kappa_1,\ldots,\kappa_M\)</span> and will set the function <span class="math inline">\(\kappa\)</span> to equal <span class="math inline">\(\kappa_i\)</span> for <span class="math inline">\(t\)</span> between <span class="math inline">\(t_{i-1}\)</span> and <span class="math inline">\(t_i\)</span>.</p>
<p>Given this definition, we have <span class="math display">\[\begin{align*}
\exp\left(-\int_0^{t_1}\kappa(x)\,\mathrm{d}x\right) &amp;= \mathrm{e}^{-\kappa_1\,\Delta t}\; ,\\
\exp\left(-\int_0^{t_2}\kappa(x)\,\mathrm{d}x\right) &amp;= \mathrm{e}^{-\kappa_1\,\Delta t}\mathrm{e}^{-\kappa_2\,\Delta t}\; ,\\
\exp\left(-\int_0^{t_3}\kappa(x)\,\mathrm{d}x\right) &amp;= \mathrm{e}^{-\kappa_1\,\Delta t}\mathrm{e}^{-\kappa_2\,\Delta t}\mathrm{e}^{-\kappa_3\,\Delta t}\;,
\end{align*}\]</span> etc. Furthermore, <span class="math display">\[\begin{align*}
b(0,t_1) &amp;= \mathrm{e}^{-\kappa_1\,\Delta t}\Delta t\; ,\\
b(0,t_2) &amp;= \mathrm{e}^{-\kappa_1\,\Delta t}\,\Delta t + \mathrm{e}^{-\kappa_1\,\Delta t}\mathrm{e}^{-\kappa_2\,\Delta t}\,\Delta t\; ,\\
b(0,t_3) &amp;= \mathrm{e}^{-\kappa_1\,\Delta t}\,\Delta t + \mathrm{e}^{-\kappa_1\,\Delta t}\mathrm{e}^{-\kappa_2\,\Delta t}\,\Delta t + \mathrm{e}^{-\kappa_1\,\Delta t}\mathrm{e}^{-\kappa_2\,\Delta t}\mathrm{e}^{-\kappa_3\,\Delta t}\,\Delta t\;,
\end{align*}\]</span> etc. This yields the following recursive structure for the <span class="math inline">\(b(0,t_i)\)</span>.</p>
<p><span id="eq-generalhwrecursive1"><span class="math display">\[
b(0,t_1) = \mathrm{e}^{-\kappa_1\,\Delta t}\Delta t\; ,
\qquad(27.62)\]</span></span> <span class="math display">\[
b(0,t_2) = b(0,t_1) + b(0,t_1)\mathrm{e}^{-\kappa_2\,\Delta t}\; ,
\]</span> <span id="eq-generalhwrecursive3"><span class="math display">\[
(\forall i \geq 3) \quad b(0,t_i) = b(0,t_{i-1}) + [b(0,t_{i-1})-b(0,t_{i-2})]\mathrm{e}^{-\kappa_i\,\Delta t}\;.
\qquad(27.63)\]</span></span></p>
<p>Matching the yield volatilities in the model to estimated market volatilities is extremely simple. The same analysis presented in <a href="#sec-s:HW_yields" class="quarto-xref"><span>Section 27.15</span></a> for the basic Hull-White model shows that the volatility at date <span class="math inline">\(0\)</span> of the yield at maturity <span class="math inline">\(t_i\)</span> in the general Hull-White model is <span class="math display">\[
\frac{\sigma_0 b(0,t_i)}{t_i}\;.
\]</span> Given the estimated yield volatility, we can define <span class="math inline">\(b(0,t_i)\)</span> by equating the model volatility to the estimated volatility. Using <a href="#eq-generalhwrecursive1" class="quarto-xref">Equation&nbsp;<span>27.62</span></a> - <a href="#eq-generalhwrecursive3" class="quarto-xref">Equation&nbsp;<span>27.63</span></a>, the <span class="math inline">\(\kappa_i\)</span> can be computed from the <span class="math inline">\(b(0,t_i)\)</span> for <span class="math inline">\(i=1,2,\ldots\)</span>.</p>
<p>It is equally easy to match the model to market cap or floor prices. Suppose we have estimated implied volatilities for caplets using the pricing <a href="#eq-vasicekfloorlet" class="quarto-xref">Equation&nbsp;<span>27.39</span></a> - <a href="#eq-vasicekcaplet" class="quarto-xref">Equation&nbsp;<span>27.40</span></a>. Suppose the first caplet has reset date <span class="math inline">\(t_1\)</span> and payment date <span class="math inline">\(t_2\)</span>, the second has reset date <span class="math inline">\(t_2\)</span> and payment date <span class="math inline">\(t_3\)</span>, etc. According to the model, the average volatility of the forward price of the discount bond underlying the caplet with reset date <span class="math inline">\(t_i\)</span> and payment date <span class="math inline">\(t_{i+1}\)</span> is <span class="math display">\[
\big[b(0,t_{i+1})-b(0,t_i)\big]\sqrt{\frac{1}{t_i}\int_0^{t_i} \sigma_t^2\exp\left(2\int_0^t\kappa(x)\,\mathrm{d}x\right)\,\mathrm{d}t}\;.
\]</span> Notice that everything in this expression, except <span class="math inline">\(b(0,t_{i+1})\)</span>, is determined by <span class="math inline">\(\kappa_1,\ldots,\kappa_i\)</span> and the <span class="math inline">\(\sigma\)</span> function. Therefore, we can select the number <span class="math inline">\(b(0,t_{i+1})\)</span> to match the model volatility to the implied volatility for this caplet. This defines <span class="math inline">\(\kappa_{i+1}\)</span> from <a href="#eq-generalhwrecursive1" class="quarto-xref">Equation&nbsp;<span>27.62</span></a> - <a href="#eq-generalhwrecursive3" class="quarto-xref">Equation&nbsp;<span>27.63</span></a>. Continuing in this way, we can successively define <span class="math inline">\(\kappa_1, \kappa_2, \ldots.\)</span></p>
</section>
<section id="section-5" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="section-5"></h2>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Modify the function <code>Vasicek_Cap</code> so that rather than taking the vector <span class="math inline">\(P\)</span> of discount bond prices as an input, it looks up discount bond prices from a function <code>DiscountBondPrice</code> that returns a discount bond price for any maturity, as in Exercise~<span class="math inline">\(\ref{c_fixedincomederivatives}\)</span>.<span class="math inline">\(\ref{exercise121}\)</span>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create a Python function <code>ContinuousHoLee_Cap</code> by modifying the function <code>Vasicek_Cap</code> so that the average volatilities are computed as <span class="math inline">\(\sigma\Delta t\)</span>. In other words, input <span class="math inline">\(\sigma\)</span> rather than the vector <span class="math inline">\(\sigma_{\text{avg}}\)</span>. Write the function so that it looks up discount bond prices as in the previous exercise.</p>
</div>
</div>
</div>
<div id="exr-e_holeeimplied" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 27.1</strong></span> Create a Python function <code>ContinuousHoLee_ImpliedVol</code> using bisection that takes the same inputs as the previous function, except taking a cap price as input rather than <span class="math inline">\(\sigma\)</span>, and which returns the volatility <span class="math inline">\(\sigma\)</span> that is consistent with the cap price.</p>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create a Python function <code>HW_Cap</code> by modifying the function <code>Vasicek_Cap</code> so that the average volatilities are calculated from equation~<a href="#eq-vasicekvbacap" class="quarto-xref">Equation&nbsp;<span>27.43</span></a>. Thus, <span class="math inline">\(\sigma\)</span> and <span class="math inline">\(\kappa\)</span> should be input rather than the vector <span class="math inline">\(\sigma_{\text{avg}}\)</span>. Write the function so that it looks up discount bond prices as in the previous exercises.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create a Python code in which the user inputs <span class="math inline">\(\bar{r}\)</span>, <span class="math inline">\(\sigma\)</span> and <span class="math inline">\(\kappa\)</span>. Compute the values of caps using the function <code>HW_Cap</code> for caps of length <span class="math inline">\(N = 1, \ldots 20\)</span>. Take <span class="math inline">\(t_0=0\)</span> and <span class="math inline">\(\Delta t=0.5\)</span> and look up discount bond prices. For each <span class="math inline">\(N\)</span>, use the function created in Exercise~<span class="math inline">\(\ref{c_vasicek}\)</span>.<span class="math inline">\(\ref{e_holeeimplied}\)</span> to compute the volatility <span class="math inline">\(\sigma\)</span> for which the <code>ContinuousHoLee_Cap</code> function gives the same cap price. In other words, compute the implied Ho-Lee volatilities, given the cap prices. What is the pattern in implied volatilities and why?</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create a Python function <code>Vasicek_Floor</code> to value a floor in the extended Vasicek model, looking up discount bond prices from the <code>DiscountBondPrice</code> function.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Modify the function <code>HW_Coup_Bond_Call</code> so that it looks up discount bond prices from the <code>DiscountBondPrice</code> function.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create a Python function <code>HW_Coup_Bond_Put</code> to value a put option on a coupon bond in the basic Hull-White Model, looking up discount bond prices from the <code>DiscountBondPrice</code> function.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create a Python function <code>HW_Payer_Swaption</code> to value a payer swaption in the basic Hull-White Model, looking up discount bond prices from the <code>DiscountBondPrice</code> function.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create a Python function <code>HW_Receiver_Swaption</code> to value a receiver swaption in the basic Hull-White Model, looking up discount bond prices as in previous exercises.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Repeat <a href="Chapter_FixedIncomeDerivatives.html#exr-e_eicchorn" class="quarto-xref">Exercise&nbsp;<span>26.2</span></a>, assuming the basic Hull-White Model, for various values of <span class="math inline">\(\sigma\)</span> and <span class="math inline">\(\kappa\)</span>.</p>
</div>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-HW" class="csl-entry" role="listitem">
Hull, J., and A. White. 1990. <span>“Pricing Interest-Rate-Derivative Securities.”</span> <em>Review of Financial Studies</em> 3: 573–92.
</div>
<div id="ref-Jamshidian89" class="csl-entry" role="listitem">
Jamshidian, F. 1989. <span>“An Exact Bond Option Formula”</span> 44: 205–9.
</div>
<div id="ref-Vasicek" class="csl-entry" role="listitem">
Vasicek, O. 1977. <span>“An Equilibrium Characterization of the Term Structure.”</span> <em>Journal of Financial Economics</em> 5: 177–88.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>These results on the mean and variance of <span class="math inline">\(r_s\)</span> follow from the solution <a href="#eq-vasicek_sol" class="quarto-xref">Equation&nbsp;<span>27.5</span></a> of the Vasicek <a href="#eq-vasicek" class="quarto-xref">Equation&nbsp;<span>27.2</span></a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Of course, the fit to market bond prices will typically be poorer with fewer parameters; therefore, the Vasicek yield curve will typically not fit as well as a cubic spline.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Note that our notation is the reverse of what many people use: here <span class="math inline">\(B\)</span> denotes a Brownian motion under the risk-neutral probability (under which we will primarily operate) and <span class="math inline">\(B^*\)</span> denotes a Brownian motion under the actual measure.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Some authors (including Hull and White) do not make this definition—i.e., they denote by <span class="math inline">\(\kappa_t\theta_t\)</span> what we are denoting by <span class="math inline">\(\theta_t\)</span>—so be careful when combining results from different sources.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>This is the same reasoning we used to derive Merton’s formulas from Black’s formulas in <a href="Chapter_Merton.html#sec-s:merton" class="quarto-xref"><span>Section 13.5</span></a><a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>This method was first described by Jamshidian <span class="citation" data-cites="Jamshidian89">(<a href="#ref-Jamshidian89" role="doc-biblioref">Jamshidian 1989</a>)</span>.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>We use now the model prices for the discount bonds at date <span class="math inline">\(T\)</span>. Obviously, the market prices at the caption maturity date <span class="math inline">\(T\)</span> are unknown at date <span class="math inline">\(0\)</span>, the date at which we are valuing the caption.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Chapter_FixedIncomeDerivatives.html" class="pagination-link" aria-label="Fixed-Income Derivatives">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Fixed-Income Derivatives</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Chapter_Survey.html" class="pagination-link" aria-label="Term Structure Models">
        <span class="nav-page-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Term Structure Models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions"><ul><li><a href="https://github.com/math-finance-book/book-code.git/blob/main/Chapter_Vasicek.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div></div></footer></body></html>