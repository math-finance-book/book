<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>22&nbsp; PDE Methods – Pricing and Hedging Derivative Securities: Theory and Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Chapter_Fourier.html" rel="next">
<link href="./Chapter_Binomial.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-933f24a0c1e0be8a62c2179459603458.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-217607b4065b1a3128a07792af3f8e33.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>



<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

<script type="text/javascript">

window.PlotlyConfig = {MathJaxConfig: 'local'};

if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}

if (typeof require !== 'undefined') {

require.undef("plotly");

requirejs.config({

    paths: {

        'plotly': ['https://cdn.plot.ly/plotly-2.35.2.min']

    }

});

require(['plotly'], function(Plotly) {

    window._Plotly = Plotly;

});

}

</script>



<style>
div.callout-InProgress.callout {
  border-left-color: #eaacf2;
}
div.callout-InProgress.callout-style-default > .callout-header {
  background-color: rgba(234, 172, 242, 0.13);
}
div.callout-InProgress .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-InProgress.callout-style-default .callout-icon::before, div.callout-InProgress.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Exercise.callout {
  border-left-color: #ede29d;
}
div.callout-Exercise.callout-style-default > .callout-header {
  background-color: rgba(237, 226, 157, 0.13);
}
div.callout-Exercise .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Exercise.callout-style-default .callout-icon::before, div.callout-Exercise.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Extra.callout {
  border-left-color: #d5deed;
}
div.callout-Extra.callout-style-default > .callout-header {
  background-color: rgba(213, 222, 237, 0.13);
}
div.callout-Extra .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Extra.callout-style-default .callout-icon::before, div.callout-Extra.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-CodeToDo.callout {
  border-left-color: #eb4034;
}
div.callout-CodeToDo.callout-style-default > .callout-header {
  background-color: rgba(235, 64, 52, 0.13);
}
div.callout-CodeToDo .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-CodeToDo.callout-style-default .callout-icon::before, div.callout-CodeToDo.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Principle.callout {
  border-left-color: #e3aab2;
}
div.callout-Principle.callout-style-default > .callout-header {
  background-color: rgba(227, 170, 178, 0.13);
}
div.callout-Principle .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Principle.callout-style-default .callout-icon::before, div.callout-Principle.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Done.callout {
  border-left-color: #e8cc97;
}
div.callout-Done.callout-style-default > .callout-header {
  background-color: rgba(232, 204, 151, 0.13);
}
div.callout-Done .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Done.callout-style-default .callout-icon::before, div.callout-Done.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Example.callout {
  border-left-color: #e8cc97;
}
div.callout-Example.callout-style-default > .callout-header {
  background-color: rgba(232, 204, 151, 0.13);
}
div.callout-Example .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Example.callout-style-default .callout-icon::before, div.callout-Example.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-WritingToDo.callout {
  border-left-color: #a7f2d8;
}
div.callout-WritingToDo.callout-style-default > .callout-header {
  background-color: rgba(167, 242, 216, 0.13);
}
div.callout-WritingToDo .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-WritingToDo.callout-style-default .callout-icon::before, div.callout-WritingToDo.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Rule.callout {
  border-left-color: #a1bced;
}
div.callout-Rule.callout-style-default > .callout-header {
  background-color: rgba(161, 188, 237, 0.13);
}
div.callout-Rule .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Rule.callout-style-default .callout-icon::before, div.callout-Rule.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter_MonteCarlo.html">Part VI: Numerical Methods</a></li><li class="breadcrumb-item"><a href="./Chapter_PDEs.html"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">PDE Methods</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Pricing and Hedging Derivative Securities: Theory and Methods</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/math-finance-book/book-code.git" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Options.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Options</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Futures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Futures and Swaps</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: Mathematical Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Intro_Binomial_Tree.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Brownian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Brownian Motion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Ito.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Ito Processes and Ito’s Formula</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_GBM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Geometric Brownian Motion</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: Arbitrage Pricing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Arbitrage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Foundations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Deltas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Delta Hedges, Replication, and PDEs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_DigitalsMeasures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Digitals and Measures</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Part IV: Black-Scholes and Extensions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_BlackScholes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Black-Scholes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Americans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">American Options</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FX.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">FX and Quantos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Merton.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Merton, Black, and Margrabe</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Asians.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Asians, Baskets, and Spreads</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Exotics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Other Exotics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Part V: Alternative Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_GARCH.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">GARCH Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_StochasticVol.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Stochastic Volatility</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Jumps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Jumps</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_VarianceSwaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Variance Swaps</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Part VI: Numerical Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_MonteCarlo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Monte Carlo Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Binomial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Binomial and Trinomial Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_PDEs.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">PDE Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Fourier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Fourier Transforms</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_MachineLearning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Machine Learning</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Part VII: Fixed Income</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FixedIncome.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Fixed-Income Concepts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FixedIncomeDerivatives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Fixed-Income Derivatives</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Vasicek.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Vasicek and Extensions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Survey.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Term Structure Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendix</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./AppendixA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Miscellaneous Facts about Continuous-Time Models</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter_MonteCarlo.html">Part VI: Numerical Methods</a></li><li class="breadcrumb-item"><a href="./Chapter_PDEs.html"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">PDE Methods</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-c:pde" class="quarto-section-identifier"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">PDE Methods</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="c7a97381" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display">
<script type="text/javascript" async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_SVG"></script>
</div>
</div>
<p>In this chapter we will see how to estimate derivative values by numerically solving the partial differential equation (pde) that the derivative value satisfies, using finite difference methods. More advanced discussions of this topic can be found in Wilmott, DeWynne and Howison <span class="citation" data-cites="WDH">(<a href="#ref-WDH" role="doc-biblioref">Wilmott, Dewynne, and Howison 2000</a>)</span>, Wilmott <span class="citation" data-cites="Wilmott">(<a href="#ref-Wilmott" role="doc-biblioref">Wilmott 2000</a>)</span>, and Tavella <span class="citation" data-cites="Tavella">(<a href="#ref-Tavella" role="doc-biblioref">Tavella 2002</a>)</span>, among other places. We will only consider derivatives written on a single underlying asset, but the ideas generalize to derivatives written on multiple underlying assets (e.g., basket and spread options) in much the same way that binomial models can be applied to derivatives on multiple underlying assets. The curse of dimensionality is the same for finite difference methods as for binomial models—the computation time increases exponentially with the number of underlying assets.</p>
<section id="sec-fundamentalpde" class="level2" data-number="22.1">
<h2 data-number="22.1" class="anchored" data-anchor-id="sec-fundamentalpde"><span class="header-section-number">22.1</span> Fundamental PD\E</h2>
<p>Consider an asset with price <span class="math inline">\(S\)</span> and constant dividend yield <span class="math inline">\(q\)</span>.<br>
Set <span class="math inline">\(X=\log S\)</span>. Then we have <span class="math display">\[\,\mathrm{d}X = \nu\,\mathrm{d}t+\sigma\,\mathrm{d}B\; ,\]</span> where <span class="math inline">\(\nu =r-q-\sigma^2/2\)</span> and <span class="math inline">\(B\)</span> is a Brownian motion under the risk-neutral probability.</p>
<p>Let <span class="math inline">\(T\)</span> denote the maturity date of a derivative security. At time <span class="math inline">\(t\)</span> (when the remaining time to maturity is <span class="math inline">\(T-t\)</span>), assume the price of the derivative can be represented as <span class="math inline">\(C(t,X_t)\)</span>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a><br>
Since <span class="math inline">\(C\)</span> is a function of <span class="math inline">\(t\)</span> and <span class="math inline">\(X\)</span>, Ito’s formula implies</p>
<p><span id="eq-2"><span class="math display">\[
\,\mathrm{d}C  = \frac{\partial C}{\partial t}\,\mathrm{d}t + \frac{\partial C}{\partial X}\,\mathrm{d}X +\frac{1}{2}\frac{\partial^2 C}{\partial X^2}(\,\mathrm{d}X)^2
\qquad(22.1)\]</span></span></p>
<p><span class="math display">\[
=\frac{\partial C}{\partial t}\,\mathrm{d}t+ \frac{\partial C}{\partial X}\big(\nu\,\mathrm{d}t+\sigma\,\mathrm{d}B\big) + \frac{1}{2}\frac{\partial^2 C}{\partial X^2}\sigma^2\,\mathrm{d}t\;.
\]</span></p>
<p>On the other hand, under the risk-neutral probability, the instantaneous expected rate of return on the derivative is the risk-free rate, so <span class="math display">\[\frac{\,\mathrm{d}C}{C} =r\,\mathrm{d}t + \text{something}\,\mathrm{d}B\; .\]</span> where the something is the volatility of the derivative value. We can of course rearrange this as <span id="eq-1"><span class="math display">\[
\,\mathrm{d}C = rC\,\mathrm{d}t+\text{something}\,\,C\,\mathrm{d}B\;.
\qquad(22.2)\]</span></span></p>
<p>In order for both <a href="#eq-2" class="quarto-xref">Equation&nbsp;<span>22.1</span></a> and <a href="#eq-1" class="quarto-xref">Equation&nbsp;<span>22.2</span></a> to hold, the drifts on both right-hand sides must be equal.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> This implies <span id="eq-3"><span class="math display">\[
rC = \frac{\partial C}{\partial t}+ \nu\frac{\partial C}{\partial X}+ \frac{1}{2}\sigma^2\frac{\partial^2 C}{\partial X^2}\;.
\qquad(22.3)\]</span></span></p>
<p>This equation is the fundamental pde. It is an equation that we want to solve for the function <span class="math inline">\(C\)</span>. Every derivative written on <span class="math inline">\(S\)</span> satisfies this same equation. Different derivatives have different values because of boundary conditions. The boundary conditions are the intrinsic value at maturity, optimality conditions for early exercise, barriers and the like.</p>
<p>To translate the terms in <a href="#eq-3" class="quarto-xref">Equation&nbsp;<span>22.3</span></a> into more familiar ones, notice that, because <span class="math inline">\(S=\mathrm{e}^X\)</span>, we have <span class="math display">\[
\frac{\partial S}{\partial X}=\mathrm{e}^X=S\;.
\]</span> Therefore, by the chain rule of calculus, <span class="math display">\[
\frac{\partial C}{\partial X} = \frac{\partial C}{\partial S}\frac{\partial S}{\partial X} = S\frac{\partial C}{\partial S}\;.\]</span> Thus the term <span class="math inline">\(\partial C/\partial X\)</span> is the delta of the derivative multiplied by the price of the underlying. Similarly, by ordinary calculus, the term <span class="math inline">\(\partial^2 C/\partial X^2\)</span> can be written in terms of the delta and the gamma of the derivative.</p>
<p>Sometimes one writes the derivative value as a function of time to maturity (<span class="math inline">\(\tau = T-t\)</span>) instead of <span class="math inline">\(t\)</span>. The partial derivative of <span class="math inline">\(C\)</span> with respect to <span class="math inline">\(\tau\)</span> is the negative of the partial derivative with respect to <span class="math inline">\(t\)</span>, so the fundamental pde is the same except for a different sign on the first term of the right-hand side of <a href="#eq-3" class="quarto-xref">Equation&nbsp;<span>22.3</span></a>. Rearranging a little, we have <span id="eq-4"><span class="math display">\[
\frac{\partial C}{\partial \tau} = -rC + \nu\frac{\partial C}{\partial X}+ \frac{1}{2}\sigma^2\frac{\partial^2 C}{\partial X^2}\;.
\qquad(22.4)\]</span></span></p>
<p>In this form, the pde is similar to important equations in physics, in particular the equation for how heat propagates through a rod over time. In fact, it can be transformed exactly into the heat equation, which is how Black and Scholes originally solved the option valuation problem. The terminal condition for a call option, <span class="math inline">\(C = \max(S-K,0)\)</span>, can be viewed as defining <span class="math inline">\(C\)</span> over the <span class="math inline">\(X\)</span> dimension at <span class="math inline">\(\tau=0\)</span>, just as the temperature along the length of the rod might be specified at an initial date, and as <span class="math inline">\(\tau\)</span> increases <span class="math inline">\(C\)</span> changes at each point <span class="math inline">\(X\)</span> according to <a href="#eq-4" class="quarto-xref">Equation&nbsp;<span>22.4</span></a>, which is similar, as noted, to the equation for the change in temperature at a point on the rod as time passes.</p>
</section>
<section id="discretizing-the-pde" class="level2" data-number="22.2">
<h2 data-number="22.2" class="anchored" data-anchor-id="discretizing-the-pde"><span class="header-section-number">22.2</span> Discretizing the PD\E</h2>
<p>To numerically solve the fundamental pde, we consider a discrete grid on the <span class="math inline">\((t,x)\)</span> space. We label the time points as <span class="math inline">\(t_0, t_1, t_2, \ldots, t_N\)</span>, and the <span class="math inline">\(x\)</span> points as <span class="math inline">\(x_{-M}, x_{-M+1}, \ldots, x_0, x_1, \ldots, x_M\)</span>, with <span class="math inline">\(t_0=0\)</span>, <span class="math inline">\(t_N=T\)</span>, and <span class="math inline">\(x_0=\log S_0\)</span>. The equation should hold for <span class="math inline">\(-\infty&lt; x &lt; \infty\)</span>, but obviously we will have to bound this space, and we have denoted the upper and lower bounds by <span class="math inline">\(x_M\)</span> and <span class="math inline">\(x_{-M}\)</span> here. We take the points to be evenly spaced and set <span class="math inline">\(\Delta t= t_i-t_{i-1}\)</span> and <span class="math inline">\(\Delta x = x_j -x_{j-1}\)</span> for any <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>.</p>
<p>For specificity, we will consider a call option, though the discussion in this section applies to any derivative. We will compute a value for the call at each of the points on the grid. Then we return the value of the call at the point <span class="math inline">\((t_0,x_0)\)</span>.</p>
<p>Consider a point <span class="math inline">\((t_i, x_j)\)</span>. We could denote the estimated value of the call at this point by <span class="math inline">\(C_{ij}\)</span> but for now we will just use the symbol <span class="math inline">\(C\)</span>. Think of <span class="math inline">\(t\)</span> being on the horizontal axis and <span class="math inline">\(x\)</span> on the vertical axis. There are four points that can be reached from <span class="math inline">\((t_i,x_j)\)</span> by one step (an increase or decrease) in either <span class="math inline">\(t\)</span> or <span class="math inline">\(x\)</span>. Let’s denote the estimated call value at <span class="math inline">\((t_i, x_j+\Delta x)\)</span> as <span class="math inline">\(C_{\text{up}}\)</span>, the value at <span class="math inline">\((t_i,x_j-\Delta x)\)</span> as <span class="math inline">\(C_{\text{down}}\)</span>, the value at <span class="math inline">\((t_i+\Delta t, x_j)\)</span> as <span class="math inline">\(C_{\text{right}}\)</span> and the value at <span class="math inline">\((t_i-\Delta t,x_j)\)</span> as <span class="math inline">\(C_{\text{left}}\)</span>.</p>
<p>We want to force <a href="#eq-3" class="quarto-xref">Equation&nbsp;<span>22.3</span></a> to hold on the grid. To estimate <span class="math inline">\(\partial C/\partial X\)</span> and <span class="math inline">\(\partial^2 C/\partial X^2\)</span>, we make exactly the same calculations we made to estimate deltas and gammas in a binomial model. At the point <span class="math inline">\((t_i,x_j)\)</span>, we estimate</p>
<p><span id="eq-pdedelta"><span class="math display">\[
\frac{\partial C}{\partial X} \approx \frac{C_{\text{up}}-C_{\text{down}}}{2\Delta x}\; .
\qquad(22.5)\]</span></span></p>
<p>There are two other obvious estimates of this derivative: <span class="math display">\[
\frac{C_{\text{up}}-C}{\Delta x} \qquad \text{and} \qquad \frac{C-C_{\text{down}}}{\Delta x}\;.
\]</span> The first of these should be understood as an estimate at the midpoint of <span class="math inline">\(x_j\)</span> and <span class="math inline">\(x_j+\Delta x\)</span> and the second as an estimate at the midpoint of <span class="math inline">\(x_j\)</span> and <span class="math inline">\(x_j-\Delta x\)</span>. The distance between these two midpoints is <span class="math inline">\(\Delta x\)</span>, so the difference in these two estimates of <span class="math inline">\(\partial C/\partial X\)</span> divided by <span class="math inline">\(\Delta x\)</span> is an estimate of the second derivative: <span id="eq-pdegamma"><span class="math display">\[
\frac{\partial^2 C}{\partial X^2} \approx \frac{C_{\text{up}}-2C+C_{\text{down}}}{(\Delta x)^2}\;.
\qquad(22.6)\]</span></span></p>
<p>The obvious estimate of <span class="math inline">\(\partial C/\partial t\)</span>, which is analogous to the estimate of <span class="math inline">\(\partial C/\partial X\)</span>, is <span class="math display">\[
\frac{C_{\text{right}}-C_{\text{left}}}{2\Delta t}\;.
\]</span> This is not the estimate we are going to use. The reason is that we want to solve for the call values on the grid in much the same way that we solved the binomial model—starting at the end and working backwards. If we use the above estimate of the time derivative, then at each point <span class="math inline">\((t_i,x_j)\)</span>, <a href="#eq-3" class="quarto-xref">Equation&nbsp;<span>22.3</span></a> will link the call values at times <span class="math inline">\(t_{i-1}\)</span>, <span class="math inline">\(t_i\)</span> and <span class="math inline">\(t_{i+1}\)</span>. This would substantially complicate the backing up process. However, in a sense, it is the right estimate, and the Crank-Nicolson method to be discussed below uses a similar idea.</p>
<p>The other two choices for estimating <span class="math inline">\(\partial C/\partial t\)</span> are analogous to the other two choices for estimating <span class="math inline">\(\partial C/\partial X\)</span>. We can use either</p>
<p><span id="eq-explicit_dt"><span class="math display">\[
\frac{\partial C}{\partial t} \approx \frac{C-C_{\text{left}}}{\Delta t}\;,
\qquad(22.7)\]</span></span></p>
<p><span class="math display">\[
\]</span> or <span id="eq-implicit_dt"><span class="math display">\[
\frac{\partial C}{\partial t} \approx \frac{C_{\text{right}}-C}{\Delta t}\;.
\qquad(22.8)\]</span></span></p>
<p>Using the first is called the explicit method of solving the pde, and using the second is called the implicit method. The reason for these names should become clear below.</p>
</section>
<section id="explicit-and-implicit-methods" class="level2" data-number="22.3">
<h2 data-number="22.3" class="anchored" data-anchor-id="explicit-and-implicit-methods"><span class="header-section-number">22.3</span> Explicit and Implicit Methods</h2>
<p>We first consider the explicit method. We set the value of the call at the final date <span class="math inline">\(t_N\)</span> and each point <span class="math inline">\(x_j\)</span> to be its intrinsic value, <span class="math inline">\(\max\left(\mathrm{e}^{x_j}-K,0\right)\)</span>. Now consider calculating the value at date <span class="math inline">\(t_{N-1}\)</span> and any point <span class="math inline">\(x_j\)</span>. We do this by forcing the approximation to <a href="#eq-3" class="quarto-xref">Equation&nbsp;<span>22.3</span></a> based on <a href="#eq-pdedelta" class="quarto-xref">Equation&nbsp;<span>22.5</span></a>–<a href="#eq-explicit_dt" class="quarto-xref">Equation&nbsp;<span>22.7</span></a> to hold at the point <span class="math inline">\((t_N,x_j)\)</span>. Using the same notation as before, for <span class="math inline">\((t_i,x_j)=(t_N,x_j)\)</span>, implies <span id="eq-explicit"><span class="math display">\[
rC = \frac{C-C_{\text{left}}}{\Delta t}+ \nu\left(\frac{C_{\text{up}}-C_{\text{down}}}{2\Delta x}\right)+ \frac{1}{2}\sigma^2\left(\frac{C_{\text{up}}+C_{\text{down}}-2C}{(\Delta x)^2}\right)\;.
\qquad(22.9)\]</span></span></p>
<p>Given that <span class="math inline">\(t_i\)</span> is the final date <span class="math inline">\(t_N\)</span>, the values <span class="math inline">\(C\)</span>, <span class="math inline">\(C_{\text{up}}\)</span> and <span class="math inline">\(C_{\text{down}}\)</span> have already been calculated as the intrinsic value of the call at maturity. The only unknown is <span class="math inline">\(C_{\text{left}}\)</span>, which is the value of the call at <span class="math inline">\((t_{N-1},x_j)\)</span>. We can solve this explicitly for <span class="math inline">\(C_{\text{left}}\)</span>, whence the name of the algorithm. We do this at each point <span class="math inline">\(x_j\)</span> at date <span class="math inline">\(t_{N-1}\)</span> (except for the top and bottom points, which we will discuss below) and then we follow the same procedure to back up sequentially to the initial date, as in the binomial model.</p>
<p><a href="#eq-explicit" class="quarto-xref">Equation&nbsp;<span>22.9</span></a> cannot be used to find <span class="math inline">\(C_{\text{left}}\)</span> at the bottom point <span class="math inline">\(x_{-M}\)</span>, because at this point there is no <span class="math inline">\(C_{\text{down}}\)</span> at date <span class="math inline">\(t_N\)</span>. Similarly, we cannot use it to find <span class="math inline">\(C_{\text{left}}\)</span> at the top point <span class="math inline">\(x_M\)</span>, because at that point there is no <span class="math inline">\(C_{\text{up}}\)</span>. We have to define the values along the top and bottom of the grid in some other fashion. We do this using conditions the derivative is known to satisfy as the stock price approaches <span class="math inline">\(+\infty\)</span> or 0. For example, for a European call option, we use the conditions that <span class="math inline">\(\partial C/\partial S \rightarrow 1\)</span> as <span class="math inline">\(S \rightarrow \infty\)</span> and <span class="math inline">\(\partial C/\partial S \rightarrow 0\)</span> as <span class="math inline">\(S \rightarrow 0\)</span>. We will explain this in more detail in the following section.</p>
<p>The solution of <a href="#eq-explicit" class="quarto-xref">Equation&nbsp;<span>22.9</span></a> for <span class="math inline">\(C_{\text{left}}\)</span> can be written as <span id="eq-fdtrinomial"><span class="math display">\[
C_{\text{left}} = \big(1-r\Delta t\big)\big(p_uC_{\text{up}}+pC + p_dC_{\text{down}}\big)\;,
\qquad(22.10)\]</span></span></p>
<p>where <span class="math display">\[\begin{align*}
p_u &amp;= \frac{\sigma^2\Delta t+\nu\Delta t\Delta x}{2(1-r\Delta t)(\Delta x)^2}\; ,\\
p_d &amp;= \frac{\sigma^2\Delta t-\nu\Delta t\Delta x}{2(1-r\Delta t)(\Delta x)^2}\; ,\\
p &amp;= 1- p_u-p_d\;.
\end{align*}\]</span> This can be interpreted as discounting the probability-weighted values of the call at the next date, where we consider that starting at the grid point <span class="math inline">\((t_{i},x_j)\)</span>, the logarithm of the stock price takes three possible values (<span class="math inline">\(x_j-\Delta x\)</span>, <span class="math inline">\(x_j\)</span>, and <span class="math inline">\(x_j+\Delta x\)</span>) at the next date <span class="math inline">\(t_{i+1}\)</span>, and where we use <span class="math inline">\(1-r\Delta t\)</span> as the discount factor. Thus, it is essentially a trinomial model. This relationship was first noted by Brennan and Schwartz <span class="citation" data-cites="BrennanSchwartz">(<a href="#ref-BrennanSchwartz" role="doc-biblioref">Brennan and Schwartz 1978</a>)</span>.</p>
<p>Actually, for this to be a sensible trinomial model, the probabilities <span class="math inline">\(p_u\)</span>, <span class="math inline">\(p\)</span> and <span class="math inline">\(p_d\)</span> should be nonnegative. Assuming <span class="math inline">\(1-r\Delta t&gt;0\)</span>, this will be the case if and only if <span class="math display">\[
\Delta x \leq  \frac{\sigma^2}{|\nu|} \qquad \text{and} \qquad \Delta t \leq \frac{(\Delta x)^2}{\sigma^2 + r(\Delta x)^2}\;.
\]</span> The first of these conditions characterizes <span class="math inline">\(p_u\)</span> and <span class="math inline">\(p_d\)</span> being nonnegative. The second is derived from <span class="math inline">\(p_u+p_d \leq 1\)</span>. It is interesting to examine these conditions in terms of the number <span class="math inline">\(N\)</span> of time periods and the number of steps in the <span class="math inline">\(x\)</span> dimension, which is <span class="math inline">\(2M\)</span>. To simplify the notation in the following somewhat, denote the distance of the upper <span class="math inline">\(x\)</span> boundary from <span class="math inline">\(x_0\)</span> by <span class="math inline">\(D\)</span> (i.e., <span class="math inline">\(D=x_M-x_0\)</span>). Then <span class="math inline">\(\Delta t=T/N\)</span> and <span class="math inline">\(\Delta x = D/M\)</span>. The probabilities are nonnegative if and only if <span class="math display">\[
M \geq \frac{|\nu| D}{\sigma^2} \qquad \text{and} \qquad N \geq rT + \left(\frac{\sigma^2T}{D^2}\right)M^2\;.
\]</span> Consider fixing <span class="math inline">\(D\)</span> and increasing the number of time periods and space steps (i.e., steps along the <span class="math inline">\(x\)</span> dimension). To maintain positive probabilities, the above shows that the number of time periods must increase as the square of the number of space steps: increasing <span class="math inline">\(M\)</span> by a factor of 10 requires increasing <span class="math inline">\(N\)</span> by a factor of 100. The upshot is it can be computationally expensive to use a large number of space steps, if we want to maintain nonnegative probabilities.</p>
<p>One can reasonably ask whether this is important, because we can certainly solve <a href="#eq-explicit" class="quarto-xref">Equation&nbsp;<span>22.9</span></a> to estimate the call values even when the probabilities are negative. The answer is that it is important, but for a reason we have not yet discussed. In a numerical algorithm for solving a partial differential equation (or for solving many other types of problems) there are two types of errors: discretization error and roundoff error. If we increase <span class="math inline">\(N\)</span> and <span class="math inline">\(M\)</span> sufficiently, we should reduce the discretization error. However, each calculation on the computer introduces roundoff error. An algorithm is said to be stable if the roundoff errors stay small and bounded as the discretization error is reduced. An unfortunate fact about the explicit method is that it is stable only if the number of time steps increases with the square of the number of space steps. In the absence of this condition, the roundoff errors can accumulate and prevent one from reaching a solution of the desired accuracy.</p>
<p>The implicit method is known to be fully stable, so it is to be preferred to the explicit method. We will discuss briefly how to implement this method, before moving in the next section to the Crank-Nicolson method, which is also fully stable and known to be more efficient than the implicit method.</p>
<p>The implicit method uses the approximation <a href="#eq-implicit_dt" class="quarto-xref">Equation&nbsp;<span>22.8</span></a> for <span class="math inline">\(\partial C/\partial t\)</span>. As before, the call values are defined at the final date as the intrinsic value. Backing up a period, consider a grid point <span class="math inline">\((t_{N-1},x_j)\)</span>. We will try to estimate the call value at this date by forcing <a href="#eq-3" class="quarto-xref">Equation&nbsp;<span>22.3</span></a> to hold at this point. This means <span id="eq-implicit"><span class="math display">\[
rC = \frac{C_{\text{right}}-C}{\Delta t}+ \nu\left(\frac{C_{\text{up}}-C_{\text{down}}}{2\Delta x}\right)+ \frac{1}{2}\sigma^2\left(\frac{C_{\text{up}}+C_{\text{down}}-2C}{(\Delta x)^2}\right)\;.
\qquad(22.11)\]</span></span></p>
<p>We know <span class="math inline">\(C_{\text{right}}\)</span>, because it is the intrinsic value at <span class="math inline">\((t_N,x_j)\)</span>. This equation links three unknowns (<span class="math inline">\(C\)</span>, <span class="math inline">\(C_{\text{up}}\)</span>, and <span class="math inline">\(C_{\text{down}}\)</span>) to the known value <span class="math inline">\(C_{\text{right}}\)</span>. We cannot solve it explicitly for these three unknowns. Instead, we need to solve a system of linear equations to simultaneously solve for all the call values at date <span class="math inline">\(t_{N-1}\)</span>. There are <span class="math inline">\(2M-1\)</span> equations of the form <a href="#eq-implicit" class="quarto-xref">Equation&nbsp;<span>22.11</span></a> plus conditions that we will impose at the upper and lower boundaries, and we need to solve these for the <span class="math inline">\(2M+1\)</span> call values. This system of equations has the same form, and is solved in the same way, as the system of equations in the Crank-Nicolson method.</p>
</section>
<section id="crank-nicolson" class="level2" data-number="22.4">
<h2 data-number="22.4" class="anchored" data-anchor-id="crank-nicolson"><span class="header-section-number">22.4</span> Crank-Nicolson</h2>
<p> The estimate <a href="#eq-implicit_dt" class="quarto-xref">Equation&nbsp;<span>22.8</span></a> of <span class="math inline">\(\partial C/\partial t\)</span> used in the implicit method is best understood as an estimate of <span class="math inline">\(\partial C/\partial t\)</span> at the midpoint of <span class="math inline">\((t_i,x_j)\)</span> and <span class="math inline">\((t_{i+1},x_j)\)</span>, i.e., at <span class="math inline">\((t_i+\Delta t/2,x_j)\)</span>. This is the basic idea of the Crank-Nicolson method. With this method, we continue to estimate the call values at the grid points, but we do so by forcing <a href="#eq-3" class="quarto-xref">Equation&nbsp;<span>22.3</span></a> to hold at midpoints of this type. To do this, we also need estimates of <span class="math inline">\(C\)</span>, <span class="math inline">\(\partial C/\partial X\)</span> and <span class="math inline">\(\partial^2 C/\partial X^2\)</span> at the midpoints, but these are easy to obtain.</p>
<p>Let’s modify the previous notation somewhat, writing <span class="math inline">\(C'\)</span> for <span class="math inline">\(C_{\text{right}}\)</span> and <span class="math inline">\(C'_{\text{up}}\)</span> and <span class="math inline">\(C'_{\text{down}}\)</span> for the values to the right and one step up and down, i.e., at the grid points <span class="math inline">\((t_i+\Delta t,x_i+\Delta x)\)</span> and <span class="math inline">\((t_i+\Delta t,x_i-\Delta x)\)</span> respectively. The obvious estimate of the call value at the midpoint <span class="math inline">\((t_i+\Delta t/2,x_j)\)</span> is the average of <span class="math inline">\(C\)</span> and <span class="math inline">\(C'\)</span>, so set <span class="math display">\[
C^{\text{mid}} = \frac{C+C'}{2}\;.
\]</span> Analogously, define <span id="eq-cn1000"><span class="math display">\[
C^{\text{mid}}_{\text{up}} = \frac{C_{\text{up}}+C'_{\text{up}}}{2}\;, \qquad \text{and} \qquad
C^{\text{mid}}_{\text{down}} = \frac{C_{\text{down}}+C'_{\text{down}}}{2}\;.
\qquad(22.12)\]</span></span></p>
<p>The formulas <a href="#eq-cn1000" class="quarto-xref">Equation&nbsp;<span>22.12</span></a> give us estimates of the call value at the midpoints one space step up and one space step down from <span class="math inline">\(x_j\)</span>—i.e., at <span class="math inline">\((t_i+\Delta t/2,x_{j+1})\)</span> and <span class="math inline">\((t_i+\Delta t/2,x_{j-1})\)</span>. We can now estimate <span class="math inline">\(\partial C/\partial X\)</span> and <span class="math inline">\(\partial^2 C/\partial X^2\)</span> at the midpoint <span class="math inline">\((t_i+\Delta t/2,x_j)\)</span> exactly as before: <span class="math display">\[
\frac{\partial C}{\partial X} \approx \frac{C^{\text{mid}}_{\text{up}}-C^{\text{mid}}_{\text{down}}}{2\Delta x}\;,
\]</span> and <span class="math display">\[
\frac{\partial^2 C}{\partial X^2} \approx \frac{C^{\text{mid}}_{\text{up}}+C^{\text{mid}}_{\text{down}}-2C^{\text{mid}}}{(\Delta x)^2}\;.
\]</span> Now, <a href="#eq-3" class="quarto-xref">Equation&nbsp;<span>22.3</span></a> becomes <span id="eq-crank"><span class="math display">\[
rC^{\text{mid}} = \frac{C'-C}{\Delta t}+ \nu\left(\frac{C^{\text{mid}}_{\text{up}}-C^{\text{mid}}_{\text{down}}}{2\Delta x}\right)+ \frac{1}{2}\sigma^2\left(\frac{C^{\text{mid}}_{\text{up}}+C^{\text{mid}}_{\text{down}}-2C^{\text{mid}}}{(\Delta x)^2}\right)\;.
\qquad(22.13)\]</span></span></p>
<p>Substituting from the formulas for <span class="math inline">\(C^{\text{mid}}\)</span>, <span class="math inline">\(C^{\text{mid}}_{\text{up}}\)</span>, and <span class="math inline">\(C^{\text{mid}}_{\text{down}}\)</span>, we can re-write <a href="#eq-crank" class="quarto-xref">Equation&nbsp;<span>22.13</span></a> as</p>
<p><span id="eq-crank2"><span class="math display">\[
\begin{multline}
\left(\frac{r}{2}+\frac{1}{\Delta t}+\frac{\sigma^2}{2(\Delta x)^2}\right)C - \left(\frac{\sigma^2}{4(\Delta x)^2}+\frac{\nu}{4\Delta x}\right)C_{\text{up}}\\ - \left(\frac{\sigma^2}{4(\Delta x)^2}-\frac{\nu}{4\Delta x}\right)C_{\text{down}}
\quad = \quad \left(\frac{1}{\Delta t}- \frac{r}{2}-\frac{\sigma^2}{2(\Delta x)^2}\right)C' \\+ \left(\frac{\sigma^2}{4(\Delta x)^2}+\frac{\nu}{4\Delta x}\right)C'_{\text{up}} + \left(\frac{\sigma^2}{4(\Delta x)^2}-\frac{\nu}{4\Delta x}\right)C'_{\text{down}}
\end{multline}
\qquad(22.14)\]</span></span></p>
<p>We can also write this as <span id="eq-crank3"><span class="math display">\[
a_1C - a_2C_{\text{up}} - a_3C_{\text{down}}
= a_4C' + a_2C'_{\text{up}} + a_3C'_{\text{down}}\;, \qquad(22.15)\]</span></span></p>
<p>where the constants <span class="math inline">\(a_i\)</span> are the factors in parentheses in <a href="#eq-crank2" class="quarto-xref">Equation&nbsp;<span>22.14</span></a>.</p>
<p>As before, we start at the final date <span class="math inline">\(t_N\)</span> and define the call value at that date by its intrinsic value. Consider a grid point <span class="math inline">\((t_{N-1},x_j)\)</span>. Forcing <a href="#eq-3" class="quarto-xref">Equation&nbsp;<span>22.3</span></a> to hold at the midpoint <span class="math inline">\((t_{N-1}+\Delta t/2,x_j)\)</span> leads us to <a href="#eq-crank3" class="quarto-xref">Equation&nbsp;<span>22.15</span></a>. In this equation, <span class="math inline">\(C'\)</span>, <span class="math inline">\(C'_{\text{up}}\)</span> and <span class="math inline">\(C'_{\text{down}}\)</span> are known from the intrinsic value at maturity, and we need to solve for <span class="math inline">\(C\)</span>, <span class="math inline">\(C_{\text{up}}\)</span> and <span class="math inline">\(C_{\text{down}}\)</span>. There are <span class="math inline">\(2M-1\)</span> linear equations of this type and we will add linear equations at the upper and lower boundaries of the grid and solve the resulting system of <span class="math inline">\(2M+1\)</span> linear equations for the <span class="math inline">\(2M+1\)</span> call values. After finding the call values at date <span class="math inline">\(t_{N-1}\)</span>, we then repeat the calculation at <span class="math inline">\(t_{N-2}\)</span> and continue backing up in this way until we reach the initial date.</p>
<p>Notice that <a href="#eq-crank2" class="quarto-xref">Equation&nbsp;<span>22.14</span></a> is similar to <a href="#eq-implicit" class="quarto-xref">Equation&nbsp;<span>22.11</span></a> in the implicit method, but more information is used in each step of the Crank-Nicolson method than is used in each step of the implicit method. <a href="#eq-crank2" class="quarto-xref">Equation&nbsp;<span>22.14</span></a> links the call values <span class="math inline">\(C\)</span>, <span class="math inline">\(C_{\text{up}}\)</span> and <span class="math inline">\(C_{\text{down}}\)</span> to the previously calculated <span class="math inline">\(C'\)</span>, <span class="math inline">\(C'_{\text{up}}\)</span> and <span class="math inline">\(C'_{\text{down}}\)</span>, whereas in the implicit method they were linked only to <span class="math inline">\(C'\)</span> (which we called <span class="math inline">\(C_{\text{right}}\)</span>).</p>
</section>
<section id="european-options" class="level2" data-number="22.5">
<h2 data-number="22.5" class="anchored" data-anchor-id="european-options"><span class="header-section-number">22.5</span> European Options</h2>
<p>To value a European option, one simply defines the values at the final date as the intrinsic value and then backs up to the initial date, using any of the methods described (explicit, implicit, or Crank-Nicolson). The value that should be returned is the value at the middle node at the initial date, which corresponds to the initial price of the underlying.</p>
<p>The boundary conditions normally used at the bottom and top of the grid are conditions that the first derivative <span class="math inline">\(\partial C/\partial S\)</span> of the option value are known to satisfy as <span class="math inline">\(S \rightarrow 0\)</span> and <span class="math inline">\(S \rightarrow \infty\)</span>. These are conditions of the form <span id="eq-cn_boundary"><span class="math display">\[
\lim_{S \rightarrow \infty} \frac{\partial C}{\partial S} =  \lambda_0\;,\qquad \text{and} \qquad
\lim_{S \rightarrow 0} \frac{\partial C}{\partial S} = \lambda_{\infty}\;,
\qquad(22.16)\]</span></span></p>
<p>for constants <span class="math inline">\(\lambda_0\)</span> and <span class="math inline">\(\lambda_{\infty}\)</span>. In the case of a call option, we have <span class="math inline">\(\lambda_0=0\)</span> and <span class="math inline">\(\lambda_{\infty}=1\)</span>. For a put option, we have <span class="math inline">\(\lambda_0=-1\)</span> and <span class="math inline">\(\lambda_\infty = 0.\)</span></p>
<p>These conditions are implemented on the grid by forcing each value <span class="math inline">\(C\)</span> at a point <span class="math inline">\((t_i,x_{-M})\)</span> on the bottom of the grid to satisfy</p>
<p><span id="eq-crank4a"><span class="math display">\[
C - C_{\text{up}} = \lambda_0 (S - S_{\text{up}})
\qquad(22.17)\]</span></span></p>
<p>and by forcing each value <span class="math inline">\(C\)</span> at a point <span class="math inline">\((t_i,x_{M})\)</span> on the top of the grid to satisfy</p>
<p><span id="eq-crank4b"><span class="math display">\[
C-C_{\text{down}} = \lambda_\infty(S-S_{\text{down}})\;.
\qquad(22.18)\]</span></span></p>
<p>These two linear equations in the values at time <span class="math inline">\(t_i\)</span> augment the <span class="math inline">\(2M-1\)</span> equations already described to form a system of <span class="math inline">\(2M+1\)</span> linear equations to be solved for the derivative values at the <span class="math inline">\(2M+1\)</span> grid points at time <span class="math inline">\(t_i\)</span>.</p>
<p>We will create a program that solves a system of equations of the form <a href="#eq-crank3" class="quarto-xref">Equation&nbsp;<span>22.15</span></a>, <a href="#eq-crank4a" class="quarto-xref">Equation&nbsp;<span>22.17</span></a> and <a href="#eq-crank4b" class="quarto-xref">Equation&nbsp;<span>22.18</span></a>. We input the vector <span class="math inline">\(a\)</span> of coefficients, a vector <span class="math inline">\(y\)</span> of dimension <span class="math inline">\(2M+1\)</span> containing the estimated values of the derivative at any date <span class="math inline">\(t_{i+1}\)</span>, an integer <span class="math inline">\(L\)</span> from which <span class="math inline">\(M\)</span> is defined as <span class="math inline">\(M=(L-1)/2\)</span> (i.e., <span class="math inline">\(L=2M+1\)</span>). The function will return the vector of values at date <span class="math inline">\(t_i\)</span>.</p>
<p>We will write the boundary conditions <a href="#eq-crank4a" class="quarto-xref">Equation&nbsp;<span>22.17</span></a> and <a href="#eq-crank4b" class="quarto-xref">Equation&nbsp;<span>22.18</span></a>, respectively, in the more general forms</p>
<p><span id="eq-crank4aa"><span class="math display">\[
C = z_1 + b_1C_{\text{up}}\;,
\qquad(22.19)\]</span></span></p>
<p>and <span id="eq-crank4bb"><span class="math display">\[
C = z_L + b_LC_{\text{down}}\;,
\qquad(22.20)\]</span></span></p>
<p>where <span class="math inline">\(z_1\)</span>, <span class="math inline">\(b_1\)</span>, <span class="math inline">\(z_L\)</span> and <span class="math inline">\(b_L\)</span> are numbers to be calculated or input by the user. <a href="#eq-crank4a" class="quarto-xref">Equation&nbsp;<span>22.17</span></a> and <a href="#eq-crank4b" class="quarto-xref">Equation&nbsp;<span>22.18</span></a> are the special cases in which <span class="math inline">\(z_1 = \lambda_0(S-S_{\text{up}})\)</span>, <span class="math inline">\(b_1 = 1\)</span>, <span class="math inline">\(z_L = \lambda_\infty(S-S_{\text{down}})\)</span>, and <span class="math inline">\(b_L=1\)</span>. The additional generality in allowing <span class="math inline">\(b_1\)</span> and <span class="math inline">\(b_L\)</span> to be different from one is important for many purposes, and we will see an example of it in the valuation of barrier options.</p>
<p>The system of equations that we want to solve is therefore </p>
<span class="math display">\[\begin{pmatrix}
1 &amp; -b_1 &amp; 0 &amp; 0 &amp; 0  &amp; \cdots  &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
-a_3 &amp; a_1 &amp; - a_2 &amp; 0 &amp; 0 &amp; \cdots &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
0 &amp; - a_3 &amp; a_1 &amp; -a_2 &amp; 0 &amp; \cdots &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
\vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp;\vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \cdots &amp; 0 &amp; -a_3 &amp; a_1 &amp; - a_2 &amp; 0\\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \cdots  &amp; 0 &amp; 0 &amp; -a_3 &amp; a_1 &amp; - a_2 \\
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \cdots  &amp; 0 &amp; 0 &amp; 0 &amp; -b_L &amp; 1
\end{pmatrix}\]</span>
<span class="math display">\[\begin{pmatrix}
C_1 \\
C_2\\
C_3\\
\vdots\\
C_{L-2}\\
C_{L-1}\\
C_L
\end{pmatrix}
\begin{matrix}
\phantom\\
\phantom\\
\phantom\\
=
\phantom\\
\phantom\\
\phantom\\
\end{matrix}
\begin{pmatrix}
z_1 \\
z_2\\
z_3\\
\vdots\\
z_{L-2}\\
z_{L-1}\\
z_L
\end{pmatrix}\]</span>
<p>where we are denoting the derivative values to be determined at date <span class="math inline">\(t_i\)</span> across the <span class="math inline">\(L\)</span> (<span class="math inline">\(=2M+1\)</span>) space nodes as <span class="math inline">\(C_1, \ldots, C_L\)</span>. The coefficients <span class="math inline">\(a_i\)</span> are defined in <a href="#eq-crank3" class="quarto-xref">Equation&nbsp;<span>22.15</span></a>. The numbers <span class="math inline">\(z_2, \ldots, z_{L-1}\)</span> are the right-hand sides of <a href="#eq-crank3" class="quarto-xref">Equation&nbsp;<span>22.15</span></a> and are determined by the coefficients <span class="math inline">\(a_i\)</span> and the derivative values <span class="math inline">\(y_1, \ldots, y_{L}\)</span> at date <span class="math inline">\(t_{i+1}\)</span>. The system of equations that must be solved to implement the implicit method is of this same form.</p>
<p>The first equation in this array (<a href="#eq-crank4aa" class="quarto-xref">Equation&nbsp;<span>22.19</span></a>) can be written as</p>
<p><span class="math display">\[
C_1 = u_1 + b_1C_2\;,
\]</span> where <span class="math inline">\(u_1 = z_1\)</span>.<br>
By induction, we will see that we can write, for each <span class="math inline">\(j = 2, \ldots, L\)</span>, <span id="eq-crank101"><span class="math display">\[
C_{j-1} = u_{j-1} + b_{j-1}C_{j}
\qquad(22.21)\]</span></span></p>
<p>for some coefficients <span class="math inline">\(u_{j-1}\)</span> and <span class="math inline">\(b_{j-1}\)</span> to be determined.<br>
The <span class="math inline">\(j\)</span>–th equation (<span class="math inline">\(j = 2, \ldots, L-1\)</span>) in the array (<a href="#eq-crank3" class="quarto-xref">Equation&nbsp;<span>22.15</span></a>) is <span class="math display">\[-a_3C_{j-1}+a_1C_j-a_2C_{j+1} = z_j\; .\]</span> Supposing <a href="#eq-crank101" class="quarto-xref">Equation&nbsp;<span>22.21</span></a> holds and using it to substitute for <span class="math inline">\(C_{j-1}\)</span>, we have <span class="math display">\[-a_3\left(u_{j-1} + b_{j-1}C_{j}\right) +a_1C_j-a_2C_{j+1} = z_j \quad\Longleftrightarrow\quad C_{j} = u_{j} + b_{j}C_{j+1}\; ,\]</span> where <span class="math display">\[\begin{align*}
u_j &amp;= \frac{z_j + a_3u_{j-1}}{a_1-a_3b_{j-1}} \;,\\
b_j &amp;= \frac{a_2}{a_1-a_3b_{j-1}}\;.
\end{align*}\]</span> This establishes that <a href="#eq-crank101" class="quarto-xref">Equation&nbsp;<span>22.21</span></a> holds for each <span class="math inline">\(j = 2, \ldots, L\)</span>.</p>
<p>The last equation in the array (<a href="#eq-crank4bb" class="quarto-xref">Equation&nbsp;<span>22.20</span></a>) is <span id="eq-crankC_L"><span class="math display">\[
C_L = z_L + b_LC_{L-1}\; . \qquad(22.22)\]</span></span> Our induction argument gives us <span class="math display">\[
C_{L-1} = u_{L-1} + b_{L-1}C_{L}\; ,
\]</span> and when we combine these we have two equations in two unknowns and can solve for <span class="math inline">\(C_L\)</span> as <span class="math display">\[
C_L = \frac{z_L+ b_Lu_{L-1}}{1-b_Lb_{L-1}}\;.
\]</span> We then successively obtain <span class="math inline">\(C_{L-1}, C_{L-2}, \ldots, C_1\)</span> from <a href="#eq-crank101" class="quarto-xref">Equation&nbsp;<span>22.21</span></a>.</p>
<p>We will demonstrate the Crank-Nicolson method by valuing a European call. Any other path-independent European derivative is valued in the same way, by appropriately redefining the value of the derivative at the final date and redefining the constants <span class="math inline">\(z_1\)</span> and <span class="math inline">\(z_L\)</span> in the boundary conditions <a href="#eq-crank4aa" class="quarto-xref">Equation&nbsp;<span>22.19</span></a> - <a href="#eq-crank4bb" class="quarto-xref">Equation&nbsp;<span>22.20</span></a> at the bottom and top of the grid.</p>
<p>As elsewhere in this chapter, <span class="math inline">\(N\)</span> denotes the number of time periods, and <span class="math inline">\(2M+1\)</span> will be the number of <span class="math inline">\(x\)</span> values on the grid. We use the symbol <span class="math inline">\(D\)</span> to denote the distance of the top (or bottom) of the grid from <span class="math inline">\(\log S_0\)</span>. In other words, <span class="math inline">\(D = x_M-x_0\)</span>. A reasonable value for <span class="math inline">\(D\)</span> would be three standard deviations for <span class="math inline">\(\log S\)</span>, which would mean <span class="math inline">\(D = |\nu|T +3 \sigma\sqrt{T}\)</span>. For example, for a one-year option on a stock with a volatility of 30%, it should suffice to input <span class="math inline">\(D=1\)</span>.</p>
<p>As should be clear, the program is conceptually very similar to a binomial model. The difference is that the backing up procedure, which involves node-by-node discounting in a binomial model, here is accomplished via the Crank-Nicolson algorithm.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<p>The following code illustrates how to use the Crank_Nicolson method to vale a European call option.</p>
<div id="crank_nicolson" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> crank_nicolson(a, y, L, z1, b1, zL, bL):</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    u <span class="op">=</span> np.zeros(L)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> np.zeros(L)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> np.zeros(L)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    z <span class="op">=</span> np.zeros(L)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    u[<span class="dv">0</span>] <span class="op">=</span> z1</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    b[<span class="dv">0</span>] <span class="op">=</span> b1</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, L <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        z[j] <span class="op">=</span> a[<span class="dv">3</span>] <span class="op">*</span> y[j] <span class="op">+</span> a[<span class="dv">1</span>] <span class="op">*</span> y[j <span class="op">+</span> <span class="dv">1</span>] <span class="op">+</span> a[<span class="dv">2</span>] <span class="op">*</span> y[j <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        u[j] <span class="op">=</span> (a[<span class="dv">2</span>] <span class="op">*</span> u[j <span class="op">-</span> <span class="dv">1</span>] <span class="op">+</span> z[j]) <span class="op">/</span> (a[<span class="dv">0</span>] <span class="op">-</span> a[<span class="dv">2</span>] <span class="op">*</span> b[j <span class="op">-</span> <span class="dv">1</span>])</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        b[j] <span class="op">=</span> a[<span class="dv">1</span>] <span class="op">/</span> (a[<span class="dv">0</span>] <span class="op">-</span> a[<span class="dv">2</span>] <span class="op">*</span> b[j <span class="op">-</span> <span class="dv">1</span>])</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    c[<span class="op">-</span><span class="dv">1</span>] <span class="op">=</span> (zL <span class="op">+</span> bL <span class="op">*</span> u[<span class="op">-</span><span class="dv">2</span>]) <span class="op">/</span> (<span class="dv">1</span> <span class="op">-</span> bL <span class="op">*</span> b[<span class="op">-</span><span class="dv">2</span>])</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(L <span class="op">-</span> <span class="dv">2</span>, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        c[j] <span class="op">=</span> u[j] <span class="op">+</span> b[j] <span class="op">*</span> c[j <span class="op">+</span> <span class="dv">1</span>]</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> c</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> european_call_crank_nicolson(S0, K, r, sigma, q, T, N, M, Dist):</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    dt <span class="op">=</span> T <span class="op">/</span> N</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    dx <span class="op">=</span> Dist <span class="op">/</span> M</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    dx2 <span class="op">=</span> dx <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    u <span class="op">=</span> np.exp(dx)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    sig2 <span class="op">=</span> sigma <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    nu <span class="op">=</span> r <span class="op">-</span> q <span class="op">-</span> sig2 <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    St <span class="op">=</span> S0 <span class="op">*</span> np.exp(Dist)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    Sb <span class="op">=</span> S0 <span class="op">*</span> np.exp(<span class="op">-</span>Dist)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> np.zeros(<span class="dv">4</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    a[<span class="dv">0</span>] <span class="op">=</span> r <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">1</span> <span class="op">/</span> dt <span class="op">+</span> sig2 <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> dx2)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    a[<span class="dv">1</span>] <span class="op">=</span> sig2 <span class="op">/</span> (<span class="dv">4</span> <span class="op">*</span> dx2) <span class="op">+</span> nu <span class="op">/</span> (<span class="dv">4</span> <span class="op">*</span> dx)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    a[<span class="dv">2</span>] <span class="op">=</span> a[<span class="dv">1</span>] <span class="op">-</span> nu <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> dx)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    a[<span class="dv">3</span>] <span class="op">=</span> <span class="op">-</span>a[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">2</span> <span class="op">/</span> dt</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    L <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> M <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> np.zeros(L)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> Sb</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    y[<span class="dv">0</span>] <span class="op">=</span> <span class="bu">max</span>(S <span class="op">-</span> K, <span class="dv">0</span>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, L):</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        S <span class="op">*=</span> u</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        y[j] <span class="op">=</span> <span class="bu">max</span>(S <span class="op">-</span> K, <span class="dv">0</span>)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    z1 <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    b1 <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    zL <span class="op">=</span> St <span class="op">-</span> St <span class="op">/</span> u</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    bL <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    CallV <span class="op">=</span> crank_nicolson(a, y, L, z1, b1, zL, bL)</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(N <span class="op">-</span> <span class="dv">2</span>, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>        CallV <span class="op">=</span> crank_nicolson(a, CallV, L, z1, b1, zL, bL)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> CallV[M]</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>S0 <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="dv">90</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.05</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>M <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>Dist <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>Bar <span class="op">=</span> <span class="dv">85</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"European Call Crank-Nicolson:"</span>, european_call_crank_nicolson(S0, K, r, sigma, q, T, N, M, Dist))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>European Call Crank-Nicolson: 15.113207926084973</code></pre>
</div>
</div>
</section>
<section id="american-options" class="level2" data-number="22.6">
<h2 data-number="22.6" class="anchored" data-anchor-id="american-options"><span class="header-section-number">22.6</span> American Options</h2>
<p>The explicit method is easily adapted to American options. As in a binomial model, we compute the option value at each node as the larger of its discounted expected value and its intrinsic value. To be somewhat more precise, we replace the trinomial value <a href="#eq-fdtrinomial" class="quarto-xref">Equation&nbsp;<span>22.10</span></a> with <span class="math display">\[
C_{\text{left}} = \max\left(\big(1-r\Delta t\big)\big(p_uC_{\text{up}}+pC + p_dC_{\text{down}}\big), \text{intrinsic value}\right)\;.
\]</span></p>
<p>In the Crank-Nicolson method, one can in similar fashion compute the value of the derivative at each space node at any date by solving the system of equations <a href="#eq-crank3" class="quarto-xref">Equation&nbsp;<span>22.15</span></a> and then replace the computed values by the intrinsic value when that is higher. However, because the values at the different space nodes are linked (i.e., the method is an implicit-type method), this one-at-a-time replacement of values by intrinsic values is not the most efficient method. See Wilmott <span class="citation" data-cites="Wilmott">(<a href="#ref-Wilmott" role="doc-biblioref">Wilmott 2000</a>)</span> for more details (and for VBA code implementing the projected successive over-relaxation method).</p>
</section>
<section id="sec-s:finitedifferencebarriers" class="level2" data-number="22.7">
<h2 data-number="22.7" class="anchored" data-anchor-id="sec-s:finitedifferencebarriers"><span class="header-section-number">22.7</span> Barrier Options</h2>
<p>Finite-difference methods work well for valuing discretely-sampled barrier options. For a down-and-out option, one should place the bottom of the grid at the knock-out boundary. For an up-and-out option, one should place the top of the grid at the knock-out boundary. As discussed in <a href="Chapter_Exotics.html" class="quarto-xref"><span>Chapter 15</span></a>, knock-in options can be valued as standard options minus knock-out options.</p>
<p>For barrier options, the boundary information <a href="#eq-cn_boundary" class="quarto-xref">Equation&nbsp;<span>22.16</span></a> can be replaced by assigning a value of zero at the knock-out boundary. For example, for a down-and-out option, the condition <a href="#eq-crank4a" class="quarto-xref">Equation&nbsp;<span>22.17</span></a> can be replaced by <span class="math inline">\(C=0\)</span>. If the contract specifies that a rebate is to be paid to the buyer when the option is knocked out, then condition <a href="#eq-crank4a" class="quarto-xref">Equation&nbsp;<span>22.17</span></a> should be replaced by <span class="math inline">\(C=\)</span> Rebate.</p>
<p>To price a down-and-out (or up-and-out option), we put the bottom (or top) of the grid at the boundary. The boundary condition that we use is that the value at the boundary is zero. We will consider the example of a down-and-out call option. In this case, the boundary condition at the bottom of the grid is <a href="#eq-crank4aa" class="quarto-xref">Equation&nbsp;<span>22.19</span></a> with <span class="math inline">\(z_1=0\)</span> and <span class="math inline">\(b_1 = 0\)</span>. The boundary condition at the top is the same as for an ordinary call. We can easily handle a rebate paid when the option is knocked out by inputting the value of the rebate as <span class="math inline">\(z_1\)</span>.</p>
<p>The main new issue that we encounter in valuing barriers is locating the boundary of the grid at the barrier. For the down-and-out, we will input the value of the stock price at which the option is knocked out as <code>Bar</code>. We want the bottom of the grid to lie at the natural logarithm of this number. This will influence our choice of the space step <span class="math inline">\(\Delta x\)</span>, because we want to have an integer number of steps between the bottom of the grid and <span class="math inline">\(\log S_0\)</span>. We assume that the value <span class="math inline">\(M\)</span> input by the user represents the desired number of space steps above <span class="math inline">\(\log S_0\)</span>. We start with <span class="math inline">\(\Delta x=D/M\)</span> as an initial estimate of the size of the space step. We then decrease it, if necessary, to ensure that the distance between <code>Bar</code> and <span class="math inline">\(\log S_0\)</span> is an integer multiple of <span class="math inline">\(\Delta x\)</span>. We then increase <span class="math inline">\(M\)</span>, if necessary, to ensure that the top of the grid will still be at or above <span class="math inline">\(D+\log S_0\)</span>. Finally, we define the top of the grid to be at <span class="math inline">\(\log S_0 +M \cdot \Delta x\)</span>.</p>
<div id="my_code_block" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> down_and_out_call_cn(S0, K, r, sigma, q, T, N, M, Dist, Bar):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    dx <span class="op">=</span> Dist <span class="op">/</span> M</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    DistBot <span class="op">=</span> np.log(S0) <span class="op">-</span> np.log(Bar)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    NumBotSteps <span class="op">=</span> <span class="bu">int</span>(np.ceil(DistBot <span class="op">/</span> dx))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    dx <span class="op">=</span> DistBot <span class="op">/</span> NumBotSteps</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    NumTopSteps <span class="op">=</span> <span class="bu">int</span>(np.ceil(Dist <span class="op">/</span> dx))</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    DistTop <span class="op">=</span> NumTopSteps <span class="op">*</span> dx</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    L <span class="op">=</span> NumBotSteps <span class="op">+</span> NumTopSteps <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    dt <span class="op">=</span> T <span class="op">/</span> N</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    dx2 <span class="op">=</span> dx <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    u <span class="op">=</span> np.exp(dx)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    sig2 <span class="op">=</span> sigma <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    nu <span class="op">=</span> r <span class="op">-</span> q <span class="op">-</span> sig2 <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    St <span class="op">=</span> S0 <span class="op">*</span> np.exp(DistTop)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> np.zeros(<span class="dv">4</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    a[<span class="dv">0</span>] <span class="op">=</span> r <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">1</span> <span class="op">/</span> dt <span class="op">+</span> sig2 <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> dx2)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    a[<span class="dv">1</span>] <span class="op">=</span> sig2 <span class="op">/</span> (<span class="dv">4</span> <span class="op">*</span> dx2) <span class="op">+</span> nu <span class="op">/</span> (<span class="dv">4</span> <span class="op">*</span> dx)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    a[<span class="dv">2</span>] <span class="op">=</span> a[<span class="dv">1</span>] <span class="op">-</span> nu <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> dx)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    a[<span class="dv">3</span>] <span class="op">=</span> <span class="op">-</span>a[<span class="dv">0</span>] <span class="op">+</span> <span class="dv">2</span> <span class="op">/</span> dt</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> np.zeros(L)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> Bar</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    y[<span class="dv">0</span>] <span class="op">=</span> <span class="bu">max</span>(S <span class="op">-</span> K, <span class="dv">0</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, L):</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        S <span class="op">*=</span> u</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        y[j] <span class="op">=</span> <span class="bu">max</span>(S <span class="op">-</span> K, <span class="dv">0</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    z1 <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    b1 <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    zL <span class="op">=</span> St <span class="op">-</span> St <span class="op">/</span> u</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    bL <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    CallV <span class="op">=</span> crank_nicolson(a, y, L, z1, b1, zL, bL)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(N <span class="op">-</span> <span class="dv">2</span>, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        CallV <span class="op">=</span> crank_nicolson(a, CallV, L, z1, b1, zL, bL)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> CallV[NumBotSteps]</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Down and Out Call CN:"</span>, down_and_out_call_cn(S0, K, r, sigma, q, T, N, M, Dist, Bar))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Down and Out Call CN: 13.780367670052469</code></pre>
</div>
</div>
</section>
<section id="section" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="section"></h2>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create a python program to compare the estimates of the value of a discretely sampled barrier option given by the functions Down_And_Out_Call_MC created before and the function Down_And_Out_Call_CN. Allow the user to input <span class="math inline">\(S\)</span>, <span class="math inline">\(K\)</span>, <span class="math inline">\(r\)</span>, <span class="math inline">\(\sigma\)</span>, <span class="math inline">\(q\)</span>, the knock-out barrier, the number of Monte Carlo simulations, and the number of space steps above <span class="math inline">\(\log S_0\)</span> in the Crank-Nicolson algorithm.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create a python function Up_And_Out_Put_CN to value an up-and-out put option by the Crank-Nicolson method.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create a python function European_Call_Explicit that uses the explicit method <a href="#eq-fdtrinomial" class="quarto-xref">Equation&nbsp;<span>22.10</span></a> to value a European call option.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Write <a href="#eq-implicit" class="quarto-xref">Equation&nbsp;<span>22.11</span></a> for the implicit method, together with boundary conditions of the form <a href="#eq-crank4aa" class="quarto-xref">Equation&nbsp;<span>22.19</span></a> - <a href="#eq-crank4bb" class="quarto-xref">Equation&nbsp;<span>22.20</span></a> as a matrix system and solve for <span class="math inline">\(u_j\)</span> and <span class="math inline">\(b_j\)</span> in <a href="#eq-crank101" class="quarto-xref">Equation&nbsp;<span>22.21</span></a> - <a href="#eq-crankC_L" class="quarto-xref">Equation&nbsp;<span>22.22</span></a>, as in the subsection that defines the function CrankNicolson.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create a python function Implicit that solves the system of equations in the preceding exercise.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create a python function European_Call_Implicit that uses the implicit method to value a European call option.</p>
</div>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-BrennanSchwartz" class="csl-entry" role="listitem">
Brennan, M., and E. Schwartz. 1978. <em>Finite Difference Methods and Jump Processes Arising in the Pricing of Contingent Claims: A Synthesis. Journal of Financial and Quantitative Analysis 13</em>. 461–474.
</div>
<div id="ref-Tavella" class="csl-entry" role="listitem">
Tavella, D. A. 2002. <em>Quantitative Methods in Derivatives Pricing</em>. Wiley, New York.
</div>
<div id="ref-Wilmott" class="csl-entry" role="listitem">
Wilmott, P. 2000. <em>Paul Wilmott on Quantitative Finance</em>. Vol.&nbsp;2, Wiley, New York.
</div>
<div id="ref-WDH" class="csl-entry" role="listitem">
Wilmott, P., J. Dewynne, and S. Howison. 2000. <em>Option Pricing: Mathematical Models and Computation</em>. Oxford Financial Press, Oxford.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>If the price of the derivative is a function of the asset price <span class="math inline">\(S\)</span> and time, then we can always write it in this form as a function of the natural logarithm of <span class="math inline">\(S\)</span> and time.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Suppose a process <span class="math inline">\(X\)</span> satisfies <span class="math inline">\(\,\mathrm{d}X=\alpha_1\,\mathrm{d}t+\sigma_1\,\mathrm{d}B = \alpha_2\,\mathrm{d}t+\sigma_2\,\mathrm{d}B\)</span> for coefficients <span class="math inline">\(\alpha_i\)</span> and <span class="math inline">\(\sigma_i\)</span>. This implies <span class="math inline">\((\alpha_1-\alpha_2)\,\mathrm{d}t=(\sigma_2-\sigma_2)\,\mathrm{d}B\)</span>. The right-hand side defines a (local) martingale and the left-hand side defines a continuous finite-variation process. As discussed in <a href="Chapter_Brownian.html#sec-s:quadraticvariation" class="quarto-xref"><span>Section 4.3</span></a>, the only continuous finite-variation martingales are constants, so the changes must be zero; i.e., <span class="math inline">\(\alpha_1=\alpha_2\)</span> and <span class="math inline">\(\sigma_1=\sigma_2\)</span>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>We use a different variable (<span class="math inline">\(y\)</span>) for the call values at the final date—and consequently need to separate the first step of backing up (to the penultimate date) and the other steps of backing up (to date zero). See Appendix~A for more discussion.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Chapter_Binomial.html" class="pagination-link" aria-label="Binomial and Trinomial Models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Binomial and Trinomial Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Chapter_Fourier.html" class="pagination-link" aria-label="Fourier Transforms">
        <span class="nav-page-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Fourier Transforms</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions"><ul><li><a href="https://github.com/math-finance-book/book-code.git/blob/main/Chapter_PDEs.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div></div></footer></body></html>