<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>4&nbsp; Binomial Trees{#sec-c:trees} – Pricing and Hedging Derivative Securities</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Chapter_BrownianMotion.html" rel="next">
<link href="./Chapter_IntroFutures.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-45de5ea787cff190a632d730191a5db6.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-8deca16a749a126e590a598812fafdf7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-45de5ea787cff190a632d730191a5db6.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
if (typeof require !== 'undefined') {
require.undef("plotly");
requirejs.config({
    paths: {
        'plotly': ['https://cdn.plot.ly/plotly-2.35.2.min']
    }
});
require(['plotly'], function(Plotly) {
    window._Plotly = Plotly;
});
}
</script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
<style>
div.callout-Principle.callout {
  border-left-color: #eb4034;
}
div.callout-Principle.callout-style-default > .callout-header {
  background-color: rgba(235, 64, 52, 0.13);
}
div.callout-Principle .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Principle.callout-style-default .callout-icon::before, div.callout-Principle.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free';
  content: '\f06a';
  background-image: none;
}
div.callout-Example.callout {
  border-left-color: #a1bced;
}
div.callout-Example.callout-style-default > .callout-header {
  background-color: rgba(161, 188, 237, 0.13);
}
div.callout-Example .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Example.callout-style-default .callout-icon::before, div.callout-Example.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free';
  content: '\f185';
  background-image: none;
}
div.callout-Rule.callout {
  border-left-color: #12801f;
}
div.callout-Rule.callout-style-default > .callout-header {
  background-color: rgba(18, 128, 31, 0.13);
}
div.callout-Rule .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Rule.callout-style-default .callout-icon::before, div.callout-Rule.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free';
  content: '\f164';
  background-image: none;
}
div.callout-Extra.callout {
  border-left-color: #a1bced;
}
div.callout-Extra.callout-style-default > .callout-header {
  background-color: rgba(161, 188, 237, 0.13);
}
div.callout-Extra .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Extra.callout-style-default .callout-icon::before, div.callout-Extra.callout-titled .callout-icon::before {
  font-family: 'Font Awesome 6 Free';
  content: '\f48b';
  background-image: none;
}
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating fullcontent quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter_IntroDerivatives.html">Part 1: Introduction</a></li><li class="breadcrumb-item"><a href="./Chapter_Trees.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Binomial Trees{#sec-c:trees}</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Pricing and Hedging Derivative Securities</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://chat.derivative-securities.org/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-chat-square-text"></i></a>
    <a href="https://github.com/math-finance-book/book-published-code.git" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part 1: Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_IntroDerivatives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Derivative Securities</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_IntroOptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Options Markets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_IntroFutures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Futures Markets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Trees.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Binomial Trees{#sec-c:trees}</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part 2: Mathematical Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_BrownianMotion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Brownian Motion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Ito.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Ito Processes and Ito’s Formula</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_GeometricBrownianMotion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Geometric Brownian Motion</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part 3: Option Pricing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_ArbitragePricing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Arbitrage Pricing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_BlackScholes_updated.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">The Black-Scholes Formula</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_MertonMargrabeBlack.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Merton, Black, and Margrabe</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Asians.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Asians, Baskets, and Spreads</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_OtherExotics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Other Exotics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Part 4: Numerical Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_MonteCarlo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Monte Carlo Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_BinomialModel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Binomial and Trinomial Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter_IntroDerivatives.html">Part 1: Introduction</a></li><li class="breadcrumb-item"><a href="./Chapter_Trees.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Binomial Trees{#sec-c:trees}</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Binomial Trees{#sec-c:trees}</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="10fe368f" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display">
<script type="text/javascript" async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_SVG"></script>
</div>
</div>
<p>This chapter introduces binomial tree models for valuing derivative securities. We begin with the fundamental concepts of arbitrage pricing in a one-period model, extend to multi-period trees, and then discuss practical implementation and parameter calibration.</p>
<section id="one-period-binomial-model" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="one-period-binomial-model"><span class="header-section-number">4.1</span> One-Period Binomial Model</h2>
<p>We start with the simplest possible model. A stock has price <span class="math inline">\(S\)</span> today (date 0) and will have one of two possible values at date <span class="math inline">\(t\)</span>: either <span class="math inline">\(S_u\)</span> (up state) or <span class="math inline">\(S_d\)</span> (down state), where <span class="math inline">\(S_u &gt; S_d\)</span>. There is also a risk-free asset earning a continuously compounded rate <span class="math inline">\(r\)</span>.</p>
<section id="delta-hedging-and-replication" class="level4">
<h4 class="anchored" data-anchor-id="delta-hedging-and-replication">Delta Hedging and Replication</h4>
<p>Consider a European call option with strike <span class="math inline">\(K\)</span> and maturity <span class="math inline">\(t\)</span>. Its payoff will be <span class="math inline">\(C_u = \max(0, S_u - K)\)</span> in the up state and <span class="math inline">\(C_d = \max(0, S_d - K)\)</span> in the down state.</p>
<p>The key insight is that we can replicate the option payoff using a portfolio of the stock and risk-free asset. Let <span class="math inline">\(\delta\)</span> be the number of shares we hold. This delta is chosen so that the portfolio has the same payoff as the option in both states:</p>
<p><span class="math display">\[\delta = \frac{C_u - C_d}{S_u - S_d}\]</span></p>
<p>To see why this works, consider a portfolio that holds <span class="math inline">\(\delta\)</span> shares of stock and borrows an amount <span class="math inline">\(B\)</span> at the risk-free rate. The portfolio value at maturity will be: - Up state: <span class="math inline">\(\delta S_u - B e^{rt}\)</span> - Down state: <span class="math inline">\(\delta S_d - B e^{rt}\)</span></p>
<p>For replication, we need these to equal the option payoffs: <span class="math display">\[\delta S_u - B e^{rt} = C_u\]</span> <span class="math display">\[\delta S_d - B e^{rt} = C_d\]</span></p>
<p>Subtracting the second equation from the first: <span class="math display">\[\delta(S_u - S_d) = C_u - C_d\]</span></p>
<p>This gives us our delta formula. We can solve for the borrowing amount: <span class="math display">\[B = e^{-rt}(\delta S_u - C_u) = e^{-rt}(\delta S_d - C_d)\]</span></p>
<p>The initial cost of this replicating portfolio is: <span class="math display">\[\text{Portfolio Cost} = \delta S - B = \delta S - e^{-rt}(\delta S_u - C_u)\]</span></p>
<p>By no-arbitrage, this must equal the option price.</p>
<div class="callout callout-style-simple callout-Example callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Suppose <span class="math inline">\(S = 100\)</span>, <span class="math inline">\(S_u = 110\)</span>, <span class="math inline">\(S_d = 90\)</span>, <span class="math inline">\(K = 105\)</span>, <span class="math inline">\(r = 0.05\)</span>, <span class="math inline">\(t = 1\)</span>. Then: - <span class="math inline">\(C_u = \max(0, 110 - 105) = 5\)</span> - <span class="math inline">\(C_d = \max(0, 90 - 105) = 0\)</span> - <span class="math inline">\(\delta = \frac{5 - 0}{110 - 90} = 0.25\)</span> - <span class="math inline">\(B = e^{-0.05}(0.25 \times 110 - 5) = e^{-0.05} \times 22.5 \approx 21.43\)</span> - Option price <span class="math inline">\(= 0.25 \times 100 - 21.43 = 3.57\)</span></p>
<p><strong>Verification:</strong> In the up state, the portfolio is worth <span class="math inline">\(0.25 \times 110 - 22.5 = 5\)</span>, matching <span class="math inline">\(C_u\)</span>. In the down state, it’s worth <span class="math inline">\(0.25 \times 90 - 22.5 = 0\)</span>, matching <span class="math inline">\(C_d\)</span>.</p>
<p>This delta hedging shows that by holding 0.25 shares and borrowing $21.43, we can perfectly replicate the option payoff.</p>
</div>
</div>
</div>
</section>
<section id="risk-neutral-valuation" class="level4">
<h4 class="anchored" data-anchor-id="risk-neutral-valuation">Risk-Neutral Valuation</h4>
<p>We can rearrange the replication formula to express the option value as:</p>
<p><span class="math display">\[C = \pi_u C_u + \pi_d C_d\]</span></p>
<p>where the state prices are:</p>
<p><span class="math display">\[\pi_u = \frac{S - \mathrm{e}^{-rt}S_d}{S_u - S_d}, \quad \pi_d = \frac{\mathrm{e}^{-rt}S_u - S}{S_u - S_d}\]</span></p>
<p>These state prices satisfy: - <span class="math inline">\(\pi_u, \pi_d &gt; 0\)</span> (under no-arbitrage condition <span class="math inline">\(S_u/S &gt; \mathrm{e}^{rt} &gt; S_d/S\)</span>) - <span class="math inline">\(\pi_u \mathrm{e}^{rt} + \pi_d \mathrm{e}^{rt} = 1\)</span></p>
<p>This motivates defining risk-neutral probabilities:</p>
<p><span class="math display">\[p_u = \pi_u \mathrm{e}^{rt}, \quad p_d = \pi_d \mathrm{e}^{rt}\]</span></p>
<p>Then:</p>
<p><span class="math display">\[C = \mathrm{e}^{-rt}[p_u C_u + p_d C_d]\]</span></p>
<p>The option value is the discounted expected payoff under the risk-neutral probability measure. Note that:</p>
<p><span class="math display">\[p_u = \frac{\mathrm{e}^{rt} - S_d/S}{S_u/S - S_d/S}\]</span></p>
</section>
</section>
<section id="two-period-model" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="two-period-model"><span class="header-section-number">4.2</span> Two-Period Model</h2>
<p>Now consider a two-period model where the stock price evolves over two time steps of length <span class="math inline">\(\Delta t = t/2\)</span>. To simplify notation and ensure the tree recombines, we parameterize the price movements using multiplicative factors <span class="math inline">\(u &gt; 1\)</span> and <span class="math inline">\(d = 1/u &lt; 1\)</span>.</p>
<p>Starting from <span class="math inline">\(S\)</span>, after one period the stock price is either <span class="math inline">\(uS\)</span> or <span class="math inline">\(dS\)</span>. After two periods, the possible prices are: - <span class="math inline">\(u^2S\)</span> (two up moves) - <span class="math inline">\(udS = S\)</span> (one up, one down)<br>
- <span class="math inline">\(d^2S\)</span> (two down moves)</p>
<p>The tree recombines because <span class="math inline">\(ud = du = 1\)</span>, so the middle node has price <span class="math inline">\(S\)</span> regardless of the path taken.</p>
<section id="backward-induction-process" class="level4">
<h4 class="anchored" data-anchor-id="backward-induction-process">Backward Induction Process</h4>
<p>The key to valuing options in multi-period trees is <strong>backward induction</strong>. We start at maturity and work backwards to find today’s value.</p>
<p><strong>Step 1: Final Period (t = 2)</strong> Calculate option payoffs at each terminal node: - Node (2,2): <span class="math inline">\(C_{uu} = \max(0, u^2S - K)\)</span> - Node (2,1): <span class="math inline">\(C_{ud} = \max(0, udS - K) = \max(0, S - K)\)</span> - Node (2,0): <span class="math inline">\(C_{dd} = \max(0, d^2S - K)\)</span></p>
<p><strong>Step 2: Intermediate Period (t = 1)</strong> At each node, calculate the option value as the discounted risk-neutral expectation of the next period’s values.</p>
<p>At the up node (1,1) with stock price <span class="math inline">\(uS\)</span>: <span class="math display">\[C_u = e^{-r\Delta t}[p \cdot C_{uu} + (1-p) \cdot C_{ud}]\]</span></p>
<p>At the down node (1,0) with stock price <span class="math inline">\(dS\)</span>: <span class="math display">\[C_d = e^{-r\Delta t}[p \cdot C_{ud} + (1-p) \cdot C_{dd}]\]</span></p>
<p><strong>Step 3: Initial Period (t = 0)</strong> Finally, calculate today’s option value: <span class="math display">\[C_0 = e^{-r\Delta t}[p \cdot C_u + (1-p) \cdot C_d]\]</span></p>
<p><strong>For American Options:</strong> At each intermediate node, compare continuation value with immediate exercise: - Up node: <span class="math inline">\(C_u = \max(\text{continuation value}, \max(0, uS - K))\)</span> - Down node: <span class="math inline">\(C_d = \max(\text{continuation value}, \max(0, dS - K))\)</span></p>
<p>This backward induction process automatically finds the optimal exercise strategy by comparing holding vs.&nbsp;exercising at each node.</p>
<div id="61f68968" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> binomial_american_detailed(S0, K, r, sigma, T, N, option_type<span class="op">=</span><span class="st">'put'</span>):</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Price American option using binomial tree with detailed backward induction</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">    This function shows exactly how backward induction works step by step</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 1: Set up tree parameters</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    dt <span class="op">=</span> T <span class="op">/</span> N                          <span class="co"># Time per step</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    u <span class="op">=</span> np.exp(sigma <span class="op">*</span> np.sqrt(dt))     <span class="co"># Up factor</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> u                           <span class="co"># Down factor (ensures recombining tree)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> (np.exp(r <span class="op">*</span> dt) <span class="op">-</span> d) <span class="op">/</span> (u <span class="op">-</span> d)  <span class="co"># Risk-neutral probability</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    disc <span class="op">=</span> np.exp(<span class="op">-</span>r <span class="op">*</span> dt)              <span class="co"># Discount factor</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Tree parameters: u=</span><span class="sc">{</span>u<span class="sc">:.4f}</span><span class="ss">, d=</span><span class="sc">{</span>d<span class="sc">:.4f}</span><span class="ss">, p=</span><span class="sc">{</span>p<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 2: Initialize option values at maturity (time N)</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># At maturity, we have N+1 possible stock prices</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    V <span class="op">=</span> np.zeros(N<span class="op">+</span><span class="dv">1</span>)  <span class="co"># Option values</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> np.zeros(N<span class="op">+</span><span class="dv">1</span>)  <span class="co"># Stock prices</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(N<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        S[j] <span class="op">=</span> S0 <span class="op">*</span> (u<span class="op">**</span>j) <span class="op">*</span> (d<span class="op">**</span>(N<span class="op">-</span>j))  <span class="co"># Stock price at node j</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> option_type <span class="op">==</span> <span class="st">'call'</span>:</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>            V[j] <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, S[j] <span class="op">-</span> K)      <span class="co"># Call payoff</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>            V[j] <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, K <span class="op">-</span> S[j])      <span class="co"># Put payoff</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">At maturity (time </span><span class="sc">{</span>N<span class="sc">}</span><span class="ss">):"</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Stock prices: </span><span class="sc">{</span>[<span class="ss">f'</span><span class="sc">{</span>s<span class="sc">:.2f}</span><span class="ss">'</span> <span class="cf">for</span> s <span class="kw">in</span> S]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Option values: </span><span class="sc">{</span>[<span class="ss">f'</span><span class="sc">{</span>v<span class="sc">:.4f}</span><span class="ss">'</span> <span class="cf">for</span> v <span class="kw">in</span> V]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 3: Backward induction through the tree</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>):  <span class="co"># Work backwards from time N-1 to 0</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Time step </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># At time i, we have i+1 nodes</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        new_V <span class="op">=</span> np.zeros(i<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        new_S <span class="op">=</span> np.zeros(i<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(i<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Stock price at this node</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>            new_S[j] <span class="op">=</span> S0 <span class="op">*</span> (u<span class="op">**</span>j) <span class="op">*</span> (d<span class="op">**</span>(i<span class="op">-</span>j))</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Continuation value (discounted expected value)</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>            continuation <span class="op">=</span> disc <span class="op">*</span> (p <span class="op">*</span> V[j<span class="op">+</span><span class="dv">1</span>] <span class="op">+</span> (<span class="dv">1</span><span class="op">-</span>p) <span class="op">*</span> V[j])</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Immediate exercise value</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> option_type <span class="op">==</span> <span class="st">'call'</span>:</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>                exercise <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, new_S[j] <span class="op">-</span> K)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>                exercise <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, K <span class="op">-</span> new_S[j])</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>            <span class="co"># American option: take maximum of continuation and exercise</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>            new_V[j] <span class="op">=</span> <span class="bu">max</span>(continuation, exercise)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  Node </span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">: S=</span><span class="sc">{</span>new_S[j]<span class="sc">:.2f}</span><span class="ss">, Cont=</span><span class="sc">{</span>continuation<span class="sc">:.4f}</span><span class="ss">, "</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f"Exercise=</span><span class="sc">{</span>exercise<span class="sc">:.4f}</span><span class="ss">, Value=</span><span class="sc">{</span>new_V[j]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update for next iteration</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        V <span class="op">=</span> new_V.copy()</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>        S <span class="op">=</span> new_S.copy()</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> V[<span class="dv">0</span>]</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Example with small tree to see the process</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Detailed backward induction for 2-step American put:"</span>)</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>S0, K, r, sigma, T, N <span class="op">=</span> <span class="dv">100</span>, <span class="dv">105</span>, <span class="fl">0.05</span>, <span class="fl">0.2</span>, <span class="fl">1.0</span>, <span class="dv">2</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>put_value <span class="op">=</span> binomial_american_detailed(S0, K, r, sigma, T, N, <span class="st">'put'</span>)</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Final American put value: </span><span class="sc">{</span>put_value<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Detailed backward induction for 2-step American put:
Tree parameters: u=1.1519, d=0.8681, p=0.5539

At maturity (time 2):
Stock prices: ['75.36', '100.00', '132.69']
Option values: ['29.6362', '5.0000', '0.0000']

Time step 1:
  Node 0: S=86.81, Cont=15.5952, Exercise=18.1877, Value=18.1877
  Node 1: S=115.19, Cont=2.1754, Exercise=0.0000, Value=2.1754

Time step 0:
  Node 0: S=100.00, Cont=9.0883, Exercise=5.0000, Value=9.0883

Final American put value: 9.0883</code></pre>
</div>
</div>
<p>The numerical output above shows the exact backward induction process for our 2-step example. Let’s visualize this same tree to better understand how the calculations flow through the nodes:</p>
<div id="cell-fig-two-step-tree" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pydot</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image, display</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the same parameters as the detailed example above</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>S0 <span class="op">=</span> <span class="dv">100</span>  <span class="co"># Initial stock price</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="dv">105</span>   <span class="co"># Strike price  </span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.05</span>  <span class="co"># Risk-free rate</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.2</span>  <span class="co"># Volatility</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="fl">1.0</span>   <span class="co"># Time to maturity</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">2</span>     <span class="co"># Number of periods</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate tree parameters</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> T <span class="op">/</span> N</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>u <span class="op">=</span> np.exp(sigma <span class="op">*</span> np.sqrt(dt))</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> u</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> (np.exp(r <span class="op">*</span> dt) <span class="op">-</span> d) <span class="op">/</span> (u <span class="op">-</span> d)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>disc <span class="op">=</span> np.exp(<span class="op">-</span>r <span class="op">*</span> dt)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate all stock prices and option values using same logic as detailed function</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>V <span class="op">=</span> np.zeros(N<span class="op">+</span><span class="dv">1</span>)  <span class="co"># Option values</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> np.zeros(N<span class="op">+</span><span class="dv">1</span>)  <span class="co"># Stock prices</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Time 2 (maturity) - put option payoffs</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(N<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    S[j] <span class="op">=</span> S0 <span class="op">*</span> (u<span class="op">**</span>j) <span class="op">*</span> (d<span class="op">**</span>(N<span class="op">-</span>j))</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    V[j] <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, K <span class="op">-</span> S[j])  <span class="co"># Put payoff</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>S_20, S_21, S_22 <span class="op">=</span> S[<span class="dv">0</span>], S[<span class="dv">1</span>], S[<span class="dv">2</span>]</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>V_20, V_21, V_22 <span class="op">=</span> V[<span class="dv">0</span>], V[<span class="dv">1</span>], V[<span class="dv">2</span>]</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Time 1 - backward induction  </span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>V_new <span class="op">=</span> np.zeros(<span class="dv">2</span>)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>S_new <span class="op">=</span> np.zeros(<span class="dv">2</span>)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    S_new[j] <span class="op">=</span> S0 <span class="op">*</span> (u<span class="op">**</span>j) <span class="op">*</span> (d<span class="op">**</span>(<span class="dv">1</span><span class="op">-</span>j))</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    continuation <span class="op">=</span> disc <span class="op">*</span> (p <span class="op">*</span> V[j<span class="op">+</span><span class="dv">1</span>] <span class="op">+</span> (<span class="dv">1</span><span class="op">-</span>p) <span class="op">*</span> V[j])</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    exercise <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, K <span class="op">-</span> S_new[j])</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    V_new[j] <span class="op">=</span> <span class="bu">max</span>(continuation, exercise)</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>S_10, S_11 <span class="op">=</span> S_new[<span class="dv">0</span>], S_new[<span class="dv">1</span>]</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>V_10, V_11 <span class="op">=</span> V_new[<span class="dv">0</span>], V_new[<span class="dv">1</span>]</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>V <span class="op">=</span> V_new.copy()</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Time 0 - final backward induction</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>S_00 <span class="op">=</span> S0</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>continuation <span class="op">=</span> disc <span class="op">*</span> (p <span class="op">*</span> V[<span class="dv">1</span>] <span class="op">+</span> (<span class="dv">1</span><span class="op">-</span>p) <span class="op">*</span> V[<span class="dv">0</span>])</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>exercise <span class="op">=</span> <span class="bu">max</span>(<span class="dv">0</span>, K <span class="op">-</span> S_00)</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>V_00 <span class="op">=</span> <span class="bu">max</span>(continuation, exercise)</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the graph</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>graph <span class="op">=</span> pydot.Dot(graph_type<span class="op">=</span><span class="st">'digraph'</span>, rankdir<span class="op">=</span><span class="st">'LR'</span>, bgcolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>graph.set_node_defaults(shape<span class="op">=</span><span class="st">'circle'</span>, style<span class="op">=</span><span class="st">'filled'</span>, fillcolor<span class="op">=</span><span class="st">'lightblue'</span>, </span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>                       fontname<span class="op">=</span><span class="st">'Arial'</span>, fontsize<span class="op">=</span><span class="st">'9'</span>)</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>graph.set_edge_defaults(fontname<span class="op">=</span><span class="st">'Arial'</span>, fontsize<span class="op">=</span><span class="st">'8'</span>)</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Time 0</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>graph.add_node(pydot.Node(<span class="st">'t0'</span>, </span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>                         label<span class="op">=</span><span class="ss">f't=0</span><span class="ch">\\</span><span class="ss">nS=</span><span class="sc">{</span>S_00<span class="sc">:.2f}</span><span class="ch">\\</span><span class="ss">nV=</span><span class="sc">{</span>V_00<span class="sc">:.4f}</span><span class="ss">'</span>,</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>                         fillcolor<span class="op">=</span><span class="st">'lightgreen'</span>))</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Time 1</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>graph.add_node(pydot.Node(<span class="st">'t1_u'</span>, </span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>                         label<span class="op">=</span><span class="ss">f't=1 Up</span><span class="ch">\\</span><span class="ss">nS=</span><span class="sc">{</span>S_11<span class="sc">:.2f}</span><span class="ch">\\</span><span class="ss">nV=</span><span class="sc">{</span>V_11<span class="sc">:.4f}</span><span class="ss">'</span>,</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>                         fillcolor<span class="op">=</span><span class="st">'lightyellow'</span>))</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>graph.add_node(pydot.Node(<span class="st">'t1_d'</span>, </span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>                         label<span class="op">=</span><span class="ss">f't=1 Down</span><span class="ch">\\</span><span class="ss">nS=</span><span class="sc">{</span>S_10<span class="sc">:.2f}</span><span class="ch">\\</span><span class="ss">nV=</span><span class="sc">{</span>V_10<span class="sc">:.4f}</span><span class="ss">'</span>,</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>                         fillcolor<span class="op">=</span><span class="st">'lightyellow'</span>))</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Time 2 (maturity)</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>graph.add_node(pydot.Node(<span class="st">'t2_uu'</span>, </span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>                         label<span class="op">=</span><span class="ss">f't=2 UU</span><span class="ch">\\</span><span class="ss">nS=</span><span class="sc">{</span>S_22<span class="sc">:.2f}</span><span class="ch">\\</span><span class="ss">nV=</span><span class="sc">{</span>V_22<span class="sc">:.4f}</span><span class="ss">'</span>,</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>                         fillcolor<span class="op">=</span><span class="st">'lightcoral'</span>))</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>graph.add_node(pydot.Node(<span class="st">'t2_ud'</span>, </span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>                         label<span class="op">=</span><span class="ss">f't=2 UD</span><span class="ch">\\</span><span class="ss">nS=</span><span class="sc">{</span>S_21<span class="sc">:.2f}</span><span class="ch">\\</span><span class="ss">nV=</span><span class="sc">{</span>V_21<span class="sc">:.4f}</span><span class="ss">'</span>,</span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>                         fillcolor<span class="op">=</span><span class="st">'lightcoral'</span>))</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>graph.add_node(pydot.Node(<span class="st">'t2_dd'</span>, </span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>                         label<span class="op">=</span><span class="ss">f't=2 DD</span><span class="ch">\\</span><span class="ss">nS=</span><span class="sc">{</span>S_20<span class="sc">:.2f}</span><span class="ch">\\</span><span class="ss">nV=</span><span class="sc">{</span>V_20<span class="sc">:.4f}</span><span class="ss">'</span>,</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>                         fillcolor<span class="op">=</span><span class="st">'lightcoral'</span>))</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Add edges</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>graph.add_edge(pydot.Edge(<span class="st">'t0'</span>, <span class="st">'t1_u'</span>, label<span class="op">=</span><span class="ss">f'p=</span><span class="sc">{</span>p<span class="sc">:.3f}</span><span class="ss">'</span>))</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>graph.add_edge(pydot.Edge(<span class="st">'t0'</span>, <span class="st">'t1_d'</span>, label<span class="op">=</span><span class="ss">f'1-p=</span><span class="sc">{</span><span class="dv">1</span><span class="op">-</span>p<span class="sc">:.3f}</span><span class="ss">'</span>))</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>graph.add_edge(pydot.Edge(<span class="st">'t1_u'</span>, <span class="st">'t2_uu'</span>, label<span class="op">=</span><span class="ss">f'p=</span><span class="sc">{</span>p<span class="sc">:.3f}</span><span class="ss">'</span>))</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>graph.add_edge(pydot.Edge(<span class="st">'t1_u'</span>, <span class="st">'t2_ud'</span>, label<span class="op">=</span><span class="ss">f'1-p=</span><span class="sc">{</span><span class="dv">1</span><span class="op">-</span>p<span class="sc">:.3f}</span><span class="ss">'</span>))</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>graph.add_edge(pydot.Edge(<span class="st">'t1_d'</span>, <span class="st">'t2_ud'</span>, label<span class="op">=</span><span class="ss">f'p=</span><span class="sc">{</span>p<span class="sc">:.3f}</span><span class="ss">'</span>))</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>graph.add_edge(pydot.Edge(<span class="st">'t1_d'</span>, <span class="st">'t2_dd'</span>, label<span class="op">=</span><span class="ss">f'1-p=</span><span class="sc">{</span><span class="dv">1</span><span class="op">-</span>p<span class="sc">:.3f}</span><span class="ss">'</span>))</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Save and display</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>graph.write_png(<span class="st">'two_step_tree.png'</span>)</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>display(Image(<span class="st">'two_step_tree.png'</span>))</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Tree parameters matching the numerical example:"</span>)</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"u = </span><span class="sc">{</span>u<span class="sc">:.4f}</span><span class="ss">, d = </span><span class="sc">{</span>d<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Risk-neutral probability p = </span><span class="sc">{</span>p<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">This tree shows the exact same values computed in the numerical output above."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-two-step-tree" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-two-step-tree-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Chapter_Trees_files/figure-html/fig-two-step-tree-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-two-step-tree-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.1: Two-step binomial tree showing the same numerical example with backward induction
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Tree parameters matching the numerical example:
u = 1.1519, d = 0.8681
Risk-neutral probability p = 0.5539

This tree shows the exact same values computed in the numerical output above.</code></pre>
</div>
</div>
<p>The tree visualization above corresponds exactly to the numerical backward induction process shown in the previous output. You can verify that the option values at each node match the calculations displayed in the step-by-step algorithm.</p>
</section>
</section>
<section id="n-period-model" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="n-period-model"><span class="header-section-number">4.3</span> N-Period Model</h2>
<p>The extension to N periods is straightforward. With parameters <span class="math inline">\(u\)</span> and <span class="math inline">\(d = 1/u\)</span>, after <span class="math inline">\(n\)</span> periods we have <span class="math inline">\(n+1\)</span> nodes with stock prices:</p>
<p><span class="math display">\[S_j = u^j d^{n-j} S = u^{2j-n} S, \quad j = 0, 1, \ldots, n\]</span></p>
<p>The critical insight for efficient implementation is backward induction rather than computing all possible paths.</p>
<section id="interactive-n-period-trees" class="level4">
<h4 class="anchored" data-anchor-id="interactive-n-period-trees">Interactive N-Period Trees</h4>
<p>Now let’s explore how N-period binomial trees behave with different parameters using an interactive tool:</p>
<div id="fig-binomial-trees" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binomial-trees-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<iframe width="100%" height="800" src="https://binomial-trees.koyeb.app/">
</iframe>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binomial-trees-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.2: <strong>Interactive Binomial Trees Explorer.</strong> This tool allows you to experiment with N-period binomial trees. Key features: (i) <strong>Interest rate</strong>: Enter the rate per period (for annual rate with N periods, use r/N), (ii) <strong>Up move</strong>: This corresponds to <span class="math inline">\((u-1)\)</span> where <span class="math inline">\(u\)</span> is our up factor, (iii) <strong>Down move</strong>: The model automatically sets <span class="math inline">\(d = 1/u\)</span> to ensure recombination, (iv) <strong>Number of periods</strong>: See how increasing N affects option values and convergence, (v) <strong>Option types</strong>: Compare European and American option pricing, (vi) <strong>Parameters</strong>: Observe how volatility, strike price, and time to maturity affect values
</figcaption>
</figure>
</div>
</section>
<section id="backward-induction-implementation" class="level4">
<h4 class="anchored" data-anchor-id="backward-induction-implementation">Backward Induction Implementation</h4>
<p>For American options especially, we must use backward induction. Here’s the streamlined version for practical use:</p>
<div id="d60651a3" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> binomial_american_fast(S0, K, r, sigma, T, N, option_type<span class="op">=</span><span class="st">'put'</span>):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Efficient American option pricing using backward induction</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    This version uses vectorized operations for speed</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    dt <span class="op">=</span> T <span class="op">/</span> N</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    u <span class="op">=</span> np.exp(sigma <span class="op">*</span> np.sqrt(dt))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> u</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> (np.exp(r <span class="op">*</span> dt) <span class="op">-</span> d) <span class="op">/</span> (u <span class="op">-</span> d)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    disc <span class="op">=</span> np.exp(<span class="op">-</span>r <span class="op">*</span> dt)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize option values at maturity</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use vectorized operations for efficiency</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    j_values <span class="op">=</span> np.arange(N<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    S_final <span class="op">=</span> S0 <span class="op">*</span> (u<span class="op">**</span>j_values) <span class="op">*</span> (d<span class="op">**</span>(N<span class="op">-</span>j_values))</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> option_type <span class="op">==</span> <span class="st">'call'</span>:</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        V <span class="op">=</span> np.maximum(S_final <span class="op">-</span> K, <span class="dv">0</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        V <span class="op">=</span> np.maximum(K <span class="op">-</span> S_final, <span class="dv">0</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Backward induction</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        j_values <span class="op">=</span> np.arange(i<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        S_current <span class="op">=</span> S0 <span class="op">*</span> (u<span class="op">**</span>j_values) <span class="op">*</span> (d<span class="op">**</span>(i<span class="op">-</span>j_values))</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Continuation values (vectorized)</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>        V_new <span class="op">=</span> disc <span class="op">*</span> (p <span class="op">*</span> V[<span class="dv">1</span>:i<span class="op">+</span><span class="dv">2</span>] <span class="op">+</span> (<span class="dv">1</span><span class="op">-</span>p) <span class="op">*</span> V[<span class="dv">0</span>:i<span class="op">+</span><span class="dv">1</span>])</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Exercise values</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> option_type <span class="op">==</span> <span class="st">'call'</span>:</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>            exercise <span class="op">=</span> np.maximum(S_current <span class="op">-</span> K, <span class="dv">0</span>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>            exercise <span class="op">=</span> np.maximum(K <span class="op">-</span> S_current, <span class="dv">0</span>)</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Take maximum (American feature)</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>        V <span class="op">=</span> np.maximum(V_new, exercise)</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> V[<span class="dv">0</span>]</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Examples</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">American option values:"</span>)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>put_american <span class="op">=</span> binomial_american_fast(<span class="dv">100</span>, <span class="dv">105</span>, <span class="fl">0.05</span>, <span class="fl">0.2</span>, <span class="dv">1</span>, <span class="dv">100</span>, <span class="st">'put'</span>)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>call_american <span class="op">=</span> binomial_american_fast(<span class="dv">100</span>, <span class="dv">105</span>, <span class="fl">0.05</span>, <span class="fl">0.2</span>, <span class="dv">1</span>, <span class="dv">100</span>, <span class="st">'call'</span>)</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"American put (K=105): </span><span class="sc">{</span>put_american<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"American call (K=105): </span><span class="sc">{</span>call_american<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
American option values:
American put (K=105): 8.7476
American call (K=105): 8.0262</code></pre>
</div>
</div>
</section>
<section id="how-the-code-works" class="level4">
<h4 class="anchored" data-anchor-id="how-the-code-works">How the Code Works</h4>
<p><strong>Key algorithmic insights:</strong></p>
<ol type="1">
<li><p><strong>Vectorization</strong>: Instead of nested loops, we use NumPy arrays to compute all nodes at each time step simultaneously</p></li>
<li><p><strong>Memory efficiency</strong>: We only store option values for the current time step, not the entire tree</p></li>
<li><p><strong>Backward induction logic</strong>:</p>
<ul>
<li>Start with payoffs at maturity</li>
<li>At each prior time step, compute continuation value as discounted expectation</li>
<li>For American options, compare with immediate exercise value</li>
<li>Take the maximum (American feature)</li>
</ul></li>
</ol>
</section>
</section>
<section id="parameter-calibration" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="parameter-calibration"><span class="header-section-number">4.4</span> Parameter Calibration</h2>
<p>We need <span class="math inline">\(\Delta t\)</span> to be small for it to be reasonable to assume that the underlying asset can only do two possible things over the next time period. If we’re going to take it be very small, we might as well ask what happens if we take it to be infinitesimal, meaning that we take <span class="math inline">\(\Delta t \rightarrow 0\)</span>. This is the <strong>continuous-time limit.</strong></p>
<p>We should choose the parameters of the model to match the properties of the underlying asset. If we’re going to take the limit, then the important feature is that the limiting parameters match the properties of the underlying asset. Several choices are possible, but the most popular set of parameters is that proposed by <span class="citation" data-cites="CRR">(<a href="#ref-CRR" role="doc-biblioref">Cox, Ross, and Rubinstein 1979</a>)</span>.</p>
<p>They set</p>
<p><span class="math display">\[u = \mathrm{e}^{\sigma\sqrt{\Delta t}}, \quad d = \frac{1}{u}, \quad p = \frac{\mathrm{e}^{(r-q)\Delta t} - d}{u - d}\]</span></p>
<p>where <span class="math inline">\(\sigma\)</span> is the standard deviation of the underlying asset return, <span class="math inline">\(r\)</span> is the risk-free rate, and <span class="math inline">\(q\)</span> is the dividend yield. This choice ensures: - The tree recombines (<span class="math inline">\(ud = 1\)</span>) - The discrete model converges to geometric Brownian motion (see <span class="quarto-unresolved-ref">?sec-c:gbm</span>). - The risk-neutral probability is well-defined when <span class="math inline">\(d &lt; \mathrm{e}^{(r-q)\Delta t} &lt; u\)</span></p>
<p>The following interactive figure shows how the option prices derived from the binomial model settle down around fixed values as the number of periods in a given time period increases (that is, as <span class="math inline">\(\Delta t = T/N \rightarrow 0\)</span>). We will later see that this limit is the celebrated Black-Scholes formula (see <a href="Chapter_BlackScholes_updated.html" class="quarto-xref"><span>Chapter 9</span></a>).</p>
<div id="fig-binomial-convergence" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binomial-convergence-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<iframe width="100%" height="1200" src="https://eerie-rivalee-kerrybackapps-f393e9af.koyeb.app/">
</iframe>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binomial-convergence-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.3: <strong>Binomial Convergence to Continuous-Time Limit</strong> The binomial model (blue dots) converges to the continuous-time limit (red dotted line) for European options as the number of time steps is increased. The deviations from the continuous-time values are the same for both calls and puts, reflecting put-call parity in both the discrete and continuous-time models.
</figcaption>
</figure>
</div>
</section>
<section id="summary" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="summary"><span class="header-section-number">4.5</span> Summary</h2>
<p>The binomial tree model provides an intuitive and flexible framework for option pricing:</p>
<ol type="1">
<li><strong>One-period model</strong>: Introduces replication and risk-neutral valuation</li>
<li><strong>Multi-period extension</strong>: Uses backward induction</li>
<li><strong>Parameter choice</strong>: Cox-Ross-Rubinstein parameters with <span class="math inline">\(u = \mathrm{e}^{\sigma\sqrt{\Delta t}}\)</span> and <span class="math inline">\(d = 1/u\)</span> ensure convergence</li>
</ol>
</section>
<section id="exercises" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="exercises"><span class="header-section-number">4.6</span> Exercises</h2>
<section id="one-period-model-exercises" class="level4">
<h4 class="anchored" data-anchor-id="one-period-model-exercises">One-Period Model Exercises</h4>
<div id="exr-trees1" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4.1</strong></span> In a one-period binomial model with <span class="math inline">\(S = 50\)</span>, <span class="math inline">\(S_u = 60\)</span>, <span class="math inline">\(S_d = 40\)</span>, and <span class="math inline">\(r = 0.05\)</span>: a) Calculate the risk-neutral probabilities b) Price a call option with strike <span class="math inline">\(K = 55\)</span> c) Verify your answer using delta hedging</p>
</div>
<div id="exr-binomialcall" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4.2</strong></span> Create a Python function in which the user inputs <span class="math inline">\(S\)</span>, <span class="math inline">\(S_d\)</span>, <span class="math inline">\(S_u\)</span>, <span class="math inline">\(K\)</span>, <span class="math inline">\(r\)</span> and <span class="math inline">\(t\)</span>. Check that the no-arbitrage condition is satisfied (<span class="math inline">\(S_d &lt; Se^{rt} &lt; S_u\)</span>). Compute the value of a call option in each of the following ways:</p>
<ol type="1">
<li>Compute the delta and use the replication formula</li>
<li>Compute the state prices and use linear pricing</li>
<li>Compute the risk-neutral probabilities and use discounted expectation</li>
<li>Compute the probabilities using the stock as numeraire</li>
</ol>
<p>Verify that all of these methods produce the same answer.</p>
</div>
<div id="exr-arbitrage2" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4.3</strong></span> In a two-state model, a put option is equivalent to <span class="math inline">\(\delta_p\)</span> shares of the stock, where <span class="math inline">\(\delta_p = (P_u-P_d)/(S_u-S_d)\)</span> (this will be negative, meaning a short position) and some money invested in the risk-free asset. Derive the amount of money <span class="math inline">\(x\)</span> that should be invested in the risk-free asset to replicate the put option. The value of the put at date <span class="math inline">\(0\)</span> must be <span class="math inline">\(x+\delta_pS\)</span>.</p>
</div>
<div id="exr-arbitrage3" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4.4</strong></span> Using the result of the previous exercise, repeat <a href="#exr-binomialcall" class="quarto-xref">Exercise&nbsp;<span>4.2</span></a> for a put option using all four pricing methods.</p>
</div>
</section>
<section id="two-period-and-multi-period-exercises" class="level4">
<h4 class="anchored" data-anchor-id="two-period-and-multi-period-exercises">Two-Period and Multi-Period Exercises</h4>
<div id="exr-trees-visual" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4.5</strong></span> Modify the visual tree code to create a two-period tree for an American put option with <span class="math inline">\(S_0 = 100\)</span>, <span class="math inline">\(K = 105\)</span>, <span class="math inline">\(r = 0.05\)</span>, <span class="math inline">\(\sigma = 0.3\)</span>, and <span class="math inline">\(T = 0.5\)</span>. At each intermediate node, show both the continuation value and the immediate exercise value, highlighting when early exercise is optimal.</p>
</div>
<div id="exr-trees-algorithm" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4.6</strong></span> Compare the detailed backward induction algorithm with the fast vectorized version for pricing American options. Time both implementations for <span class="math inline">\(N = 50, 100, 200, 500\)</span> time steps. At what point does the speed difference become significant? Verify that both give identical results.</p>
</div>
<div id="exr-trees2" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4.7</strong></span> Show that in the Cox-Ross-Rubinstein model, the expected return on the stock under the risk-neutral measure equals the risk-free rate: <span class="math inline">\(\mathbb{E}^p[S_{t+\Delta t}/S_t] = \mathrm{e}^{r\Delta t}\)</span></p>
</div>
</section>
<section id="parameter-calibration-and-convergence" class="level4">
<h4 class="anchored" data-anchor-id="parameter-calibration-and-convergence">Parameter Calibration and Convergence</h4>
<div id="exr-binomial1" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4.8</strong></span> Consider an at-the-money European call option on a dividend-reinvested stock with six months to maturity. Take the initial stock price to be $50, the interest rate to be 5% and <span class="math inline">\(\sigma = 30\%\)</span>. Compute the value in a binomial model with <span class="math inline">\(N = 10, 11, \ldots, 30\)</span> and plot the values against <span class="math inline">\(N\)</span>. Is convergence monotone? Comment on the oscillations you observe.</p>
</div>
<div id="exr-binomial2" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4.9</strong></span> Consider the same option as in the previous problem. Roughly what value of <span class="math inline">\(N\)</span> is needed to get penny accuracy? (To evaluate the accuracy, compare the price to the price given by the Black-Scholes formula.)</p>
</div>
<div id="exr-trees4" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4.10</strong></span> Compare the convergence of European option prices using: a) Cox-Ross-Rubinstein parameters: <span class="math inline">\(u = e^{\sigma\sqrt{\Delta t}}\)</span>, <span class="math inline">\(d = 1/u\)</span> b) Jarrow-Rudd parameters: <span class="math inline">\(p = 1/2\)</span>, adjust <span class="math inline">\(u\)</span> and <span class="math inline">\(d\)</span> to match moments</p>
<p>Plot the option values against the number of time steps <span class="math inline">\(N\)</span> for both methods. Which converges faster? Which is more stable?</p>
</div>
<div id="exr-moment-matching" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4.11</strong></span> Verify that the Cox-Ross-Rubinstein parameters satisfy the moment-matching conditions: a) Show that <span class="math inline">\(\frac{\mathbb{E}[\Delta \log S]}{\Delta t} \to r - q - \frac{\sigma^2}{2}\)</span> as <span class="math inline">\(\Delta t \to 0\)</span> b) Show that <span class="math inline">\(\frac{\mathrm{Var}[\Delta \log S]}{\Delta t} \to \sigma^2\)</span> as <span class="math inline">\(\Delta t \to 0\)</span></p>
<p>where the expectation and variance are under the risk-neutral measure.</p>
</div>
</section>
<section id="american-options-and-early-exercise" class="level4">
<h4 class="anchored" data-anchor-id="american-options-and-early-exercise">American Options and Early Exercise</h4>
<div id="exr-binomial4" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4.12</strong></span> The early exercise premium is the difference between the value of an American option and the value of a European option with the same parameters. Compute the early exercise premium for an American put with varying: a) Interest rates (<span class="math inline">\(r = 0\%, 2\%, 5\%, 10\%\)</span>) b) Exercise prices (<span class="math inline">\(K = 80, 90, 100, 110, 120\)</span> with <span class="math inline">\(S_0 = 100\)</span>) c) Time to maturity (<span class="math inline">\(T = 0.25, 0.5, 1, 2\)</span> years)</p>
<p>Under what circumstances is the early exercise premium relatively large?</p>
</div>
<div id="exr-trees3" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4.13</strong></span> Implement a function to compute the early exercise boundary for an American put option. Plot the boundary as a function of time to maturity for different parameter values. Explain intuitively why the boundary has the shape it does.</p>
</div>
<div id="exr-optimal-exercise" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4.14</strong></span> For an American call option on a dividend-paying stock, show analytically that it may be optimal to exercise just before an ex-dividend date. Implement this in your binomial tree by adding discrete dividend payments and compare American and European call values.</p>
</div>
</section>
<section id="advanced-applications" class="level4">
<h4 class="anchored" data-anchor-id="advanced-applications">Advanced Applications</h4>
<div id="exr-shout-option" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4.15</strong></span> A shout option is an option where the holder is entitled to “shout” at any time before expiration. Upon shouting, the holder receives the immediate exercise value paid at expiration, plus an at-the-money option with the same expiration. The payoff if the holder shouts at time <span class="math inline">\(\tau\)</span> is <span class="math inline">\(\max(0, S(\tau)-K, S_T-S(\tau))\)</span> where <span class="math inline">\(K\)</span> is the original strike.</p>
<ol type="a">
<li>Show that it is better to shout at some time where <span class="math inline">\(S(\tau) &gt; K\)</span> than to never shout at all</li>
<li>Modify the backward induction algorithm to find the optimal shouting strategy</li>
<li>Plot the optimal shouting boundary</li>
</ol>
</div>
<div id="exr-barrier-option" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4.16</strong></span> A down-and-out barrier option is a call option that becomes worthless if the stock price ever falls below a barrier <span class="math inline">\(B &lt; S_0\)</span>. Modify the binomial tree algorithm to price such options by setting the option value to zero at any node where <span class="math inline">\(S \leq B\)</span>. Compare the barrier option price to a standard call for different barrier levels.</p>
</div>
<div id="exr-trinomial" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 4.17</strong></span> Extend the binomial model to a trinomial model with three possible moves at each step: up by factor <span class="math inline">\(u\)</span>, stay the same, or down by factor <span class="math inline">\(d\)</span>. a) Derive the risk-neutral probabilities <span class="math inline">\(p_u\)</span>, <span class="math inline">\(p_m\)</span>, <span class="math inline">\(p_d\)</span> for the three states b) Implement trinomial backward induction c) Compare trinomial and binomial convergence for the same <span class="math inline">\(\Delta t\)</span></p>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-CRR" class="csl-entry" role="listitem">
Cox, J., S. Ross, and M. Rubinstein. 1979. <span>“Option Pricing: A Simplified Approach.”</span> <em>Journal of Financial Economics</em> 7: 229–63.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Chapter_IntroFutures.html" class="pagination-link" aria-label="Futures Markets">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Futures Markets</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Chapter_BrownianMotion.html" class="pagination-link" aria-label="Brownian Motion">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Brownian Motion</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions"><ul><li><a href="https://github.com/math-finance-book/book-published-code.git/blob/main/Chapter_Trees.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div></div></footer></body></html>