<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Pricing and Hedging Derivative Securities - 3&nbsp; Black-Scholes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Chapter4.html" rel="next">
<link href="./Chapter2.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter3.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Black-Scholes</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Pricing and Hedging Derivative Securities</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Asset Pricing Basics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Continuous-Time Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Black-Scholes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Estimating and Modelling Volatility</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Monte Carlo\ and Binomial Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Foreign Exchange</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Forward, Futures, and Exchange Options</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Exotic Options</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">More on Monte Carlo and Binomial Valuation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Finite Difference Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Fixed Income Concepts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to Fixed Income Derivatives</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Valuing Derivatives in the Extended Vasicek Model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">A Brief Survey of Term Structure Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./AppendixB.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Miscellaneous Facts about Continuous-Time Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-s_digitals" id="toc-sec-s_digitals" class="nav-link active" data-scroll-target="#sec-s_digitals"><span class="header-section-number">3.1</span> Digital Options</a></li>
  <li><a href="#sec-s_sharedigitals" id="toc-sec-s_sharedigitals" class="nav-link" data-scroll-target="#sec-s_sharedigitals"><span class="header-section-number">3.2</span> Share Digitals</a></li>
  <li><a href="#sec-s_blackscholes" id="toc-sec-s_blackscholes" class="nav-link" data-scroll-target="#sec-s_blackscholes"><span class="header-section-number">3.3</span> Puts and Calls</a></li>
  <li><a href="#greeks" id="toc-greeks" class="nav-link" data-scroll-target="#greeks"><span class="header-section-number">3.4</span> Greeks</a></li>
  <li><a href="#sec-s_deltahedging" id="toc-sec-s_deltahedging" class="nav-link" data-scroll-target="#sec-s_deltahedging"><span class="header-section-number">3.5</span> Delta Hedging</a></li>
  <li><a href="#sec-s_gammahedging" id="toc-sec-s_gammahedging" class="nav-link" data-scroll-target="#sec-s_gammahedging"><span class="header-section-number">3.6</span> Gamma Hedging</a></li>
  <li><a href="#sec-s_impliedvolatility" id="toc-sec-s_impliedvolatility" class="nav-link" data-scroll-target="#sec-s_impliedvolatility"><span class="header-section-number">3.7</span> Implied Volatilities</a></li>
  <li><a href="#sec-s_timevaryingvolatility" id="toc-sec-s_timevaryingvolatility" class="nav-link" data-scroll-target="#sec-s_timevaryingvolatility"><span class="header-section-number">3.8</span> Term Structure of Volatility</a></li>
  <li><a href="#sec-s_smiles" id="toc-sec-s_smiles" class="nav-link" data-scroll-target="#sec-s_smiles"><span class="header-section-number">3.9</span> Smiles and Smirks</a></li>
  <li><a href="#sec-s_blackscholes_vba" id="toc-sec-s_blackscholes_vba" class="nav-link" data-scroll-target="#sec-s_blackscholes_vba"><span class="header-section-number">3.10</span> Calculations in VBA</a>
  <ul class="collapse">
  <li><a href="#black-scholes-call-and-put-formulas" id="toc-black-scholes-call-and-put-formulas" class="nav-link" data-scroll-target="#black-scholes-call-and-put-formulas">Black-Scholes Call and Put Formulas</a></li>
  <li><a href="#black-scholes-greeks" id="toc-black-scholes-greeks" class="nav-link" data-scroll-target="#black-scholes-greeks">Black-Scholes Greeks</a></li>
  <li><a href="#implied-volatilities" id="toc-implied-volatilities" class="nav-link" data-scroll-target="#implied-volatilities">Implied Volatilities</a></li>
  <li><a href="#discretely-rebalanced-delta-hedges" id="toc-discretely-rebalanced-delta-hedges" class="nav-link" data-scroll-target="#discretely-rebalanced-delta-hedges">Discretely-Rebalanced Delta Hedges</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">3.11</span> Exercises</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-c_blackscholes" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Black-Scholes</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In this chapter, we will study the value of European digital and share digital options and standard European puts and calls under the Black-Scholes assumptions. We will also explain how to calculate implied volatilities and the option Greeks. The Black-Scholes assumptions are that the underlying asset pays a constant dividend yield <span class="math inline">\(q\)</span> and has price <span class="math inline">\(S\)</span> satisfying <span id="eq-bs1"><span class="math display">\[
\frac{\mathrm{d} S}{S} = \mu\,\mathrm{d} t + \sigma\,\mathrm{d} B
\tag{3.1}\]</span></span></p>
<p>for a Brownian motion B. Here <span class="math inline">\(\sigma\)</span> is assumed to be constant (though we will allow it to vary in a non-random way at the end of the chapter) and <span class="math inline">\(\mu\)</span> can be a quite general random process. It is also assumed that there is a constant continuously-compounded risk-free rate~<span class="math inline">\(r\)</span>.</p>
<p>Under these assumptions, we will complete the discussion of <a href="Chapter1.html#sec-s_introoptions"><span>Section&nbsp;1.5</span></a> to derive option pricing formulas. Recall that, to price a European call option, all that remains to be done is to calculate the probabilities of the option finishing in the money when we use the risk-free asset and the underlying asset as numeraires. We will do this using the results of <a href="Chapter2.html#sec-s_girsanov"><span>Section&nbsp;2.9</span></a>. As in <a href="Chapter1.html#sec-s_introoptions"><span>Section&nbsp;1.5</span></a>, we will approach the pricing of call and put options by first considering their basic building blocks: digitals and share digitals.</p>
<section id="sec-s_digitals" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-s_digitals"><span class="header-section-number">3.1</span> Digital Options</h2>
<p>A digital (or binary) option pays a fixed amount in a certain event and zero otherwise. Consider a digital that pays $1 at date <span class="math inline">\(T\)</span> if <span class="math inline">\(S(T)&gt;K\)</span>, where <span class="math inline">\(K\)</span> is a number that is fixed by the contract. This means that the digital pays <span class="math inline">\(x\)</span> dollars at date <span class="math inline">\(T\)</span> where <span class="math inline">\(x\)</span> is defined as <span class="math display">\[\begin{equation*}
x =  \begin{cases} 1 &amp; \text{if $S(T)&gt;K$}\; ,\\
0 &amp; \text{otherwise}\;.
\end{cases}
\end{equation*}\]</span> Using the risk-neutral pricing <a href="Chapter1.html#eq-riskneutralformula">Equation&nbsp;<span>1.31</span></a>, the value of the digital at date~0 is <span class="math inline">\(\mathrm{e}^{-rT}E^R[x]\)</span>. Note that <span class="math display">\[\begin{align*}
E^R[x] \;&amp;=\; 1 \times \text{prob}^R(x=1)\; + \;0 \times \text{prob}^R(x\!\!=\!\!0) \\
\;&amp;=\; \text{prob}^R(x=1)\\
\;&amp;=\; \text{prob}^R\big(S(T) &gt; K\big)\;.
\end{align*}\]</span> So we need to calculate this probability of the digital finishing in the money.</p>
<p>In <a href="Chapter2.html#sec-s_girsanov"><span>Section&nbsp;2.9</span></a>—see <a href="Chapter2.html#eq-riskneutral11">Equation&nbsp;<span>2.31</span></a>—we learned that under the Black-Scholes assumption <a href="#eq-bs1">Equation&nbsp;<span>3.1</span></a> we have <span class="math display">\[\frac{\mathrm{d} S}{S} =( r-q)\,\mathrm{d} t+\sigma\,\mathrm{d} B^*\; ,\]</span> where <span class="math inline">\(B^*\)</span> is a Brownian motion under the risk-neutral measure.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> on the volatility coefficients and on <span class="math inline">\(B\)</span> and <span class="math inline">\(B^*\)</span> to distinguish the Brownian motion driving <span class="math inline">\(S\)</span> from the Brownian motion driving <span class="math inline">\(Y\)</span> and to distinguish their volatilities are not needed here. In <a href="Chapter2.html#sec-s_geometricbrownianmotion"><span>Section&nbsp;2.8</span></a>, we observed that this is equivalent to <span class="math display">\[\mathrm{d} \log S = \left(r-q-\frac{1}{2}\sigma^2\right)\,\mathrm{d} t + \sigma\,\mathrm{d} B^*\; .\]</span> Now using the formulas <a href="Chapter2.html#eq-tailprob01">Equation&nbsp;<span>2.38</span></a>–<a href="Chapter2.html#eq-tailprob3">Equation&nbsp;<span>2.39</span></a>, with <span class="math inline">\(\alpha = r-q-\sigma^2/2\)</span>, we have <span class="math inline">\(\text{prob}^R\big(S(T) &gt; K\big) = \mathrm{N}(d_2)\)</span> where <span id="eq-digital_d2"><span class="math display">\[
d_2 = \frac{\log\left(\frac{S(0)}{K}\right)+\left(r-q-\frac{1}{2}\sigma^2\right)T}{\sigma\sqrt{T}}\;.
\tag{3.2}\]</span></span></p>
<p>The notation <span class="math inline">\(d_2\)</span> is standard notation from the Black-Scholes formula, and we use it—rather than a simple <span class="math inline">\(d\)</span>—to distinguish the number <a href="#eq-digital_d2">Equation&nbsp;<span>3.2</span></a> from a similar number—to be called <span class="math inline">\(d_1\)</span> of course—that we will see in the next section.<br>
We conclude:</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">

</div>
</div>
<div class="callout-body-container callout-body">
<p>The value of a digital option that pays $1 when <span class="math inline">\(S(T)&gt;K\)</span> is <span class="math inline">\(\mathrm{e}^{-rT}\mathrm{N}(d_2)\)</span>, where <span class="math inline">\(d_2\)</span> is defined in <a href="#eq-digital_d2">Equation&nbsp;<span>3.2</span></a>.</p>
</div>
</div>
<p>Consider now a digital that pays when the underlying asset price is low; i.e., consider a security that pays <span class="math inline">\(y\)</span> dollars at date <span class="math inline">\(T\)</span> where <span class="math display">\[\begin{equation*}
y =  \begin{cases} 1 &amp; \text{if $S(T)&lt;K$}\; ,\\
0 &amp; \text{otherwise}\;.
\end{cases}
\end{equation*}\]</span> Using risk-neutral pricing again, the value of this digital at date 0 is <span class="math display">\[\mathrm{e}^{-rT}E^R[y] = \mathrm{e}^{-rT}\text{prob}^R(y=1) = \mathrm{e}^{-rT}\text{prob}^R\big(S(T)&lt;K\big)\; .\]</span> From this fact and <a href="Chapter2.html#eq-tailprob02">Equation&nbsp;<span>2.40</span></a>, we conclude:</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">

</div>
</div>
<div class="callout-body-container callout-body">
<p>The value of a digital option that pays $1 when <span class="math inline">\(S(T)&lt;K\)</span> is <span class="math inline">\(\mathrm{e}^{-rT}\mathrm{N}(-d_2)\)</span>, where <span class="math inline">\(d_2\)</span> is defined in <a href="#eq-digital_d2">Equation&nbsp;<span>3.2</span></a>.</p>
</div>
</div>
</section>
<section id="sec-s_sharedigitals" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sec-s_sharedigitals"><span class="header-section-number">3.2</span> Share Digitals</h2>
<p>Consider a derivative security that pays one share of the underlying asset at date <span class="math inline">\(T\)</span> if <span class="math inline">\(S(T)&gt;K\)</span> and pays zero otherwise. This is called a share digital. As before, let <span class="math display">\[\begin{equation*}
x =  \begin{cases} 1 &amp; \text{if $S(T)&gt;K$}\; ,\\
0 &amp; \text{otherwise}\;.
\end{cases}
\end{equation*}\]</span> Then the payoff of the share digital at date <span class="math inline">\(T\)</span> is <span class="math inline">\(xS(T)\)</span>. Let <span class="math inline">\(Y(t)\)</span> denote the value of this claim for <span class="math inline">\(0\leq t\leq T\)</span>. We have <span class="math inline">\(Y(T)=xS(T)\)</span> and we want to find <span class="math inline">\(Y(0)\)</span>.</p>
<p>From <a href="Chapter2.html#sec-s_reinvestingdividends"><span>Section&nbsp;2.7</span></a>, we know that <span class="math inline">\(V(t)=\mathrm{e}^{qt}S(t)\)</span> is the price of a non-dividend-paying portfolio. From our fundamental pricing <a href="Chapter1.html#eq-formula">Equation&nbsp;<span>1.29</span></a>, using <span class="math inline">\(V\)</span> as the numeraire, we have <span class="math display">\[\begin{align*}
Y(0) &amp;= S(0) E^V \left[\frac{Y(T)}{\mathrm{e}^{q T}S(T)}\right]\\
&amp;=\mathrm{e}^{-q T}S(0)E^V [x]\;.
\end{align*}\]</span> As in the previous section, <span class="math inline">\(E^V[x] = \text{prob}^V\!(x=1)\)</span>, so we need to compute this probability of the option finishing in the money.</p>
<p>We follow the same steps as in the previous section. From <a href="Chapter2.html#eq-own11">Equation&nbsp;<span>2.32</span></a> we have <span class="math display">\[
\frac{\mathrm{d} S}{S} = (r-q+ \sigma^2)\,\mathrm{d} t+\sigma\,\mathrm{d} B^*,
\]</span> where now <span class="math inline">\(B^*\)</span> denotes a Brownian motion when <span class="math inline">\(V\)</span> is the numeraire. This is equivalent to <span id="eq-new5"><span class="math display">\[
\mathrm{d} \log S = \left(r-q+\frac{1}{2}\sigma^2\right)\,\mathrm{d} t + \sigma \,\mathrm{d} B^*\;.
\tag{3.3}\]</span></span></p>
<p>Thus, from the formulas <a href="Chapter2.html#eq-tailprob01">Equation&nbsp;<span>2.38</span></a>–<a href="Chapter2.html#eq-tailprob3">Equation&nbsp;<span>2.39</span></a>, with <span class="math inline">\(\alpha = r-q+\sigma^2/2\)</span>, we have <span class="math display">\[\text{prob}^V\!\big(S(T)&gt;K\big) = \mathrm{N}(d_1)\; ,\]</span> where <span id="eq-sharedigital_d1"><span class="math display">\[
d_1 = \frac{\log\left(\frac{S(0)}{K}\right)+\left(r-q+\frac{1}{2}\sigma^2\right)T}{\sigma\sqrt{T}}\;.
\tag{3.4}\]</span></span></p>
<p>This implies:</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">

</div>
</div>
<div class="callout-body-container callout-body">
<p>The value of a share digital that pays one share when <span class="math inline">\(S(T)&gt;K\)</span> is <span class="math inline">\(\mathrm{e}^{-q T}S(0)\mathrm{N}(d_1)\)</span>, where <span class="math inline">\(d_1\)</span> is defined in <a href="#eq-sharedigital_d1">Equation&nbsp;<span>3.4</span></a>.</p>
</div>
</div>
<p>Consider now a share digital that pays one share of the stock at date <span class="math inline">\(T\)</span> if <span class="math inline">\(S(T)&lt;K\)</span>. Letting <span class="math display">\[\begin{equation*}
y =  \begin{cases} 1 &amp; \text{if $S(T)&lt;K$}\; ,\\
0 &amp; \text{otherwise}\;,
\end{cases}
\end{equation*}\]</span> the payoff of this option is <span class="math inline">\(yS(T)\)</span>. Its value at date 0 is <span class="math display">\[\begin{align*}
\mathrm{e}^{-q T}S(0)E^V [y] &amp;= \mathrm{e}^{-q T}S(0)\times\text{prob}^V\!(y=1) \\
&amp;= \mathrm{e}^{-q T}S(0)\times\text{prob}^V\!\big(S(T)&lt;K\big)\; ,
\end{align*}\]</span> and from <a href="Chapter2.html#eq-tailprob02">Equation&nbsp;<span>2.40</span></a> we have <span class="math display">\[\text{prob}^V\!\big(S(T)&lt;K\big) = \mathrm{N}(-d_1)\; .\]</span> We conclude:</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">

</div>
</div>
<div class="callout-body-container callout-body">
<p>The value of a share digital that pays one share when <span class="math inline">\(S(T)&lt;K\)</span> is <span class="math inline">\(\mathrm{e}^{-q T}S(0)\mathrm{N}(-d_1)\)</span>, where <span class="math inline">\(d_1\)</span> is defined in <a href="#eq-sharedigital_d1">Equation&nbsp;<span>3.4</span></a>.</p>
</div>
</div>
</section>
<section id="sec-s_blackscholes" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="sec-s_blackscholes"><span class="header-section-number">3.3</span> Puts and Calls</h2>
<p>A European call option pays <span class="math inline">\(S(T)-K\)</span> at date <span class="math inline">\(T\)</span> if <span class="math inline">\(S(T)&gt;K\)</span> and 0 otherwise. Again letting <span class="math display">\[\begin{equation*}
x =  \begin{cases} 1 &amp; \text{if $S(T)&gt;K$}\; ,\\
0 &amp; \text{otherwise}\;,
\end{cases}
\end{equation*}\]</span> the payoff of the call can be written as <span class="math inline">\(xS(T)-xK\)</span>. This is equivalent to one share digital minus <span class="math inline">\(K\)</span> digitals, with the digitals paying in the event that <span class="math inline">\(S(T)&gt;K\)</span>. The share digital is worth <span class="math inline">\(\mathrm{e}^{-q T}S(0)\mathrm{N}(d_1)\)</span> at date 0 and each digital is worth <span class="math inline">\(\mathrm{e}^{-rT}\mathrm{N}(d_2)\)</span>. Note that equations <a href="#eq-digital_d2">Equation&nbsp;<span>3.2</span></a> and <a href="#eq-sharedigital_d1">Equation&nbsp;<span>3.4</span></a> for <span class="math inline">\(d_1\)</span> and <span class="math inline">\(d_2\)</span> imply <span class="math inline">\(d_2 = d_1-\sigma{\sqrt{T}}\)</span>. Therefore, combining the results of the previous two sections yields the Black-Scholes formula: </p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">

</div>
</div>
<div class="callout-body-container callout-body">
<p>The value of a European call option at date 0 is <span id="eq-blackscholescall"><span class="math display">\[
\mathrm{e}^{-q T}S(0)\mathrm{N}(d_1)-\mathrm{e}^{-rT}K\mathrm{N}(d_2)\;,
\tag{3.5}\]</span></span></p>
<p>where <span class="math inline">\(d_1\)</span> is defined in <a href="#eq-sharedigital_d1">Equation&nbsp;<span>3.4</span></a> and <span class="math inline">\(d_2 = d_1-\sigma{\sqrt{T}}\)</span>.</p>
</div>
</div>
<p>A European put option pays <span class="math inline">\(K-S(T)\)</span> at date <span class="math inline">\(T\)</span> if <span class="math inline">\(S(T)&lt;K\)</span> and 0 otherwise. As before, let <span class="math display">\[\begin{equation*}
y =  \begin{cases} 1 &amp; \text{if $S(T)&lt;K$}\; ,\\
0 &amp; \text{otherwise}\;.
\end{cases}
\end{equation*}\]</span> The payoff of the put option is <span class="math inline">\(yK-yS(T)\)</span>. This is equivalent to <span class="math inline">\(K\)</span> digitals minus one share digital, all of the digitals paying when <span class="math inline">\(S(T)&lt;K\)</span>. Thus, we have:</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">

</div>
</div>
<div class="callout-body-container callout-body">
<p>The value of a European put option at date 0 is <span id="eq-blackscholesput"><span class="math display">\[
\mathrm{e}^{-rT}K\mathrm{N}(-d_2)-\mathrm{e}^{-q T}S(0)\mathrm{N}(-d_1)\;,
\tag{3.6}\]</span></span></p>
<p>where <span class="math inline">\(d_1\)</span> is defined in <a href="#eq-sharedigital_d1">Equation&nbsp;<span>3.4</span></a> and <span class="math inline">\(d_2 = d_1-\sigma{\sqrt{T}}\)</span>.</p>
</div>
</div>
<p>Again, this is the Black-Scholes formula.</p>
<p>The values of the European put and call satisfy put-call parity, and we can also find one from the other by^[The put-call parity relation follows from the fact that both the left and the right-hand sides are the prices of portfolios that have value <span class="math inline">\(\max(S(T),K)\)</span> at the maturity of the option. To see this for the left-hand side, note that <span class="math inline">\(\mathrm{e]^{-rT}K\)</span> is sufficient cash to accumulate to <span class="math inline">\(K\)</span> at date <span class="math inline">\(T\)</span>, allowing exercise of the call when it is in the money and retention of the cash <span class="math inline">\(K\)</span> otherwise. For the right-hand side, note that <span class="math inline">\(\mathrm{e}^{-q T}S(0)\)</span> is enough cash to buy <span class="math inline">\(\mathrm{e}^{-q T}\)</span> shares of the stock at date 0 which, with reinvestment of dividends, will accumulate to one share at date <span class="math inline">\(T\)</span>, enabling exercise of the put if it is in the money or retention of the share otherwise.} <span id="eq-putcallparity11"><span class="math display">\[
\mathrm{e}^{-rT}K + \text{Call Price} = \mathrm{e}^{-q T}S(0)+ \text{Put Price}\;.
\tag{3.7}\]</span></span></p>
</section>
<section id="greeks" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="greeks"><span class="header-section-number">3.4</span> Greeks</h2>
<p>The derivatives (calculus derivatives, not financial derivatives!) of an option pricing formula with respect to the inputs are commonly called Greeks. The most important Greek is the option delta. This measures the sensitivity of the option value to changes in the value of the underlying asset. The following table shows the standard Greeks, with reference to the Black-Scholes pricing formula.</p>
<p> The second line of the above shows <span class="math inline">\(\delta\)</span> as an input.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> Of course, it is not an input but instead is calculated. Gamma, the derivative of <span class="math inline">\(\delta\)</span>, is the second derivative of the option price with respect to the underlying asset price. The reason for calculating <span class="math inline">\(\Theta\)</span> as the derivative with respect to <span class="math inline">\(-T\)</span> instead of <span class="math inline">\(T\)</span> is that the time-to-maturity <span class="math inline">\(T\)</span> decreasing (<span class="math inline">\(-T\)</span> increasing) is equivalent to time passing, so <span class="math inline">\(\Theta\)</span> measures the change in the option value when time passes.</p>
<p>We can calculate these from the Black-Scholes formula using the chain rule from differential calculus. The derivative of the normal distribution function~<span class="math inline">\(\mathrm{N}\)</span> is the normal density function <span class="math inline">\(\mathrm{n}d\)</span> defined as <span class="math display">\[\mathrm{n}d(d) = \frac{1}{\sqrt{2\pi}}\mathrm{e}^{-d^2/2}\; .\]</span> One can easily verify directly that <span id="eq-greeksimplify"><span class="math display">\[
\mathrm{e}^{-q T}S\mathrm{n}d(d_1)=\mathrm{e}^{-rT}K\mathrm{n}d(d_2)\;,
\tag{3.8}\]</span></span></p>
<p>which simplifies the calculations for the Black-Scholes call option pricing formula. For this formula, the Greeks are as follows: <span class="math display">\[\begin{align*}
\delta &amp;= \mathrm{e}^{-q T}\mathrm{N}(d_1) + \mathrm{e}^{-q T}S\mathrm{n}d(d_1)\frac{\partial d_1}{\partial S} -\mathrm{e}^{-rT}K\mathrm{n}d(d_2)\frac{\partial d_2}{\partial S}\\
&amp;= \mathrm{e}^{-q T}\mathrm{N}(d_1) + \mathrm{e}^{-q T}S\mathrm{n}d(d_1)\left(\frac{\partial d_1}{\partial S}-\frac{\partial d_2}{\partial S}\right)\\
&amp;=\mathrm{e}^{-q T}\mathrm{N}(d_1)\;,\\
\Gamma &amp;=\mathrm{e}^{-q T}\mathrm{n}d(d_1)\frac{\partial d_1}{\partial S}= \mathrm{e}^{-q T}\mathrm{n}d(d_1)\frac{1}{S\sigma\sqrt{T}}\;,
\end{align*}\]</span> <span class="math display">\[\begin{align*}
\Theta &amp;=-\mathrm{e}^{-q T}S\mathrm{n}d(d_1)\frac{\partial d_1}{\partial T} +q \mathrm{e}^{-q T}S\mathrm{N}(d_1) \\
&amp;\quad + \mathrm{e}^{-rT}K\mathrm{n}d(d_2)\frac{\partial d_2}{\partial T} -r\mathrm{e}^{-rT}K\mathrm{N}(d_2)\\
&amp;=\mathrm{e}^{-q T}S\mathrm{n}d(d_1)\left(\frac{\partial d_2}{\partial T}-\frac{\partial d_1}{\partial T}\right)\\
&amp;\quad + q \mathrm{e}^{-q T}S\mathrm{N}(d_1)-r\mathrm{e}^{-rT}K\mathrm{N}(d_2)\\
&amp;=-\mathrm{e}^{-q T}S\mathrm{n}d(d_1)\frac{\sigma}{2\sqrt{T}}+ q \mathrm{e}^{-q T}S\mathrm{N}(d_1)-r\mathrm{e}^{-rT}K\mathrm{N}(d_2)\;,\\
\cal{V}&amp;=\mathrm{e}^{-q T}S\mathrm{n}d(d_1)\frac{\partial d_1}{\partial \sigma} - \mathrm{e}^{-rT}K\mathrm{n}d(d_2)\frac{\partial d_2}{\partial \sigma}\\
&amp;=\mathrm{e}^{-q T}S\mathrm{n}d(d_1)\left(\frac{\partial d_1}{\partial \sigma}-\frac{\partial d_2}{\partial \sigma}\right)\\
&amp;=\mathrm{e}^{-q T}S\mathrm{n}d(d_1)\sqrt{T}\;,\\
\rho &amp;=\mathrm{e}^{-q T}S\mathrm{n}d(d_1)\frac{\partial d_1}{\partial r} - \mathrm{e}^{-rT}K\mathrm{n}d(d_2)\frac{\partial d_2}{\partial r} +T\mathrm{e}^{-rT}K\mathrm{N}(d_2)\\
&amp;=\mathrm{e}^{-q T}S\mathrm{n}d(d_1)\left(\frac{\partial d_1}{\partial r}-\frac{\partial d_2}{\partial r}\right)+T\mathrm{e}^{-rT}K\mathrm{N}(d_2)\\
&amp;=T\mathrm{e}^{-rT}K\mathrm{N}(d_2)\;.
\end{align*}\]</span></p>
<p>We can calculate the Greeks of a European put option from the call option Greeks and put-call parity: <span class="math display">\[\text{Put Price} = \text{Call Price} +\mathrm{e}^{-rT}K- \mathrm{e}^{-q T}S(0)\; .\]</span> For example, the delta of a put is the delta of a call (with the same strike and maturity) minus <span class="math inline">\(\mathrm{e}^{-q T}\)</span>, and the gamma of a put is the same as the gamma of the corresponding call.</p>
</section>
<section id="sec-s_deltahedging" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="sec-s_deltahedging"><span class="header-section-number">3.5</span> Delta Hedging</h2>
<p>The ability to create a fully hedged (risk-free) portfolio of the stock and an option is the essence of the arbitrage argument underlying the Black-Scholes formula, as we saw in <a href="Chapter1.html"><span>Chapter&nbsp;1</span></a> for the binomial model. For a call option, such a portfolio consists of delta shares of the underlying asset and a short call option, or a short position of delta shares of the underlying and a long call option. These portfolios have no instantaneous exposure to the price of the underlying. To create a perfect hedge, the portfolio must be adjusted continuously, because the delta changes when the price of the underlying changes and when time passes. In practice, any hedge will therefore be imperfect, even if the assumptions of the model are satisfied.</p>
<p>We first consider the continuous-time hedging argument. Consider a European call option with maturity <span class="math inline">\(T\)</span>, and let <span class="math inline">\(C(S,t)\)</span> denote the value of the option at date <span class="math inline">\(t&lt;T\)</span> when the stock price is <span class="math inline">\(S\)</span> at date <span class="math inline">\(t\)</span>. Consider a portfolio that is short one call option and long <span class="math inline">\(\delta\)</span> shares of the underlying asset and that has a (short) cash position equal to <span class="math inline">\(C-\delta S\)</span>. This portfolio has zero value at date <span class="math inline">\(t\)</span>.</p>
<p>The change in the value of the portfolio in an instant <span class="math inline">\(\mathrm{d} t\)</span> is <span id="eq-changeportfoliovalue"><span class="math display">\[
-\mathrm{d} C + \delta \,\mathrm{d} S + q \delta S\,\mathrm{d} t+(C-\delta S)r\,\mathrm{d} t\;.
\tag{3.9}\]</span></span></p>
<p>The first term reflects the change in the value of the option, the second term is the capital gain or loss on <span class="math inline">\(\delta\)</span> shares of stock, the third term is the dividends received on <span class="math inline">\(\delta\)</span> shares of stock, and the fourth term is the interest expense on the short cash position.</p>
<p>On the other hand, we know from Ito’s formula that</p>
<p><span class="math display">\[
\mathrm{d} C = \frac{\partial C}{\partial S}\,\mathrm{d} S + \frac{\partial C}{\partial t}\,\mathrm{d} t + \frac{1}{2}\frac{\partial^2C}{\partial S^2} (\mathrm{d} S)^2  
\]</span> <span id="eq-changeportfoliovalue2"><span class="math display">\[
= \delta \,\mathrm{d} S + \Theta \,\mathrm{d} t + \frac{1}{2}\Gamma \sigma^2S^2\,\mathrm{d} t\;.
\tag{3.10}\]</span></span></p>
<p>Substituting <a href="#eq-changeportfoliovalue2">Equation&nbsp;<span>3.10</span></a> into <a href="#eq-changeportfoliovalue">Equation&nbsp;<span>3.9</span></a> shows that the change in the value of the portfolio is <span id="eq-hedgeprofits"><span class="math display">\[
-\Theta \,\mathrm{d} t - \frac{1}{2}\Gamma \sigma^2S^2\,\mathrm{d} t+ q \delta S\,\mathrm{d} t+(C-\delta S)r\,\mathrm{d} t\;.
\tag{3.11}\]</span></span></p>
<p>Several aspects of this are noteworthy. First, as noted earlier, the delta hedge (being long <span class="math inline">\(\delta\)</span> shares of the underlying) eliminates the exposure to changes in the price of the underlying—there is no <span class="math inline">\(\mathrm{d} S\)</span> term in <a href="#eq-hedgeprofits">Equation&nbsp;<span>3.11</span></a>. Second, <span class="math inline">\(\Theta\)</span> will be negative, because it captures the time decay in the option value; being short the option means the portfolio will profit from time decay at rate <span class="math inline">\(-\Theta\)</span>. Third, this portfolio is short gamma. We can also say it is short convexity, the term convexity referring to the convex shape of the option value as a function of the price of the underlying, which translates mathematically to a positive second derivative (gamma). The volatility in the stock makes convexity valuable, and a portfolio that is short convexity will suffer losses. Finally, the portfolio is earning dividends but paying interest.</p>
<p>It is straightforward to check, from the definitions of <span class="math inline">\(\Theta\)</span>, <span class="math inline">\(\Gamma\)</span> and <span class="math inline">\(\delta\)</span> in the preceding section, that the sum of the terms in <a href="#eq-hedgeprofits">Equation&nbsp;<span>3.11</span></a> is zero. The time decay in the option value and dividends received on the shares of the underlying exactly offset the losses due to convexity and interest. Therefore, the delta hedge is a perfect hedge. The portfolio, which has a zero cost, neither earns nor loses money. This is true not only on average but for every possible change in the stock price.</p>
<p>To see how well this works with only discrete adjustments to the hedge, one can simulate the changes in <span class="math inline">\(S\)</span> over time and sum the gains and losses over discrete rebalancing periods. One should input the actual (not risk-neutral) expected rate of return on the asset to compute the actual distribution of gains and losses. This is discussed further in <a href="#sec-s_blackscholes_vba"><span>Section&nbsp;3.10</span></a>.</p>
</section>
<section id="sec-s_gammahedging" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="sec-s_gammahedging"><span class="header-section-number">3.6</span> Gamma Hedging</h2>
<p>To attempt to improve the performance of a discretely rebalanced delta hedge, one can use another option to create a portfolio that is both delta and gamma neutral. Being delta neutral means hedged as in the previous section—the portfolio value has no exposure to changes in the underlying asset price. In other words, it means that the derivative of the portfolio value with respect to the price of the underlying (the portfolio delta) is zero. Being gamma neutral means that the delta of the portfolio has no exposure to changes in the underlying price, which is equivalent to the second derivative of the portfolio value with respect to the price of the underlying (the portfolio gamma) being zero. If the delta truly did not change, then there would be no need to rebalance continuously, and hence no hedging error introduced by only adjusting the portfolio at discrete times rather than continuously. However, there is certainly no guarantee that a discretely-rebalanced delta/gamma hedge will perform better than a discretely rebalanced delta hedge. </p>
<p>A delta/gamma hedge can be constructed as follows. Suppose we have written (shorted) a call option and we want to hedge both the delta and gamma using the underlying asset and another option, for example, another call option with a different strike. In practice, one would want to use a liquid option for this purpose, which typically means that the strike of the option will be near the current value of the underlying (i.e., the option used to hedge would be approximately at the money).</p>
<p>Let <span class="math inline">\(\delta\)</span> and <span class="math inline">\(\Gamma\)</span> denote the delta and gamma of the written option and let <span class="math inline">\(\delta'\)</span> and <span class="math inline">\(\Gamma'\)</span> denote the delta and gamma of the option used to hedge. Consider holding <span class="math inline">\(a\)</span> of shares of the stock and <span class="math inline">\(b\)</span> units of the option used to hedge in conjunction with the short option. The delta of the stock is one (<span class="math inline">\(\mathrm{d} S/\mathrm{d} S = 1\)</span>), so to obtain a zero portfolio delta we need</p>
<p><span id="eq-portfoliodelta"><span class="math display">\[
0 = - \delta + a + b\delta'.
\tag{3.12}\]</span></span></p>
<p>The gamma of the stock is zero (<span class="math inline">\(\mathrm{d}^2 S/\mathrm{d} S^2 = d\,1/\mathrm{d} S = 0\)</span>), so to obtain a zero portfolio gamma we need</p>
<p><span id="eq-portfoliogamma"><span class="math display">\[
0 = - \Gamma + b\Gamma'\;.
\tag{3.13}\]</span></span></p>
<p>Equation <a href="#eq-portfoliogamma">Equation&nbsp;<span>3.13</span></a> shows that we should hold enough of the second option to neutralize the gamma of the option we have shorted; i.e., <span class="math display">\[\
b= \frac{\Gamma}{\Gamma'}
\]</span> Equation <a href="#eq-portfoliodelta">Equation&nbsp;<span>3.12</span></a> shows that we should use the stock to delta hedge the portfolio of options; i.e., <span class="math display">\[
a=\delta - \frac{\Gamma}{\Gamma'}\delta'\;.
\]</span></p>
</section>
<section id="sec-s_impliedvolatility" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="sec-s_impliedvolatility"><span class="header-section-number">3.7</span> Implied Volatilities</h2>
<p>All of the inputs into the option pricing formulas are in theory observable, except for the volatility coefficient <span class="math inline">\(\sigma\)</span>. We can estimate <span class="math inline">\(\sigma\)</span> from historical data (see <a href="Chapter4.html"><span>Chapter&nbsp;4</span></a>), or estimate it from the prices of other options. The latter method exploits the fact that there is a one-to-one relationship between the price given by the Black-Scholes formula and the <span class="math inline">\(\sigma\)</span> that is input, so one can take the price as given and infer <span class="math inline">\(\sigma\)</span> from the formula. The <span class="math inline">\(\sigma\)</span> computed in this way is called the implied volatility. The implied volatility from one option can be used to price another (perhaps non-traded or less actively traded) option. The calculation of implied volatilities is discussed in <a href="#sec-s_blackscholes_vba"><span>Section&nbsp;3.10</span></a>.</p>
<p>Even if we acknowledge that the model is not correct, the computation of implied volatilities is still useful for characterizing market prices, because we can quickly describe an option as expensive or cheap depending on whether its implied volatility is large or small. Somewhat paradoxically, it is less easy to see if an option is expensive or cheap by looking at its price, because one must consider the price in the context of the exercise price and maturity. To some extent, the implied volatility normalizes the price relative to the exercise price and maturity. Of course, it does not always pay to sell expensive options or buy cheap options, unless they are expensive or cheap relative to an accurate model!</p>
</section>
<section id="sec-s_timevaryingvolatility" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="sec-s_timevaryingvolatility"><span class="header-section-number">3.8</span> Term Structure of Volatility</h2>
<p>The option pricing formulas in this chapter are derived from the fact that the natural logarithm of the stock price at maturity is normally distributed with a certain mean (depending on the numeraire) and variance equal to <span class="math inline">\(\sigma^2T\)</span>. It is not actually necessary that the volatility be constant. The formulas are still valid if <span class="math display">\[\frac{\mathrm{d} S(t)}{S(t)}= \mu(t)\,\mathrm{d} t + \sigma(t)\,\mathrm{d} B(t)\]</span> where <span class="math inline">\(\sigma(t)\)</span> is some non-random function of time (and again <span class="math inline">\(\mu\)</span> can be a quite general random process). In this case, the variance of <span class="math inline">\(\log S(T)\)</span> will be <span id="eq-totalvariance"><span class="math display">\[
\int_0^T \sigma^2(t)\,\mathrm{d} t\;,
\tag{3.14}\]</span></span></p>
<p>which is essentially the sum of the instantaneous variances <span class="math inline">\(\sigma^2(t)\,\mathrm{d} t\)</span>. In the <span class="math inline">\(d_1\)</span>’s and <span class="math inline">\(d_2\)</span>’s in the option pricing formulas, <span class="math inline">\(\sigma^2T\)</span> should be replaced by <a href="#eq-totalvariance">Equation&nbsp;<span>3.14</span></a>. A convenient way of expressing this is as follows. Let <span class="math inline">\(\sigma_{\text{avg}}\)</span> be the positive number such that <span id="eq-sigmaavg100"><span class="math display">\[
\sigma_{\text{avg}}^2 = \frac{1}{T}\int_0^T \sigma^2(t)\,\mathrm{d} t\;.
\tag{3.15}\]</span></span></p>
<p>Then we simply need to input <span class="math inline">\(\sigma_{\text{avg}}\)</span> as in our option pricing functions. We will call <span class="math inline">\(\sigma_{\text{avg}}\)</span> the average volatility, though note that it is not really the average of <span class="math inline">\(\sigma(t)\)</span> but instead is the square root of the average of <span class="math inline">\(\sigma^2(t)\)</span>.</p>
<p>It is important to recognize that, throughout this chapter, date 0 means the date at which the option is being valued. It is not necessarily the date at which the option was first bought or sold. So <span class="math inline">\(\sigma_{\text{avg}}\)</span> is the average (in a sense) volatility during the remaining lifetime of the option, which need not be the same as the average during the option’s entire lifetime. It is this remaining volatility that is important for pricing and hedging. Moreover, it is a mistake at date 0 to use <span class="math inline">\(\sigma(0)\)</span> as the volatility to compute prices and hedges. Instead, prices and hedges should be based on <span class="math inline">\(\sigma_{\text{avg}}\)</span>.</p>
<p>These considerations provide a way to address the following situation. If we compute implied volatilities for options with different maturities, we will normally get different numbers. For example, consider two at-the-money options with maturities <span class="math inline">\(T_1\)</span> and <span class="math inline">\(T_2\)</span> where <span class="math inline">\(T_2&gt;T_1\)</span>. Denote the implied volatilities by <span class="math inline">\(\hat{\sigma}_1\)</span> and <span class="math inline">\(\hat{\sigma}_2\)</span>. We want to interpret these as average volatilities for the time periods <span class="math inline">\([0,T_1]\)</span> and <span class="math inline">\([0,T_2]\)</span> respectively. This requires the existence of a function <span class="math inline">\(\sigma(t)\)</span> such that <span class="math display">\[\hat{\sigma}_1^2 = \frac{1}{T_1}\int_0^{T_1} \sigma^2(t)\,\mathrm{d} t \quad \text{and} \quad \hat{\sigma}_2^2 = \frac{1}{T_2}\int_0^{T_2} \sigma^2(t)\,\mathrm{d} t\; .\]</span> This would imply <span class="math display">\[\hat{\sigma}_2^2T_2 - \hat{\sigma}_1^2T_1 = \int_{T_1}^{T_2} \sigma^2(t)\,\mathrm{d} t\; ,\]</span> which requires <span class="math display">\[\hat{\sigma}_2^2T_2 - \hat{\sigma}_1^2T_1 \geq 0\; .\]</span> Equivalently, <span class="math display">\[\hat{\sigma}_2 \geq \sqrt{\frac{T_1}{T_2}} \hat{\sigma}_1\; .\]</span> Provided this last inequality is satisfied, we can easily construct the function <span class="math inline">\(\sigma(t)\)</span> as <span class="math display">\[\sigma(t) = \begin{cases} \hat{\sigma}_1 &amp; \quad\text{for $t\leq T_1$} \\
\sqrt{\frac{\hat{\sigma}_2^2T_2 - \hat{\sigma}_1^2T_1}{T_2-T_1}} &amp;\quad\text{for $T_1 &lt; t\leq T_2$}.
\end{cases}\]</span> More generally, given a sequence of at-the-money options with maturities <span class="math inline">\(T_1&lt;T_2&lt;\cdots T_N\)</span> and implied volatilities <span class="math inline">\(\hat{\sigma}_1,\dots,\hat{\sigma}_N\)</span>, we define <span class="math display">\[\sigma(t) = \sqrt{\frac{\hat{\sigma}_{i+1}^2T_{i+1} - \hat{\sigma}_i^2T_i}{T_{i+1}-T_i}}\]</span> for <span class="math inline">\(T_i&lt;t\leq T_{i+1}\)</span>, provided the expression inside the square root symbol is positive. This <span class="math inline">\(\sigma(t)\)</span> is often called the term structure of (implied) volatilities. Generally, we may expect <span class="math inline">\(\sigma(t)\)</span> to be a decreasing function of time <span class="math inline">\(t\)</span> when the current market is especially volatile and to be an increasing function when the current market is especially quiet.</p>
</section>
<section id="sec-s_smiles" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="sec-s_smiles"><span class="header-section-number">3.9</span> Smiles and Smirks</h2>
<p>If we compute implied volatilities for options with the same maturity but different strikes, we will again obtain different implied volatilities for different options. If we plot implied volatility against the strike, the pattern one normally sees for equities and equity indices is the implied volatility declining as the strike increases until the strike is somewhere near the current value of the underlying (so the option is at the money). The implied volatility will then generally flatten out or increase slightly at higher strikes. The graph looks like a twisted smile (smirk). This pattern has been very pronounced in equity index option prices since the crash of 1987. In contrast to the term structure of implied volatilities, this moneyness structure of implied volatilities is simply inconsistent with the model. It suggests that the risk-neutral return distribution is not lognormal but instead exhibits a higher likelihood of extreme returns than the lognormal distribution (i.e., it has fat tails) with the likelihood of extreme negative returns being higher than the likelihood of extreme positive returns (i.e., it is skewed). We will return to this subject in <a href="Chapter4.html#sec-s_smilesagain"><span>Section&nbsp;4.6</span></a>.</p>
</section>
<section id="sec-s_blackscholes_vba" class="level2" data-number="3.10">
<h2 data-number="3.10" class="anchored" data-anchor-id="sec-s_blackscholes_vba"><span class="header-section-number">3.10</span> Calculations in VBA</h2>
<p>The Black-Scholes call and put formulas and Greeks can easily be calculated in an Excel worksheet, using the standard functions , and the cumulative normal distribution function, which is provided in Excel as . However, if these are to be used repeatedly, it is useful to create functions in VBA. In VBA, the cumulative normal distribution function is called . Also, the natural logarithm function in VBA is rather than and the square root function in VBA is rather than .</p>
<section id="black-scholes-call-and-put-formulas" class="level3">
<h3 class="anchored" data-anchor-id="black-scholes-call-and-put-formulas">Black-Scholes Call and Put Formulas</h3>
The following function implements the Black-Scholes call pricing formula. For the sake of completeness, the function returns a value even when a volatility of zero is input, in which case <a href="#eq-blackscholescall">Equation&nbsp;<span>3.5</span></a> is invalid (it involves division by zero in the calculation of <span class="math inline">\(d_1\)</span> and <span class="math inline">\(d_2\)</span>). If the volatility is zero, then the stock is riskless and should appreciate at rate <span class="math inline">\(r-q\)</span>. Moreover the option is riskless and its date–0 value should be the date–T value discounted at the risk-free rate. This implies that the call value at date~0 is<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> <span class="math display">\[\mathrm{e}^{-rT}\max\left(0,\mathrm{e}^{(r-q)T}S(0)-K\right) = \max \left(0, \mathrm{e}^{-qT}S(0)-\mathrm{e}^{-rT}K\right)\; .\]</span>
<p>It is useful to note that</p>
<p>gives the same result as</p>
<p>In the latter formulation, we view the underlying asset as the portfolio which starts with <span class="math inline">\(\mathrm{e}^{-qT}\)</span> shares of the asset and reinvests dividends until date <span class="math inline">\(T\)</span>. This portfolio has value <span class="math inline">\(S(T)\)</span> at date <span class="math inline">\(T\)</span>, so a European call option on this non-dividend-paying portfolio is equivalent to a European call option on the stock. The initial value of the portfolio is <span class="math inline">\(\mathrm{e}^{-qT}S(0)\)</span>, which is input as the asset price in the latter formulation.</p>
The Black-Scholes formula for the value of a European put option can be implemented as follows.
</section>
<section id="black-scholes-greeks" class="level3">
<h3 class="anchored" data-anchor-id="black-scholes-greeks">Black-Scholes Greeks</h3>
The delta and gamma of a European call option can be computed with the following functions. The other Greeks are obviously calculated in a similar manner. Note that the constant <span class="math inline">\(\pi = 3.14159...\)</span> is provided in Excel as the function and can be accessed in Excel VBA as .
</section>
<section id="implied-volatilities" class="level3">
<h3 class="anchored" data-anchor-id="implied-volatilities">Implied Volatilities</h3>
<p>We could find an implied volatility using the Solver tool, but then we would have to re-run Solver each time we changed one of the input values. We will need to solve similar problems on several occasions, so it seems worthwhile to program a Solver-like function in VBA. We will write this in such a way that it can easily be applied in other contexts. We will assume there is a single variable for which we want to solve, solving for multiple variables being more difficult.</p>
Letting denote the market price of a European call option, the implied volatility is satisfying
The solution of this equation is called a root of the function
<p>and the problem of finding roots of functions is a standard numerical problem. Roots are found by what are essentially sophisticated trial-and-error methods. The simplest method is to start with upper and lower bounds for <span class="math inline">\(\sigma\)</span> and repeatedly bisect the interval containing <span class="math inline">\(\sigma\)</span>, each time finding a new upper or lower bound. The program below is a standard bisection routine.</p>
<p>For there to be a volatility that equates the market price to the Black-Scholes price, it is necessary for the call option price to satisfy the arbitrage bound<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> <span class="math inline">\(C +\mathrm{e}^{-rT}K \geq \mathrm{e}^{-qT}S\)</span>. We check this condition at the beginning of the program and supply an error message if it is violated.</p>
<p>We need to input all of the inputs of other than~<span class="math inline">\(\sigma\)</span>, and we need to input the call option price. The following uses an error tolerance of <span class="math inline">\(10^{-6}\)</span>. Therefore, the value that is returned will equal the exact implied volatility to at least five decimal places. The bisection is begun with a lower bound of <span class="math inline">\(\sigma =0\)</span>. An iterative procedure is used to find an upper bound, starting with <span class="math inline">\(\sigma = 100\)</span>%.</p>
<p>This same algorithm can be used to find a real number <span class="math inline">\(x\)</span> such that <span class="math inline">\(f(x)=0\)</span> for any (continuous) function <span class="math inline">\(f\)</span>. The only changes necessary are in the right hand sides of the assignment statements for , , and and in finding lower and upper bounds (and obviously one would not check the arbitrage bound in general).^[The key to the function is checking each time whether the root is between the guess and the upper bound or between the guess and the lower bound. If $ We will use this algorithm on several occasions to find roots of functions.</p>
<p>To compute an implied volatility from a put option price, one can first compute a corresponding call option price from put-call parity and then run the above program.</p>
There are faster root-finding methods than bisection. These use other methods to update the guess than just halving the distance between the prior guess and the upper or lower bound. For example, one can use the vega (the derivative of the option formula with respect to <span class="math inline">\(\sigma\)</span>) at the given guess for <span class="math inline">\(\sigma\)</span> and replace the bisection with
This amounts to approximating the Black-Scholes formula as being linear in~<span class="math inline">\(\sigma\)</span> and using the root of the approximation as the updated guess. This is the essence of the method. A similar idea that does not require the computation of vega is to keep track of the two most recent (, ) pairs and to approximate as:
<p>This is the essence of the method. </p>
</section>
<section id="discretely-rebalanced-delta-hedges" class="level3">
<h3 class="anchored" data-anchor-id="discretely-rebalanced-delta-hedges">Discretely-Rebalanced Delta Hedges</h3>
<p>To compute the real-world distribution of gains and losses from a discretely-rebalanced delta hedge, we input the expected rate of return <span class="math inline">\(\mu\)</span>. We consider adjusting the hedge at dates <span class="math inline">\(0=t_0&lt;t_1&lt;\cdots&lt;t_N=T\)</span>, with <span class="math inline">\(t_i-t_{i-1}=\Delta t = T/N\)</span> for each <span class="math inline">\(i\)</span>. The changes in the natural logarithm of the stock price between successive dates <span class="math inline">\(t_{i-1}\)</span> and <span class="math inline">\(t_i\)</span> are simulated as <span class="math display">\[\Delta \log S = \left(\mu-q-\frac{1}{2}\sigma^2\right)\,\Delta t + \sigma\,\Delta B\; ,\]</span> where <span class="math inline">\(\Delta B\)</span> is normally distributed with mean zero and variance <span class="math inline">\(\Delta t\)</span>. The random variables <span class="math inline">\(\Delta B\)</span> are simulated as standard normals multiplied by <span class="math inline">\(\sqrt{\Delta t}\)</span>. We begin with the portfolio that is short a call, long <span class="math inline">\(\delta\)</span> shares of the underlying, and short <span class="math inline">\(\delta S-C\)</span> in cash. After the stock price changes, say from <span class="math inline">\(S\)</span> to <span class="math inline">\(S'\)</span>, we compute the new delta <span class="math inline">\(\delta'\)</span>. The cash flow from adjusting the hedge is <span class="math inline">\((\delta-\delta')S'\)</span>. Accumulation (or payment) of interest on the cash position is captured by the factor <span class="math inline">\(e^{r\Delta t}\)</span>. Continuous payment of dividends is modelled similarly: the dividends earned during the period <span class="math inline">\(\Delta t\)</span> is taken to be <span class="math inline">\(\delta S\left(e^{q\Delta t}-1\right)\)</span>. The cash position is adjusted due to interest, dividends, and the cash flow from adjusting the hedge. At date <span class="math inline">\(T\)</span>, the value of the portfolio is the cash position less the intrinsic value of the option.</p>
<p>To describe the distribution of gains and losses, we compute percentiles of the distribution. You should see that the hedge becomes more nearly perfect as the number of periods <span class="math inline">\(N\)</span> is increased. Note that this is true regardless of the <span class="math inline">\(\mu\)</span> that is input, which reaffirms the point that option values and hedges do not depend on the expected rate of return of the underlying. The percentile is calculated with the Excel function.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
</section>
</section>
<section id="exercises" class="level2" data-number="3.11">
<h2 data-number="3.11" class="anchored" data-anchor-id="exercises"><span class="header-section-number">3.11</span> Exercises</h2>
<div id="exr-problem4.1" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.1 </strong></span>Create an Excel worksheet in which the user inputs <span class="math inline">\(K\)</span>, <span class="math inline">\(r\)</span>, <span class="math inline">\(\sigma\)</span>, <span class="math inline">\(q\)</span> and <span class="math inline">\(T\)</span>. Compute the delta of a call option for stock prices <span class="math inline">\(S = .01K\)</span>, <span class="math inline">\(.02K\)</span>, , <span class="math inline">\(1.99K\)</span>, <span class="math inline">\(2K\)</span> (i.e., <span class="math inline">\(S = iK/100\)</span> for <span class="math inline">\(i=1, \ldots 200\)</span>) and plot the delta against the stock price.</p>
</div>
<div id="exr-nolabel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.2 </strong></span>The delta of a digital option that pays $1 when <span class="math inline">\(S(T)&gt;K\)</span> is <span class="math display">\[\frac{\mathrm{e}^{-rT}\mathrm{n}d(d_2)}{\sigma S\sqrt{T}}\; .\]</span> Repeat the previous problem for the delta of this digital. Given that in reality it is costly to trade (due to commissions, the bid-ask spread and possible adverse price impacts for large trades), do you see any problems with delta hedging a short digital near maturity if it is close to being at the money?</p>
</div>
<div id="exr-nolabel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.3 </strong></span>Repeat <a href="#exr-problem4.1">Exercise&nbsp;<span>3.1</span></a> for the gamma of a call option.</p>
</div>
<div id="exr-nolabel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.4 </strong></span>Use put-call parity to derive the Greeks of a put option, and write a VBA function that computes the value and Greeks.</p>
</div>
<div id="exr-nolabel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.5 </strong></span>Consider delta and gamma hedging a short call option, using the underlying and a put with the same strike and maturity as the call. Calculate the position in the underlying and the put that you should take, using the analysis in <a href="#sec-s_gammahedging"><span>Section&nbsp;3.6</span></a>. Will you ever need to adjust this hedge? Relate your result to put-call parity.</p>
</div>
<div id="exr-nolabel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.6 </strong></span>The delta of a share digital that pays one share when <span class="math inline">\(S(T)&gt;K\)</span> is <span class="math display">\[\mathrm{e}^{-qT}\mathrm{N}(d_1) + \frac{\mathrm{e}^{-qT}\mathrm{n}d(d_1)}{\sigma \sqrt{T}}\; .\]</span> Repeat <a href="#exr-problem4.1">Exercise&nbsp;<span>3.1</span></a> for the delta of this share digital.</p>
</div>
<div id="exr-nolabel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.7 </strong></span>Create an Excel worksheet in which the user inputs <span class="math inline">\(K\)</span>, <span class="math inline">\(r\)</span>, <span class="math inline">\(q\)</span> and <span class="math inline">\(T\)</span>. Compute the value of an at-the-money call option (<span class="math inline">\(S=K\)</span>) using the function for volatilities <span class="math inline">\(\sigma = .01, .02, \ldots, 1.0\)</span>. Plot the call value against the volatility.</p>
</div>
<div id="exr-nolabel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.8 </strong></span>Repeat the previous problem for <span class="math inline">\(S=1.2K\)</span> (an example of an in-the-money call option).</p>
</div>
<div id="exr-nolabel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.9 </strong></span>The file CBOEQuotes.txt (available at ) contains price data for call options on the S&amp;P 500 index. The options expired in February, 2003, and the prices were obtained on January 22, 2003. The first column lists various exercise prices. The second column gives the bid price and the third column the ask price. Import this data into an Excel worksheet and compute and plot the implied volatility against the exercise price using this data. Use the ask price as the market price for the option. The options have 30 days to maturity (so <span class="math inline">\(T=30/365\)</span>). At the time the quotes were downloaded, the S&amp;P 500 was at 884.25. According to the CBOE, the dividend yield on the S&amp;P 500 was 1.76%. Use 1.25% for the risk-free interest rate.</p>
</div>
<div id="exr-nolabel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.10 </strong></span>Attempt to repeat the previous problem using the bid price as the market price of the option. If this doesn’t work, what is wrong? Does this indicate there is an arbitrage opportunity?</p>
</div>
<p>::: Suppose an investor invests in a portfolio with price <span class="math inline">\(S\)</span> and constant dividend yield~<span class="math inline">\(q\)</span>. Assume the investor is charged a constant expense ratio <span class="math inline">\(\alpha\)</span> (which acts as a negative dividend) and at date <span class="math inline">\(T\)</span> receives either his portfolio value or his initial investment, whichever is higher. This is similar to a popular type of variable annuity. Letting <span class="math inline">\(D\)</span> denote the number of dollars invested in the contract, the contract pays <span id="eq-bsp1"><span class="math display">\[
\max\left(D,\frac{D\mathrm{e}^{(q-\alpha)T}S(T)}{S(0)}\right)
\tag{3.16}\]</span></span> at date <span class="math inline">\(T\)</span>.<br>
We can rearrange the expression <a href="#eq-bsp1">Equation&nbsp;<span>3.16</span></a> as</p>
<p><span class="math display">\[
\max\left(D,\frac{D\mathrm{e}^{(q-\alpha)T}S(T)}{S(0)}\right) = D + \max\left(0, \frac{D\mathrm{e}^{(q-\alpha)T}S(T)}{S(0)}-D\right)
\]</span> <span id="eq-bsp2"><span class="math display">\[
= D + \mathrm{e}^{-\alpha T}D\max\left(0,\frac{\mathrm{e}^{qT}S(T)}{S(0)}-\mathrm{e}^{\alpha T}\right)\;.
\tag{3.17}\]</span></span></p>
Thus, the contract payoff is equivalent to the amount invested plus a certain number of call options written on the gross holding period return <span class="math inline">\(\mathrm{e}^{qT}S(T)/S(0)\)</span>. Note that <span class="math inline">\(Z(t) = \mathrm{e}^{qt}S(t)/S(0)\)</span> is the date–<span class="math inline">\(t\)</span> value of the portfolio that starts with <span class="math inline">\(1/S(0)\)</span> units of the asset (i.e., with a $1 investment) and reinvests dividends. Thus, the call options are call options on a non-dividend paying portfolio with the same volatility as <span class="math inline">\(S\)</span> and initial price of $1. This implies that the date–0 value of the contract to the investor is <span class="math inline">\(\mathrm{e}^{-rT}D\)</span> plus
<ol type="1">
<li>Create a VBA function to compute the fair expense ratio; i.e., find <span class="math inline">\(\alpha\)</span> such that the date–0 value of the contract is equal to <span class="math inline">\(D\)</span>. Hint: Modify the
function. You can use <span class="math inline">\(\alpha=0\)</span> as a lower bound. Because the value of the contract is decreasing as <span class="math inline">\(\alpha\)</span> increases, you can find an upper bound by iterating until the value of the contract is less than <span class="math inline">\(D\)</span>.</li>
<li>How does the fair expense ratio vary with the maturity <span class="math inline">\(T\)</span>? Why?</li>
</ol>
::: ::: {#exr-nolabel} Modify the function to compute percentiles of gains and losses for an investor who writes a call option and constructs a delta and gamma hedge using the underlying asset and another call option. Include the exercise price of the call option used to hedge as an input, and assume it has the same time to maturity as the option that is written. Hint: In each period , the updated cash position can be calculated as
where denotes the number of shares of the stock held, denotes the number of units held of the option that is used for hedging, and denotes the price of the option used for hedging (computed from the Black-Scholes formula each period). This expression embodies the interest earned (paid) on the cash position, the dividends received on the shares of stock and the cash inflows (outflows) from adjusting the hedge. At the final date , the value of the hedge is
and the value of the overall portfolio is the value of the hedge less
<p>where denotes the strike price of the option used to hedge and denotes the strike of the option that was written. :::</p>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>There is no other risky asset price <span class="math inline">\(Y\)</span> in this model, so the subscripts we used in <a href="Chapter2.html#sec-s_girsanov"><span>Section&nbsp;2.9</span></a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The delta is frequently denoted by the upper case <span class="math inline">\(\Delta\)</span>, but we will use the lower case, reserving the upper case for discrete changes, e.g., <span class="math inline">\(\Delta t\)</span>. One may have noticed also that the symbol for vega is a little different from the others; this reflects the fact that vega is not actually a Greek letter.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>This result can be verified by a simple arbitrage argument. For example, if the call value were less than this formula, then put-call parity would show that the put price is negative, which is impossible. On the other hand, if the call price is greater than this formula (and hence positive), then put-call parity shows that the put price is positive, and it is impossible that both the put and call will finish in the money (so, given that they are riskless, only one should have a positive value).<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Note that by put-call parity—<a href="#eq-putcallparity11">Equation&nbsp;<span>3.7</span></a>—the difference between the left and right-hand sides of this inequality is the value of the put with the same strike and maturity as the call. Thus, the inequality is equivalent to the statement that the put value is nonnegative, which must be the case.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>If numsims = 11 and pct =0.1, the percentile function returns the second lowest element in the series. The logic is that 10% of the numbers, excluding the number returned, are below the number returned—i.e., 1 out of the other 10 are below—and 90% of the others are above. In particular, if pct = 0.5, the percentile function returns the median. When necessary, the function interpolates; for example, if numsims = 10 and pct=0.1, then the number returned is an interpolation between the lowest and second lowest numbers.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Chapter2.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Continuous-Time Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Chapter4.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Estimating and Modelling Volatility</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>