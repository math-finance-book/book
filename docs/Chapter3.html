<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Mathematical Finance Book - 3&nbsp; Black-Scholes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Chapter4.html" rel="next">
<link href="./Chapter2.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Black-Scholes</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Mathematical Finance Book</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Asset Pricing Basics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Continuous-Time Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter3.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Black-Scholes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter4.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Estimating and Modelling Volatility</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter5.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to Monte Carlo and Binomial Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter6.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Foreign Exchange</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter7.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Forward, Futures, and Exchange Options</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter8.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Exotic Options</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter9.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">More on Monte Carlo and Binomial Valuation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter10.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Finite Difference Methods</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter11.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Fixed Income Concepts</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter12.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to Fixed Income Derivatives</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter13.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Valuing Derivatives in the Extended Vasicek Model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter14.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">A Brief Survey of Term Structure Models</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#s_digitals" id="toc-s_digitals" class="nav-link active" data-scroll-target="#s_digitals"><span class="toc-section-number">4</span>  Digital Options</a></li>
  <li><a href="#s_sharedigitals" id="toc-s_sharedigitals" class="nav-link" data-scroll-target="#s_sharedigitals"><span class="toc-section-number">5</span>  Share Digitals</a></li>
  <li><a href="#s_blackscholes" id="toc-s_blackscholes" class="nav-link" data-scroll-target="#s_blackscholes"><span class="toc-section-number">6</span>  Puts and Calls</a></li>
  <li><a href="#greeks" id="toc-greeks" class="nav-link" data-scroll-target="#greeks"><span class="toc-section-number">7</span>  Greeks</a></li>
  <li><a href="#s_deltahedging" id="toc-s_deltahedging" class="nav-link" data-scroll-target="#s_deltahedging"><span class="toc-section-number">8</span>  Delta Hedging</a></li>
  <li><a href="#s_gammahedging" id="toc-s_gammahedging" class="nav-link" data-scroll-target="#s_gammahedging"><span class="toc-section-number">9</span>  Gamma Hedging</a></li>
  <li><a href="#s_impliedvolatility" id="toc-s_impliedvolatility" class="nav-link" data-scroll-target="#s_impliedvolatility"><span class="toc-section-number">10</span>  Implied Volatilities</a></li>
  <li><a href="#s_timevaryingvolatility" id="toc-s_timevaryingvolatility" class="nav-link" data-scroll-target="#s_timevaryingvolatility"><span class="toc-section-number">11</span>  Term Structure of Volatility</a></li>
  <li><a href="#s_smiles" id="toc-s_smiles" class="nav-link" data-scroll-target="#s_smiles"><span class="toc-section-number">12</span>  Smiles and Smirks</a></li>
  <li><a href="#s_blackscholes_vba" id="toc-s_blackscholes_vba" class="nav-link" data-scroll-target="#s_blackscholes_vba"><span class="toc-section-number">13</span>  Calculations in VBA</a>
  <ul class="collapse">
  <li><a href="#black-scholes-call-and-put-formulas" id="toc-black-scholes-call-and-put-formulas" class="nav-link" data-scroll-target="#black-scholes-call-and-put-formulas">Black-Scholes Call and Put Formulas</a></li>
  <li><a href="#black-scholes-greeks" id="toc-black-scholes-greeks" class="nav-link" data-scroll-target="#black-scholes-greeks">Black-Scholes Greeks</a></li>
  <li><a href="#implied-volatilities" id="toc-implied-volatilities" class="nav-link" data-scroll-target="#implied-volatilities">Implied Volatilities</a></li>
  <li><a href="#discretely-rebalanced-delta-hedges" id="toc-discretely-rebalanced-delta-hedges" class="nav-link" data-scroll-target="#discretely-rebalanced-delta-hedges">Discretely-Rebalanced Delta Hedges</a></li>
  </ul></li>
  <li><a href="#problems" id="toc-problems" class="nav-link" data-scroll-target="#problems">Problems</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="c_blackscholes" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Black-Scholes</span></span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>In this chapter, we will study the value of European digital and share digital options and standard European puts and calls under the Black-Scholes assumptions. We will also explain how to calculate implied volatilities and the option “Greeks.” The Black-Scholes assumptions are that the underlying asset pays a constant dividend yield <span class="math inline">\(q\)</span> and has price <span class="math inline">\(S\)</span> satisfying <span class="math display">\[\begin{equation}\label{bs1}
\frac{\D S}{S} = \mu\,\D t + \sigma\,\D B
\end{equation}\]</span> for a Brownian motion B. Here <span class="math inline">\(\sigma\)</span> is assumed to be constant (though we will allow it to vary in a non-random way at the end of the chapter) and <span class="math inline">\(\mu\)</span> can be a quite general random process. It is also assumed that there is a constant continuously-compounded risk-free rate~<span class="math inline">\(r\)</span>.</p>
<p>Under these assumptions, we will complete the discussion of Sect. <a href="Chapter1.html#s_introoptions" data-reference-type="ref" data-reference="s_introoptions">[s_introoptions]</a> to derive option pricing formulas. Recall that, to price a European call option, all that remains to be done is to calculate the probabilities of the option finishing in the money when we use the risk-free asset and the underlying asset as numeraires. We will do this using the results of Sect. <a href="Chapter2.html#s_girsanov" data-reference-type="ref" data-reference="s_girsanov">[s_girsanov]</a>. As in Sect. <a href="Chapter1.html#s_introoptions" data-reference-type="ref" data-reference="s_introoptions">[s_introoptions]</a>, we will approach the pricing of call and put options by first considering their basic building blocks: digitals and share digitals.</p>
<section id="s_digitals" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Digital Options</h1>
<p>A digital (or “binary”) option pays a fixed amount in a certain event and zero otherwise. Consider a digital that pays $1 at date <span class="math inline">\(T\)</span> if <span class="math inline">\(S(T)&gt;K\)</span>, where <span class="math inline">\(K\)</span> is a number that is fixed by the contract. This means that the digital pays <span class="math inline">\(x\)</span> dollars at date <span class="math inline">\(T\)</span> where <span class="math inline">\(x\)</span> is defined as <span class="math display">\[\begin{equation*}
x =  \begin{cases} 1 &amp; \text{if $S(T)&gt;K$}\; ,\\
0 &amp; \text{otherwise}\;.
\end{cases}
\end{equation*}\]</span> Using the risk-neutral pricing formula <span class="math inline">\(\eqref{riskneutralformula}\)</span>, the value of the digital at date~0 is <span class="math inline">\(\E^{-rT}E^R[x]\)</span>. Note that <span class="math display">\[\begin{align*}
E^R[x] \;&amp;=\; 1 \times \text{prob}^R(x=1)\; + \;0 \times \text{prob}^R(x\!\!=\!\!0) \\
\;&amp;=\; \text{prob}^R(x=1)\\
\;&amp;=\; \text{prob}^R\big(S(T) &gt; K\big)\;.
\end{align*}\]</span> So we need to calculate this probability of the digital finishing in the money.</p>
<p>In Sect. <a href="Chapter2.html#s_girsanov" data-reference-type="ref" data-reference="s_girsanov">[s_girsanov]</a>—see <a href="#riskneutral11" data-reference-type="eqref" data-reference="riskneutral11">[riskneutral11]</a>—we learned that under the Black-Scholes assumption <span class="math inline">\(\eqref{bs1}\)</span> we have <span class="math display">\[\frac{\D S}{S} =( r-q)\,\D t+\sigma\,\D B^*\; ,\]</span> where <span class="math inline">\(B^*\)</span> is a Brownian motion under the risk-neutral measure.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>In Sect. <a href="Chapter2.html#s_geometricbrownianmotion" data-reference-type="ref" data-reference="s_geometricbrownianmotion">[s_geometricbrownianmotion]</a>, we observed that this is equivalent to <span class="math display">\[\D \log S = \left(r-q-\frac{1}{2}\sigma^2\right)\,\D t + \sigma\,\D B^*\; .\]</span> Now using the formulas <span class="math inline">\(\eqref{tailprob01}\)</span>–<span class="math inline">\(\eqref{tailprob3}\)</span>, with <span class="math inline">\(\alpha = r-q-\sigma^2/2\)</span>, we have <span class="math inline">\(\text{prob}^R\big(S(T) &gt; K\big) = \N(d_2)\)</span> where <span class="math display">\[\begin{equation}\label{digital_d2}
d_2 = \frac{\log\left(\frac{S(0)}{K}\right)+\left(r-q-\frac{1}{2}\sigma^2\right)T}{\sigma\sqrt{T}}\;.
\end{equation}\]</span> The notation <span class="math inline">\(d_2\)</span> is standard notation from the Black-Scholes formula, and we use it—rather than a simple <span class="math inline">\(d\)</span>—to distinguish the number <span class="math inline">\(\eqref{digital_d2}\)</span> from a similar number—to be called <span class="math inline">\(d_1\)</span> of course—that we will see in the next section.<br>
We conclude: </p>
<p>Consider now a digital that pays when the underlying asset price is low; i.e., consider a security that pays <span class="math inline">\(y\)</span> dollars at date <span class="math inline">\(T\)</span> where <span class="math display">\[\begin{equation*}
y =  \begin{cases} 1 &amp; \text{if $S(T)&lt;K$}\; ,\\
0 &amp; \text{otherwise}\;.
\end{cases}
\end{equation*}\]</span> Using risk-neutral pricing again, the value of this digital at date 0 is <span class="math display">\[\E^{-rT}E^R[y] = \E^{-rT}\text{prob}^R(y=1) = \E^{-rT}\text{prob}^R\big(S(T)&lt;K\big)\; .\]</span> From this fact and the formula <span class="math inline">\(\eqref{tailprob02}\)</span>, we conclude: </p>
</section>
<section id="s_sharedigitals" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Share Digitals</h1>
<p>Consider a derivative security that pays one share of the underlying asset at date <span class="math inline">\(T\)</span> if <span class="math inline">\(S(T)&gt;K\)</span> and pays zero otherwise. This is called a “share digital.” As before, let <span class="math display">\[\begin{equation*}
x =  \begin{cases} 1 &amp; \text{if $S(T)&gt;K$}\; ,\\
0 &amp; \text{otherwise}\;.
\end{cases}
\end{equation*}\]</span> Then the payoff of the share digital at date <span class="math inline">\(T\)</span> is <span class="math inline">\(xS(T)\)</span>. Let <span class="math inline">\(Y(t)\)</span> denote the value of this claim for <span class="math inline">\(0\leq t\leq T\)</span>. We have <span class="math inline">\(Y(T)=xS(T)\)</span> and we want to find <span class="math inline">\(Y(0)\)</span>.</p>
<p>From Sect. <a href="Chapter2.html#s_reinvestingdividends" data-reference-type="ref" data-reference="s_reinvestingdividends">[s_reinvestingdividends]</a>, we know that <span class="math inline">\(V(t)=\E^{qt}S(t)\)</span> is the price of a non-dividend-paying portfolio. From our fundamental pricing formula <a href="#formula" data-reference-type="eqref" data-reference="formula">[formula]</a>, using <span class="math inline">\(V\)</span> as the numeraire, we have</p>
<p><span class="math display">\[\begin{align*}
Y(0) &amp;= S(0) E^V \left[\frac{Y(T)}{\E^{q T}S(T)}\right]\\
&amp;=\E^{-q T}S(0)E^V [x]\;.
\end{align*}\]</span> As in the previous section, <span class="math inline">\(E^V[x] = \text{prob}^V\!(x=1)\)</span>, so we need to compute this probability of the option finishing in the money.</p>
<p>We follow the same steps as in the previous section. From <span class="math inline">\(\eqref{own11}\)</span> we have <span class="math display">\[
\frac{\D S}{S} = (r-q+ \sigma^2)\,\D t+\sigma\,\D B^*,
\]</span> where now <span class="math inline">\(B^*\)</span> denotes a Brownian motion when <span class="math inline">\(V\)</span> is the numeraire. This is equivalent to <span class="math display">\[\begin{equation}\label{new5}
\D \log S = \left(r-q+\frac{1}{2}\sigma^2\right)\,\D t + \sigma \,\D B^*\;.
\end{equation}\]</span> Thus, from the formulas <span class="math inline">\(\eqref{tailprob01}\)</span>–<span class="math inline">\(\eqref{tailprob3}\)</span>, with <span class="math inline">\(\alpha = r-q+\sigma^2/2\)</span>, we have <span class="math display">\[\text{prob}^V\!\big(S(T)&gt;K\big) = \N(d_1)\; ,\]</span> where <span class="math display">\[\begin{equation}\label{sharedigital_d1}
d_1 = \frac{\log\left(\frac{S(0)}{K}\right)+\left(r-q+\frac{1}{2}\sigma^2\right)T}{\sigma\sqrt{T}}\;.
\end{equation}\]</span> This implies: </p>
<p>Consider now a share digital that pays one share of the stock at date <span class="math inline">\(T\)</span> if <span class="math inline">\(S(T)&lt;K\)</span>. Letting <span class="math display">\[\begin{equation*}
y =  \begin{cases} 1 &amp; \text{if $S(T)&lt;K$}\; ,\\
0 &amp; \text{otherwise}\;,
\end{cases}
\end{equation*}\]</span> the payoff of this option is <span class="math inline">\(yS(T)\)</span>. Its value at date 0 is <span class="math display">\[\begin{align*}
\E^{-q T}S(0)E^V [y] &amp;= \E^{-q T}S(0)\times\text{prob}^V\!(y=1) \\
&amp;= \E^{-q T}S(0)\times\text{prob}^V\!\big(S(T)&lt;K\big)\; ,
\end{align*}\]</span> and from the formula <span class="math inline">\(\eqref{tailprob02}\)</span> we have <span class="math display">\[\text{prob}^V\!\big(S(T)&lt;K\big) = \N(-d_1)\; .\]</span> We conclude: </p>
</section>
<section id="s_blackscholes" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Puts and Calls</h1>
<p>A European call option pays <span class="math inline">\(S(T)-K\)</span> at date <span class="math inline">\(T\)</span> if <span class="math inline">\(S(T)&gt;K\)</span> and 0 otherwise. Again letting</p>
<p><span class="math display">\[\begin{equation*}
x =  \begin{cases} 1 &amp; \text{if $S(T)&gt;K$}\; ,\\
0 &amp; \text{otherwise}\;,
\end{cases}
\end{equation*}\]</span> the payoff of the call can be written as <span class="math inline">\(xS(T)-xK\)</span>. This is equivalent to one share digital minus <span class="math inline">\(K\)</span> digitals, with the digitals paying in the event that <span class="math inline">\(S(T)&gt;K\)</span>. The share digital is worth <span class="math inline">\(\E^{-q T}S(0)\N(d_1)\)</span> at date 0 and each digital is worth <span class="math inline">\(\E^{-rT}\N(d_2)\)</span>. Note that equations <a href="#digital_d2" data-reference-type="eqref" data-reference="digital_d2">[digital_d2]</a> and <a href="#sharedigital_d1" data-reference-type="eqref" data-reference="sharedigital_d1">[sharedigital_d1]</a> for <span class="math inline">\(d_1\)</span> and <span class="math inline">\(d_2\)</span> imply <span class="math inline">\(d_2 = d_1-\sigma{\sqrt{T}}\)</span>. Therefore, combining the results of the previous two sections yields the Black-Scholes formula:</p>
<p>A European put option pays <span class="math inline">\(K-S(T)\)</span> at date <span class="math inline">\(T\)</span> if <span class="math inline">\(S(T)&lt;K\)</span> and 0 otherwise. As before, let <span class="math display">\[\begin{equation*}
y =  \begin{cases} 1 &amp; \text{if $S(T)&lt;K$}\; ,\\
0 &amp; \text{otherwise}\;.
\end{cases}
\end{equation*}\]</span> The payoff of the put option is <span class="math inline">\(yK-yS(T)\)</span>. This is equivalent to <span class="math inline">\(K\)</span> digitals minus one share digital, all of the digitals paying when <span class="math inline">\(S(T)&lt;K\)</span>. Thus, we have: Again, this is the Black-Scholes formula.</p>
<p>The values of the European put and call satisfy put-call parity, and we can also find one from the other by<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
</section>
<section id="greeks" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Greeks</h1>
<p>The derivatives (calculus derivatives, not financial derivatives!) of an option pricing formula with respect to the inputs are commonly called “Greeks.” The most important Greek is the option “delta.” This measures the sensitivity of the option value to changes in the value of the underlying asset. The following table shows the standard Greeks, with reference to the Black-Scholes pricing formula.</p>
<p> The second line of the above shows <span class="math inline">\(\delta\)</span> as an input.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> Of course, it is not an input but instead is calculated. Gamma, the derivative of <span class="math inline">\(\delta\)</span>, is the second derivative of the option price with respect to the underlying asset price. The reason for calculating <span class="math inline">\(\Theta\)</span> as the derivative with respect to <span class="math inline">\(-T\)</span> instead of <span class="math inline">\(T\)</span> is that the time-to-maturity <span class="math inline">\(T\)</span> decreasing (<span class="math inline">\(-T\)</span> increasing) is equivalent to time passing, so <span class="math inline">\(\Theta\)</span> measures the change in the option value when time passes.</p>
<p>We can calculate these from the Black-Scholes formula using the chain rule from differential calculus. The derivative of the normal distribution function~<span class="math inline">\(\N\)</span> is the normal density function <span class="math inline">\(\nd\)</span> defined as <span class="math display">\[\nd(d) = \frac{1}{\sqrt{2\pi}}\E^{-d^2/2}\; .\]</span> One can easily verify directly that <span class="math display">\[\begin{equation}\label{greeksimplify}
\E^{-q T}S\nd(d_1)=\E^{-rT}K\nd(d_2)\;,
\end{equation}\]</span> which simplifies the calculations for the Black-Scholes call option pricing formula. For this formula, the Greeks are as follows: <span class="math display">\[\begin{align*}
\delta &amp;= \E^{-q T}\N(d_1) + \E^{-q T}S\nd(d_1)\frac{\partial d_1}{\partial S} -\E^{-rT}K\nd(d_2)\frac{\partial d_2}{\partial S}\\
&amp;= \E^{-q T}\N(d_1) + \E^{-q T}S\nd(d_1)\left(\frac{\partial d_1}{\partial S}-\frac{\partial d_2}{\partial S}\right)\\
&amp;=\E^{-q T}\N(d_1)\;,\\
\Gamma &amp;=\E^{-q T}\nd(d_1)\frac{\partial d_1}{\partial S}= \E^{-q T}\nd(d_1)\frac{1}{S\sigma\sqrt{T}}\;,
\end{align*}\]</span> <span class="math display">\[\begin{align*}
\Theta &amp;=-\E^{-q T}S\nd(d_1)\frac{\partial d_1}{\partial T} +q \E^{-q T}S\N(d_1) \\
&amp;\quad + \E^{-rT}K\nd(d_2)\frac{\partial d_2}{\partial T} -r\E^{-rT}K\N(d_2)\\
&amp;=\E^{-q T}S\nd(d_1)\left(\frac{\partial d_2}{\partial T}-\frac{\partial d_1}{\partial T}\right)\\
&amp;\quad + q \E^{-q T}S\N(d_1)-r\E^{-rT}K\N(d_2)\\
&amp;=-\E^{-q T}S\nd(d_1)\frac{\sigma}{2\sqrt{T}}+ q \E^{-q T}S\N(d_1)-r\E^{-rT}K\N(d_2)\;,\\
\cal{V}&amp;=\E^{-q T}S\nd(d_1)\frac{\partial d_1}{\partial \sigma} - \E^{-rT}K\nd(d_2)\frac{\partial d_2}{\partial \sigma}\\
&amp;=\E^{-q T}S\nd(d_1)\left(\frac{\partial d_1}{\partial \sigma}-\frac{\partial d_2}{\partial \sigma}\right)\\
&amp;=\E^{-q T}S\nd(d_1)\sqrt{T}\;,\\
\rho &amp;=\E^{-q T}S\nd(d_1)\frac{\partial d_1}{\partial r} - \E^{-rT}K\nd(d_2)\frac{\partial d_2}{\partial r} +T\E^{-rT}K\N(d_2)\\
&amp;=\E^{-q T}S\nd(d_1)\left(\frac{\partial d_1}{\partial r}-\frac{\partial d_2}{\partial r}\right)+T\E^{-rT}K\N(d_2)\\
&amp;=T\E^{-rT}K\N(d_2)\;.
\end{align*}\]</span></p>
<p>We can calculate the Greeks of a European put option from the call option Greeks and put-call parity: <span class="math display">\[\text{Put Price} = \text{Call Price} +\E^{-rT}K- \E^{-q T}S(0)\; .\]</span> For example, the delta of a put is the delta of a call (with the same strike and maturity) minus <span class="math inline">\(\E^{-q T}\)</span>, and the gamma of a put is the same as the gamma of the corresponding call.</p>
</section>
<section id="s_deltahedging" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Delta Hedging</h1>
<p>The ability to create a fully hedged (risk-free) portfolio of the stock and an option is the essence of the arbitrage argument underlying the Black-Scholes formula, as we saw in Chap. <a href="Chapter1.html" data-reference-type="ref" data-reference="c_basics">[c_basics]</a> for the binomial model. For a call option, such a portfolio consists of delta shares of the underlying asset and a short call option, or a short position of delta shares of the underlying and a long call option. These portfolios have no instantaneous exposure to the price of the underlying. To create a perfect hedge, the portfolio must be adjusted continuously, because the delta changes when the price of the underlying changes and when time passes. In practice, any hedge will therefore be imperfect, even if the assumptions of the model are satisfied.</p>
<p>We first consider the continuous-time hedging argument. Consider a European call option with maturity <span class="math inline">\(T\)</span>, and let <span class="math inline">\(C(S,t)\)</span> denote the value of the option at date <span class="math inline">\(t&lt;T\)</span> when the stock price is <span class="math inline">\(S\)</span> at date <span class="math inline">\(t\)</span>. Consider a portfolio that is short one call option and long <span class="math inline">\(\delta\)</span> shares of the underlying asset and that has a (short) cash position equal to <span class="math inline">\(C-\delta S\)</span>. This portfolio has zero value at date <span class="math inline">\(t\)</span>.</p>
<p>The change in the value of the portfolio in an instant <span class="math inline">\(\D t\)</span> is <span class="math display">\[\begin{equation}\label{changeportfoliovalue}
-\D C + \delta \,\D S + q \delta S\,\D t+(C-\delta S)r\,\D t\;.
\end{equation}\]</span> The first term reflects the change in the value of the option, the second term is the capital gain or loss on <span class="math inline">\(\delta\)</span> shares of stock, the third term is the dividends received on <span class="math inline">\(\delta\)</span> shares of stock, and the fourth term is the interest expense on the short cash position.</p>
<p>On the other hand, we know from Itô’s formula that <span class="math display">\[\begin{align}
\D C &amp;= \frac{\partial C}{\partial S}\,\D S + \frac{\partial C}{\partial t}\,\D t + \frac{1}{2}\frac{\partial^2C}{\partial S^2} (\D S)^2 \notag \\
&amp;= \delta \,\D S + \Theta \,\D t + \frac{1}{2}\Gamma \sigma^2S^2\,\D t\;.\label{changeportfoliovalue2}
\end{align}\]</span> Substituting <a href="#changeportfoliovalue2" data-reference-type="eqref" data-reference="changeportfoliovalue2">[changeportfoliovalue2]</a> into <a href="#changeportfoliovalue" data-reference-type="eqref" data-reference="changeportfoliovalue">[changeportfoliovalue]</a> shows that the change in the value of the portfolio is <span class="math display">\[\begin{equation}\label{hedgeprofits}
-\Theta \,\D t - \frac{1}{2}\Gamma \sigma^2S^2\,\D t+ q \delta S\,\D t+(C-\delta S)r\,\D t\;.
\end{equation}\]</span> Several aspects of this are noteworthy. First, as noted earlier, the delta hedge (being long <span class="math inline">\(\delta\)</span> shares of the underlying) eliminates the exposure to changes in the price of the underlying—there is no <span class="math inline">\(\D S\)</span> term in <a href="#hedgeprofits" data-reference-type="eqref" data-reference="hedgeprofits">[hedgeprofits]</a>. Second, <span class="math inline">\(\Theta\)</span> will be negative, because it captures the time decay in the option value; being short the option means the portfolio will profit from time decay at rate <span class="math inline">\(-\Theta\)</span>. Third, this portfolio is “short gamma.” We can also say it is “short convexity,” the term “convexity” referring to the convex shape of the option value as a function of the price of the underlying, which translates mathematically to a positive second derivative (gamma). The volatility in the stock makes convexity valuable, and a portfolio that is short convexity will suffer losses. Finally, the portfolio is earning dividends but paying interest.</p>
<p>It is straightforward to check, from the definitions of <span class="math inline">\(\Theta\)</span>, <span class="math inline">\(\Gamma\)</span> and <span class="math inline">\(\delta\)</span> in the preceding section, that the sum of the terms in <a href="#hedgeprofits" data-reference-type="eqref" data-reference="hedgeprofits">[hedgeprofits]</a> is zero. The time decay in the option value and dividends received on the shares of the underlying exactly offset the losses due to convexity and interest. Therefore, the delta hedge is a perfect hedge. The portfolio, which has a zero cost, neither earns nor loses money. This is true not only on average but for every possible change in the stock price.</p>
<p>To see how well this works with only discrete adjustments to the hedge, one can simulate the changes in <span class="math inline">\(S\)</span> over time and sum the gains and losses over discrete rebalancing periods. One should input the actual (not risk-neutral) expected rate of return on the asset to compute the actual distribution of gains and losses. This is discussed further in Sect. <a href="#s_blackscholes_vba" data-reference-type="ref" data-reference="s_blackscholes_vba">[s_blackscholes_vba]</a>.</p>
</section>
<section id="s_gammahedging" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Gamma Hedging</h1>
<p>To attempt to improve the performance of a discretely rebalanced delta hedge, one can use another option to create a portfolio that is both delta and gamma neutral. Being delta neutral means hedged as in the previous section—the portfolio value has no exposure to changes in the underlying asset price. In other words, it means that the derivative of the portfolio value with respect to the price of the underlying (the portfolio delta) is zero. Being gamma neutral means that the delta of the portfolio has no exposure to changes in the underlying price, which is equivalent to the second derivative of the portfolio value with respect to the price of the underlying (the portfolio gamma) being zero. If the delta truly did not change, then there would be no need to rebalance continuously, and hence no hedging error introduced by only adjusting the portfolio at discrete times rather than continuously. However, there is certainly no guarantee that a discretely-rebalanced delta/gamma hedge will perform better than a discretely rebalanced delta hedge.</p>
<p>A delta/gamma hedge can be constructed as follows. Suppose we have written (shorted) a call option and we want to hedge both the delta and gamma using the underlying asset and another option, for example, another call option with a different strike. In practice, one would want to use a liquid option for this purpose, which typically means that the strike of the option will be near the current value of the underlying (i.e., the option used to hedge would be approximately at the money).</p>
<p>Let <span class="math inline">\(\delta\)</span> and <span class="math inline">\(\Gamma\)</span> denote the delta and gamma of the written option and let <span class="math inline">\(\delta'\)</span> and <span class="math inline">\(\Gamma'\)</span> denote the delta and gamma of the option used to hedge. Consider holding <span class="math inline">\(a\)</span> of shares of the stock and <span class="math inline">\(b\)</span> units of the option used to hedge in conjunction with the short option. The delta of the stock is one (<span class="math inline">\(\D S/\D S = 1\)</span>), so to obtain a zero portfolio delta we need <span class="math display">\[\begin{align}
0 &amp;= - \delta + a + b\delta'.\label{portfoliodelta}
\intertext{The gamma of the stock is zero ($\D^2 S/\D S^2 = d\,1/\D S = 0$), so to obtain a zero portfolio gamma we need}
0 &amp;= - \Gamma + b\Gamma'\;. \label{portfoliogamma}
\end{align}\]</span> Equation <a href="#portfoliogamma" data-reference-type="eqref" data-reference="portfoliogamma">[portfoliogamma]</a> shows that we should hold enough of the second option to neutralize the gamma of the option we have shorted; i.e., <span class="math display">\[\begin{align*}
b&amp;= \frac{\Gamma}{\Gamma'}
\intertext{Equation \eqref{portfoliodelta} shows that we should use the stock to delta hedge the portfolio of options; i.e.,}
a&amp;=\delta - \frac{\Gamma}{\Gamma'}\delta'\;.
\end{align*}\]</span></p>
</section>
<section id="s_impliedvolatility" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Implied Volatilities</h1>
<p>All of the inputs into the option pricing formulas are in theory observable, except for the volatility coefficient <span class="math inline">\(\sigma\)</span>. We can estimate <span class="math inline">\(\sigma\)</span> from historical data (see Chap. <a href="Chapter4.html" data-reference-type="ref" data-reference="c_stochasticvolatility">[c_stochasticvolatility]</a>), or estimate it from the prices of other options. The latter method exploits the fact that there is a one-to-one relationship between the price given by the Black-Scholes formula and the <span class="math inline">\(\sigma\)</span> that is input, so one can take the price as given and infer <span class="math inline">\(\sigma\)</span> from the formula. The <span class="math inline">\(\sigma\)</span> computed in this way is called the “implied volatility.” The implied volatility from one option can be used to price another (perhaps non-traded or less actively traded) option. The calculation of implied volatilities is discussed in Sect. <a href="#s_blackscholes_vba" data-reference-type="ref" data-reference="s_blackscholes_vba">[s_blackscholes_vba]</a>.</p>
<p>Even if we acknowledge that the model is not correct, the computation of implied volatilities is still useful for characterizing market prices, because we can quickly describe an option as “expensive” or “cheap” depending on whether its implied volatility is large or small. Somewhat paradoxically, it is less easy to see if an option is expensive or cheap by looking at its price, because one must consider the price in the context of the exercise price and maturity. To some extent, the implied volatility normalizes the price relative to the exercise price and maturity. Of course, it does not always pay to sell expensive options or buy cheap options, unless they are expensive or cheap relative to an accurate model!</p>
</section>
<section id="s_timevaryingvolatility" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Term Structure of Volatility</h1>
<p>The option pricing formulas in this chapter are derived from the fact that the natural logarithm of the stock price at maturity is normally distributed with a certain mean (depending on the numeraire) and variance equal to <span class="math inline">\(\sigma^2T\)</span>. It is not actually necessary that the volatility be constant. The formulas are still valid if <span class="math display">\[\frac{\D S(t)}{S(t)}= \mu(t)\,\D t + \sigma(t)\,\D B(t)\]</span> where <span class="math inline">\(\sigma(t)\)</span> is some non-random function of time (and again <span class="math inline">\(\mu\)</span> can be a quite general random process). In this case, the variance of <span class="math inline">\(\log S(T)\)</span> will be <span class="math display">\[\begin{equation}\label{totalvariance}
\int_0^T \sigma^2(t)\,\D t\;,
\end{equation}\]</span> which is essentially the sum of the instantaneous variances <span class="math inline">\(\sigma^2(t)\,\D t\)</span>. In the <span class="math inline">\(d_1\)</span>’s and <span class="math inline">\(d_2\)</span>’s in the option pricing formulas, <span class="math inline">\(\sigma^2T\)</span> should be replaced by <a href="#totalvariance" data-reference-type="eqref" data-reference="totalvariance">[totalvariance]</a>. A convenient way of expressing this is as follows. Let <span class="math inline">\(\sigma_{\text{avg}}\)</span> be the positive number such that <span class="math display">\[\begin{equation}\label{sigmaavg100}
\sigma_{\text{avg}}^2 = \frac{1}{T}\int_0^T \sigma^2(t)\,\D t\;.
\end{equation}\]</span> Then we simply need to input <span class="math inline">\(\sigma_{\text{avg}}\)</span> as <code>sigma</code> in our option pricing functions. We will call <span class="math inline">\(\sigma_{\text{avg}}\)</span> the “average volatility,” though note that it is not really the average of <span class="math inline">\(\sigma(t)\)</span> but instead is the square root of the average of <span class="math inline">\(\sigma^2(t)\)</span>.</p>
<p>It is important to recognize that, throughout this chapter, date 0 means the date at which the option is being valued. It is not necessarily the date at which the option was first bought or sold. So <span class="math inline">\(\sigma_{\text{avg}}\)</span> is the average (in a sense) volatility during the remaining lifetime of the option, which need not be the same as the average during the option’s entire lifetime. It is this remaining volatility that is important for pricing and hedging. Moreover, it is a mistake at date 0 to use <span class="math inline">\(\sigma(0)\)</span> as the volatility to compute prices and hedges. Instead, prices and hedges should be based on <span class="math inline">\(\sigma_{\text{avg}}\)</span>.</p>
<p>These considerations provide a way to address the following situation. If we compute implied volatilities for options with different maturities, we will normally get different numbers. For example, consider two at-the-money options with maturities <span class="math inline">\(T_1\)</span> and <span class="math inline">\(T_2\)</span> where <span class="math inline">\(T_2&gt;T_1\)</span>. Denote the implied volatilities by <span class="math inline">\(\hat{\sigma}_1\)</span> and <span class="math inline">\(\hat{\sigma}_2\)</span>. We want to interpret these as average volatilities for the time periods <span class="math inline">\([0,T_1]\)</span> and <span class="math inline">\([0,T_2]\)</span> respectively. This requires the existence of a function <span class="math inline">\(\sigma(t)\)</span> such that</p>
<p><span class="math display">\[\hat{\sigma}_1^2 = \frac{1}{T_1}\int_0^{T_1} \sigma^2(t)\,\D t \quad \text{and} \quad \hat{\sigma}_2^2 = \frac{1}{T_2}\int_0^{T_2} \sigma^2(t)\,\D t\; .\]</span> This would imply <span class="math display">\[\hat{\sigma}_2^2T_2 - \hat{\sigma}_1^2T_1 = \int_{T_1}^{T_2} \sigma^2(t)\,\D t\; ,\]</span> which requires <span class="math display">\[\hat{\sigma}_2^2T_2 - \hat{\sigma}_1^2T_1 \geq 0\; .\]</span> Equivalently, <span class="math display">\[\hat{\sigma}_2 \geq \sqrt{\frac{T_1}{T_2}} \hat{\sigma}_1\; .\]</span> Provided this last inequality is satisfied, we can easily construct the function <span class="math inline">\(\sigma(t)\)</span> as <span class="math display">\[\sigma(t) = \begin{cases} \hat{\sigma}_1 &amp; \quad\text{for $t\leq T_1$} \\
\sqrt{\frac{\hat{\sigma}_2^2T_2 - \hat{\sigma}_1^2T_1}{T_2-T_1}} &amp;\quad\text{for $T_1 &lt; t\leq T_2$}.
\end{cases}\]</span> More generally, given a sequence of at-the-money options with maturities <span class="math inline">\(T_1&lt;T_2&lt;\cdots T_N\)</span> and implied volatilities <span class="math inline">\(\hat{\sigma}_1,\dots,\hat{\sigma}_N\)</span>, we define <span class="math display">\[\sigma(t) = \sqrt{\frac{\hat{\sigma}_{i+1}^2T_{i+1} - \hat{\sigma}_i^2T_i}{T_{i+1}-T_i}}\]</span> for <span class="math inline">\(T_i&lt;t\leq T_{i+1}\)</span>, provided the expression inside the square root symbol is positive. This <span class="math inline">\(\sigma(t)\)</span> is often called the ``term structure of (implied) volatilities.’’ Generally, we may expect <span class="math inline">\(\sigma(t)\)</span> to be a decreasing function of time <span class="math inline">\(t\)</span> when the current market is especially volatile and to be an increasing function when the current market is especially quiet.</p>
</section>
<section id="s_smiles" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Smiles and Smirks</h1>
<p>If we compute implied volatilities for options with the same maturity but different strikes, we will again obtain different implied volatilities for different options. If we plot implied volatility against the strike, the pattern one normally sees for equities and equity indices is the implied volatility declining as the strike increases until the strike is somewhere near the current value of the underlying (so the option is at the money). The implied volatility will then generally flatten out or increase slightly at higher strikes. The graph looks like a twisted smile (smirk). This pattern has been very pronounced in equity index option prices since the crash of 1987. In contrast to the term structure of implied volatilities, this “moneyness” structure of implied volatilities is simply inconsistent with the model. It suggests that the risk-neutral return distribution is not lognormal but instead exhibits a higher likelihood of extreme returns than the lognormal distribution (i.e., it has “fat tails”) with the likelihood of extreme negative returns being higher than the likelihood of extreme positive returns (i.e., it is “skewed”). We will return to this subject in Sect. <a href="Chapter4.html#s_smilesagain" data-reference-type="ref" data-reference="s_smilesagain">[s_smilesagain]</a>.</p>
</section>
<section id="s_blackscholes_vba" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> Calculations in VBA</h1>
<p>The Black-Scholes call and put formulas and Greeks can easily be calculated in an Excel worksheet, using the standard functions <code>Exp</code>, <code>Ln</code> and the cumulative normal distribution function, which is provided in Excel as <code>NormSDist</code>. However, if these are to be used repeatedly, it is useful to create functions in VBA. In VBA, the cumulative normal distribution function is called <code>Application.NormSDist</code>. Also, the natural logarithm function in VBA is <code>Log</code> rather than <code>Ln</code> and the square root function in VBA is <code>Sqr</code> rather than <code>Sqrt</code>.</p>
<section id="black-scholes-call-and-put-formulas" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="black-scholes-call-and-put-formulas">Black-Scholes Call and Put Formulas</h2>
<p>The following function implements the Black-Scholes call pricing formula. For the sake of completeness, the function returns a value even when a volatility of zero is input, in which case the formula <a href="#blackscholescall" data-reference-type="eqref" data-reference="blackscholescall">[blackscholescall]</a> is invalid (it involves division by zero in the calculation of <span class="math inline">\(d_1\)</span> and <span class="math inline">\(d_2\)</span>). If the volatility is zero, then the stock is riskless and should appreciate at rate <span class="math inline">\(r-q\)</span>. Moreover the option is riskless and its date–0 value should be the date–T value discounted at the risk-free rate. This implies that the call value at date 0 is<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>

It is useful to note that
gives the same result as
<p>In the latter formulation, we view the underlying asset as the portfolio which starts with <span class="math inline">\(\E^{-qT}\)</span> shares of the asset and reinvests dividends until date <span class="math inline">\(T\)</span>. This portfolio has value <span class="math inline">\(S(T)\)</span> at date <span class="math inline">\(T\)</span>, so a European call option on this non-dividend-paying portfolio is equivalent to a European call option on the stock. The initial value of the portfolio is <span class="math inline">\(\E^{-qT}S(0)\)</span>, which is input as the asset price in the latter formulation.</p>
The Black-Scholes formula for the value of a European put option can be implemented as follows.

</section>
<section id="black-scholes-greeks" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="black-scholes-greeks">Black-Scholes Greeks</h2>
<p>The delta and gamma of a European call option can be computed with the following functions. The other Greeks are obviously calculated in a similar manner. Note that the constant <span class="math inline">\(\pi = 3.14159...\)</span> is provided in Excel as the “function” <code>Pi()</code> and can be accessed in Excel VBA as <code>Application.Pi</code>.</p>


</section>
<section id="implied-volatilities" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="implied-volatilities">Implied Volatilities</h2>
<p>We could find an implied volatility using the Solver tool, but then we would have to re-run Solver each time we changed one of the input values. We will need to solve similar problems on several occasions, so it seems worthwhile to program a Solver-like function in VBA. We will write this in such a way that it can easily be applied in other contexts. We will assume there is a single variable for which we want to solve, solving for multiple variables being more difficult.</p>
Letting denote the market price of a European call option, the implied volatility is satisfying
The solution of this equation is called a ``root’’ of the function
<p>and the problem of finding roots of functions is a standard numerical problem. Roots are found by what are essentially sophisticated trial-and-error methods. The simplest method is to start with upper and lower bounds for <span class="math inline">\(\sigma\)</span> and repeatedly bisect the interval containing <span class="math inline">\(\sigma\)</span>, each time finding a new upper or lower bound. The program below is a standard bisection routine.</p>
<p>For there to be a volatility that equates the market price to the Black-Scholes price, it is necessary for the call option price to satisfy the arbitrage bound<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> <span class="math inline">\(C +\E^{-rT}K \geq \E^{-qT}S\)</span>. We check this condition at the beginning of the program and supply an error message if it is violated.</p>
<p>We need to input all of the inputs of other than~<span class="math inline">\(\sigma\)</span>, and we need to input the call option price. The following uses an error tolerance of <span class="math inline">\(10^{-6}\)</span>. Therefore, the value that is returned will equal the exact implied volatility to at least five decimal places. The bisection is begun with a lower bound of <span class="math inline">\(\sigma =0\)</span>. An iterative procedure is used to find an upper bound, starting with <span class="math inline">\(\sigma = 100\)</span>%.</p>
<p>This same algorithm can be used to find a real number <span class="math inline">\(x\)</span> such that <span class="math inline">\(f(x)=0\)</span> for any (continuous) function <span class="math inline">\(f\)</span>. The only changes necessary are in the right hand sides of the assignment statements for <code>flower</code>, <code>fupper</code>, and <code>fguess</code> and in finding lower and upper bounds (and obviously one would not check the arbitrage bound in general).<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> We will use this algorithm on several occasions to find roots of functions.</p>

<p>To compute an implied volatility from a put option price, one can first compute a corresponding call option price from put-call parity and then run the above program.</p>
There are faster root-finding methods than bisection. These use other methods to update the guess than just halving the distance between the prior guess and the upper or lower bound. For example, one can use the vega (the derivative of the option formula with respect to <span class="math inline">\(\sigma\)</span>) at the given guess for <span class="math inline">\(\sigma\)</span> and replace the bisection with
This amounts to approximating the Black-Scholes formula as being linear in <span class="math inline">\(\sigma\)</span> and using the root of the approximation as the updated guess. This is the essence of the <em>Newton-Raphson</em> method. A similar idea that does not require the computation of vega is to keep track of the two most recent (<code>guess</code>, <code>call</code>) pairs and to approximate <code>vega</code> as:
<p>This is the essence of the method. </p>
</section>
<section id="discretely-rebalanced-delta-hedges" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="discretely-rebalanced-delta-hedges">Discretely-Rebalanced Delta Hedges</h2>
<p>To compute the real-world distribution of gains and losses from a discretely-rebalanced delta hedge, we input the expected rate of return <span class="math inline">\(\mu\)</span>. We consider adjusting the hedge at dates <span class="math inline">\(0=t_0&lt;t_1&lt;\cdots&lt;t_N=T\)</span>, with <span class="math inline">\(t_i-t_{i-1}=\varDelta t = T/N\)</span> for each <span class="math inline">\(i\)</span>. The changes in the natural logarithm of the stock price between successive dates <span class="math inline">\(t_{i-1}\)</span> and <span class="math inline">\(t_i\)</span> are simulated as</p>
<p><span class="math display">\[\varDelta \log S = \left(\mu-q-\frac{1}{2}\sigma^2\right)\,\varDelta t + \sigma\,\varDelta B\; ,\]</span> where <span class="math inline">\(\varDelta B\)</span> is normally distributed with mean zero and variance <span class="math inline">\(\varDelta t\)</span>. The random variables <span class="math inline">\(\varDelta B\)</span> are simulated as standard normals multiplied by <span class="math inline">\(\sqrt{\varDelta t}\)</span>. We begin with the portfolio that is short a call, long <span class="math inline">\(\delta\)</span> shares of the underlying, and short <span class="math inline">\(\delta S-C\)</span> in cash. After the stock price changes, say from <span class="math inline">\(S\)</span> to <span class="math inline">\(S'\)</span>, we compute the new delta <span class="math inline">\(\delta'\)</span>. The cash flow from adjusting the hedge is <span class="math inline">\((\delta-\delta')S'\)</span>. Accumulation (or payment) of interest on the cash position is captured by the factor <span class="math inline">\(e^{r\varDelta t}\)</span>. Continuous payment of dividends is modelled similarly: the dividends earned during the period <span class="math inline">\(\varDelta t\)</span> is taken to be <span class="math inline">\(\delta S\left(e^{q\varDelta t}-1\right)\)</span>. The cash position is adjusted due to interest, dividends, and the cash flow from adjusting the hedge. At date <span class="math inline">\(T\)</span>, the value of the portfolio is the cash position less the intrinsic value of the option.</p>
<p>To describe the distribution of gains and losses, we compute percentiles of the distribution. You should see that the hedge becomes more nearly perfect as the number of periods <span class="math inline">\(N\)</span> is increased. Note that this is true regardless of the <span class="math inline">\(\mu\)</span> that is input, which reaffirms the point that option values and hedges do not depend on the expected rate of return of the underlying. The percentile is calculated with the Excel <code>Percentile</code> function.<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>

</section>
</section>
<section id="problems" class="level1 unnumbered">
<h1 class="unnumbered">Problems</h1>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>If numsims = 11 and pct =0.1, the percentile function returns the second lowest element in the series. The logic is that 10% of the numbers, excluding the number returned, are below the number returned—i.e., 1 out of the other 10 are below—and 90% of the others are above. In particular, if pct = 0.5, the percentile function returns the median. When necessary, the function interpolates; for example, if numsims = 10 and pct=0.1, then the number returned is an interpolation between the lowest and second lowest numbers.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>If numsims = 11 and pct =0.1, the percentile function returns the second lowest element in the series. The logic is that 10% of the numbers, excluding the number returned, are below the number returned—i.e., 1 out of the other 10 are below—and 90% of the others are above. In particular, if pct = 0.5, the percentile function returns the median. When necessary, the function interpolates; for example, if numsims = 10 and pct=0.1, then the number returned is an interpolation between the lowest and second lowest numbers.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>If numsims = 11 and pct =0.1, the percentile function returns the second lowest element in the series. The logic is that 10% of the numbers, excluding the number returned, are below the number returned—i.e., 1 out of the other 10 are below—and 90% of the others are above. In particular, if pct = 0.5, the percentile function returns the median. When necessary, the function interpolates; for example, if numsims = 10 and pct=0.1, then the number returned is an interpolation between the lowest and second lowest numbers.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>If numsims = 11 and pct =0.1, the percentile function returns the second lowest element in the series. The logic is that 10% of the numbers, excluding the number returned, are below the number returned—i.e., 1 out of the other 10 are below—and 90% of the others are above. In particular, if pct = 0.5, the percentile function returns the median. When necessary, the function interpolates; for example, if numsims = 10 and pct=0.1, then the number returned is an interpolation between the lowest and second lowest numbers.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>If numsims = 11 and pct =0.1, the percentile function returns the second lowest element in the series. The logic is that 10% of the numbers, excluding the number returned, are below the number returned—i.e., 1 out of the other 10 are below—and 90% of the others are above. In particular, if pct = 0.5, the percentile function returns the median. When necessary, the function interpolates; for example, if numsims = 10 and pct=0.1, then the number returned is an interpolation between the lowest and second lowest numbers.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>If numsims = 11 and pct =0.1, the percentile function returns the second lowest element in the series. The logic is that 10% of the numbers, excluding the number returned, are below the number returned—i.e., 1 out of the other 10 are below—and 90% of the others are above. In particular, if pct = 0.5, the percentile function returns the median. When necessary, the function interpolates; for example, if numsims = 10 and pct=0.1, then the number returned is an interpolation between the lowest and second lowest numbers.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>If numsims = 11 and pct =0.1, the percentile function returns the second lowest element in the series. The logic is that 10% of the numbers, excluding the number returned, are below the number returned—i.e., 1 out of the other 10 are below—and 90% of the others are above. In particular, if pct = 0.5, the percentile function returns the median. When necessary, the function interpolates; for example, if numsims = 10 and pct=0.1, then the number returned is an interpolation between the lowest and second lowest numbers.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Chapter2.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Continuous-Time Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Chapter4.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Estimating and Modelling Volatility</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>