<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>13&nbsp; Merton, Black, and Margrabe – Pricing and Hedging Derivative Securities: Theory and Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Chapter_Asians.html" rel="next">
<link href="./Chapter_FX.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-933f24a0c1e0be8a62c2179459603458.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-217607b4065b1a3128a07792af3f8e33.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>



<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

<script type="text/javascript">

window.PlotlyConfig = {MathJaxConfig: 'local'};

if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}

if (typeof require !== 'undefined') {

require.undef("plotly");

requirejs.config({

    paths: {

        'plotly': ['https://cdn.plot.ly/plotly-2.35.2.min']

    }

});

require(['plotly'], function(Plotly) {

    window._Plotly = Plotly;

});

}

</script>



<style>
div.callout-WritingToDo.callout {
  border-left-color: #a7f2d8;
}
div.callout-WritingToDo.callout-style-default > .callout-header {
  background-color: rgba(167, 242, 216, 0.13);
}
div.callout-WritingToDo .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-WritingToDo.callout-style-default .callout-icon::before, div.callout-WritingToDo.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Principle.callout {
  border-left-color: #e3aab2;
}
div.callout-Principle.callout-style-default > .callout-header {
  background-color: rgba(227, 170, 178, 0.13);
}
div.callout-Principle .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Principle.callout-style-default .callout-icon::before, div.callout-Principle.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Example.callout {
  border-left-color: #e8cc97;
}
div.callout-Example.callout-style-default > .callout-header {
  background-color: rgba(232, 204, 151, 0.13);
}
div.callout-Example .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Example.callout-style-default .callout-icon::before, div.callout-Example.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Extra.callout {
  border-left-color: #d5deed;
}
div.callout-Extra.callout-style-default > .callout-header {
  background-color: rgba(213, 222, 237, 0.13);
}
div.callout-Extra .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Extra.callout-style-default .callout-icon::before, div.callout-Extra.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Done.callout {
  border-left-color: #e8cc97;
}
div.callout-Done.callout-style-default > .callout-header {
  background-color: rgba(232, 204, 151, 0.13);
}
div.callout-Done .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Done.callout-style-default .callout-icon::before, div.callout-Done.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Exercise.callout {
  border-left-color: #ede29d;
}
div.callout-Exercise.callout-style-default > .callout-header {
  background-color: rgba(237, 226, 157, 0.13);
}
div.callout-Exercise .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Exercise.callout-style-default .callout-icon::before, div.callout-Exercise.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Rule.callout {
  border-left-color: #a1bced;
}
div.callout-Rule.callout-style-default > .callout-header {
  background-color: rgba(161, 188, 237, 0.13);
}
div.callout-Rule .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Rule.callout-style-default .callout-icon::before, div.callout-Rule.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-InProgress.callout {
  border-left-color: #eaacf2;
}
div.callout-InProgress.callout-style-default > .callout-header {
  background-color: rgba(234, 172, 242, 0.13);
}
div.callout-InProgress .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-InProgress.callout-style-default .callout-icon::before, div.callout-InProgress.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-CodeToDo.callout {
  border-left-color: #eb4034;
}
div.callout-CodeToDo.callout-style-default > .callout-header {
  background-color: rgba(235, 64, 52, 0.13);
}
div.callout-CodeToDo .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-CodeToDo.callout-style-default .callout-icon::before, div.callout-CodeToDo.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter_BlackScholes.html">Part IV: Black-Scholes and Extensions</a></li><li class="breadcrumb-item"><a href="./Chapter_Merton.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Merton, Black, and Margrabe</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Pricing and Hedging Derivative Securities: Theory and Methods</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/math-finance-book/book-code.git" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Options.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Options</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Futures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Futures and Swaps</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: Mathematical Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Intro_Binomial_Tree.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Brownian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Brownian Motion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Ito.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Ito Processes and Ito’s Formula</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_GBM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Geometric Brownian Motion</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: Arbitrage Pricing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Arbitrage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Foundations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Deltas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Delta Hedges, Replication, and PDEs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_DigitalsMeasures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Digitals and Measures</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Part IV: Black-Scholes and Extensions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_BlackScholes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Black-Scholes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Americans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">American Options</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FX.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">FX and Quantos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Merton.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Merton, Black, and Margrabe</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Asians.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Asians, Baskets, and Spreads</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Exotics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Other Exotics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Part V: Alternative Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_GARCH.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">GARCH Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_StochasticVol.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Stochastic Volatility</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Jumps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Jumps</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_VarianceSwaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Variance Swaps</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Part VI: Numerical Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_MonteCarlo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Monte Carlo Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Binomial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Binomial and Trinomial Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_PDEs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">PDE Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Fourier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Fourier Transforms</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_MachineLearning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Machine Learning</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Part VII: Fixed Income</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FixedIncome.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Fixed-Income Concepts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FixedIncomeDerivatives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Fixed-Income Derivatives</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Vasicek.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Vasicek and Extensions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Survey.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Term Structure Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendix</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./AppendixA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Miscellaneous Facts about Continuous-Time Models</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter_BlackScholes.html">Part IV: Black-Scholes and Extensions</a></li><li class="breadcrumb-item"><a href="./Chapter_Merton.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Merton, Black, and Margrabe</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-c:forwardexchange" class="quarto-section-identifier"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Merton, Black, and Margrabe</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="a6821321" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display">
<script type="text/javascript" async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_SVG"></script>
</div>
</div>
<p>In this chapter, we will derive three important generalizations of the Black-Scholes formula. We will derive them from the Black-Scholes formula, which shows that all of the formulas are equivalent. We will start with Margrabe’s <span class="citation" data-cites="Margrabe">(<a href="#ref-Margrabe" role="doc-biblioref">Margrabe 1978</a>)</span> formula for an option to exchange one asset for another. Standard calls and puts are special cases, involving the exchange of cash for an asset or an asset for cash. From Margrabe’s formula, we will derive Black’s <span class="citation" data-cites="Black">(<a href="#ref-Black" role="doc-biblioref">Black 1976</a>)</span> formulas for options on forward and futures contracts. Then, from Black’s formulas, we will derive Merton’s <span class="citation" data-cites="Merton">(<a href="#ref-Merton" role="doc-biblioref">Merton 1973</a>)</span> formulas for calls and puts in the absence of a constant risk-free rate.</p>
<p>Unless explicitly stated otherwise, we will not assume in this chapter the existence of a risk-free asset (or even an instantaneously risk-free asset as described in <a href="Chapter_Arbitrage.html" class="quarto-xref"><span>Chapter 7</span></a>). This implies that the market is incomplete and there are many risk-neutral probabilitys. Nevertheless, we can price exchange options, forward and futures options, and stock options by arbitrage. Understanding this issue is not essential for deriving the formulas in this chapter—as mentioned, they will all be derived from the Black-Scholes formula—but the issue is nonetheless important. It is discussed in the final section of the chapter.</p>
<p>Naturally, all of the option-pricing formulas discussed in this chapter are quite similar. The similarity can be seen from the Black-Scholes formula for a call option, which we can write as follows (replacing <span class="math inline">\(d_1\)</span> by <span class="math inline">\(x\)</span> and <span class="math inline">\(d_2\)</span> by <span class="math inline">\(y\)</span>): <span id="eq-blackscholesagain"><span class="math display">\[
\mathrm{e}^{-qT}S_0\mathrm{N}(x) - \mathrm{e}^{-rT}K\mathrm{N}(y)\;,
\qquad(13.1)\]</span></span></p>
<p>where</p>
<p><span id="eq-d1again"><span class="math display">\[
x=\frac{\log\left(\frac{S_0}{K}\right)+\left(r-q+\frac{1}{2}\sigma^2\right)T}{\sigma\sqrt{T}}
\qquad(13.2)\]</span></span></p>
<p><span id="eq-d2again"><span class="math display">\[
y = x -\sigma\sqrt{T}\;.
\qquad(13.3)\]</span></span></p>
<p>Note that <span class="math inline">\(\mathrm{e}^{-qT}S_0\)</span> is the present value at date <span class="math inline">\(0\)</span> of the stock that would be acquired if the option is exercised, because it is the cost that one must pay at date <span class="math inline">\(0\)</span> to have one share of the stock at date <span class="math inline">\(T\)</span> with no withdrawal of dividends in the interim. Obviously, <span class="math inline">\(\mathrm{e}^{-rT}K\)</span> is the present value of the cash that is paid if the option is exercised. Moreover, <span class="math inline">\(x\)</span> is equal to <span class="math display">\[\frac{\log \left(\frac{\mathrm{e}^{-qT}S_0}{\mathrm{e}^{-rT}K} \right)+ \frac{1}{2}\sigma^2T}{\sigma\sqrt{T}}\; ,\]</span> and the logarithm in the numerator is of the ratio of present values. All of the option pricing formulas in this chapter have the same form: the present value of the asset to be acquired multiplied by <span class="math inline">\(\mathrm{N}(x)\)</span> minus the present value of the asset to be delivered multiplied by <span class="math inline">\(\mathrm{N}(y)\)</span>. Moreover in each case <span class="math inline">\(x\)</span> is the logarithm of the ratio of present values plus one-half <span class="math inline">\(\sigma^2T\)</span> all divided by <span class="math inline">\(\sigma\sqrt{T}\)</span>, and in each case <span class="math inline">\(y\)</span> is defined by <a href="#eq-d2again" class="quarto-xref">Equation&nbsp;<span>13.3</span></a>. Notice that the Black-Scholes put option formula has this structure also. The Black-Scholes put option formula is <span id="eq-blackscholesputagain"><span class="math display">\[
\mathrm{e}^{-rT}K\mathrm{N}(x) - \mathrm{e}^{-qT}S_0\mathrm{N}(y)\;,
\qquad(13.4)\]</span></span></p>
<p>where</p>
<p><span class="math display">\[
x =-d_2
=  - \frac{\log\left(\frac{S_0}{K}\right)+\left(r-q-\frac{1}{2}\sigma^2\right)T}{\sigma\sqrt{T}}
\]</span> <span id="eq-d2again2"><span class="math display">\[
=\frac{\log \left(\frac{\mathrm{e}^{-rT}K}{\mathrm{e}^{-qT}S_0} \right)+ \frac{1}{2}\sigma^2T}{\sigma\sqrt{T}}\;,
\qquad(13.5)\]</span></span></p>
<p><span class="math display">\[
y=-d_1
= - \frac{\log\left(\frac{S_0}{K}\right)+\left(r-q+\frac{1}{2}\sigma^2\right)T}{\sigma\sqrt{T}}
=x - \sigma\sqrt{T}\;.
\]</span> This similarity is discussed further in later, where the pricing formulas are implemented in Python.</p>
<section id="sec-s:margrabe" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="sec-s:margrabe"><span class="header-section-number">13.1</span> Margrabe’s Formula</h2>
<p>Consider two assets with prices <span class="math inline">\(S_1\)</span> and <span class="math inline">\(S_2\)</span> and a European option to exchange asset 2 for asset 1 at date <span class="math inline">\(T\)</span>. The value of the option at maturity is <span class="math display">\[\max(0,S_1_T-S_2_T)\; .\]</span> Note that there is no real difference between a put and a call: the exchange option can be viewed as a call on the first asset with random strike <span class="math inline">\(S_2_T\)</span> or as a put on the second asset with random strike <span class="math inline">\(S_1_T\)</span>.</p>
<p>Assume the assets pay constant dividend yields <span class="math inline">\(q_i\)</span> and assume the prices satisfy <span class="math display">\[\frac{\,\mathrm{d}S_i}{S_i} = \mu_i\,\mathrm{d}t+\sigma_i\,\mathrm{d}B_i\]</span> where each <span class="math inline">\(B_i\)</span> is a Brownian motion under the actual probability measure. As before, the drifts <span class="math inline">\(\mu_i\)</span> can be quite general random processes. We also allow the volatilities <span class="math inline">\(\sigma_i\)</span> and the correlation <span class="math inline">\(\rho\)</span> of the Brownian motions to be random processes; however, we make the assumption that <span class="math inline">\(\sigma\)</span> defined as <span id="eq-margrabesigma"><span class="math display">\[
\sigma = \sqrt{\sigma_1^2 + \sigma_2^2 - 2\rho\sigma_1\sigma_2}
\qquad(13.6)\]</span></span></p>
<p>is a constant. As shown in <a href="Chapter_GBM.html#eq-volatilityratio" class="quarto-xref">Equation&nbsp;<span>6.17</span></a>, <span class="math inline">\(\sigma\)</span> is the volatility of <span class="math inline">\(S_1/S_2\)</span> (and also <span class="math inline">\(S_2/S_1\)</span>). So, the assumption we are making is that the volatility of the ratio of the asset prices is constant. In <a href="#sec-s:volatility" class="quarto-xref"><span>Section 13.15</span></a>, we will relax this assumption to allow <span class="math inline">\(\sigma\)</span> to be time-varying (though still non-random).</p>
<p>The following is the formula of Margrabe <span class="citation" data-cites="Margrabe">(<a href="#ref-Margrabe" role="doc-biblioref">Margrabe 1978</a>)</span>: </p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">13.2</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>The value of a European option to exchange two assets at date <span class="math inline">\(T\)</span> is <span id="eq-margrabeoption"><span class="math display">\[
\mathrm{e}^{-q_1 T}S_1_0\mathrm{N}(d_1)-\mathrm{e}^{-q_2 T}S_2_0\mathrm{N}(d_2)\;,
\qquad(13.7)\]</span></span></p>
<p>where</p>
<p><span id="eq-margrabe_d1"><span class="math display">\[
d_1= \frac{\log\left(\frac{S_1_0}{S_2_0}\right)+\left(q_2-q_1+
\frac{1}{2}\sigma^2\right)T}{\sigma\sqrt{T}}\;,
\qquad(13.8)\]</span></span></p>
<p><span id="eq-margrabe_d2"><span class="math display">\[
d_2=d_1-\sigma\sqrt{T}\;,
\qquad(13.9)\]</span></span></p>
</div>
</div>
<p>Margrabe’s derivation is a very simple argument based on the Black-Scholes formula. We noted in <a href="Chapter_FX.html" class="quarto-xref"><span>Chapter 12</span></a> that the Black-Scholes formula does not depend on the currency—if the underlying asset and risk-free asset are dollar denominated, the formula gives the dollar value of an option; if they are yen denominated, the formula gives the yen value of an option, etc. So we can take the currency to be units of the second asset; i.e., we will use the second asset as numeraire. With this numeraire, the value of the first asset is <span class="math inline">\(S_1/S_2\)</span>. The value of the exchange option at maturity is <span class="math display">\[\max(0,S_1_T-S_2_T) = S_2_T\max\left(0,\frac{S_1_T}{S_2_T}-1\right)\; .\]</span> This is the value in the natural currency (e.g., dollars). The value using the second asset as numeraire is obtained by dividing by <span class="math inline">\(S_2_T\)</span>, so it is <span class="math display">\[\max\left(0,\frac{S_1_T}{S_2_T}-1\right)\; .\]</span> This is the value of a standard call option, the underlying being the first asset measured in units of the second. We can apply the Black-Scholes formula to obtain the value of the option (in units of the second asset) at date <span class="math inline">\(0\)</span>. Multiplying this value by <span class="math inline">\(S_2_0\)</span> will give the option value in the natural currency.</p>
<p>The risk-free rate when the second asset is the numeraire is the dividend yield on the second asset <span class="math inline">\(q_2\)</span>. To see this, note that the price of the second asset is always equal to one; moreover, an investment in the second asset will accumulate at the rate <span class="math inline">\(q_2\)</span> via reinvestment of dividends. Therefore, <span class="math inline">\(q_2\)</span> is a risk-free rate of return.</p>
<p>The dividend yield on the first asset remains <span class="math inline">\(q_1\)</span>. To see this, note that the dividend paid in the natural currency is <span class="math inline">\(q_1S_1_t\,\mathrm{d}t\)</span> in an instant <span class="math inline">\(\,\mathrm{d}t\)</span> and the value of this dividend using the second asset as numeraire is <span class="math inline">\([q_1S_1_t/S_2_t]\,\mathrm{d}t\)</span>, which is the fraction <span class="math inline">\(q_1\,\mathrm{d}t\)</span> of the value <span class="math inline">\(S_1_t/S_2_t\)</span> of the first asset using the second asset as numeraire.</p>
<p>The volatility of the first asset using the second as numeraire is the volatility of the ratio <span class="math inline">\(S_1_t/S_2_t\)</span>, which is <span class="math inline">\(\sigma\)</span> defined in <a href="#eq-margrabesigma" class="quarto-xref">Equation&nbsp;<span>13.6</span></a>. Applying the Black-Scholes formula with these inputs yields Margrabe’s formula directly.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<p>In terms of programming, we could of course write entirely separate programs for the options discussed so far and those to be discussed in this chapter but it will become clear that they have common structure. As discussed in the introduction to this chapter, each is the present value of what is received upon exercise multiplied by <span class="math inline">\(\mathrm{N}(x)\)</span> minus the present value of what is delivered upon exercise multiplied by <span class="math inline">\(\mathrm{N}(y)\)</span> and <span class="math inline">\(x\)</span> in each case is the logarithm of the ratio of present values plus one-half <span class="math inline">\(\sigma^2T\)</span>, all divided by <span class="math inline">\(\sigma\sqrt{T}\)</span>. Thus, we first write a code for a generic option price. Later we use this generic option price function to price other options.</p>
<div id="6e9df3da" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generic_option(P1, P2, sigma, T):</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Inputs:</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">    P1 = present value of asset to be received</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">    P2 = present value of asset to be delivered</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">    sigma = volatility</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">    T = time to maturity</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> (np.log(P1 <span class="op">/</span> P2) <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> sigma <span class="op">**</span> <span class="dv">2</span> <span class="op">*</span> T) <span class="op">/</span> (sigma <span class="op">*</span> np.sqrt(T))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> x <span class="op">-</span> sigma <span class="op">*</span> np.sqrt(T)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    N1 <span class="op">=</span> norm.cdf(x)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    N2 <span class="op">=</span> norm.cdf(y)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> P1 <span class="op">*</span> N1 <span class="op">-</span> P2 <span class="op">*</span> N2</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>P1 <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>P2 <span class="op">=</span> <span class="dv">90</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Generic Option:"</span>, generic_option(P1, P2, sigma, T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Generic Option: 13.589108116054796</code></pre>
</div>
</div>
<p>Now we can use the following one-line programs to value exchange options.</p>
<div id="d1842c85" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> margrabe(S1, S2, sigma, q1, q2, T):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Inputs:</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">    S1 = price of asset to be received</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">    S2 = price of asset to be delivered</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">    sigma = volatility of ratio of prices</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">    q1 = dividend yield of asset to be received</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">    q2 = dividend yield of asset to be delivered</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">    T = time to maturity</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    P1 <span class="op">=</span> np.exp(<span class="op">-</span>q1 <span class="op">*</span> T) <span class="op">*</span> S1</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    P2 <span class="op">=</span> np.exp(<span class="op">-</span>q2 <span class="op">*</span> T) <span class="op">*</span> S2</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> generic_option(P1, P2, sigma, T)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>S1 <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>S2 <span class="op">=</span> <span class="dv">90</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>q1 <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>q2 <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Margrabe Option:"</span>, margrabe(S1, S2, sigma, q1, q2, T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Margrabe Option: 14.05169829758782</code></pre>
</div>
</div>
<p>We could also have calculated the Black-Scholes call formula as <span class="math display">\[
\text{Generic\_Option}(Exp(-q*T)*S, Exp(-r*T)*K, sigma, T)
\]</span></p>
<p>and the Black-Scholes put formula as</p>
<p><span class="math display">\[
\text{Generic\_Option}(Exp(-r*T)*K, Exp(-q*T)*S, sigma, T).
\]</span></p>
</section>
<section id="sec-s:black" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="sec-s:black"><span class="header-section-number">13.3</span> Black’s Formula</h2>
<p>Black <span class="citation" data-cites="Black">(<a href="#ref-Black" role="doc-biblioref">Black 1976</a>)</span> gives formulas for the values of options on futures contracts when interest rates are deterministic (i.e., non-random). It is well known (and we will establish this in <a href="#sec-s:futuresforwards" class="quarto-xref"><span>Section 13.12</span></a>) that, when interest rates are deterministic, futures prices should equal forward prices, so Black’s formulas also yield formulas for the values of options on forward contracts when interest rates are deterministic. However, the formulas for options on forwards are valid more generally (even when interest rates vary randomly) and now a mention of Black’s formulas is more likely to be referring to the formulas for options on forwards, instead of the formulas for options on futures. In any case, we will start with the formulas for options on forwards and then in <a href="#sec-s:futuresoptions" class="quarto-xref"><span>Section 13.13</span></a> derive the formulas for options on futures when interest rates are deterministic.</p>
<p>We consider a forward contract that matures at some date <span class="math inline">\(T'\)</span> and a call or put option on the forward that matures at <span class="math inline">\(T \leq T'\)</span>. The meaning of a call option on a forward is that exercise of the call creates a long position in the forward contract with forward price equal to the strike price of the option. The long forward contract means that the investor will receive the underlying asset at <span class="math inline">\(T'\)</span> and pay the forward price (the strike of the option) at <span class="math inline">\(T'\)</span>. Thus, the strike price is not paid at the date of exercise but instead is paid when the underlying asset is delivered. Symmetrically, the exercise of a put creates a short position in the forward contract with forward price equal to the strike of the put, which means that the exerciser must deliver the underlying at <span class="math inline">\(T'\)</span> and will receive the strike price at <span class="math inline">\(T'\)</span>.</p>
<p>We will denote the market forward price by <span class="math inline">\(F_t\)</span>. We assume the forward price satisfies <span id="eq-dforward"><span class="math display">\[
\frac{\,\mathrm{d}F}{F} = \mu\,\mathrm{d}t + \sigma\,\mathrm{d}B\;,
\qquad(13.10)\]</span></span></p>
<p>where <span class="math inline">\(B\)</span> is a Brownian motion. As before, <span class="math inline">\(\mu\)</span> can be a quite general random process. We will assume in this section that the volatility <span class="math inline">\(\sigma\)</span> is a constant and generalize to a time-varying (but non-random) volatility in <a href="#sec-s:volatility" class="quarto-xref"><span>Section 13.15</span></a>. In <a href="#sec-s:merton" class="quarto-xref"><span>Section 13.5</span></a>, we will discuss the relations of the forward price and its volatility to the price and volatility of the underlying.</p>
<p>Black’s formulas are particularly useful when interest rates are assumed to be random, as we will see in Part~<span class="math inline">\(\ref{p_fixedincome}\)</span> of the book when we study fixed income derivatives. Therefore, we do not assume here that there is a constant risk-free rate. Instead we will assume that there is a discount bond that pays $1 at date <span class="math inline">\(T'\)</span>. It is called a discount bond because its price is the appropriate discount factor for computing the present value of nonrandom cash flows at date <span class="math inline">\(T'\)</span>. Such a bond is also called a zero coupon bond because it does not pay any cash flows until <span class="math inline">\(T'\)</span>, when it pays its face value (which we take simply for convenience to be $1). We will let <span class="math inline">\(P(t,T')\)</span> denote the price of the bond at date <span class="math inline">\(t\)</span>.^[In this section we could drop the <span class="math inline">\(T'\)</span> in <span class="math inline">\(P(t,T')\)</span> and simply write <span class="math inline">\(P_t\)</span>, because we only consider one maturity date, but we will use the same notation when discussing multiple maturities in Part~<span class="math inline">\(\ref{p_fixedincome].}\)</span></p>
<p>Black’s formulas are: </p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">13.4</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>The values at date <span class="math inline">\(0\)</span> of European options with strike <span class="math inline">\(K\)</span> and maturity <span class="math inline">\(T\)</span> on a forward contract with maturity <span class="math inline">\(T'\)</span> are</p>
<p><span id="eq-black"><span class="math display">\[
\text{Call Price} =P(0,T')F_0\mathrm{N}(d_1)-P(0,T')K\mathrm{N}(d_2)\; ,
\qquad(13.11)\]</span></span></p>
<p><span id="eq-black_put"><span class="math display">\[
\text{Put Price} =P(0,T')K\mathrm{N}(-d_2)-P(0,T')F_0\mathrm{N}(-d_1)\; ,
\qquad(13.12)\]</span></span></p>
<p><span class="math display">\[
\]</span> where <span id="eq-black_d1"><span class="math display">\[
d_1= \frac{\log\left(\frac{F_0}{K}\right)+\frac{1}{2}\sigma^2T}{\sigma\sqrt{T}}\;,
\qquad(13.13)\]</span></span></p>
<p><span id="eq-black_d2"><span class="math display">\[
d_2=d_1-\sigma\sqrt{T}\;.
\qquad(13.14)\]</span></span></p>
</div>
</div>
<p>Black’s formulas are a simple consequence of Margrabe’s formula. To see this, we first need to describe the value of an option on a forward at the maturity date <span class="math inline">\(T\)</span> of the option. Consider a call option. Exercise of the call results in a long forward position with forward price <span class="math inline">\(K\)</span>. The value of the long forward is given by its market price <span class="math inline">\(F_T\)</span>, but we must keep in mind that the forward price is not paid until the underlying is delivered at date <span class="math inline">\(T'\)</span>. So suppose that you exercise the call and then sell a forward contract at the market forward price <span class="math inline">\(F_T\)</span>. The delivery/receipt obligations of the long and short forwards cancel, leaving you with the obligation to pay <span class="math inline">\(K\)</span> dollars at date <span class="math inline">\(T'\)</span> and with an asset of <span class="math inline">\(F_T\)</span> dollars to be received at date <span class="math inline">\(T'\)</span>. The value of the net cash flow at date <span class="math inline">\(T\)</span> is <span class="math inline">\(P(T,T')[F_T-K]\)</span>. This is the value if exercised, so the value of the call at date <span class="math inline">\(T\)</span> is <span id="eq-blackcallexchange1"><span class="math display">\[
\max\big(0, P(T,T')[F_T-K]\big) = \max\big(0,P(T,T')F_T-P(T,T')K\big)\;.
\qquad(13.15)\]</span></span></p>
<p>We can write this as <span id="eq-blackcallexchange2"><span class="math display">\[
\max(0,S_1_T-S_2_T)
\qquad(13.16)\]</span></span></p>
<p>if we define <span id="eq-blackexchange"><span class="math display">\[
S_1_t = P(t,T')F_t \quad \text{and} \quad S_2_t = P(t,T')K
\qquad(13.17)\]</span></span></p>
<p>for <span class="math inline">\(t=T\)</span> (and more generally for <span class="math inline">\(t \leq T\)</span>). Thus, the value at maturity of a call option on a forward is the value at maturity of an option to exchange the two assets with prices <span class="math inline">\(S_1\)</span> and <span class="math inline">\(S_2\)</span> (we will establish in a moment that <span class="math inline">\(S_1\)</span> and <span class="math inline">\(S_2\)</span> are actually asset prices). It follows that the value at date <span class="math inline">\(0\)</span> of a call option on a forward is the value at date <span class="math inline">\(0\)</span> of an option to exchange the two assets.</p>
<p>Now consider a put option on a forward. Exercising the put and unwinding the short forward position by buying a forward at the market price <span class="math inline">\(F_T\)</span> will leave one with a net cash flow of <span class="math inline">\(K-F_T\)</span> to be received at the maturity date <span class="math inline">\(T'\)</span> of the forward. Therefore the value of the put at maturity is <span id="eq-blackputexchange"><span class="math display">\[
\max(0,P(T,T')[K-F_T]) = \max(S_2_T-S_1_T)\;.
\qquad(13.18)\]</span></span></p>
<p>Therefore, the value at date <span class="math inline">\(0\)</span> of the put option on a forward must be the value at date <span class="math inline">\(0\)</span> of an exchange option, where asset one in <a href="#eq-blackexchange" class="quarto-xref">Equation&nbsp;<span>13.17</span></a> is exchanged for asset two.</p>
<p>The key assumption in deriving Margrabe’s formula is that the volatility of the ratio of asset prices is a constant. For a call option on a forward, the relevant ratio is <span class="math inline">\(S_1/S_2 = F/K\)</span>. Because <span class="math inline">\(K\)</span> is a constant, the volatility of the ratio is the volatility <span class="math inline">\(\sigma\)</span> of the forward price <span class="math inline">\(F\)</span>, which we have assumed to be constant. For a put option on a forward, the relevant ratio is <span class="math inline">\(S_2/S_1 = K/F\)</span>. Ito’s formula implies</p>
<p><span class="math display">\[\begin{align*}
\frac{d(K/F)}{K/F} &amp;= -\frac{\,\mathrm{d}F}{F} + \left(\frac{\,\mathrm{d}F}{F}\right)^2\; ,\\
&amp;= (-\mu +\sigma^2)\,\mathrm{d}t - \sigma\,\mathrm{d}B\\
&amp;= (-\mu+\sigma^2)\,\mathrm{d}t + \sigma (-\,\mathrm{d}B),
\end{align*}\]</span> The purpose of the last equality displayed here is to emphasize that we should take the volatility of <span class="math inline">\(K/F\)</span> to be the positive number <span class="math inline">\(\sigma\)</span>. We can do this by using <span class="math inline">\(-B\)</span> as the Brownian motion instead of <span class="math inline">\(B\)</span>.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> Thus, we can apply Margrabe’s formula to value calls and puts on forwards (once we verify that <span class="math inline">\(S_1\)</span> and <span class="math inline">\(S_2\)</span> are indeed asset prices).</p>
<p>To obtain Black’s <a href="#eq-black" class="quarto-xref">Equation&nbsp;<span>13.11</span></a> for a call on a forward from Margrabe’s <a href="#eq-margrabeoption" class="quarto-xref">Equation&nbsp;<span>13.7</span></a>, we simply substitute <span class="math inline">\(S_1_0=P(0,T')F_0\)</span>, <span class="math inline">\(S_2_0=P(0,T')K\)</span>, <span class="math inline">\(q_1=0\)</span> and <span class="math inline">\(q_2=0\)</span> in Margrabe’s formula. A put option is the reverse exchange, so Margrabe’s formula gives <span id="eq-margrabeput"><span class="math display">\[
P(0,T')K\mathrm{N}(d^m_1) - P(0,T')F_0\mathrm{N}(d^m_2)\;,
\qquad(13.19)\]</span></span></p>
<p>where <span class="math display">\[\begin{align*}
d^m_1&amp;= \frac{\log\left(\frac{P(0,T')K}{P(0,T')F_0}\right)+\frac{1}{2}\sigma^2T}{\sigma\sqrt{T}}\; ,\\
d^m_2 &amp;=d^m_1-\sigma\sqrt{T}.
\end{align*}\]</span> We introduce the superscript <span class="math inline">\(m\)</span> here to distinguish these numbers in Margrabe’s formula from the <span class="math inline">\(d_1\)</span> and <span class="math inline">\(d_2\)</span> defined in <a href="#eq-black_d1" class="quarto-xref">Equation&nbsp;<span>13.13</span></a> and <a href="#eq-black_d2" class="quarto-xref">Equation&nbsp;<span>13.14</span></a>. Notice that <span class="math display">\[\begin{align*}
d^m_1&amp; = -\frac{\log\left(\frac{F_0}{K}\right)-\frac{1}{2}\sigma^2T}{\sigma\sqrt{T}} = -d_2\\
d^m_2 &amp;= -\frac{\log\left(\frac{F_0}{K}\right)+\frac{1}{2}\sigma^2T}{\sigma\sqrt{T}} =-d_1,
\end{align*}\]</span> so Margrabe’s <a href="#eq-margrabeput" class="quarto-xref">Equation&nbsp;<span>13.19</span></a> is the same as Black’s <a href="#eq-black_put" class="quarto-xref">Equation&nbsp;<span>13.12</span></a> for a put option on a forward.</p>
<p>We still need to explain why <span class="math inline">\(S_1\)</span> and <span class="math inline">\(S_2\)</span> defined in <a href="#eq-blackexchange" class="quarto-xref">Equation&nbsp;<span>13.17</span></a> are asset prices, in fact the prices of dividend-reinvested assets since we have taken <span class="math inline">\(q_1=q_2=0\)</span> in applying Margrabe’s formula. The case of <span class="math inline">\(S_2\)</span> should be clear: it is the price of <span class="math inline">\(K\)</span> units of the discount bond maturing at <span class="math inline">\(T'\)</span>. The case of <span class="math inline">\(S_1\)</span> is more subtle. It is the price of the following portfolio constructed at date <span class="math inline">\(0\)</span> and held until date <span class="math inline">\(T\)</span>: go long one forward contract and buy <span class="math inline">\(F_0\)</span> units of the discount bond maturing at <span class="math inline">\(T'\)</span>. The value at date <span class="math inline">\(t\)</span> of the bonds in the portfolio is <span class="math inline">\(F_0P(t,T')\)</span>. The value at date <span class="math inline">\(t\)</span> of the long forward contract can be seen by considering unwinding it by selling a forward at date <span class="math inline">\(t\)</span> at the market price <span class="math inline">\(F_t\)</span>. This cancels the delivery/receipt obligations on the underlying and results in a net cash flow of <span class="math inline">\(F_t-F_0\)</span> to be received at date <span class="math inline">\(T'\)</span>. The value at date <span class="math inline">\(t\)</span> of this future cash flow is <span class="math inline">\(P(t,T')[F_t-F_0]\)</span> and when we add this to the value of the bonds we obtain <span class="math inline">\(P(t,T')F_t = S_1_t\)</span>.</p>
<p>Put-call parity for options on forwards is <span class="math display">\[\text{Call Price}  + P(0,T')K = \text{Put Price}  + P(0,T')F_0\; .\]</span> The left-hand side is the cost of the call and <span class="math inline">\(K\)</span> units of the discount bond, which have value <span class="math inline">\(\max(F_T,K)P(T,T')\)</span> at time <span class="math inline">\(T\)</span>. The right-hand side is the cost of the put option and <span class="math inline">\(F_0\)</span> units of the discount bond, which, together with a long forward contract initiated at date <span class="math inline">\(0\)</span>, also have value <span class="math inline">\(\max(F_T,K)P(T,T')\)</span> at time <span class="math inline">\(T\)</span>.</p>
<p>As in the case of exchange option, we can also write one-line programs for pricing options on futures and forwards.</p>
<div id="cde7fdd3" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> black_call(F, K, P, sigma, T):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Inputs:</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">    F = forward price</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    K = strike price</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">    P = price of discount bond maturing when forward matures</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">    sigma = volatility of forward price</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">    T = time to maturity</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">    To value a futures option, input F = futures price and P = price</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">    of discount bond maturing when option matures.</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> generic_option(P <span class="op">*</span> F, P <span class="op">*</span> K, sigma, T)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> black_put(F, K, P, sigma, T):</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">    Inputs:</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">    F = forward price</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">    K = strike price</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">    P = price of discount bond maturing when forward matures</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">    sigma = volatility of forward price</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co">    T = time to maturity</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co">    To value a futures option, input F = futures price and P = price</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co">    of discount bond maturing when option matures.</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> generic_option(P <span class="op">*</span> K, P <span class="op">*</span> F, sigma, T)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>F <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="dv">90</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> <span class="fl">0.95</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Black Call:"</span>, black_call(F, K, P, sigma, T))</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Black Put:"</span>, black_put(F, K, P, sigma, T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Black Call: 12.909652710252054
Black Put: 3.409652710252054</code></pre>
</div>
</div>
</section>
<section id="sec-s:merton" class="level2" data-number="13.5">
<h2 data-number="13.5" class="anchored" data-anchor-id="sec-s:merton"><span class="header-section-number">13.5</span> Merton’s Formula</h2>
<p>Now we reconsider the Black-Scholes model but without assuming there is a constant risk-free rate. We assume instead that there is a discount bond maturing at the same date as the option. Letting <span class="math inline">\(T\)</span> denote the maturity date of the option and discount bond, we write the price of the discount bond at dates <span class="math inline">\(t \leq T\)</span> as <span class="math inline">\(P(t,T)\)</span>. We continue to assume that the stock has a constant dividend yield <span class="math inline">\(q\)</span> but we make a different assumption about volatility—instead of assuming that the volatility of the stock is constant, we assume that the volatility of its forward price is constant. We relax this to allow time-varying but non-random volatility of the forward price in <a href="#sec-s:volatility" class="quarto-xref"><span>Section 13.15</span></a>.</p>
<p>The forward contract we consider is a forward contract for the stock maturing at the date <span class="math inline">\(T\)</span> that the option matures. Let <span class="math inline">\(F_t\)</span> denote the forward price for this contract at dates <span class="math inline">\(0 \leq t\leq T\)</span>. Because the forward price must equal the spot price at the maturity of a forward contract, we have <span class="math inline">\(F_T=S_T\)</span>. Consider a call option on the forward, with the call maturing at <span class="math inline">\(T\)</span> also. In the notation of the previous section, we have <span class="math inline">\(T'=T\)</span> and hence <span class="math inline">\(P(T,T')=1\)</span> (the discount bond is worth $1 at maturity). Therefore the value <a href="#eq-blackcallexchange1" class="quarto-xref">Equation&nbsp;<span>13.15</span></a> of the call on the forward at its maturity <span class="math inline">\(T\)</span> is <span class="math display">\[\max(0,F_T-K) = \max(0,S_T-K)\; ,\]</span> which is the same as the value of the call on the stock. Therefore, the value at date <span class="math inline">\(0\)</span> of the call on the stock must equal the value at date <span class="math inline">\(0\)</span> of the call on the forward, and we can use Black’s <a href="#eq-black" class="quarto-xref">Equation&nbsp;<span>13.11</span></a> for a call option on a forward to price a call option on the stock, assuming the forward price has a constant volatility.</p>
<p>Likewise, the value at the maturity date <span class="math inline">\(T\)</span> of a put option on the same forward contract is, from <a href="#eq-blackputexchange" class="quarto-xref">Equation&nbsp;<span>13.18</span></a>, <span class="math display">\[\max(0,K-F_T) = \max(0,K-S_T)\; .\]</span> Hence, we can use Black’s <a href="#eq-black_put" class="quarto-xref">Equation&nbsp;<span>13.12</span></a> to price a put option on the stock, assuming the forward price has a constant volatility.</p>
<p>It is not necessary that the forward contract be traded, because we can create a synthetic forward using the stock. To create a synthetic forward at date <span class="math inline">\(t\)</span> we buy <span class="math inline">\(\mathrm{e}^{-q(T-t)}\)</span> shares of the stock at cost <span class="math inline">\(\mathrm{e}^{-q(T-t)}S_t\)</span>. With reinvestment of dividends, this will accumulate to one share at date <span class="math inline">\(T\)</span>. We finance the purchase of the stock by shorting <span class="math inline">\(\mathrm{e}^{-q(T-t)}S_t/P(t,T)\)</span> units of the discount bond. This results in a liability of <span class="math inline">\(\mathrm{e}^{-q(T-t)}S_t/P(t,T)\)</span> dollars at date <span class="math inline">\(T\)</span>, so the forward purchase is arranged by promising to pay <span class="math inline">\(\mathrm{e}^{-q(T-t)}S_t/P(t,T)\)</span> dollars at the delivery date; i.e., the forward price is^[If there is a constant risk-free rate <span class="math inline">\(r\)</span>, then it must be that <span class="math inline">\(P(t,T) = \mathrm{e}^{-r(T-t)}\)</span>, so <a href="#eq-forwardprice" class="quarto-xref">Equation&nbsp;<span>13.20</span></a> becomes <span class="math display">\[F_t = \mathrm{e}^{(r-q)(T-t)}S_t\; ,\]</span> which is the same as the covered interest parity condition <a href="Chapter_FX.html#eq-forwardexchangerate" class="quarto-xref">Equation&nbsp;<span>12.2</span></a>—recall that we interpret the exchange rate as the price of an asset with dividend yield <span class="math inline">\(q=r_f\)</span>.} <span id="eq-forwardprice"><span class="math display">\[
F_t = \frac{\mathrm{e}^{-q(T-t)}S_t}{P(t,T)}\;.
\qquad(13.20)\]</span></span></p>
<p>The assumption we need to apply Black’s formulas is that <span id="eq-mertonforward"><span class="math display">\[
\frac{\,\mathrm{d}F}{F} = \mu\,\mathrm{d}t+\sigma\,\mathrm{d}B\;,
\qquad(13.21)\]</span></span></p>
<p>where <span class="math inline">\(B\)</span> is a Brownian motion, <span class="math inline">\(\mu\)</span> can be a quite general random process, and <span class="math inline">\(\sigma\)</span> is a constant. At the end of this section, we will discuss the meaning of this assumption in terms of the volatilities of the stock and bond and their correlation.</p>
<p>Under this assumption, the following formulas originally due to Merton <span class="citation" data-cites="Merton">(<a href="#ref-Merton" role="doc-biblioref">Merton 1973</a>)</span> follow immediately from Black’s formulas <a href="#eq-black" class="quarto-xref">Equation&nbsp;<span>13.11</span></a> - <a href="#eq-black_d2" class="quarto-xref">Equation&nbsp;<span>13.14</span></a> by substituting <span class="math inline">\(F_0 = \mathrm{e}^{-qT}S_0/P(0,T)\)</span>.</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">13.6</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Assuming the forward price has a constant volatility <span class="math inline">\(\sigma\)</span>, the values at date <span class="math inline">\(0\)</span> of European calls and puts maturing at date <span class="math inline">\(T\)</span> on a stock with a constant dividend yield <span class="math inline">\(q\)</span> are</p>
<p><span id="eq-mertoncall"><span class="math display">\[
\text{Call Price}  = \mathrm{e}^{-q T}S_0\mathrm{N}(d_1)-P(0,T)K\mathrm{N}(d_2)\;,
\qquad(13.22)\]</span></span></p>
<p><span id="eq-mertonput"><span class="math display">\[
\text{Put Price} = P(0,T)K\mathrm{N}(-d_2) - \mathrm{e}^{-qT}S_0\mathrm{N}(-d_1)\;,
\qquad(13.23)\]</span></span></p>
<p>where <span id="eq-merton_d1"><span class="math display">\[
d_1= \frac{\log\left(\frac{S_0}{KP(0,T)}\right)-qT+\frac{1}{2}\sigma^2T}{\sigma\sqrt{T}}\;,
\qquad(13.24)\]</span></span></p>
<p><span id="eq-merton_d2"><span class="math display">\[
d_2=d_1-\sigma\sqrt{T}\;.
\qquad(13.25)\]</span></span></p>
</div>
</div>
<p></p>
<p>These formulas are clearly similar to the Black-Scholes formulas. The similarities are made more apparent by writing the discount bond price in terms of its yield. The yield <span class="math inline">\(y\)</span> of the discount bond is defined as <span class="math display">\[y = \frac{-\log P(0,T)}{T} \qquad\Longleftrightarrow \qquad P(0,T) = \mathrm{e}^{-yT}\; .
\]</span> Substituting this into the expressions above, we have:</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">13.7</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Assuming the forward price has a constant volatility <span class="math inline">\(\sigma\)</span>, the values at date <span class="math inline">\(0\)</span> of European calls and puts maturing at date <span class="math inline">\(T\)</span> on a stock with a constant dividend yield <span class="math inline">\(q\)</span> are</p>
<p><span id="eq-merton"><span class="math display">\[
\text{Call Price} =\mathrm{e}^{-q T}S_0\mathrm{N}(d_1)-\mathrm{e}^{-yT}K\mathrm{N}(d_2)\;,
\qquad(13.26)\]</span></span></p>
<p><span id="eq-merton2"><span class="math display">\[
\text{Put Price} =\mathrm{e}^{-yT}K\mathrm{N}(-d_2)-\mathrm{e}^{-q T}S_0\mathrm{N}(-d_1),
\qquad(13.27)\]</span></span></p>
<p><span id="eq-merton_d1again"><span class="math display">\[
d_1 = \frac{\log\left(\frac{S_0}{K}\right)+\left(y-q+\frac{1}{2}\sigma^2\right)T}{\sigma\sqrt{T}}\;,
\qquad(13.28)\]</span></span></p>
<p><span id="eq-merton_d2again"><span class="math display">\[
d_2 = d_1 - \sigma\sqrt{T}\;.
\qquad(13.29)\]</span></span></p>
</div>
</div>
<p>This shows that the Merton call and put formulas can be calculated from the Black-Scholes call and put functions given in <a href="Chapter_BlackScholes.html" class="quarto-xref"><span>Chapter 10</span></a> by inputting the yield of the discount bond as the risk-free rate and by inputting the volatility of the forward price as <span class="math inline">\(\sigma\)</span>.</p>
<p>If one wants to assume that there is a constant risk-free rate, then the discount bond price will have to be <span class="math inline">\(\mathrm{e}^{-rT}\)</span> and its yield will be the risk-free rate <span class="math inline">\(r\)</span>. In this case, the forward price is <span class="math inline">\(\mathrm{e}^{(r-q)T}S_0\)</span> and it has the same volatility as <span class="math inline">\(S\)</span>. Making these substitutions, the Merton formulas <a href="#eq-merton" class="quarto-xref">Equation&nbsp;<span>13.26</span></a> - <a href="#eq-merton_d2again" class="quarto-xref">Equation&nbsp;<span>13.29</span></a> are the same as the Black-Scholes formulas. However, the Merton formulas are an important generalization. It is common practice to use the yield of the discount bond as the risk-free rate that is input into the Black-Scholes formulas. The Merton formulas justify this practice. It is less common to attempt to estimate the volatility of the forward price and use this (as one should since the risk-free rate really is not constant) as the volatility in the Black-Scholes-Merton formulas. However, this does little damage for pricing short-term options, because the volatility of the forward price—see <a href="#eq-mertonsigma" class="quarto-xref">Equation&nbsp;<span>13.30</span></a> below—will be approximately the same as the volatility of the underlying for short-term options, due to the low volatility of short-term bond prices. Moreover, when one computes an implied volatility from the Black-Scholes formula (using the discount bond yield as the risk-free rate), it should be regarded as the market’s view of the forward price volatility, and it is perfectly appropriate to input it into the Black-Scholes-Merton formulas to price another option (assuming of course that the forward price volatility can be regarded as constant).</p>
<p>The volatility of the forward price can be computed in terms of the volatilities and correlation of the stock and discount bond as follows. Assume that </p>
<p><span class="math display">\[\begin{align*}
\frac{\,\mathrm{d}S}{S}&amp; = \mu_s\,\mathrm{d}t + \sigma_s\,\mathrm{d}B_s\; ,\\
\frac{\,\mathrm{d}P}{P}&amp; = \mu_p\,\mathrm{d}t + \sigma_p\,\mathrm{d}B_p,
\end{align*}\]</span> where <span class="math inline">\(B_s\)</span> and <span class="math inline">\(B_p\)</span> are Brownian motions with correlation <span class="math inline">\(\rho\)</span>. Then <a href="Chapter_GBM.html#eq-volatilityproduct" class="quarto-xref">Equation&nbsp;<span>6.15</span></a> and <a href="Chapter_GBM.html#eq-volatilityratio" class="quarto-xref">Equation&nbsp;<span>6.17</span></a> show that the volatility of <span class="math inline">\(F_t = \mathrm{e}^{-q(T-t)}S_t/P(t,T)\)</span> is <span class="math inline">\(\sigma\)</span> defined as <span id="eq-mertonsigma"><span class="math display">\[
\sigma = \sqrt{\sigma_s^2+\sigma_p^2 - 2\rho\sigma_s\sigma_p}\;.
\qquad(13.30)\]</span></span></p>
<p>As mentioned before, we will consider in <a href="#sec-s:volatility" class="quarto-xref"><span>Section 13.15</span></a> that the the volatility <a href="#eq-mertonsigma" class="quarto-xref">Equation&nbsp;<span>13.30</span></a> may vary over time in a non-random way.</p>
</section>
<section id="deferred-exchange-options" class="level2" data-number="13.8">
<h2 data-number="13.8" class="anchored" data-anchor-id="deferred-exchange-options"><span class="header-section-number">13.8</span> Deferred Exchange Options</h2>
<p>A call option on a forward can be viewed as an option to exchange <span class="math inline">\(K\)</span> dollars (or, equivalently, <span class="math inline">\(K\)</span> units of the discount bond maturing at the maturity date of the forward) for the underlying asset, with the exchange taking place at the maturity date of the forward. Therefore, it is an exchange option in which the exchange takes place at a fixed date after the option matures. We can easily extend Margrabe’s formula to value options to exchange other assets when the option maturity precedes the date of the exchange. </p>
<p>As in <a href="#sec-s:margrabe" class="quarto-xref"><span>Section 13.1</span></a>, consider two assets with prices <span class="math inline">\(S_i\)</span> and constant dividend yields <span class="math inline">\(q_i\)</span> and assume the prices satisfy <span class="math display">\[\frac{\,\mathrm{d}S_i}{S_i} = \mu_i\,\mathrm{d}t + \sigma_i\,\mathrm{d}B_i\; ,\]</span> where the drifts <span class="math inline">\(\mu_i\)</span>, the volatilities <span class="math inline">\(\sigma_i\)</span> and the correlation <span class="math inline">\(\rho\)</span> of the two Brownian motions can be general random processes. However, also as in <a href="#sec-s:margrabe" class="quarto-xref"><span>Section 13.1</span></a>, assume that the volatility <span class="math display">\[\sigma = \sqrt{\sigma_1^2 + \sigma_2^2 - 2\rho\sigma_1\sigma_2}\]</span> of the ratio of asset prices is constant.</p>
<p>Consider an option maturing at date <span class="math inline">\(T\)</span> to exchange the second asset for the first asset at date <span class="math inline">\(T'\geq T\)</span>. To understand the value of the option at date <span class="math inline">\(T\)</span>, suppose it is exercised. To unwind the positions in the two assets, one can sell a forward contract on the asset to be received and buy a forward contract on the asset to be delivered, with the forward contracts maturing at the date of the exchange. Then the difference <span class="math inline">\(F_1_T-F_2_T\)</span> in the forward prices is a cash flow to be received/paid at the exchange date <span class="math inline">\(T'\)</span> and its value at date <span class="math inline">\(T\)</span> is <span class="math inline">\(P(T,T')[F_1_T-F_2_T]\)</span>. Therefore, the value of the option at its maturity <span class="math inline">\(T\)</span> is <span class="math display">\[\max(0,P(T,T')F_1_T - P(T,T')F_2_T)\; .\]</span> As in <a href="#sec-s:black" class="quarto-xref"><span>Section 13.3</span></a>, this valuation does not require the existence of traded forward contracts, because synthetic forwards can be created. Also as in <a href="#sec-s:black" class="quarto-xref"><span>Section 13.3</span></a> we know that <span class="math display">\[S^*_1_t = P(t,T')F_1_t \quad \text{and} \quad S^*_2_t = P(t,T')F_2_t\]</span> are the prices of dividend-reinvested assets. Therefore, the option to exchange the assets at date <span class="math inline">\(T'\)</span> must have the same value as an option to exchange at date <span class="math inline">\(T\)</span> the assets with prices <span class="math inline">\(S^*_i\)</span>.</p>
<p>We recall here the arbitrage <a href="#eq-forwardprice" class="quarto-xref">Equation&nbsp;<span>13.20</span></a> for the forward prices (making the change that here the forwards mature at <span class="math inline">\(T'\)</span>): <span class="math display">\[F_i_t =  \frac{\mathrm{e}^{-q_i(T'-t)}S_i_t}{P(t,T')}\; .\]</span> Thus, <span class="math display">\[S^*_i_t = \mathrm{e}^{-q_i(T'-t)}S_i_t\; .\]</span> This implies that the volatility of the ratio <span class="math inline">\(S_1^*/S_2^*\)</span> is the same as the volatility of the ratio <span class="math inline">\(S_1/S_2\)</span>. Therefore, we can price a deferred exchange option from Margrabe’s formula, inputting the prices <span class="math inline">\(S^*_i_0 = \mathrm{e}^{-q_iT'}S_i_0\)</span> as the initial asset prices and zero as their dividend yields. This formula is:</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">13.9</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>The value of a European option maturing at date <span class="math inline">\(T\)</span> to exchange two assets at date <span class="math inline">\(T'\)</span> is <span id="eq-margrabedeferredoption"><span class="math display">\[
\mathrm{e}^{-q_1 T'}S_1_0\mathrm{N}(d_1)-\mathrm{e}^{-q_2 T'}S_2_0\mathrm{N}(d_2)\;,
\qquad(13.31)\]</span></span></p>
<p>where</p>
<p><span id="eq-margrabedeferred_d1"><span class="math display">\[
d_1= \frac{\log\left(\frac{S_1_0}{S_2_0}\right)+(q_2-q_1)T'+
\frac{1}{2}\sigma^2T}{\sigma\sqrt{T}}\;,
\qquad(13.32)\]</span></span></p>
<p><span id="eq-margrabedeferred_d2"><span class="math display">\[
d_2=d_1-\sigma\sqrt{T}\;,
\qquad(13.33)\]</span></span></p>
</div>
</div>
<div id="5447ece2" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> margrabe_deferred(S1, S2, sigma, q1, q2, Tmat, Texch):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Inputs:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">    S1 = price of asset to be received</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">    S2 = price of asset to be delivered</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">    sigma = volatility of ratio of prices</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">    q1 = dividend yield of asset to be received</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">    q2 = dividend yield of asset to be delivered</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Tmat = time to maturity of option</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Texch = time until exchange &gt;= TOption</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    P1 <span class="op">=</span> np.exp(<span class="op">-</span>q1 <span class="op">*</span> Texch) <span class="op">*</span> S1</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    P2 <span class="op">=</span> np.exp(<span class="op">-</span>q2 <span class="op">*</span> Texch) <span class="op">*</span> S2</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> generic_option(P1, P2, sigma, Tmat)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>S1 <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>S2 <span class="op">=</span> <span class="dv">90</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>q1 <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>q2 <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>sigma<span class="op">=</span><span class="fl">0.2</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>Tmat <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>Texch <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Margrabe Deferred:"</span>, margrabe_deferred(S1, S2, sigma, q1, q2, Tmat, Texch))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Margrabe Deferred: 14.513318533107103</code></pre>
</div>
</div>
</section>
<section id="sec-s:forwardhedging" class="level2" data-number="13.10">
<h2 data-number="13.10" class="anchored" data-anchor-id="sec-s:forwardhedging"><span class="header-section-number">13.10</span> Greeks and Hedging</h2>
<p>The Greeks for the Margrabe and Black formulas can be calculated in the same way that we calculated them in <a href="Chapter_BlackScholes.html" class="quarto-xref"><span>Chapter 10</span></a> for the Black-Scholes formula. In analogy with <a href="Chapter_BlackScholes.html#eq-greeksimplify" class="quarto-xref">Equation&nbsp;<span>10.5</span></a>, it can be shown for the Margrabe formula that <span class="math display">\[\mathrm{e}^{-q_1T}S_1_0\mathrm{n}d(d_1) = \mathrm{e}^{-q_2T}S_2_0\mathrm{n}d(d_2)\; ,\]</span> and again this simplifies the calculations. This equation applies to the Black call formula by taking <span class="math inline">\(q_1=q_2=0\)</span>, <span class="math inline">\(S_1_0=P(0,T')F_0\)</span>, and <span class="math inline">\(S_2_0=P(0,T')K\)</span>, leading to <span class="math display">\[F_0\mathrm{n}d(d_1) = K\mathrm{n}d(d_2)\; .\]</span> The Greeks for the Black call formula and the Margrabe formula are: </p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">13.11</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="math display">\[\begin{align*}
&amp;**Black Call** &amp;&amp; **Margrabe**\\
&amp; &amp; &amp; \\
\frac{\partial}{\partial F} &amp;= P(0,T')\mathrm{N}(d_1)  % Black delta1
&amp;\frac{\partial}{\partial S_1}&amp;= \mathrm{e}^{-q_1T}\mathrm{N}(d_1)\\ % Margrabe delta1
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\frac{\partial}{\partial P} &amp;= F_0\mathrm{N}(d_1)-K\mathrm{N}(d_2)% Black delta2
&amp;\frac{\partial}{\partial S_2}&amp;=-\mathrm{e}^{-q_2T}\mathrm{N}(d_2)\\ % Margrabe delta2
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\frac{\partial^2}{\partial F^2} &amp;= \frac{P(0,T')\mathrm{n}d(d_1)}{\sigma\sqrt{T}F_0}  % Black gamma1
&amp;\frac{\partial^2}{\partial S_1^2}&amp;= \frac{\mathrm{e}^{-q_1T}\mathrm{n}d(d_1)}{\sigma\sqrt{T}S_1_0}\\ % Margrabe gamma1
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\frac{\partial^2}{\partial P^2} &amp;= 0 % Black gamma2
&amp;\frac{\partial^2}{\partial S_2^2}&amp;=\frac{\mathrm{e}^{-q_2T}\mathrm{n}d(d_2)}{\sigma\sqrt{T}S_2_0}\\ %Margrabe gamma2
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\frac{\partial^2}{\partial F \partial P} &amp;= \mathrm{N}(d_1)&amp;\frac{\partial^2}{\partial S_1 \partial S_2}% Black crossgamma
&amp;= -\frac{\mathrm{e}^{-q_1T}\mathrm{n}d(d_1)}{\sigma\sqrt{T}S_2_0}\\ % Margrabe crossgamma
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-\frac{\partial}{\partial T} &amp;= -\frac{\sigma P(0,T')F_0\mathrm{n}d(d_1)}{2\sqrt{T}}%Black theta part1
&amp; -\frac{\partial}{\partial T}&amp;=q_1\mathrm{e}^{-q_1T}S_1_0\mathrm{N}(d_1)\\ %Margrabe theta part1
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
&amp; &amp;&amp;-q_2\mathrm{e}^{-q_2T}S_2_0\mathrm{N}(d_2)\\ % Margrabe theta part2
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
&amp;&amp;&amp;-\frac{\sigma \mathrm{e}^{-q_1T}S_1_0\mathrm{n}d(d_1)}{2\sqrt{T}}\\ % Margrabe theta part3
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\frac{\partial}{\partial \sigma} &amp;= \sqrt{T}P(0,T')F_0\mathrm{n}d(d_1) % Black vega
&amp;\frac{\partial}{\partial \sigma}&amp;=\sqrt{T}\mathrm{e}^{-q_1T}S_1_0\mathrm{n}d(d_1) % Margrabe vega
\end{align*}\]</span></p>
</div>
</div>
<p>Hedging for the Margrabe formula is much the same as for the Black-Scholes formula. We would delta-hedge a written exchange option by holding <span class="math inline">\(\delta_1=\mathrm{e}^{-q_1T}\mathrm{N}(d_1)\)</span> shares of the first asset and <span class="math inline">\(\delta_2 =- \mathrm{e}^{-q_2T}\mathrm{N}(d_2)\)</span> shares of the second asset (which means shorting the second asset). This position would be financed by borrowing at the risk-free rate (or shorting the discount bond). The same argument that we used in <a href="Chapter_BlackScholes.html#sec-s:deltahedging" class="quarto-xref"><span>Section 10.5</span></a> shows that this zero-cost portfolio will have a zero return if continuously rebalanced.</p>
<p>Because the Black formulas are a special case of the Margrabe formula, we can delta-hedge options on forwards in the same way. Putting <span class="math inline">\(q_1=q_2=0\)</span>, <span class="math inline">\(S_1_0=P(0,T')F_0\)</span> and <span class="math inline">\(S_2_0=P(0,T')K\)</span>, we would delta-hedge a written call option by buying <span class="math inline">\(\mathrm{N}(d_1)\)</span> shares of the first asset and shorting <span class="math inline">\(\mathrm{N}(d_2)\)</span> shares of the second, where <span class="math inline">\(d_1\)</span> and <span class="math inline">\(d_2\)</span> are defined in the Margrabe formulas <a href="#eq-margrabe_d1" class="quarto-xref">Equation&nbsp;<span>13.8</span></a> and <a href="#eq-margrabe_d2" class="quarto-xref">Equation&nbsp;<span>13.9</span></a> and equivalently in the Black formulas <a href="#eq-black_d1" class="quarto-xref">Equation&nbsp;<span>13.13</span></a> and <a href="#eq-black_d2" class="quarto-xref">Equation&nbsp;<span>13.14</span></a>. This position would be financed by shorting the discount bond to raise the difference between the cost of the portfolio and the option value so that the cost of the total portfolio (including the short discount bond) equals the option value. However, the first asset here consists of a long forward contract plus <span class="math inline">\(F_0\)</span> units of the discount bond, and the second asset is <span class="math inline">\(K\)</span> units of the discount bond. Furthermore, we are using the discount bond to finance the position (including the buying and shorting of the discount bond!). We can conclude that buying <span class="math inline">\(\mathrm{N}(d_1)\)</span> units of the first asset means that we should buy <span class="math inline">\(\mathrm{N}(d_1)\)</span> forward contracts. This has zero cost. Therefore, the portfolio value will equal the value of the discount bonds, and this must equal the option value. So, we actually invest the option value<br>
<span class="math display">\[P(0,T')F_0\mathrm{N}(d_1) - P(0,T')K\mathrm{N}(d_2)\; ,\]</span> in the discount bond, which means buying <span class="math inline">\(F_0\mathrm{N}(d_1)-K\mathrm{N}(d_2)\)</span> units of the bond.</p>
<p>A more direct analysis of hedging options on forwards is possible and instructive. We will consider that topic further in <a href="#sec-s:hedgingforwards" class="quarto-xref"><span>Section 13.16</span></a>.</p>
</section>
<section id="sec-s:futuresforwards" class="level2" data-number="13.12">
<h2 data-number="13.12" class="anchored" data-anchor-id="sec-s:futuresforwards"><span class="header-section-number">13.12</span> The Relation of Futures Prices to Forward Prices</h2>
<p>The difference between futures and forward contracts is that futures are marked to market, which means that daily gains and losses are posted to the investor’s margin account. Thus, there are interim cash flows on a futures contract, whereas the only cash flows on a forward contract are at the maturity of the forward. We will establish three useful facts in this section, the last of which follows from the first two:</p>
<ol type="1">
<li>Futures prices are martingales under the risk-neutral probability.</li>
<li>Forward prices are martingales when we use the discount bond with the same maturity as the forward as the numeraire.</li>
<li>When interest rates are non-random, futures prices equal forward prices.</li>
</ol>
<p>We consider the idealized case in which the futures contract is continuously marked to market. Assume there is an instantaneously risk-free asset with rate of return <span class="math inline">\(r\)</span>, which could vary randomly over time, and define, as in <a href="Chapter_Arbitrage.html" class="quarto-xref"><span>Chapter 7</span></a>, <span class="math display">\[R_t = \exp\left(\int_0^t r_s\,ds\right)\; ,\]</span> which is the value at date <span class="math inline">\(t\)</span> of a $1 investment in the asset at date <span class="math inline">\(0\)</span>, with interest continuously reinvested. Let <span class="math inline">\(T'\)</span> denote the maturity of the futures contract, and let <span class="math inline">\(F^*_t\)</span> denote the futures price at dates <span class="math inline">\(t \leq T'\)</span> (the <span class="math inline">\(^*\)</span> notation is to distinguish the futures price from the forward price <span class="math inline">\(F\)</span>). Consider the portfolio strategy that starts with zero dollars and one long futures contract at price <span class="math inline">\(F^*_0\)</span> and which continuously invests and withdraws from the risk-free asset the gains and losses on the futures contract. Let <span class="math inline">\(V_t\)</span> denote the value of this portfolio at date <span class="math inline">\(t\)</span>. The change in the value of the portfolio at any instant is the interest earned (or paid, if <span class="math inline">\(V&lt;0\)</span>) on the risk-free asset plus the gain/loss on the futures. This means that <span class="math display">\[\,\mathrm{d}V = rV\,\mathrm{d}t + \,\mathrm{d}F^*\; .\]</span> Because all gains and losses on this portfolio are reinvested, <span class="math inline">\(V\)</span> is the price of a dividend-reinvested asset. Therefore, under the risk-neutral probability (i.e., using <span class="math inline">\(R\)</span> as the numeraire), the ratio <span class="math inline">\(V/R\)</span> must be a martingale and hence have zero drift. From Ito’s formula, <span class="math display">\[\begin{align*}
\frac{\,\mathrm{d}(V/R)}{V/R} &amp;= \frac{\,\mathrm{d}V}{V} - \frac{\,\mathrm{d}R}{R}\\
&amp;=\frac{rV\,\mathrm{d}t + \,\mathrm{d}F^*}{V} - r\,\mathrm{d}t\\
&amp;= \frac{\,\mathrm{d}F^*}{V}\;.
\end{align*}\]</span> Thus, the drift of <span class="math inline">\(V/R\)</span> being zero implies the drift of <span class="math inline">\(F^*\)</span> is zero. We need to assume (and can assume) that <span class="math inline">\(F^*\)</span> is an Ito process with finite expected quadratic variation—cf.&nbsp;condition <a href="Chapter_Ito.html#eq-regularity1" class="quarto-xref">Equation&nbsp;<span>5.9</span></a>—in which case the absence of a drift implies that it is a martingale.</p>
<p>Now we turn to fact (2). Consider a forward contract with maturity <span class="math inline">\(T'\)</span> and a discount bond also maturing at <span class="math inline">\(T'\)</span>. Let <span class="math inline">\(F_t\)</span> denote the forward price and let <span class="math inline">\(P(t,T')\)</span> denote the price of the discount bond at dates <span class="math inline">\(t \leq T'\)</span>. We observed in <a href="#sec-s:black" class="quarto-xref"><span>Section 13.3</span></a> that there is a dividend-reinvested asset with price <span class="math inline">\(P(t,T')F_t\)</span>. When we use the discount bond as the numeraire, the ratio <span class="math inline">\(P(t,T')F_t/P(t,T') = F_t\)</span> must be a martingale, which is fact (2). Because of this fact, a probability measure corresponding to a discount bond being the numeraire is called a forward measure. </p>
<p>Suppose now that interest rates are deterministic, that is, even if <span class="math inline">\(r\)</span> varies over time, it does so in a non-random way. Then the discount bond price at date <span class="math inline">\(0\)</span> must be the discount factor <span class="math display">\[P(0,T') = \exp\left(-\int_0^{T'} r_t\,\mathrm{d}t\right)\; .\]</span> <a href="Chapter_Arbitrage.html#eq-probSnumeraire" class="quarto-xref">Equation&nbsp;<span>7.23</span></a> gives the probability of any event <span class="math inline">\(A\)</span> when the discount bond is used as the numeraire as <span class="math display">\[\text{prob}^P[A] = \\E\left[1_A\phi_{T'}\frac{P(T',T')}{P(0,T')}\right] = \exp\left(-\int_0^{T'} r_t\,\mathrm{d}t\right)\\E[1_A\phi_{T'}]\; ,\]</span> where <span class="math inline">\(\phi\)</span> denotes the state prices. On the other hand, the same equation gives the probability of <span class="math inline">\(A\)</span> when <span class="math inline">\(R\)</span> is used as the numeraire as <span class="math display">\[\text{prob}^R[A] = \\E\left[1_A\phi_{T'}\frac{R_{T'}}{R_0}\right] = \exp\left(-\int_0^{T'} r_t\,\mathrm{d}t\right)\\E[1_A\phi_{T'}]\; .\]</span> Therefore, the two probability measures are the same, and consequently the expectations <span class="math inline">\(\\E^P\)</span> and <span class="math inline">\(\\E^R\)</span> are the same. Now using the fact that both the futures price and the forward price must equal the spot price at maturity, we have <span class="math inline">\(F^*_{T'} = F_{T'}\)</span>, and, from the martingale properties, <span class="math display">\[F^*_t = \\E_t^P[F^*_{T'}] = \\E_t^P[F_{T'}] = \\E_t^R[F_{T'}] = F_t\; ,\]</span> which is fact (3).</p>
</section>
<section id="sec-s:futuresoptions" class="level2" data-number="13.13">
<h2 data-number="13.13" class="anchored" data-anchor-id="sec-s:futuresoptions"><span class="header-section-number">13.13</span> Futures Options</h2>
<p>Now we consider options on futures contracts, assuming that interest rates are deterministic. We just showed that in this circumstance the futures price will equal the forward price for a contract of the same maturity. However, the values of options on a futures contract do not equal the values of options on the corresponding forward contract.</p>
<p>The difference is due to marking to market. Consider futures and forward contracts with maturity <span class="math inline">\(T'\)</span> and options maturing at <span class="math inline">\(T \leq T'\)</span>. Exercise of a call option on a futures contract will roll the investor into a long futures contract with futures price equal to the market futures price at that date. The difference <span class="math inline">\(F^*_T-K\)</span> between the market futures price and the strike price of the option is immediately credited to the investor’s margin account. On the other hand, exercise of an option on a forward and sale of the forward results in a cash flow of <span class="math inline">\(F_T - K\)</span> that is received at the maturity date <span class="math inline">\(T'\)</span> of the forward. Therefore, the value at maturity of a call option on a futures contract is <span class="math inline">\(\max(0,F^*_T-K)\)</span>, whereas, as noted before, the value of a call option on a forward at the maturity of the option is <span class="math inline">\(P(T,T')\max(0,F_T-K)\)</span></p>
<p>As in the analysis of options on forwards, an options on a futures contract can be viewed as an exchange option, where one exchanges the asset with price <span class="math inline">\(S_2_t = P(t,T)K\)</span> at date <span class="math inline">\(t\leq T\)</span> for the asset with price <span class="math inline">\(S_1_t = P(t,T)F^*_t\)</span>. The asset with price <span class="math inline">\(S_2\)</span> is of course <span class="math inline">\(K\)</span> units of the discount bond maturing at <span class="math inline">\(T\)</span>. Assuming interest rates are deterministic, we have <span class="math inline">\(F^*_t = F_t\)</span>, and we noted in <a href="#sec-s:black" class="quarto-xref"><span>Section 13.3</span></a> that <span class="math inline">\(P(t,T)F_t\)</span> is the price of a dividend-reinvested asset. Thus, we can apply Margrabe’s formula to price call (and put) options on futures when interest rates are deterministic. Compared to options on forwards, the difference is that the discount bonds defining the prices <span class="math inline">\(S_1\)</span> and <span class="math inline">\(S_2\)</span> mature at the maturity date of the option rather than at the maturity date of the futures or forward contract. The result is:</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">13.14</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>When interest rates are deterministic and the futures price <span class="math inline">\(F^*\)</span> has a constant volatility <span class="math inline">\(\sigma\)</span>, the values of European calls and puts on a futures contract are</p>
<p><span id="eq-black2"><span class="math display">\[
\text{Call Price} =P(0,T)F^*_0\mathrm{N}(d_1)-P(0,T)K\mathrm{N}(d_2)\; ,
\qquad(13.34)\]</span></span></p>
<p><span id="eq-black_put2"><span class="math display">\[
\text{Put Price} =P(0,T)K\mathrm{N}(-d_2)-P(0,T)F^*_0\mathrm{N}(-d_1)\; ,
\qquad(13.35)\]</span></span></p>
<p><span class="math display">\[
\]</span> where <span id="eq-black_d12"><span class="math display">\[
d_1= \frac{\log\left(\frac{F^*_0}{K}\right)+\frac{1}{2}\sigma^2T}{\sigma\sqrt{T}}\;,
\qquad(13.36)\]</span></span></p>
<p><span id="eq-black_d22"><span class="math display">\[
d_2=d_1-\sigma\sqrt{T}\;.
\qquad(13.37)\]</span></span></p>
</div>
</div>
<p>We can calculate these values from the <code>Black_Call</code> and <code>Black_Put</code> functions by inputting the price of the discount bond maturing when the option matures rather than the price of the discount bond maturing when the forward/futures matures.<br>
We will derive delta hedges for futures options in <a href="#sec-s:hedgingforwards" class="quarto-xref"><span>Section 13.16</span></a>.</p>
</section>
<section id="sec-s:volatility" class="level2" data-number="13.15">
<h2 data-number="13.15" class="anchored" data-anchor-id="sec-s:volatility"><span class="header-section-number">13.15</span> Time-Varying Volatility</h2>
<p>All of the option pricing formulas in this chapter were derived from Margrabe’s formula, the main assumption of which is that the logarithm of the ratio of asset prices at date <span class="math inline">\(T\)</span> is normally distributed with variance equal to <span class="math inline">\(\sigma^2T\)</span>. As in <span class="quarto-unresolved-ref">?sec-s:timevaryingvolatility</span> regarding the Black-Scholes formulas, the formulas in this chapter can easily be adapted to allow a time-varying but non-random volatility. If the volatility is a non-random function <span class="math inline">\(\sigma_t\)</span> of time, then we define <span class="math inline">\(\sigma_{\text{avg}}\)</span> to be the number such that <span id="eq-averagesigma"><span class="math display">\[
\sigma_{\text{avg}}^2 = \frac{1}{T}\int_0^T \sigma^2_t\,\mathrm{d}t\;.
\qquad(13.38)\]</span></span></p>
<p>We should input <span class="math inline">\(\sigma_{\text{avg}}\)</span> as (i) the volatility of the ratio of asset prices in Margrabe’s formula and the deferred exchange option formula if <span class="math inline">\(\sigma_t\)</span> is the volatility of the ratio at date <span class="math inline">\(t\)</span> or as (ii) the volatility of the forward price in Black’s and Merton’s formulas if <span class="math inline">\(\sigma_t\)</span> is the volatility of the forward price at date <span class="math inline">\(t\)</span>.</p>
<p>As in <span class="quarto-unresolved-ref">?sec-s:timevaryingvolatility</span>, equation~<a href="#eq-averagesigma" class="quarto-xref">Equation&nbsp;<span>13.38</span></a> enables one to interpret and apply different implied volatilities computed at different maturities. Another circumstance in which it can be useful is in conjunction with bond price models such as the Vasicek and extended Vasicek models described in <a href="Chapter_Vasicek.html" class="quarto-xref"><span>Chapter 27</span></a> that imply a time-varying non-random volatility for discount bond prices.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> If we assume a constant volatility for the price of the underlying and a constant correlation between the underlying and the discount bond, then we will have a time-varying non-random forward price volatility via <a href="#eq-mertonsigma" class="quarto-xref">Equation&nbsp;<span>13.30</span></a>, and we should input the average volatility <span class="math inline">\(\sigma_{\text{avg}}\)</span> defined in <a href="#eq-averagesigma" class="quarto-xref">Equation&nbsp;<span>13.38</span></a> for the forward price volatility in Black’s and Merton’s formulas. As mentioned in <a href="#sec-s:merton" class="quarto-xref"><span>Section 13.5</span></a>, this will be more important for long-term options than for short-term options.</p>
</section>
<section id="sec-s:hedgingforwards" class="level2" data-number="13.16">
<h2 data-number="13.16" class="anchored" data-anchor-id="sec-s:hedgingforwards"><span class="header-section-number">13.16</span> Hedging with Forwards and Futures</h2>
<p>In <a href="Chapter_FX.html" class="quarto-xref"><span>Chapter 12</span></a>, we considered hedging quanto contracts with currency forwards. In <a href="#sec-s:forwardhedging" class="quarto-xref"><span>Section 13.10</span></a>, we considered hedging options on forwards with forwards. To present a more complete analysis of these topics, we need to discuss the gains and losses that accrue from trading forwards.</p>
<p>Consider dates <span class="math inline">\(t&lt;u\)</span> and a forward contract with maturity <span class="math inline">\(T\)</span>. Suppose we purchase <span class="math inline">\(x_t\)</span> forwards at date <span class="math inline">\(t\)</span> and then change our position in forwards to <span class="math inline">\(x(u)\)</span> at time <span class="math inline">\(u\)</span>. The purchase/sale of <span class="math inline">\(x(u)-x_t\)</span> new contracts does not affect the portfolio value, so the change in the value of the portfolio is the change in the value of the <span class="math inline">\(x_t\)</span> contracts purchased at date <span class="math inline">\(t\)</span>. These contracts were worth zero at date <span class="math inline">\(t\)</span>, because forward contracts have zero value at initiation. Selling them at date <span class="math inline">\(u\)</span> cancels the obligation to deliver/receive the underlying, leaving one with a cash flow of <span class="math inline">\(x_t[F(u)-F_t]\)</span> dollars to be received at date <span class="math inline">\(T\)</span>. The value of this cash flow at date <span class="math inline">\(u\)</span> is <span class="math inline">\(x_tP(u,T)[F(u)-F_t]\)</span>. We can write this as <span class="math display">\[\begin{align*}
x_tP(u,T)[F(u)-F_t]  &amp;= x_t\big[P(t,T)[F(u)-F_t] + [P(u,T)-P(t,T)][F(u)-F_t]\big]\\
&amp;= x_t\big[P(t,T)\,\Delta F + (\Delta P)(\Delta F)\big]\;.
\end{align*}\]</span> This motivates the following definition:</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">13.17</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>The change in the value of a portfolio of forward contracts at date <span class="math inline">\(t\)</span> is <span id="eq-changeforwardvalue"><span class="math display">\[
x_t\big[P(t,T)\,\mathrm{d}F_t + \,\mathrm{d}P(t,T)\times \,\mathrm{d}F_t]\;,
\qquad(13.39)\]</span></span></p>
<p>where <span class="math inline">\(x_t\)</span> denotes the number of forward contracts held, <span class="math inline">\(F_t\)</span> denotes the forward price, <span class="math inline">\(P(t,T)\)</span> denotes the price of a discount bond maturing at <span class="math inline">\(T\)</span>, and <span class="math inline">\(T\)</span> is the maturity of the forward contract.</p>
</div>
</div>
<p>Hedging with futures is a bit simpler, because the gains and losses are received instantaneously (daily, at least) rather than being deferred to the contract maturity. Letting <span class="math inline">\(x_t\)</span> denote the number of futures contracts held at date <span class="math inline">\(t\)</span> and <span class="math inline">\(F^*_t\)</span> the futures price, the cash flow from the contracts is <span class="math inline">\(x_t\,\mathrm{d}F^*_t\)</span>. This is also the change in the value of the portfolio, because marking to market means that the contracts always have zero value.</p>
<p>To compare hedging with futures and forwards, assume there is a constant risk-free rate <span class="math inline">\(r\)</span>. Let <span class="math inline">\(T\)</span> denote the maturity of the futures and forward contracts. Because there is a constant risk-free rate, we have <span class="math inline">\(P(t,T) = \mathrm{e}^{-r(T-t)}\)</span>, which implies <span class="math inline">\((\,\mathrm{d}P)(\,\mathrm{d}F) =0\)</span>. Moreover, futures prices equal forward prices. Thus,</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">13.18</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>If there is a constant risk-free rate <span class="math inline">\(r\)</span>, the change in the value of a portfolio of forward contracts at date <span class="math inline">\(t\)</span> is <span id="eq-forwardchange100"><span class="math display">\[
x_t\mathrm{e}^{-r(T-t)}\,\mathrm{d}F_t
\qquad(13.40)\]</span></span></p>
<p>and the change in the value of a portfolio of futures contracts is <span id="eq-futureschange100"><span class="math display">\[
x_t\,\mathrm{d}F_t\;,
\qquad(13.41)\]</span></span></p>
<p>where <span class="math inline">\(x_t\)</span> denotes the number of futures/forward contracts held at date <span class="math inline">\(t\)</span>, <span class="math inline">\(T\)</span> is the maturity of the futures and forward contracts and <span class="math inline">\(F_t\)</span> is the futures (= forward) price at date <span class="math inline">\(t\)</span>.</p>
</div>
</div>
<p>Comparing <a href="#eq-forwardchange100" class="quarto-xref">Equation&nbsp;<span>13.40</span></a> and <a href="#eq-futureschange100" class="quarto-xref">Equation&nbsp;<span>13.41</span></a>, we see that if <span class="math inline">\(x_t\)</span> is the number of forward contracts that should be held in a hedge, then <span id="eq-futuresxy"><span class="math display">\[
y_t = \mathrm{e}^{-r(T-t)}x_t
\qquad(13.42)\]</span></span></p>
<p>is the number of futures contracts that should be held, because with this number of contracts we have <span class="math display">\[\begin{align*}
\text{Change in Forward Portfolio} &amp; = x_t\mathrm{e}^{-r(T-t)}\,\mathrm{d}F_t\\
&amp; = y_t\,\mathrm{d}F_t\\
&amp; = \text{Change in Futures Portfolio}\;.
\end{align*}\]</span> In short, we don’t require as many futures contracts as forward contracts, and the scaling factor to convert from forwards to futures is just the present value factor <span class="math inline">\(\mathrm{e}^{-r(T-t)}\)</span>.</p>
<p>For example, the result of <a href="Chapter_FX.html#sec-s:replicatingquantos" class="quarto-xref"><span>Section 12.11</span></a> on replicating the payoff <span class="math inline">\(\bar{X}S_T\)</span> with forward contracts leads to the following:</p>
<div class="callout callout-style-default callout-Rule no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="header-section-number">13.19</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>To replicate the payoff <span class="math inline">\(\bar{X}S_T\)</span> at date <span class="math inline">\(T\)</span>, where <span class="math inline">\(\bar{X}\)</span> is a fixed exchange rate and <span class="math inline">\(S\)</span> is the foreign currency price of an asset, one should invest <span class="math inline">\(V_t\)</span> units of domestic currency in the foreign asset and be short <span class="math inline">\(\mathrm{e}^{(r_f-r)(T-t)}V_t/X_t\)</span> currency futures at date <span class="math inline">\(t\)</span>, where <span class="math inline">\(V_t\)</span> is defined in <a href="Chapter_FX.html#eq-quanto2" class="quarto-xref">Equation&nbsp;<span>12.7</span></a> and <span class="math inline">\(X_t\)</span> is the spot exchange rate.</p>
</div>
</div>
<p>We can use <a href="#eq-futuresxy" class="quarto-xref">Equation&nbsp;<span>13.42</span></a> to determine how to delta hedge futures options. As explained in <a href="#sec-s:futuresoptions" class="quarto-xref"><span>Section 13.13</span></a>, assuming non-random interest rates, futures options are more valuable than options on forwards because futures are marked to market upon exercise of an option. Specifically, Black’s formulas <a href="#eq-black" class="quarto-xref">Equation&nbsp;<span>13.11</span></a> - <a href="#eq-black_d2" class="quarto-xref">Equation&nbsp;<span>13.14</span></a> for options on forwards and <a href="#eq-black2" class="quarto-xref">Equation&nbsp;<span>13.34</span></a> - <a href="#eq-black_d22" class="quarto-xref">Equation&nbsp;<span>13.37</span></a> for options on futures show that the values are the same except for the maturity of the discount bond appearing in the equations. With a constant risk-free rate <span class="math inline">\(r\)</span>, options maturing at <span class="math inline">\(T\)</span> and futures/forwards maturing at <span class="math inline">\(T'\)</span>, the relation is <span class="math display">\[\text{Value of Futures Option} = \mathrm{e}^{r(T'-T)} \times \text{Value of Forward Option}\; .\]</span> Because the scaling factor <span class="math inline">\(\mathrm{e}^{r(T'-T)}\)</span> does not change as time passes, this implies that as time passes we have</p>
<p><span id="eq-futures1001"><span class="math display">\[
\begin{multline}
\text{Change in Futures Option Value } \\= \mathrm{e}^{r(T'-T)} \times \text{Change in Forward Option Value}\;.
\end{multline}
\qquad(13.43)\]</span></span></p>
<p>We can combine <a href="#eq-futuresxy" class="quarto-xref">Equation&nbsp;<span>13.42</span></a> and <a href="#eq-futures1001" class="quarto-xref">Equation&nbsp;<span>13.43</span></a> to convert from a hedge of a forward option using forward contracts, which we discussed in <a href="#sec-s:forwardhedging" class="quarto-xref"><span>Section 13.10</span></a>, to a hedge of a futures option using futures contracts. For example, we concluded in <a href="#sec-s:forwardhedging" class="quarto-xref"><span>Section 13.10</span></a> that we should be long <span class="math inline">\(\mathrm{N}(d_1)\)</span> forwards to hedge a short call option on a forward contract. Consequently, <a href="#eq-futuresxy" class="quarto-xref">Equation&nbsp;<span>13.42</span></a> shows that we can hedge a short call option on a forward by being long <span class="math inline">\(\mathrm{e}^{-r(T'-t)}\mathrm{N}(d_1)\)</span> futures, and then we see from <a href="#eq-futures1001" class="quarto-xref">Equation&nbsp;<span>13.43</span></a> that the hedge for a short call on a futures is being long <span class="math display">\[\mathrm{e}^{r(T'-T)}\mathrm{e}^{-r(T'-t)}\mathrm{N}(d_1) = \mathrm{e}^{-r(T-t)}\mathrm{N}(d_1)\]</span> futures contracts.</p>
<p>In <a href="#sec-s:forwardhedging" class="quarto-xref"><span>Section 13.10</span></a>, we derived the hedges for forward options by considering them as exchange options. We can use <a href="#eq-changeforwardvalue" class="quarto-xref">Equation&nbsp;<span>13.39</span></a> to confirm that our calculations were correct. Consider hedging a short call maturing at <span class="math inline">\(T\)</span> on a forward contract maturing at <span class="math inline">\(T'\)</span>. We can assume interest rates vary randomly and use discount bonds in the hedge. We stated in <a href="#sec-s:forwardhedging" class="quarto-xref"><span>Section 13.10</span></a> that we should hold <span class="math inline">\(F_0\mathrm{N}(d_1)-K\mathrm{N}(d_2)\)</span> units of the discount bond maturing at <span class="math inline">\(T'\)</span> and we should go long <span class="math inline">\(\mathrm{N}(d_1)\)</span> forwards to hedge the short call. This is a zero-cost portfolio when we include the proceeds from selling the call. Using <a href="#eq-changeforwardvalue" class="quarto-xref">Equation&nbsp;<span>13.39</span></a>, we see that the change in the value of the portfolio will be <span id="eq-forwardhedging1"><span class="math display">\[
-\,\mathrm{d}C + [F_0\mathrm{N}(d_1)-K\mathrm{N}(d_2)]\,\mathrm{d}P + \mathrm{N}(d_1)[P(0,T')\,\mathrm{d}F + (\,\mathrm{d}P)(\,\mathrm{d}F)]\;.
\qquad(13.44)\]</span></span></p>
<p>The value of the call at date <span class="math inline">\(t\)</span> will be a function of <span class="math inline">\(t\)</span>, <span class="math inline">\(P(t,T')\)</span> and <span class="math inline">\(F_t\)</span>, which we write as <span class="math inline">\(C(t,P,F)\)</span>. From Ito’s formula, <span class="math display">\[\begin{align*}
\,\mathrm{d}C &amp;= \frac{\partial C}{\partial t}\,\mathrm{d}t + \frac{\partial C}{\partial P}\,\mathrm{d}P + \frac{\partial C}{\partial F}\,\mathrm{d}F \\  &amp;\qquad + \frac{1}{2}\frac{\partial^2 C}{\partial P^2}\, (\,\mathrm{d}P)^2   + \frac{1}{2}\frac{\partial^2 C}{\partial F^2}\, (\,\mathrm{d}F)^2 + \frac{\partial^2 C}{\partial F \partial P} (\,\mathrm{d}P)(\,\mathrm{d}F)\;.\\
&amp;=\Theta\,\mathrm{d}t + \delta_P\,\mathrm{d}P + \delta_F\,\mathrm{d}F  + \frac{1}{2}\Gamma_{PP} (\,\mathrm{d}P)^2 + \frac{1}{2}\Gamma_{FF} (\,\mathrm{d}F)^2  + \Gamma_{FP}\,(\,\mathrm{d}P)(\,\mathrm{d}F)\;,
\end{align*}\]</span> where the <span class="math inline">\(\delta\)</span>’s and <span class="math inline">\(\Gamma\)</span>’s denote the first and second partial derivatives indicated by the subscripts. Inserting this formula into <a href="#eq-forwardhedging1" class="quarto-xref">Equation&nbsp;<span>13.44</span></a> and making use of the formulas in the table in <a href="#sec-s:forwardhedging" class="quarto-xref"><span>Section 13.10</span></a>, we see that the <span class="math inline">\(\,\mathrm{d}P\)</span> terms cancel because <span class="math inline">\(\delta_P = F_0\mathrm{N}(d_1)-K\mathrm{N}(d_2)\)</span>. Furthermore, the <span class="math inline">\(\,\mathrm{d}F\)</span> terms cancel because <span class="math inline">\(\delta_F = \mathrm{N}(d_1)P(0,T')\)</span>. Thus, there is no exposure in the portfolio to the two risky asset prices <span class="math inline">\(P\)</span> and <span class="math inline">\(F\)</span>. Furthermore, <span class="math inline">\(\Gamma_{PP} = 0\)</span> and the <span class="math inline">\((\,\mathrm{d}P)(\,\mathrm{d}F)\)</span> terms cancel because <span class="math inline">\(\Gamma_{FP} = \mathrm{N}(d_1)\)</span>. These substitutions simplify the change <a href="#eq-forwardhedging1" class="quarto-xref">Equation&nbsp;<span>13.44</span></a> in the value of the portfolio to <span class="math display">\[-\Theta\,\mathrm{d}t - \frac{1}{2}\Gamma_{FF} (\,\mathrm{d}F)^2  = \frac{\sigma P(0,T')F_0\mathrm{n}d(d_1)}{2\sqrt{T}}\,\mathrm{d}t  -  \frac{P(0,T')\mathrm{n}d(d_1)}{2\sigma\sqrt{T}F_0}\,(\,\mathrm{d}F)^2\; ,\]</span> which we can see to be zero because <span class="math inline">\((\,\mathrm{d}F)^2 = \sigma^2F^2\,\mathrm{d}t\)</span>. Thus, the hedge is perfect when continuously rebalanced.</p>
</section>
<section id="sec-s:margrabecomplete" class="level2" data-number="13.20">
<h2 data-number="13.20" class="anchored" data-anchor-id="sec-s:margrabecomplete"><span class="header-section-number">13.20</span> Market Completeness</h2>
<p>A formal definition of market completeness must specify which state-contin-gent claims (random variables depending on the history of prices) can be replicated by trading the marketed assets—for example, one might want all of the claims with finite means to be replicable, or only all of the claims with finite variances, etc. A formal analysis of market completeness is not presented in this book, except for the binomial and trinomial models in <a href="Chapter_Arbitrage.html" class="quarto-xref"><span>Chapter 7</span></a>. However, we have stated that stochastic volatility models are incomplete. This follows intuitively from the fact that a portfolio containing only one risky asset (the underlying) cannot be perfectly correlated with the two Brownian motions that determine the value of a derivative asset (the Brownian motions driving the price of the underlying and its volatility). In general, a market must include an instantaneously risk-free asset and as many risky assets as there are Brownian motions in order to be complete.</p>
<p>The exchange-option model of Margrabe—with two risky assets, two Brownian motions, and no risk-free asset—is obviously incomplete. For example, it is impossible to have exactly $100 at date <span class="math inline">\(T\)</span>. With no risk-free asset, there is simply no way to store money. This may seem far-fetched, but we might be interested in payoffs in real (i.e., inflation-adjusted) dollars, in which case the absence of a risk-free asset may be a normal situation. In any case, we have not assumed a risk-free asset exists, but we have priced options without appealing to equilibrium arguments. This deserves some clarification.</p>
<p>As mentioned above, a formal definition of market completeness must specify which contingent claims are to be replicable. The Margrabe model is complete for a certain set of contingent claims. Contingent claims of the form <span class="math inline">\(S_2_TX_T\)</span> where <span class="math inline">\(X_T\)</span> is a random variable depending on the relative prices <span class="math inline">\(S_1_t/S_2_t\)</span> for <span class="math inline">\(0 \leq t\leq T\)</span> can be replicated. Likewise, contingent claims of the form <span class="math inline">\(S_1_TX_T\)</span> can be replicated. The payoffs of exchange options are of this form, so they can be priced by arbitrage, even though there are other contingent claims (for example, receiving exactly $100 at date <span class="math inline">\(T\)</span>) that cannot be replicated and hence cannot be priced by arbitrage. Likewise, the Black and Merton models in which there is a zero-coupon bond but no instantaneously risk-free asset are examples of incomplete markets that are still sufficiently complete to price options by arbitrage (the options can be replicated). The proof that the Margrabe model is complete in the sense stated here follows from the change of numeraire argument used to derive Margrabe’s formula from the Black-Scholes formula (recall that the second asset is risk-free when we use it as the numeraire, so there is a risk-free asset under the new numeraire) and a proof that the Black-Scholes model is complete (which we have omitted, except to show that European options can be replicated).</p>
<div class="callout callout-style-default callout-Extra no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Theory Extra
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>##</p>
<p>We will conclude with a proof of the Margrabe formula that does not depend on the Black-Scholes formula. Let <span class="math inline">\(x\)</span> denote the random variable taking the value 1 when <span class="math inline">\(S_1_T&gt;S_2_T\)</span> and which is 0 otherwise. Then the value of the exchange option at maturity is <span class="math inline">\(xS_1_T-xS_2_T\)</span>. Let <span class="math inline">\(V_i\)</span> denote the value of the portfolio beginning with <span class="math inline">\(\mathrm{e}^{-q_iT}\)</span> units of asset <span class="math inline">\(i\)</span> at date <span class="math inline">\(0\)</span> and reinvesting dividends, to accumulate to one share at date <span class="math inline">\(T\)</span>. Then <span class="math inline">\(V_i_T=S_i_T\)</span> and from the fundamental pricing <a href="Chapter_Arbitrage.html#eq-formula" class="quarto-xref">Equation&nbsp;<span>7.28</span></a> the value at date <span class="math inline">\(0\)</span> of receiving <span class="math inline">\(xS_i_T\)</span> at date <span class="math inline">\(T\)</span> is <span class="math display">\[\begin{align*}
V_i_0\\E^{V_i}\left[x\frac{S_i_T}{V_i_T}\right] &amp;= \mathrm{e}^{-q_iT}S_i_0\\E^{V_i}[x] \\
&amp;= \mathrm{e}^{-q_iT}S_i_0\times\text{prob}^{V_i}\big(V_1_T&gt;V_2_T\big)\; .
\end{align*}\]</span> We can write the value of receiving <span class="math inline">\(xS_1_T\)</span> as <span class="math display">\[\mathrm{e}^{-q_1T}S_1_0\times\text{prob}^{V_1}\left(\frac{V_2_T}{V_1_T} &lt; 1\right)\]</span> and the value of receiving <span class="math inline">\(xS_2_T\)</span> as <span class="math display">\[\mathrm{e}^{-q_2T}S_2_0\times\text{prob}^{V_2}\left(\frac{V_1_T}{V_2_T} &gt; 1\right)\;.\]</span> Note that <span class="math inline">\(V_2/V_1\)</span> is a martingale when we use <span class="math inline">\(V_1\)</span> as the numeraire and <span class="math inline">\(V_1/V_2\)</span> is a martingale when we use <span class="math inline">\(V_2\)</span> as the numeraire. Because they are martingales, they have no drifts. The volatility of the ratios is given in <a href="#eq-margrabesigma" class="quarto-xref">Equation&nbsp;<span>13.6</span></a>. Therefore, we have <span class="math display">\[\begin{align*}
\frac{\,\mathrm{d}(V_2/V_1)}{V_2/V_1} &amp;= \sigma \,\mathrm{d}B^*_1,\\
\frac{\,\mathrm{d}(V_1/V_2)}{V_1/V_2} &amp;= \sigma \,\mathrm{d}B^*_2,
\end{align*}\]</span> where <span class="math inline">\(B^*_i\)</span> is a Brownian motion when <span class="math inline">\(V_i\)</span> is used as the numeraire. Margrabe’s formula now follows from the tail probability formulas <a href="Chapter_GBM.html#eq-tailprob01" class="quarto-xref">Equation&nbsp;<span>6.11</span></a>–<a href="Chapter_GBM.html#eq-tailprob02" class="quarto-xref">Equation&nbsp;<span>6.13</span></a>.</p>
</div>
</div>
</div>
</section>
<section id="section-10" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="section-10"></h2>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Derive the Greeks of a call option on a futures contract.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Using the results of the previous exercise, show that the delta hedge of a written call on a futures contract that consists of <span class="math inline">\(\mathrm{e}^{-r(T-t)}\mathrm{N}(d_1)\)</span> long futures contracts and the value of the call invested in the risk-free asset is a riskless hedge.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Derive a formula (like put-call parity) for the value of an option to exchange asset~1 for asset~2 in terms of the value of an option to do the reverse exchange.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create a Python function <code>Black_Call_Implied_Vol</code> that uses bisection to compute an implied forward price volatility from Black’s formula and the market price of a call option on a forward.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Using a synthetic forward argument, derive the forward price for a forward contract on a stock, where the forward matures at <span class="math inline">\(T'\)</span> and the stock pays a single known cash dividend <span class="math inline">\(D\)</span> at date <span class="math inline">\(T&lt;T'\)</span>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Using the result of the previous exercise and Black’s formula, derive a formula for the value of a European call option on a stock that pays a single known cash dividend before the option matures.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Modify the function <code>Simulated_Delta_Hedge_Profits</code> to compute the percentiles of gains and losses for an investor who writes a call option on a forward contract and uses a discretely-rebalanced delta hedge. As in <a href="Chapter_FX.html#exr-e_forwardhedging" class="quarto-xref">Exercise&nbsp;<span>12.1</span></a>, you will need to create a variable to keep track of the net asset/liability from trading forwards and include it in the valuation at date <span class="math inline">\(T\)</span>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Consider the portfolio that promises to pay <span class="math inline">\(\bar{X}S_T\)</span> at date <span class="math inline">\(T\)</span> and replicates the payoff using currency forwards described in <a href="Chapter_FX.html#sec-s:replicatingquantos" class="quarto-xref"><span>Section 12.11</span></a>, where <span class="math inline">\(\bar{X}\)</span> is a fixed exchange rate and <span class="math inline">\(S\)</span> is the foreign currency price of an asset. Using <a href="#eq-changeforwardvalue" class="quarto-xref">Equation&nbsp;<span>13.39</span></a> of gains and losses from trading forwards, verify that the portfolio is riskless.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Repeat the previous exercise using the futures hedge described in <a href="#sec-s:hedgingforwards" class="quarto-xref"><span>Section 13.16</span></a>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>It has been observed empirically that implied volatilities of stocks are upward biased estimates of future volatility. Given that there is not really a constant risk-free rate, implied volatilities should be interpreted as implied forward-price volatilities, whereas the empirical literature has measured future volatility as the subsequent volatility of the stock. What assumptions about bond volatilities and the correlation of bonds and stocks could explain the empirical finding; i.e., what assumptions imply that the volatility of the forward price exceeds the volatility of the stock?</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-22-contents" aria-controls="callout-22" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-22" class="callout-22-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In the continuous-time Ho-Lee model described in <a href="Chapter_Vasicek.html" class="quarto-xref"><span>Chapter 27</span></a>, the volatility of a discount bond with time <span class="math inline">\(\tau\)</span> to maturity is <span class="math inline">\(\sigma_r\tau\)</span> for a constant <span class="math inline">\(\sigma_r\)</span>. Under this assumption, calculate the average volatility of the forward price of a stock from date <span class="math inline">\(0\)</span> to date <span class="math inline">\(T\)</span>, where <span class="math inline">\(T\)</span> is the maturity of the forward contract. Assume the stock has a constant volatility <span class="math inline">\(\sigma_s\)</span> and the correlation between the stock and bond is a constant <span class="math inline">\(\rho\)</span>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-23-contents" aria-controls="callout-23" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-23" class="callout-23-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Making the same assumptions as in the previous exercise, and using the result of that exercise and Merton’s formula, write a Python function to calculate the value of a call option on a stock. The inputs should be <span class="math inline">\(S\)</span>, <span class="math inline">\(K\)</span>, <span class="math inline">\(P\)</span>, <span class="math inline">\(\sigma_s\)</span>, <span class="math inline">\(\sigma_r\)</span>, <span class="math inline">\(\rho\)</span>, <span class="math inline">\(q\)</span>, and <span class="math inline">\(T\)</span>.</p>
</div>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Black" class="csl-entry" role="listitem">
Black, F. 1976. <span>“The Pricing of Commodity Contracts.”</span> <em>Journal of Financial Economics</em> 3: 167–79.
</div>
<div id="ref-Margrabe" class="csl-entry" role="listitem">
Margrabe, W. 1978. <span>“The Value of an Option to Exchange One Asset for Another.”</span> <em>Journal of Finance</em> 33: 177–86.
</div>
<div id="ref-Merton" class="csl-entry" role="listitem">
Merton, R. 1973. <span>“Theory of Rational Option Pricing.”</span> <em>Bell Journal of Economics and Management Science</em> 4: 141–83.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Of course, it is possible to give a direct proof, without relying on the Black-Scholes formula. A sketch is given in <a href="#sec-s:margrabecomplete" class="quarto-xref"><span>Section 13.20</span></a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>This is really nothing more than the usual convention of defining the standard deviation of a random variable to be the positive square root of the variance.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>The volatility of a discount bond price cannot be constant because it must go to zero as the bond approaches maturity.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Chapter_FX.html" class="pagination-link" aria-label="FX and Quantos">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">FX and Quantos</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Chapter_Asians.html" class="pagination-link" aria-label="Asians, Baskets, and Spreads">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Asians, Baskets, and Spreads</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions"><ul><li><a href="https://github.com/math-finance-book/book-code.git/blob/main/Chapter_Merton.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div></div></footer></body></html>