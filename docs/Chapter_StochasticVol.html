<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>18&nbsp; Stochastic Volatility – Pricing and Hedging Derivative Securities: Theory and Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Chapter_Jumps.html" rel="next">
<link href="./Chapter_GARCH.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2486e1f0a3ee9ee1fc393803a1361cdb.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-6561bbde787c299e21493071c8edc6ff.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-bb6b93f51bf5a7975605005bd985cc1c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/quarto-contrib/foldbox/foldbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>



<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

<script type="text/javascript">

window.PlotlyConfig = {MathJaxConfig: 'local'};

if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}

if (typeof require !== 'undefined') {

require.undef("plotly");

requirejs.config({

    paths: {

        'plotly': ['https://cdn.plot.ly/plotly-2.35.2.min']

    }

});

require(['plotly'], function(Plotly) {

    window._Plotly = Plotly;

});

}

</script>



<style>
.CodeToDo {
  --color1: #a7f2d8;
  --color2: #50997f;
}
.Rule {
  --color1: #a1bced;
  --color2: #38568f;
}
.Done {
  --color1: #e8cc97;
  --color2: #7d6538;
}
.Exercise {
  --color1: #ede29d;
  --color2: #8c813a;
}
.InProgress {
  --color1: #eaacf2;
  --color2: #75387d;
}
.Principle {
  --color1: #e3aab2;
  --color2: #8f575f;
}
.Example {
  --color1: #e8cc97;
  --color2: #7d6538;
}
.Extra {
  --color1: #d5deed;
  --color2: #6d778a;
}
.WritingToDo {
  --color1: #a7f2d8;
  --color2: #50997f;
}
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter_GARCH.html">Part IV: Alternative Models</a></li><li class="breadcrumb-item"><a href="./Chapter_StochasticVol.html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Stochastic Volatility</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Pricing and Hedging Derivative Securities: Theory and Methods</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/math-finance-book/book-code.git" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Options.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Options</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Futures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Futures and Swaps</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Arbitrage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Arbitrage Pricing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Digitals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Pricing Digitals</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: Mathematical Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Brownian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Brownian Motion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Ito.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Ito Processes and Ito’s Formula</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_GBM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Geometric Brownian Motion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Girsanov.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Changing Measures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Deltas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Delta Hedges and PDEs</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: Black-Scholes and Extensions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_BlackScholes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Black-Scholes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Americans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">American Options</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Greeks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Greeks and Hedging</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FX.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">FX and Quantos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Merton.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Merton, Black, and Margrabe</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Asians.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Asians, Baskets, and Spreads</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Exotics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Other Exotics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Part IV: Alternative Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_GARCH.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">GARCH Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_StochasticVol.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Stochastic Volatility</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Jumps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Jumps</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_VarianceSwaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Variance Swaps</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Part V: Numerical Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_MonteCarlo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Monte Carlo Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Binomial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Binomial and Trinomial Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_PDEs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">PDE Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Fourier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Fourier Transforms</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_MachineLearning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Machine Learning</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Part VI: Fixed Income</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FixedIncome.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Fixed-Income Concepts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FixedIncomeDerivatives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Fixed-Income Derivatives</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Vasicek.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Vasicek and Extensions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Survey.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Term Structure Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendix</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./AppendixA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Miscellaneous Facts about Continuous-Time Models</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter_GARCH.html">Part IV: Alternative Models</a></li><li class="breadcrumb-item"><a href="./Chapter_StochasticVol.html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Stochastic Volatility</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-c:stochasticvolatility" class="quarto-section-identifier"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Stochastic Volatility</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="d1ce5b0b" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display">
<script type="text/javascript" async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_SVG"></script>
</div>
</div>
<p>The volatility is stochastic (random) in a GARCH model, but it is determined by the changes in the stock price. In this section, in contrast, we will consider models in which the volatility depends on a second Brownian motion. The most popular model of this type is the model of Heston <span class="citation" data-cites="Heston">(<a href="#ref-Heston" role="doc-biblioref">Heston 1993</a>)</span>. In this model, we have, as usual,</p>
<p><span id="eq-heston1"><span class="math display">\[
\,\mathrm{d}\log S = \left(r-q-\frac{1}{2}\sigma^2\right)\,\mathrm{d}t + \sigma\,\mathrm{d}B_s\;,
\qquad(18.1)\]</span></span></p>
<p>where <span class="math inline">\(B_s\)</span> is a Brownian motion under the risk-neutral probability but now <span class="math inline">\(\sigma\)</span> is not a constant but instead evolves as <span class="math inline">\(\sigma_t = \sqrt{v_t}\)</span> where</p>
<p><span id="eq-heston2"><span class="math display">\[
dv_t = \kappa \big[\theta-v_t\big]\,\mathrm{d}t + \gamma \sqrt{v_t}\,\mathrm{d}B_v\;,
\qquad(18.2)\]</span></span></p>
<p>where <span class="math inline">\(B_v\)</span> is a Brownian motion under the risk-neutral probability having a constant correlation <span class="math inline">\(\rho\)</span> with the Brownian motion <span class="math inline">\(B_s\)</span>. In this equation, <span class="math inline">\(\kappa\)</span>, <span class="math inline">\(\theta\)</span> and <span class="math inline">\(\gamma\)</span> are positive constants. Given the empirical fact that negative return shocks have a bigger impact on future volatility than do positive shocks, one would expect the correlation <span class="math inline">\(\rho\)</span> to be negative.</p>
<p>The term <span class="math inline">\(\kappa (\theta-v)\)</span> will be positive when <span class="math inline">\(v&lt;\theta\)</span> and negative when <span class="math inline">\(v&gt;\theta\)</span> and hence <span class="math inline">\(\sigma^2=v\)</span> will tend to drift towards <span class="math inline">\(\theta\)</span>, which, as in the GARCH model, is the long-run or unconditional mean of <span class="math inline">\(\sigma^2\)</span>. Thus, the volatility is said to mean revert. The rate at which it drifts towards <span class="math inline">\(\theta\)</span> is obviously determined by the magnitude of <span class="math inline">\(\kappa\)</span>, also as in the GARCH model.</p>
<p>The specification <a href="#eq-heston2" class="quarto-xref">Equation&nbsp;<span>18.2</span></a> implies that the volatility of <span class="math inline">\(v\)</span> approaches zero whenever <span class="math inline">\(v\)</span> approaches zero. In this circumstance, one might expect the drift towards <span class="math inline">\(\theta\)</span> to dominate the volatility and keep <span class="math inline">\(v\)</span> nonnegative, and this is indeed the case; thus, the definition <span class="math inline">\(\sigma_t = \sqrt{v_t}\)</span> is possible. Moreover, the parameter <span class="math inline">\(\gamma\)</span> plays a role here that is similar to the role of <span class="math inline">\(1-\lambda\)</span> in the GARCH model—the variance of the variance in the GARCH model <a href="Chapter_GARCH.html#eq-garch10" class="quarto-xref">Equation&nbsp;<span>17.10</span></a> depends on the weight <span class="math inline">\(1-\lambda\)</span> placed on the scaled return <span class="math inline">\(y_i\)</span>, just as the variance of the variance in the stochastic volatility model <a href="#eq-heston2" class="quarto-xref">Equation&nbsp;<span>18.2</span></a> depends on the weight <span class="math inline">\(\gamma\)</span> placed on <span class="math inline">\(\,\mathrm{d}B_v\)</span>.</p>
<p>We could discretize <a href="#eq-heston1" class="quarto-xref">Equation&nbsp;<span>18.1</span></a> - <a href="#eq-heston2" class="quarto-xref">Equation&nbsp;<span>18.2</span></a> as:</p>
<p><span id="eq-heston3"><span class="math display">\[
\log S(t_{i+1}) = \log S_{t_i} + \left(r-q-\frac{1}{2}\sigma_{t_i}^2\right)\,\Delta t + \sqrt{v_{t_i}}\,\Delta B_s,
\qquad(18.3)\]</span></span></p>
<p><span id="eq-heston4"><span class="math display">\[
v(t_{i+1}) = v_{t_i} + \kappa \big[\theta-v_{t_i}\big]\,\Delta t + \gamma \sqrt{v_{t_i}}\,\Delta B_v\;.
\qquad(18.4)\]</span></span></p>
<p>However, even though in the continuous-time model <a href="#eq-heston1" class="quarto-xref">Equation&nbsp;<span>18.1</span></a> - <a href="#eq-heston2" class="quarto-xref">Equation&nbsp;<span>18.2</span></a> we always have <span class="math inline">\(v_t \geq 0\)</span> and hence can define <span class="math inline">\(\sigma_t=\sqrt{v_t}\)</span>, there is no guarantee that <span class="math inline">\(v(t_{i+1})\)</span> defined by <a href="#eq-heston4" class="quarto-xref">Equation&nbsp;<span>18.4</span></a> will be nonnegative. A simple remedy is to define <span class="math inline">\(v(t_{i+1})\)</span> as the larger of zero and the right-hand side of <a href="#eq-heston4" class="quarto-xref">Equation&nbsp;<span>18.4</span></a>; thus, we will simulate the Heston model as <a href="#eq-heston3" class="quarto-xref">Equation&nbsp;<span>18.3</span></a> and<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> <span id="eq-heston41"><span class="math display">\[
v(t_{i+1}) = \max\left\{0,v_{t_i} + \kappa \big[\theta-v_{t_i}\big]\,\Delta t + \gamma \sqrt{v_{t_i}}\,\Delta B_v\right\}\;.
\qquad(18.5)\]</span></span></p>
<p>A simple way to simulate the changes <span class="math inline">\(\Delta B_s\)</span> and <span class="math inline">\(\Delta B_v\)</span> in the two correlated Brownian motions is to generate two independent standard normals <span class="math inline">\(z_1\)</span> and <span class="math inline">\(z_2\)</span> and take <span class="math display">\[\Delta B_s = \sqrt{\Delta t}\,z \qquad \text{and} \qquad \Delta B_v = \sqrt{\Delta t}\,z^*\; ,\]</span> where we define <span class="math display">\[z = z_1 \qquad \text{and} \qquad z^* = \rho z_1 + \sqrt{1-\rho^2}\,z_2\; .\]</span> The random variable <span class="math inline">\(z^*\)</span> is also a standard normal, and the correlation between <span class="math inline">\(z\)</span> and <span class="math inline">\(z^*\)</span> is <span class="math inline">\(\rho\)</span>.</p>
<p>As in the GARCH model, we can simulate a path of an asset price that follows a GARCH process and the path of its volatility as follows. The following python code produces three columns of data (with headings), the first column being time, the second the asset price, and the third the volatility in the Heston model.</p>
<div id="59319771" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="59319771"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="59319771-1"><a href="#59319771-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="59319771-2"><a href="#59319771-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="59319771-3"><a href="#59319771-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="59319771-4"><a href="#59319771-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="59319771-5"><a href="#59319771-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulating_stochastic_volatility(S, V0, r, q, dt, N, theta, kappa, sigma, rho):</span>
<span id="59319771-6"><a href="#59319771-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="59319771-7"><a href="#59319771-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Inputs:</span></span>
<span id="59319771-8"><a href="#59319771-8" aria-hidden="true" tabindex="-1"></a><span class="co">    S = initial stock price</span></span>
<span id="59319771-9"><a href="#59319771-9" aria-hidden="true" tabindex="-1"></a><span class="co">    V0 = initial variance</span></span>
<span id="59319771-10"><a href="#59319771-10" aria-hidden="true" tabindex="-1"></a><span class="co">    r = risk-free rate</span></span>
<span id="59319771-11"><a href="#59319771-11" aria-hidden="true" tabindex="-1"></a><span class="co">    q = dividend yield</span></span>
<span id="59319771-12"><a href="#59319771-12" aria-hidden="true" tabindex="-1"></a><span class="co">    dt = length of each time period (Delta t)</span></span>
<span id="59319771-13"><a href="#59319771-13" aria-hidden="true" tabindex="-1"></a><span class="co">    N = number of time periods</span></span>
<span id="59319771-14"><a href="#59319771-14" aria-hidden="true" tabindex="-1"></a><span class="co">    theta = long-term variance (mean of variance)</span></span>
<span id="59319771-15"><a href="#59319771-15" aria-hidden="true" tabindex="-1"></a><span class="co">    kappa = rate of mean reversion of variance</span></span>
<span id="59319771-16"><a href="#59319771-16" aria-hidden="true" tabindex="-1"></a><span class="co">    sigma = volatility of variance</span></span>
<span id="59319771-17"><a href="#59319771-17" aria-hidden="true" tabindex="-1"></a><span class="co">    rho = correlation between the two Wiener processes</span></span>
<span id="59319771-18"><a href="#59319771-18" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="59319771-19"><a href="#59319771-19" aria-hidden="true" tabindex="-1"></a>    LogS <span class="op">=</span> np.log(S)</span>
<span id="59319771-20"><a href="#59319771-20" aria-hidden="true" tabindex="-1"></a>    Sqrdt <span class="op">=</span> np.sqrt(dt)</span>
<span id="59319771-21"><a href="#59319771-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="59319771-22"><a href="#59319771-22" aria-hidden="true" tabindex="-1"></a>    time <span class="op">=</span> np.zeros(N <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="59319771-23"><a href="#59319771-23" aria-hidden="true" tabindex="-1"></a>    stock_price <span class="op">=</span> np.zeros(N <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="59319771-24"><a href="#59319771-24" aria-hidden="true" tabindex="-1"></a>    volatility <span class="op">=</span> np.zeros(N <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="59319771-25"><a href="#59319771-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="59319771-26"><a href="#59319771-26" aria-hidden="true" tabindex="-1"></a>    stock_price[<span class="dv">0</span>] <span class="op">=</span> S</span>
<span id="59319771-27"><a href="#59319771-27" aria-hidden="true" tabindex="-1"></a>    volatility[<span class="dv">0</span>] <span class="op">=</span> V0</span>
<span id="59319771-28"><a href="#59319771-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="59319771-29"><a href="#59319771-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, N <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="59319771-30"><a href="#59319771-30" aria-hidden="true" tabindex="-1"></a>        time[i] <span class="op">=</span> i <span class="op">*</span> dt</span>
<span id="59319771-31"><a href="#59319771-31" aria-hidden="true" tabindex="-1"></a>        Z1 <span class="op">=</span> np.random.randn()</span>
<span id="59319771-32"><a href="#59319771-32" aria-hidden="true" tabindex="-1"></a>        Z2 <span class="op">=</span> np.random.randn()</span>
<span id="59319771-33"><a href="#59319771-33" aria-hidden="true" tabindex="-1"></a>        W1 <span class="op">=</span> Z1</span>
<span id="59319771-34"><a href="#59319771-34" aria-hidden="true" tabindex="-1"></a>        W2 <span class="op">=</span> rho <span class="op">*</span> Z1 <span class="op">+</span> np.sqrt(<span class="dv">1</span> <span class="op">-</span> rho<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> Z2</span>
<span id="59319771-35"><a href="#59319771-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="59319771-36"><a href="#59319771-36" aria-hidden="true" tabindex="-1"></a>        LogS <span class="op">=</span> (</span>
<span id="59319771-37"><a href="#59319771-37" aria-hidden="true" tabindex="-1"></a>            LogS</span>
<span id="59319771-38"><a href="#59319771-38" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> (r <span class="op">-</span> q <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> volatility[i <span class="op">-</span> <span class="dv">1</span>] <span class="op">**</span> <span class="dv">2</span>) <span class="op">*</span> dt</span>
<span id="59319771-39"><a href="#59319771-39" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> np.sqrt(volatility[i <span class="op">-</span> <span class="dv">1</span>] <span class="op">**</span> <span class="dv">2</span> <span class="op">*</span> dt) <span class="op">*</span> W1</span>
<span id="59319771-40"><a href="#59319771-40" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="59319771-41"><a href="#59319771-41" aria-hidden="true" tabindex="-1"></a>        S <span class="op">=</span> np.exp(LogS)</span>
<span id="59319771-42"><a href="#59319771-42" aria-hidden="true" tabindex="-1"></a>        stock_price[i] <span class="op">=</span> S</span>
<span id="59319771-43"><a href="#59319771-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="59319771-44"><a href="#59319771-44" aria-hidden="true" tabindex="-1"></a>        volatility[i] <span class="op">=</span> np.sqrt(</span>
<span id="59319771-45"><a href="#59319771-45" aria-hidden="true" tabindex="-1"></a>            np.maximum(</span>
<span id="59319771-46"><a href="#59319771-46" aria-hidden="true" tabindex="-1"></a>                volatility[i <span class="op">-</span> <span class="dv">1</span>] <span class="op">**</span> <span class="dv">2</span></span>
<span id="59319771-47"><a href="#59319771-47" aria-hidden="true" tabindex="-1"></a>                <span class="op">+</span> kappa <span class="op">*</span> (theta <span class="op">-</span> volatility[i <span class="op">-</span> <span class="dv">1</span>] <span class="op">**</span> <span class="dv">2</span>) <span class="op">*</span> dt</span>
<span id="59319771-48"><a href="#59319771-48" aria-hidden="true" tabindex="-1"></a>                <span class="op">+</span> sigma <span class="op">*</span> np.sqrt(volatility[i <span class="op">-</span> <span class="dv">1</span>] <span class="op">**</span> <span class="dv">2</span> <span class="op">*</span> dt) <span class="op">*</span> W2,</span>
<span id="59319771-49"><a href="#59319771-49" aria-hidden="true" tabindex="-1"></a>                <span class="dv">0</span>,</span>
<span id="59319771-50"><a href="#59319771-50" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="59319771-51"><a href="#59319771-51" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="59319771-52"><a href="#59319771-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="59319771-53"><a href="#59319771-53" aria-hidden="true" tabindex="-1"></a>    df_stochastic_vol <span class="op">=</span> pd.DataFrame(</span>
<span id="59319771-54"><a href="#59319771-54" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"Time"</span>: time, <span class="st">"Stock Price"</span>: stock_price, <span class="st">"Volatility"</span>: volatility}</span>
<span id="59319771-55"><a href="#59319771-55" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="59319771-56"><a href="#59319771-56" aria-hidden="true" tabindex="-1"></a>    df_stochastic_vol.to_csv(<span class="st">"stochastic_volatility_simulation.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="59319771-57"><a href="#59319771-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_stochastic_vol</span>
<span id="59319771-58"><a href="#59319771-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="59319771-59"><a href="#59319771-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="59319771-60"><a href="#59319771-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="59319771-61"><a href="#59319771-61" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> <span class="dv">100</span>  <span class="co"># Initial stock price</span></span>
<span id="59319771-62"><a href="#59319771-62" aria-hidden="true" tabindex="-1"></a>V0 <span class="op">=</span> <span class="fl">0.04</span>  <span class="co"># Initial variance</span></span>
<span id="59319771-63"><a href="#59319771-63" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.05</span>  <span class="co"># Risk-free rate</span></span>
<span id="59319771-64"><a href="#59319771-64" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="fl">0.02</span>  <span class="co"># Dividend yield</span></span>
<span id="59319771-65"><a href="#59319771-65" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> <span class="dv">252</span>  <span class="co"># Length of each time period (daily)</span></span>
<span id="59319771-66"><a href="#59319771-66" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">252</span>  <span class="co"># Number of time periods (one year)</span></span>
<span id="59319771-67"><a href="#59319771-67" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> <span class="fl">0.04</span>  <span class="co"># Long-term variance</span></span>
<span id="59319771-68"><a href="#59319771-68" aria-hidden="true" tabindex="-1"></a>kappa <span class="op">=</span> <span class="fl">2.0</span>  <span class="co"># Rate of mean reversion of variance</span></span>
<span id="59319771-69"><a href="#59319771-69" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.3</span>  <span class="co"># Volatility of variance</span></span>
<span id="59319771-70"><a href="#59319771-70" aria-hidden="true" tabindex="-1"></a>rho <span class="op">=</span> <span class="op">-</span><span class="fl">0.7</span>  <span class="co"># Correlation between the two Wiener processes</span></span>
<span id="59319771-71"><a href="#59319771-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="59319771-72"><a href="#59319771-72" aria-hidden="true" tabindex="-1"></a>df_stochastic_vol <span class="op">=</span> simulating_stochastic_volatility(</span>
<span id="59319771-73"><a href="#59319771-73" aria-hidden="true" tabindex="-1"></a>    S, V0, r, q, dt, N, theta, kappa, sigma, rho</span>
<span id="59319771-74"><a href="#59319771-74" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="59319771-75"><a href="#59319771-75" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_stochastic_vol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         Time  Stock Price  Volatility
0    0.000000   100.000000    0.040000
1    0.003968    99.726158    0.054538
2    0.007937   100.074946    0.048307
3    0.011905    99.945809    0.059813
4    0.015873   100.129575    0.054439
..        ...          ...         ...
248  0.984127    93.344123    0.171872
249  0.988095    94.087522    0.152977
250  0.992063    94.266084    0.149252
251  0.996032    93.395937    0.163006
252  1.000000    94.255783    0.140319

[253 rows x 3 columns]</code></pre>
</div>
</div>
<p>The following code plots the simulated stock price and the variance paths.</p>
<div id="02923b1e" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="02923b1e"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="02923b1e-1"><a href="#02923b1e-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="02923b1e-2"><a href="#02923b1e-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="02923b1e-3"><a href="#02923b1e-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="02923b1e-4"><a href="#02923b1e-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Heston model parameters</span></span>
<span id="02923b1e-5"><a href="#02923b1e-5" aria-hidden="true" tabindex="-1"></a>S0 <span class="op">=</span> <span class="dv">100</span>  <span class="co"># Initial stock price</span></span>
<span id="02923b1e-6"><a href="#02923b1e-6" aria-hidden="true" tabindex="-1"></a>V0 <span class="op">=</span> <span class="fl">0.04</span>  <span class="co"># Initial variance</span></span>
<span id="02923b1e-7"><a href="#02923b1e-7" aria-hidden="true" tabindex="-1"></a>rho <span class="op">=</span> <span class="op">-</span><span class="fl">0.7</span>  <span class="co"># Correlation between the two Wiener processes</span></span>
<span id="02923b1e-8"><a href="#02923b1e-8" aria-hidden="true" tabindex="-1"></a>kappa <span class="op">=</span> <span class="fl">2.0</span>  <span class="co"># Rate of mean reversion of variance</span></span>
<span id="02923b1e-9"><a href="#02923b1e-9" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> <span class="fl">0.04</span>  <span class="co"># Long-term variance</span></span>
<span id="02923b1e-10"><a href="#02923b1e-10" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.3</span>  <span class="co"># Volatility of variance</span></span>
<span id="02923b1e-11"><a href="#02923b1e-11" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.05</span>  <span class="co"># Risk-free rate</span></span>
<span id="02923b1e-12"><a href="#02923b1e-12" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="fl">1.0</span>  <span class="co"># Time to maturity</span></span>
<span id="02923b1e-13"><a href="#02923b1e-13" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">252</span>  <span class="co"># Number of time steps</span></span>
<span id="02923b1e-14"><a href="#02923b1e-14" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> T <span class="op">/</span> N  <span class="co"># Time step size</span></span>
<span id="02923b1e-15"><a href="#02923b1e-15" aria-hidden="true" tabindex="-1"></a>n_simulations <span class="op">=</span> <span class="dv">1000</span>  <span class="co"># Number of simulations</span></span>
<span id="02923b1e-16"><a href="#02923b1e-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="02923b1e-17"><a href="#02923b1e-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Preallocate arrays</span></span>
<span id="02923b1e-18"><a href="#02923b1e-18" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> np.zeros((N <span class="op">+</span> <span class="dv">1</span>, n_simulations))</span>
<span id="02923b1e-19"><a href="#02923b1e-19" aria-hidden="true" tabindex="-1"></a>V <span class="op">=</span> np.zeros((N <span class="op">+</span> <span class="dv">1</span>, n_simulations))</span>
<span id="02923b1e-20"><a href="#02923b1e-20" aria-hidden="true" tabindex="-1"></a>S[<span class="dv">0</span>] <span class="op">=</span> S0</span>
<span id="02923b1e-21"><a href="#02923b1e-21" aria-hidden="true" tabindex="-1"></a>V[<span class="dv">0</span>] <span class="op">=</span> V0</span>
<span id="02923b1e-22"><a href="#02923b1e-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="02923b1e-23"><a href="#02923b1e-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate the paths</span></span>
<span id="02923b1e-24"><a href="#02923b1e-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, N <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="02923b1e-25"><a href="#02923b1e-25" aria-hidden="true" tabindex="-1"></a>    Z1 <span class="op">=</span> np.random.normal(size<span class="op">=</span>n_simulations)</span>
<span id="02923b1e-26"><a href="#02923b1e-26" aria-hidden="true" tabindex="-1"></a>    Z2 <span class="op">=</span> np.random.normal(size<span class="op">=</span>n_simulations)</span>
<span id="02923b1e-27"><a href="#02923b1e-27" aria-hidden="true" tabindex="-1"></a>    W1 <span class="op">=</span> Z1</span>
<span id="02923b1e-28"><a href="#02923b1e-28" aria-hidden="true" tabindex="-1"></a>    W2 <span class="op">=</span> rho <span class="op">*</span> Z1 <span class="op">+</span> np.sqrt(<span class="dv">1</span> <span class="op">-</span> rho<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> Z2</span>
<span id="02923b1e-29"><a href="#02923b1e-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="02923b1e-30"><a href="#02923b1e-30" aria-hidden="true" tabindex="-1"></a>    V[t] <span class="op">=</span> np.maximum(</span>
<span id="02923b1e-31"><a href="#02923b1e-31" aria-hidden="true" tabindex="-1"></a>        V[t <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="02923b1e-32"><a href="#02923b1e-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> kappa <span class="op">*</span> (theta <span class="op">-</span> V[t <span class="op">-</span> <span class="dv">1</span>]) <span class="op">*</span> dt</span>
<span id="02923b1e-33"><a href="#02923b1e-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> sigma <span class="op">*</span> np.sqrt(V[t <span class="op">-</span> <span class="dv">1</span>] <span class="op">*</span> dt) <span class="op">*</span> W2,</span>
<span id="02923b1e-34"><a href="#02923b1e-34" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span>,</span>
<span id="02923b1e-35"><a href="#02923b1e-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="02923b1e-36"><a href="#02923b1e-36" aria-hidden="true" tabindex="-1"></a>    S[t] <span class="op">=</span> S[t <span class="op">-</span> <span class="dv">1</span>] <span class="op">*</span> np.exp((r <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> V[t <span class="op">-</span> <span class="dv">1</span>]) <span class="op">*</span> dt <span class="op">+</span> np.sqrt(V[t <span class="op">-</span> <span class="dv">1</span>] <span class="op">*</span> dt) <span class="op">*</span> W1)</span>
<span id="02923b1e-37"><a href="#02923b1e-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="02923b1e-38"><a href="#02923b1e-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the results</span></span>
<span id="02923b1e-39"><a href="#02923b1e-39" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="02923b1e-40"><a href="#02923b1e-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_simulations):</span>
<span id="02923b1e-41"><a href="#02923b1e-41" aria-hidden="true" tabindex="-1"></a>    plt.plot(S[:, i], lw<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="02923b1e-42"><a href="#02923b1e-42" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Stock Price Paths with Stochastic Volatility (Heston Model)"</span>)</span>
<span id="02923b1e-43"><a href="#02923b1e-43" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Time Steps"</span>)</span>
<span id="02923b1e-44"><a href="#02923b1e-44" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Stock Price"</span>)</span>
<span id="02923b1e-45"><a href="#02923b1e-45" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="02923b1e-46"><a href="#02923b1e-46" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="02923b1e-47"><a href="#02923b1e-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="02923b1e-48"><a href="#02923b1e-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the volatility paths</span></span>
<span id="02923b1e-49"><a href="#02923b1e-49" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="02923b1e-50"><a href="#02923b1e-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_simulations):</span>
<span id="02923b1e-51"><a href="#02923b1e-51" aria-hidden="true" tabindex="-1"></a>    plt.plot(V[:, i], lw<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="02923b1e-52"><a href="#02923b1e-52" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Variance Paths with Stochastic Volatility (Heston Model)"</span>)</span>
<span id="02923b1e-53"><a href="#02923b1e-53" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Time Steps"</span>)</span>
<span id="02923b1e-54"><a href="#02923b1e-54" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Variance"</span>)</span>
<span id="02923b1e-55"><a href="#02923b1e-55" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="02923b1e-56"><a href="#02923b1e-56" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter_StochasticVol_files/figure-html/cell-4-output-1.png" width="965" height="523" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter_StochasticVol_files/figure-html/cell-4-output-2.png" width="969" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The following code shows that the stock returns under the stochastic volatility model display fat-tails with positive kurtosis.</p>
<div id="b4b7ec6a" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="b4b7ec6a"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="b4b7ec6a-1"><a href="#b4b7ec6a-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="b4b7ec6a-2"><a href="#b4b7ec6a-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="b4b7ec6a-3"><a href="#b4b7ec6a-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="b4b7ec6a-4"><a href="#b4b7ec6a-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="b4b7ec6a-5"><a href="#b4b7ec6a-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm, kurtosis</span>
<span id="b4b7ec6a-6"><a href="#b4b7ec6a-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4b7ec6a-7"><a href="#b4b7ec6a-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4b7ec6a-8"><a href="#b4b7ec6a-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulating_stochastic_volatility(</span>
<span id="b4b7ec6a-9"><a href="#b4b7ec6a-9" aria-hidden="true" tabindex="-1"></a>    S, V0, r, q, dt, N, theta, kappa, sigma, rho, n_simulations</span>
<span id="b4b7ec6a-10"><a href="#b4b7ec6a-10" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="b4b7ec6a-11"><a href="#b4b7ec6a-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="b4b7ec6a-12"><a href="#b4b7ec6a-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Inputs:</span></span>
<span id="b4b7ec6a-13"><a href="#b4b7ec6a-13" aria-hidden="true" tabindex="-1"></a><span class="co">    S = initial stock price</span></span>
<span id="b4b7ec6a-14"><a href="#b4b7ec6a-14" aria-hidden="true" tabindex="-1"></a><span class="co">    V0 = initial variance</span></span>
<span id="b4b7ec6a-15"><a href="#b4b7ec6a-15" aria-hidden="true" tabindex="-1"></a><span class="co">    r = risk-free rate</span></span>
<span id="b4b7ec6a-16"><a href="#b4b7ec6a-16" aria-hidden="true" tabindex="-1"></a><span class="co">    q = dividend yield</span></span>
<span id="b4b7ec6a-17"><a href="#b4b7ec6a-17" aria-hidden="true" tabindex="-1"></a><span class="co">    dt = length of each time period (Delta t)</span></span>
<span id="b4b7ec6a-18"><a href="#b4b7ec6a-18" aria-hidden="true" tabindex="-1"></a><span class="co">    N = number of time periods</span></span>
<span id="b4b7ec6a-19"><a href="#b4b7ec6a-19" aria-hidden="true" tabindex="-1"></a><span class="co">    theta = long-term variance (mean of variance)</span></span>
<span id="b4b7ec6a-20"><a href="#b4b7ec6a-20" aria-hidden="true" tabindex="-1"></a><span class="co">    kappa = rate of mean reversion of variance</span></span>
<span id="b4b7ec6a-21"><a href="#b4b7ec6a-21" aria-hidden="true" tabindex="-1"></a><span class="co">    sigma = volatility of variance</span></span>
<span id="b4b7ec6a-22"><a href="#b4b7ec6a-22" aria-hidden="true" tabindex="-1"></a><span class="co">    rho = correlation between the two Wiener processes</span></span>
<span id="b4b7ec6a-23"><a href="#b4b7ec6a-23" aria-hidden="true" tabindex="-1"></a><span class="co">    n_simulations = number of simulations</span></span>
<span id="b4b7ec6a-24"><a href="#b4b7ec6a-24" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="b4b7ec6a-25"><a href="#b4b7ec6a-25" aria-hidden="true" tabindex="-1"></a>    LogS <span class="op">=</span> np.log(S)</span>
<span id="b4b7ec6a-26"><a href="#b4b7ec6a-26" aria-hidden="true" tabindex="-1"></a>    Sqrdt <span class="op">=</span> np.sqrt(dt)</span>
<span id="b4b7ec6a-27"><a href="#b4b7ec6a-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4b7ec6a-28"><a href="#b4b7ec6a-28" aria-hidden="true" tabindex="-1"></a>    log_returns <span class="op">=</span> []</span>
<span id="b4b7ec6a-29"><a href="#b4b7ec6a-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4b7ec6a-30"><a href="#b4b7ec6a-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n_simulations):</span>
<span id="b4b7ec6a-31"><a href="#b4b7ec6a-31" aria-hidden="true" tabindex="-1"></a>        stock_price <span class="op">=</span> S</span>
<span id="b4b7ec6a-32"><a href="#b4b7ec6a-32" aria-hidden="true" tabindex="-1"></a>        variance <span class="op">=</span> V0</span>
<span id="b4b7ec6a-33"><a href="#b4b7ec6a-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(N):</span>
<span id="b4b7ec6a-34"><a href="#b4b7ec6a-34" aria-hidden="true" tabindex="-1"></a>            Z1 <span class="op">=</span> np.random.randn()</span>
<span id="b4b7ec6a-35"><a href="#b4b7ec6a-35" aria-hidden="true" tabindex="-1"></a>            Z2 <span class="op">=</span> np.random.randn()</span>
<span id="b4b7ec6a-36"><a href="#b4b7ec6a-36" aria-hidden="true" tabindex="-1"></a>            W1 <span class="op">=</span> Z1</span>
<span id="b4b7ec6a-37"><a href="#b4b7ec6a-37" aria-hidden="true" tabindex="-1"></a>            W2 <span class="op">=</span> rho <span class="op">*</span> Z1 <span class="op">+</span> np.sqrt(<span class="dv">1</span> <span class="op">-</span> rho<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> Z2</span>
<span id="b4b7ec6a-38"><a href="#b4b7ec6a-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4b7ec6a-39"><a href="#b4b7ec6a-39" aria-hidden="true" tabindex="-1"></a>            log_return <span class="op">=</span> (r <span class="op">-</span> q <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> variance) <span class="op">*</span> dt <span class="op">+</span> np.sqrt(variance <span class="op">*</span> dt) <span class="op">*</span> W1</span>
<span id="b4b7ec6a-40"><a href="#b4b7ec6a-40" aria-hidden="true" tabindex="-1"></a>            LogS <span class="op">=</span> np.log(stock_price) <span class="op">+</span> log_return</span>
<span id="b4b7ec6a-41"><a href="#b4b7ec6a-41" aria-hidden="true" tabindex="-1"></a>            stock_price <span class="op">=</span> np.exp(LogS)</span>
<span id="b4b7ec6a-42"><a href="#b4b7ec6a-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4b7ec6a-43"><a href="#b4b7ec6a-43" aria-hidden="true" tabindex="-1"></a>            variance <span class="op">=</span> np.maximum(</span>
<span id="b4b7ec6a-44"><a href="#b4b7ec6a-44" aria-hidden="true" tabindex="-1"></a>                variance</span>
<span id="b4b7ec6a-45"><a href="#b4b7ec6a-45" aria-hidden="true" tabindex="-1"></a>                <span class="op">+</span> kappa <span class="op">*</span> (theta <span class="op">-</span> variance) <span class="op">*</span> dt</span>
<span id="b4b7ec6a-46"><a href="#b4b7ec6a-46" aria-hidden="true" tabindex="-1"></a>                <span class="op">+</span> sigma <span class="op">*</span> np.sqrt(variance <span class="op">*</span> dt) <span class="op">*</span> W2,</span>
<span id="b4b7ec6a-47"><a href="#b4b7ec6a-47" aria-hidden="true" tabindex="-1"></a>                <span class="dv">0</span>,</span>
<span id="b4b7ec6a-48"><a href="#b4b7ec6a-48" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="b4b7ec6a-49"><a href="#b4b7ec6a-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4b7ec6a-50"><a href="#b4b7ec6a-50" aria-hidden="true" tabindex="-1"></a>            log_returns.append(log_return)</span>
<span id="b4b7ec6a-51"><a href="#b4b7ec6a-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4b7ec6a-52"><a href="#b4b7ec6a-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> log_returns</span>
<span id="b4b7ec6a-53"><a href="#b4b7ec6a-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4b7ec6a-54"><a href="#b4b7ec6a-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4b7ec6a-55"><a href="#b4b7ec6a-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="b4b7ec6a-56"><a href="#b4b7ec6a-56" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> <span class="dv">100</span>  <span class="co"># Initial stock price</span></span>
<span id="b4b7ec6a-57"><a href="#b4b7ec6a-57" aria-hidden="true" tabindex="-1"></a>V0 <span class="op">=</span> <span class="fl">0.04</span>  <span class="co"># Initial variance</span></span>
<span id="b4b7ec6a-58"><a href="#b4b7ec6a-58" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.05</span>  <span class="co"># Risk-free rate</span></span>
<span id="b4b7ec6a-59"><a href="#b4b7ec6a-59" aria-hidden="true" tabindex="-1"></a>q <span class="op">=</span> <span class="fl">0.02</span>  <span class="co"># Dividend yield</span></span>
<span id="b4b7ec6a-60"><a href="#b4b7ec6a-60" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> <span class="dv">252</span>  <span class="co"># Length of each time period (daily)</span></span>
<span id="b4b7ec6a-61"><a href="#b4b7ec6a-61" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">252</span>  <span class="co"># Number of time periods (one year)</span></span>
<span id="b4b7ec6a-62"><a href="#b4b7ec6a-62" aria-hidden="true" tabindex="-1"></a>theta <span class="op">=</span> <span class="fl">0.04</span>  <span class="co"># Long-term variance</span></span>
<span id="b4b7ec6a-63"><a href="#b4b7ec6a-63" aria-hidden="true" tabindex="-1"></a>kappa <span class="op">=</span> <span class="fl">0.2</span>  <span class="co"># Rate of mean reversion of variance</span></span>
<span id="b4b7ec6a-64"><a href="#b4b7ec6a-64" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.3</span>  <span class="co"># Volatility of variance</span></span>
<span id="b4b7ec6a-65"><a href="#b4b7ec6a-65" aria-hidden="true" tabindex="-1"></a>rho <span class="op">=</span> <span class="op">-</span><span class="fl">0.7</span>  <span class="co"># Correlation between the two Wiener processes</span></span>
<span id="b4b7ec6a-66"><a href="#b4b7ec6a-66" aria-hidden="true" tabindex="-1"></a>n_simulations <span class="op">=</span> <span class="dv">1000</span>  <span class="co"># Number of simulations</span></span>
<span id="b4b7ec6a-67"><a href="#b4b7ec6a-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4b7ec6a-68"><a href="#b4b7ec6a-68" aria-hidden="true" tabindex="-1"></a>log_returns <span class="op">=</span> simulating_stochastic_volatility(</span>
<span id="b4b7ec6a-69"><a href="#b4b7ec6a-69" aria-hidden="true" tabindex="-1"></a>    S, V0, r, q, dt, N, theta, kappa, sigma, rho, n_simulations</span>
<span id="b4b7ec6a-70"><a href="#b4b7ec6a-70" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="b4b7ec6a-71"><a href="#b4b7ec6a-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4b7ec6a-72"><a href="#b4b7ec6a-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the distribution of log returns</span></span>
<span id="b4b7ec6a-73"><a href="#b4b7ec6a-73" aria-hidden="true" tabindex="-1"></a>sns.histplot(</span>
<span id="b4b7ec6a-74"><a href="#b4b7ec6a-74" aria-hidden="true" tabindex="-1"></a>    log_returns,</span>
<span id="b4b7ec6a-75"><a href="#b4b7ec6a-75" aria-hidden="true" tabindex="-1"></a>    bins<span class="op">=</span><span class="dv">100</span>,</span>
<span id="b4b7ec6a-76"><a href="#b4b7ec6a-76" aria-hidden="true" tabindex="-1"></a>    kde<span class="op">=</span><span class="va">True</span>,</span>
<span id="b4b7ec6a-77"><a href="#b4b7ec6a-77" aria-hidden="true" tabindex="-1"></a>    stat<span class="op">=</span><span class="st">"density"</span>,</span>
<span id="b4b7ec6a-78"><a href="#b4b7ec6a-78" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"blue"</span>,</span>
<span id="b4b7ec6a-79"><a href="#b4b7ec6a-79" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">"Simulated Log Returns"</span>,</span>
<span id="b4b7ec6a-80"><a href="#b4b7ec6a-80" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="b4b7ec6a-81"><a href="#b4b7ec6a-81" aria-hidden="true" tabindex="-1"></a>xmin, xmax <span class="op">=</span> plt.xlim()</span>
<span id="b4b7ec6a-82"><a href="#b4b7ec6a-82" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.linspace(xmin, xmax, <span class="dv">100</span>)</span>
<span id="b4b7ec6a-83"><a href="#b4b7ec6a-83" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> norm.pdf(x, np.mean(log_returns), np.std(log_returns))</span>
<span id="b4b7ec6a-84"><a href="#b4b7ec6a-84" aria-hidden="true" tabindex="-1"></a>plt.plot(x, p, <span class="st">"k"</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">"Normal Distribution"</span>)</span>
<span id="b4b7ec6a-85"><a href="#b4b7ec6a-85" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Distribution of Log Returns with Stochastic Volatility"</span>)</span>
<span id="b4b7ec6a-86"><a href="#b4b7ec6a-86" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Log Return"</span>)</span>
<span id="b4b7ec6a-87"><a href="#b4b7ec6a-87" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Density"</span>)</span>
<span id="b4b7ec6a-88"><a href="#b4b7ec6a-88" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="b4b7ec6a-89"><a href="#b4b7ec6a-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4b7ec6a-90"><a href="#b4b7ec6a-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Display kurtosis</span></span>
<span id="b4b7ec6a-91"><a href="#b4b7ec6a-91" aria-hidden="true" tabindex="-1"></a>kurt <span class="op">=</span> kurtosis(log_returns)</span>
<span id="b4b7ec6a-92"><a href="#b4b7ec6a-92" aria-hidden="true" tabindex="-1"></a>plt.figtext(<span class="fl">0.15</span>, <span class="fl">0.8</span>, <span class="ss">f"Kurtosis: </span><span class="sc">{</span>kurt<span class="sc">:.2f}</span><span class="ss">"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="b4b7ec6a-93"><a href="#b4b7ec6a-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="b4b7ec6a-94"><a href="#b4b7ec6a-94" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Chapter_StochasticVol_files/figure-html/cell-5-output-1.png" width="585" height="302" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>To price European options, we again need to compute <span class="math display">\[\text{prob}^S(S_T&gt;K) \qquad \text{and} \qquad \text{prob}^R(S_T&gt;K)\; .\]</span> The virtue of modelling volatility as in <a href="#eq-heston2" class="quarto-xref">Equation&nbsp;<span>18.2</span></a> is that these probabilities can be computed quite efficiently, as shown by Heston <span class="citation" data-cites="Heston">(<a href="#ref-Heston" role="doc-biblioref">Heston 1993</a>)</span>.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> There are many other ways in which one could model volatility, but the computations may be more difficult. For example, one could replace <a href="#eq-heston2" class="quarto-xref">Equation&nbsp;<span>18.2</span></a> by <span id="eq-heston5"><span class="math display">\[
\sigma_t = \mathrm{e}^{v_t} \quad \text{and} \quad dv_t = \kappa (\theta-v_t)\,\mathrm{d}t + \lambda \,\mathrm{d}B^*\;.
\qquad(18.6)\]</span></span></p>
<p>This implies a lognormal volatility and is simpler to simulate than <a href="#eq-heston2" class="quarto-xref">Equation&nbsp;<span>18.2</span></a>—because <span class="math inline">\(\mathrm{e}^{v}\)</span> is well defined even when <span class="math inline">\(v\)</span> is negative—but it is easier to calculate the probabilities <span class="math inline">\(\text{prob}^S(S_T&gt;K)\)</span> and <span class="math inline">\(\text{prob}^R(S_T&gt;K)\)</span> if we assume <a href="#eq-heston2" class="quarto-xref">Equation&nbsp;<span>18.2</span></a>.</p>
<p>One way to implement the GARCH or stochastic volatility model is to imply both the initial volatility <span class="math inline">\(\sigma_0\)</span> and the constants <span class="math inline">\(\kappa\)</span>, <span class="math inline">\(\theta\)</span> and <span class="math inline">\(\lambda\)</span> or <span class="math inline">\(\kappa\)</span>, <span class="math inline">\(\theta\)</span>, <span class="math inline">\(\gamma\)</span> and <span class="math inline">\(\rho\)</span> from observed option prices. These four (or five) constants can be computed by forcing the model prices of four (or five) options to equal the observed market prices. Or, a larger set of prices can be used and the constants can be chosen to minimize the average squared error or some other measure of goodness-of-fit between the model and market prices.</p>
<section id="hedging-and-market-completeness" class="level2" data-number="18.1">
<h2 data-number="18.1" class="anchored" data-anchor-id="hedging-and-market-completeness"><span class="header-section-number">18.1</span> Hedging and Market Completeness</h2>
<p>The GARCH model is inherently a discrete-time model. If returns have a GARCH structure at one frequency (e.g., monthly), they will not have a GARCH structure at a different frequency (e.g., weekly). Hence, the return period (monthly, weekly, ) is part of the specification of the model. One interpretation of the model is that the dates <span class="math inline">\(t_i\)</span> at which the variance changes are the only dates at which investors can trade. Under this interpretation, it is impossible to perfectly hedge an option: the gross return <span class="math inline">\(S_{t_i}/S_{t_{i-1}}\)</span> over the interval <span class="math inline">\((t_{i-1},t_i)\)</span> is lognormally distributed, so no portfolio of the stock and riskless asset formed at <span class="math inline">\(t_{i-1}\)</span> and held over the interval <span class="math inline">\((t_{i-1},t_i)\)</span> can perfectly replicate the return of an option over the interval. As discussed in <span class="quarto-unresolved-ref">?sec-s:incomplete</span>, we call a market in which some derivatives cannot be perfectly hedged an incomplete market. Thus, the GARCH model is an example of an incomplete market, if investors can only trade at the frequency at which returns have a GARCH structure. However, it is unreasonable to assume that investors can only trade weekly or monthly or even daily.</p>
<p>Another interpretation of the GARCH model is that investors can trade continuously and the asset has a constant volatility within each period <span class="math inline">\((t_{i-1},t_i)\)</span>. Under this interpretation, the market is complete and options can be delta-hedged. The completeness is a result of the fact that the change <span class="math inline">\(\sigma_{i+1}-\sigma_i\)</span> in the volatility at date <span class="math inline">\(t_i\)</span> (recall that <span class="math inline">\(\sigma_i\)</span> is the volatility over the period <span class="math inline">\((t_{i-1},t_i)\)</span> and <span class="math inline">\(\sigma_{i+1}\)</span> is the volatility over the period <span class="math inline">\((t_{i},t_{i+1})\)</span>) depends only on <span class="math inline">\(\log S_{t_i}\)</span>. Thus, the only random factor in the model that needs to be hedged is, as usual, the underlying asset price. However, this interpretation of the model is also a bit strange. Suppose for example that monthly returns are assumed to have a GARCH structure. Then the model states that the volatility in February will be higher if there is an unusually large return (in absolute value) in January. Suppose there is an unusually large return in the first half of January. Then, intuitively, one would expect the change in the volatility to occur in the second half of January rather than being delayed until February. However, the model specifies that the volatility is constant during each month, hence constant during January in this example.</p>
<p>The stochastic volatility model is more straightforward. The market is definitely incomplete. The value of a call option at date <span class="math inline">\(t&lt;T\)</span>, where <span class="math inline">\(T\)</span> is the maturity of the option, will depend on the underlying asset price <span class="math inline">\(S_t\)</span> and the volatility <span class="math inline">\(\sigma_t\)</span>. Denoting the value by <span class="math inline">\(C(t,S_t,\sigma_t)\)</span>, we have from Ito’s formula that <span class="math display">\[
\,\mathrm{d}C_t = \text{something}\;\,\mathrm{d}t + \frac{\partial C}{\partial S}\,\mathrm{d}S_t + \frac{\partial C}{\partial \sigma}\,\mathrm{d}\sigma_t\; .\]</span> A replicating portfolio must have the same dollar change at each date <span class="math inline">\(t\)</span>. If we hold <span class="math inline">\(\partial C/\partial S\)</span> shares of the underlying asset, then the change in the value of the shares will be <span class="math inline">\((\partial C/\partial S)\,\mathrm{d}S\)</span>. However, there is no way to match the<br>
<span class="math inline">\((\partial C/\partial \sigma)\,\mathrm{d}\sigma\)</span> term using the underlying asset and the riskless asset.</p>
<p>The significance of the market being incomplete is that the value of a derivative asset that cannot be replicated using traded assets (e.g., the underlying and riskless assets) is not uniquely determined by arbitrage considerations. As discussed in <span class="quarto-unresolved-ref">?sec-s:incomplete</span>, one must use equilibrium pricing in this circumstance. That is what we have implicitly done in this chapter. By assuming particular dynamics for the volatility under the risk-neutral probability, we have implicitly selected a particular risk-neutral probability from the set of risk-neutral probabilitys that are consistent with the absence of arbitrage.</p>
</section>
<section id="variance-swaps" class="level2" data-number="18.2">
<h2 data-number="18.2" class="anchored" data-anchor-id="variance-swaps"><span class="header-section-number">18.2</span> Variance Swaps</h2>
<p>Variance swaps are a type of futures contracts that allows investors to trade future realized volatility against current option implied variance. Unlike traditional futures, which provide a payoff based on the difference between the underlying asset’s price and the futures price, variance swaps provide a payoff based on the difference between the realized variance of the underlying asset and the predetermined variance level (termed ``Strike’’ in practice), which is the futures price in variance unit.</p>
<p>Variance swaps have gained popularity due to their ability to provide pure exposure to the volatility of an underlying asset, independent of its price movements. Unlike traditional options, variance swaps allow investors to speculate on or hedge against changes in volatility without the need for constant delta hedging. This makes them an effective tool for managing volatility risk and for executing volatility arbitrage strategies, as they simplify the trading of variance and offer a more straightforward payoff structure based on realized versus implied volatility.</p>
<section id="payoff-of-a-variance-swap" class="level3">
<h3 class="anchored" data-anchor-id="payoff-of-a-variance-swap">Payoff of a Variance Swap</h3>
<p>A variance swap is a future contract on future realized variance. Its main components include:</p>
<ul>
<li><strong>Notional Amount</strong>: Specifies the amount of money to be paid for each unit of variance difference.</li>
<li><strong>Strike</strong>: The predetermined level of variance agreed upon at the inception of the swap.</li>
<li><strong>Realized Variance</strong>: Calculated from the returns of the underlying asset over the life of the swap.</li>
</ul>
<p>The payoff of a variance swap is given by:</p>
<p><span class="math display">\[
\text{Payoff} = \text{Notional} \times (\text{Realized Variance} - \text{Strike})
\]</span></p>
<p>Where:</p>
<ul>
<li><strong>Realized Variance</strong> is typically calculated using the formula:</li>
</ul>
<p><span class="math display">\[
\text{Realized Variance} = \frac{252}{N} \sum_{i=1}^{N} \left( \log\left(\frac{S_i}{S_{i-1}}\right) \right)^2
\]</span></p>
<p>Here, <span class="math inline">\(S_i\)</span> represents the price of the underlying asset at time <span class="math inline">\(i\)</span>, and <span class="math inline">\(N\)</span> is the number of trading days over the contract period.</p>
<p><strong>Example</strong>: Suppose an investor enters into a variance swap with a notional amount of $100,000 and a strike of 0.04 (implying a volatility strike of 20%). If the realized variance over the swap’s life is 0.06 (implying a realized volatility of 24.5%), the payoff would be:</p>
<p><span class="math display">\[
\text{Payoff} = 100,000 \times (0.06 - 0.04) = 100,000 \times 0.02 = 2,000
\]</span></p>
<p>This means the investor would receive $2,000 at the end of the swap period.</p>
<p>As all futures constracts, variance swaps are marked to market on each trading day.</p>
<p>Variance swaps can be used to hedge against volatility risk. For example, a portfolio manager concerned about increasing market volatility can buy variance swaps to protect the portfolio’s value.</p>
<p>Traders can also use variance swaps to speculate or arbitrage on future volatility. For example, If a trader believes that future volatility will be higher than the current implied volatility, they can enter a variance swap to profit from this view.</p>
</section>
<section id="pricing-of-a-variance-swap-for-stocks-with-geometric-brownian-motion-prices" class="level3">
<h3 class="anchored" data-anchor-id="pricing-of-a-variance-swap-for-stocks-with-geometric-brownian-motion-prices">Pricing of a Variance Swap for Stocks with Geometric Brownian Motion Prices</h3>
<p>Similor the pricing of a futures, we need find the fair swap strike such that the initial value of the swap is zero. For simplicity, consider a stock whose price <span class="math inline">\(S_t\)</span> follows a geometric Brownian motion process:</p>
<p><span class="math display">\[ \frac{dS_t}{S_t} = \mu \, dt + \sigma \, dZ_t
\]</span></p>
<p>Applying Ito’s Lemma to <span class="math inline">\(\log(S_t)\)</span>:</p>
<p><span class="math display">\[ d(\log S_t) = \left( \mu - \frac{\sigma^2}{2} \right) \, dt + \sigma \, dZ_t
\]</span></p>
<p>Rearranging terms, we get:</p>
<p><span class="math display">\[ \frac{dS_t}{S_t} - d(\log S_t) = \frac{\sigma^2}{2} \, dt
\]</span></p>
<p>Integrating over the life of the swap ( [0, T] ):</p>
<p><span class="math display">\[ \text{Total Variance} = \frac{1}{T} \int_0^T \sigma^2 \, dt = \frac{2}{T} \left( \int_0^T \frac{dS_t}{S_t} - \log \left( \frac{S_T}{S_0} \right) \right),  
\]</span> which implies that the total variance can be replicated by continuously rebalancing the stock position with weight <span class="math inline">\(1/S_t\)</span> and shorting one unit of the security which pays the <span class="math inline">\(\log\)</span> return of the stock. However, this <span class="math inline">\(\log\)</span> return secutiry is not traded in the market. Fortunately, we can synthesize this security with a forward and options, because</p>
<p><span class="math display">\[
-ln (\frac{S_T}{S^*})=-\frac{S-S^*}{S^*}+\int_0^{S^*}\frac{(K-S)^+}{K^2}dK+\int_{S^*}^\infty\frac{(S-K)^+}{K^2}dK,
\]</span> where <span class="math inline">\(S^*\)</span> is an arbitrary cut-off strike for calls and puts, the first term on the right hand side represents a short position in the forward contract on the stock, the second term represents a continuum of put options with strike prices from 0 to <span class="math inline">\(S^*\)</span>, and the third term represents a continuum of call options with strike prices above <span class="math inline">\(S^*\)</span>. Taking expectation under the risk-neutral probability, we have that the fair swap strike <span class="math inline">\(K_{\text{var}}\)</span> is equal to:</p>
<p><span class="math display">\[ K_{\text{var}} = \frac{2}{T} \left( rT - \left( \frac{S_0}{S^*} e^{rT} - 1 \right) - \log \left( \frac{S^*}{S_0} \right) + e^{rT} \int_0^{S^*} \frac{1}{K^2} P(K) \, dK + e^{rT} \int_{S^*}^\infty \frac{1}{K^2} C(K) \, dK \right)
\]</span></p>
<p>Choosing <span class="math inline">\(S^*\)</span> to be the current forward price <span class="math inline">\(F_0=S_0 e^{rT}\)</span>:</p>
<p><span class="math display">\[ K_{\text{var}} = \frac{2 e^{rT}}{T} \left( \int_0^{F_0} \frac{P(K)}{K^2} \, dK + \int_{F_0}^\infty \frac{C(K)}{K^2} \, dK \right)
\]</span></p>
<p>This formula allows us to compute the fair strike price of a variance swap using the prices of European call and put options. The following code provides an example of this computation using data from Yahoo finance for Apple.</p>
<div id="variance_swap_pricing" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="variance_swap_pricing"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="variance_swap_pricing-1"><a href="#variance_swap_pricing-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="variance_swap_pricing-2"><a href="#variance_swap_pricing-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="variance_swap_pricing-3"><a href="#variance_swap_pricing-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.interpolate <span class="im">import</span> interp1d</span>
<span id="variance_swap_pricing-4"><a href="#variance_swap_pricing-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="variance_swap_pricing-5"><a href="#variance_swap_pricing-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="variance_swap_pricing-6"><a href="#variance_swap_pricing-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="variance_swap_pricing-7"><a href="#variance_swap_pricing-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="variance_swap_pricing-8"><a href="#variance_swap_pricing-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> indicator_function(condition):</span>
<span id="variance_swap_pricing-9"><a href="#variance_swap_pricing-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span> <span class="cf">if</span> condition <span class="cf">else</span> <span class="dv">0</span></span>
<span id="variance_swap_pricing-10"><a href="#variance_swap_pricing-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="variance_swap_pricing-11"><a href="#variance_swap_pricing-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="variance_swap_pricing-12"><a href="#variance_swap_pricing-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_variance_swap_strike(S, r, T, options_data):</span>
<span id="variance_swap_pricing-13"><a href="#variance_swap_pricing-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract call and put prices</span></span>
<span id="variance_swap_pricing-14"><a href="#variance_swap_pricing-14" aria-hidden="true" tabindex="-1"></a>    call_data <span class="op">=</span> options_data[options_data[<span class="st">"Type"</span>] <span class="op">==</span> <span class="st">"call"</span>].copy()</span>
<span id="variance_swap_pricing-15"><a href="#variance_swap_pricing-15" aria-hidden="true" tabindex="-1"></a>    put_data <span class="op">=</span> options_data[options_data[<span class="st">"Type"</span>] <span class="op">==</span> <span class="st">"put"</span>].copy()</span>
<span id="variance_swap_pricing-16"><a href="#variance_swap_pricing-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="variance_swap_pricing-17"><a href="#variance_swap_pricing-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Interpolate call and put prices</span></span>
<span id="variance_swap_pricing-18"><a href="#variance_swap_pricing-18" aria-hidden="true" tabindex="-1"></a>    strikes <span class="op">=</span> np.unique(options_data[<span class="st">"Strike"</span>])</span>
<span id="variance_swap_pricing-19"><a href="#variance_swap_pricing-19" aria-hidden="true" tabindex="-1"></a>    call_interp <span class="op">=</span> interp1d(</span>
<span id="variance_swap_pricing-20"><a href="#variance_swap_pricing-20" aria-hidden="true" tabindex="-1"></a>        call_data[<span class="st">"Strike"</span>], call_data[<span class="st">"Price"</span>], fill_value<span class="op">=</span><span class="st">"extrapolate"</span></span>
<span id="variance_swap_pricing-21"><a href="#variance_swap_pricing-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="variance_swap_pricing-22"><a href="#variance_swap_pricing-22" aria-hidden="true" tabindex="-1"></a>    put_interp <span class="op">=</span> interp1d(</span>
<span id="variance_swap_pricing-23"><a href="#variance_swap_pricing-23" aria-hidden="true" tabindex="-1"></a>        put_data[<span class="st">"Strike"</span>], put_data[<span class="st">"Price"</span>], fill_value<span class="op">=</span><span class="st">"extrapolate"</span></span>
<span id="variance_swap_pricing-24"><a href="#variance_swap_pricing-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="variance_swap_pricing-25"><a href="#variance_swap_pricing-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="variance_swap_pricing-26"><a href="#variance_swap_pricing-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Integrate using numerical methods (trapezoidal rule)</span></span>
<span id="variance_swap_pricing-27"><a href="#variance_swap_pricing-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="variance_swap_pricing-28"><a href="#variance_swap_pricing-28" aria-hidden="true" tabindex="-1"></a>    K_min, K_max <span class="op">=</span> strikes.<span class="bu">min</span>(), strikes.<span class="bu">max</span>()</span>
<span id="variance_swap_pricing-29"><a href="#variance_swap_pricing-29" aria-hidden="true" tabindex="-1"></a>    K <span class="op">=</span> np.linspace(K_min, S <span class="op">*</span> np.exp(r <span class="op">*</span> T), <span class="dv">500</span>)</span>
<span id="variance_swap_pricing-30"><a href="#variance_swap_pricing-30" aria-hidden="true" tabindex="-1"></a>    integral1 <span class="op">=</span> np.trapezoid(put_interp(K) <span class="op">/</span> K<span class="op">**</span><span class="dv">2</span>, K)</span>
<span id="variance_swap_pricing-31"><a href="#variance_swap_pricing-31" aria-hidden="true" tabindex="-1"></a>    K <span class="op">=</span> np.linspace(S <span class="op">*</span> np.exp(r <span class="op">*</span> T), K_max, <span class="dv">500</span>)</span>
<span id="variance_swap_pricing-32"><a href="#variance_swap_pricing-32" aria-hidden="true" tabindex="-1"></a>    integral2 <span class="op">=</span> np.trapezoid(call_interp(K) <span class="op">/</span> K<span class="op">**</span><span class="dv">2</span>, K)</span>
<span id="variance_swap_pricing-33"><a href="#variance_swap_pricing-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="variance_swap_pricing-34"><a href="#variance_swap_pricing-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the variance swap strike</span></span>
<span id="variance_swap_pricing-35"><a href="#variance_swap_pricing-35" aria-hidden="true" tabindex="-1"></a>    variance_swap_strike <span class="op">=</span> np.sqrt(<span class="dv">2</span> <span class="op">*</span> (integral1 <span class="op">+</span> integral2) <span class="op">/</span> T)</span>
<span id="variance_swap_pricing-36"><a href="#variance_swap_pricing-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> variance_swap_strike</span>
<span id="variance_swap_pricing-37"><a href="#variance_swap_pricing-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="variance_swap_pricing-38"><a href="#variance_swap_pricing-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="variance_swap_pricing-39"><a href="#variance_swap_pricing-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="variance_swap_pricing-40"><a href="#variance_swap_pricing-40" aria-hidden="true" tabindex="-1"></a>ticker <span class="op">=</span> <span class="st">"AAPL"</span></span>
<span id="variance_swap_pricing-41"><a href="#variance_swap_pricing-41" aria-hidden="true" tabindex="-1"></a>S <span class="op">=</span> <span class="fl">150.0</span>  <span class="co"># Current stock price</span></span>
<span id="variance_swap_pricing-42"><a href="#variance_swap_pricing-42" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.01</span>  <span class="co"># Risk-free rate</span></span>
<span id="variance_swap_pricing-43"><a href="#variance_swap_pricing-43" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="fl">0.5</span>  <span class="co"># Time to maturity (6 months)</span></span>
<span id="variance_swap_pricing-44"><a href="#variance_swap_pricing-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="variance_swap_pricing-45"><a href="#variance_swap_pricing-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch options data from Yahoo Finance</span></span>
<span id="variance_swap_pricing-46"><a href="#variance_swap_pricing-46" aria-hidden="true" tabindex="-1"></a>stock <span class="op">=</span> yf.Ticker(ticker)</span>
<span id="variance_swap_pricing-47"><a href="#variance_swap_pricing-47" aria-hidden="true" tabindex="-1"></a>expiry <span class="op">=</span> stock.options[<span class="dv">0</span>]</span>
<span id="variance_swap_pricing-48"><a href="#variance_swap_pricing-48" aria-hidden="true" tabindex="-1"></a>opt_chain <span class="op">=</span> stock.option_chain(expiry)</span>
<span id="variance_swap_pricing-49"><a href="#variance_swap_pricing-49" aria-hidden="true" tabindex="-1"></a>calls <span class="op">=</span> opt_chain.calls[[<span class="st">"strike"</span>, <span class="st">"lastPrice"</span>]].copy()</span>
<span id="variance_swap_pricing-50"><a href="#variance_swap_pricing-50" aria-hidden="true" tabindex="-1"></a>puts <span class="op">=</span> opt_chain.puts[[<span class="st">"strike"</span>, <span class="st">"lastPrice"</span>]].copy()</span>
<span id="variance_swap_pricing-51"><a href="#variance_swap_pricing-51" aria-hidden="true" tabindex="-1"></a>calls.columns <span class="op">=</span> [<span class="st">"Strike"</span>, <span class="st">"Price"</span>]</span>
<span id="variance_swap_pricing-52"><a href="#variance_swap_pricing-52" aria-hidden="true" tabindex="-1"></a>puts.columns <span class="op">=</span> [<span class="st">"Strike"</span>, <span class="st">"Price"</span>]</span>
<span id="variance_swap_pricing-53"><a href="#variance_swap_pricing-53" aria-hidden="true" tabindex="-1"></a>calls[<span class="st">"Type"</span>] <span class="op">=</span> <span class="st">"call"</span></span>
<span id="variance_swap_pricing-54"><a href="#variance_swap_pricing-54" aria-hidden="true" tabindex="-1"></a>puts[<span class="st">"Type"</span>] <span class="op">=</span> <span class="st">"put"</span></span>
<span id="variance_swap_pricing-55"><a href="#variance_swap_pricing-55" aria-hidden="true" tabindex="-1"></a>options_data <span class="op">=</span> pd.concat([calls, puts])</span>
<span id="variance_swap_pricing-56"><a href="#variance_swap_pricing-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="variance_swap_pricing-57"><a href="#variance_swap_pricing-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the variance swap strike</span></span>
<span id="variance_swap_pricing-58"><a href="#variance_swap_pricing-58" aria-hidden="true" tabindex="-1"></a>variance_swap_strike <span class="op">=</span> calculate_variance_swap_strike(S, r, T, options_data)</span>
<span id="variance_swap_pricing-59"><a href="#variance_swap_pricing-59" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Variance Swap Strike: </span><span class="sc">{</span>variance_swap_strike<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Variance Swap Strike: 0.6075</code></pre>
</div>
</div>
</section>
</section>
<section id="section" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="section"></h2>
<div id="exr-e_mixture" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 18.1</strong></span> The purpose of this exercise is to generate a fat-tailed distribution from a model that is simpler than the GARCH and stochastic volatility models but has somewhat the same flavor. The distribution will be a mixture of normals. Create a python program in which the user can input <span class="math inline">\(S\)</span>, <span class="math inline">\(r\)</span>, <span class="math inline">\(q\)</span>, <span class="math inline">\(T\)</span>, <span class="math inline">\(\sigma_1\)</span> and <span class="math inline">\(\sigma_2\)</span>. Use these inputs to produce a column of 500 simulated <span class="math inline">\(\log S_T\)</span>. In each simulation, define <span class="math inline">\(\log S_T\)</span> as <span class="math display">\[\log S_T = \log S_0 + \left(r-q-\frac{1}{2}\sigma^2\right)T + \sigma \sqrt{T}z\;,\]</span> where <span class="math inline">\(z\)</span> is a standard normal, <span class="math inline">\(\sigma = x\sigma_1 + (1-x)\sigma_2\)</span>, and <span class="math inline">\(x\)</span> is a random variable that equals zero or one with equal probabilities.</p>
<p>Calculate the mean and standard deviation of the <span class="math inline">\(\log S_T\)</span> and calculate the fraction that lie more than two standard deviations below the mean. If the <span class="math inline">\(\log S_T\)</span> all came from a normal distribution with the same variance, then this fraction should equal <span class="math inline">\(\mathrm{N}(-2) =\)</span> 2.275%. If the fraction is higher, then the distribution is fat tailed. (Of course, the actual fraction would differ from 2.275% in any particular case due to the randomness of the simulation, even if all of the <span class="math inline">\(\log S_T\)</span> came from a normal distribution with the same variance).</p>
</div>
<div id="exr-e_GARCH1" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 18.2</strong></span> Create a python program prompting the user to input the same inputs as in the <code>simulating_garch</code> function except for the initial volatility and <span class="math inline">\(\theta\)</span>. Simulate 500 paths of a GARCH process and output <span class="math inline">\(\log S_T\)</span> for each simulation (you don’t need to output the entire paths as in the <code>simulating_garch</code> function). Take the initial volatility to be 0.3 and <span class="math inline">\(\theta = 0.09\)</span>. Determine whether the distribution is fat-tailed by computing the fraction of the <span class="math inline">\(\log S_T\)</span> that lie two or more standard deviations below the mean, as in the previous exercise. For what values of <span class="math inline">\(\kappa\)</span> and <span class="math inline">\(\lambda\)</span> does the distribution appear to be especially fat-tailed?</p>
</div>
<div id="Exercise-18.1" class="Exercise">
<p></p><details class="Exercise fbx-simplebox fbx-default"><summary><strong>Exercise 18.1</strong></summary><div>Repeat <a href="Chapter_Jumps.html#exr-e_GARCH1" class="quarto-xref">Exercise&nbsp;<span>19.2</span></a> for the Heston stochastic volatility model, describing the values of <span class="math inline">\(\kappa\)</span>, <span class="math inline">\(\gamma\)</span> and <span class="math inline">\(\rho\)</span> that appear to generate especially fat-tailed distributions.<p></p>
</div></details>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-broadiekaya" class="csl-entry" role="listitem">
Broadie, M., and O. Kaya. 2006. <span>“Exact Simulation of Stochastic Volatility and Other Affine Jump Diffusion Processes.”</span> <em>Operations Research</em> 52: 217–31.
</div>
<div id="ref-Epps" class="csl-entry" role="listitem">
Epps, T. W. 2000. <em>Pricing Derivative Securities</em>. World Scientific Publishing, Singapore.
</div>
<div id="ref-Glasserman" class="csl-entry" role="listitem">
Glasserman, P. 2004. <em>Monte Carlo Methods in Financial Engineering</em>. Springer, New York Berlin Heidelberg.
</div>
<div id="ref-Heston" class="csl-entry" role="listitem">
Heston, S. 1993. <span>“A Closed-Form Solution for Options with Stochastic Volatility with Applications to Bond and Currency Options.”</span> <em>Review of Financial Studies</em> 6: 327–44.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>There are better (but more complicated) ways to simulate the Heston model. An excellent discussion of ways to simulate the volatility process can be found in Glasserman <span class="citation" data-cites="Glasserman">(<a href="#ref-Glasserman" role="doc-biblioref">Glasserman 2004</a>)</span>. Broadie and Kaya <span class="citation" data-cites="broadiekaya">(<a href="#ref-broadiekaya" role="doc-biblioref">Broadie and Kaya 2006</a>)</span> present a method for simulating from the exact distribution of the asset price in the Heston model and related models.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Further discussion can be found in Epps <span class="citation" data-cites="Epps">(<a href="#ref-Epps" role="doc-biblioref">Epps 2000</a>)</span>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Chapter_GARCH.html" class="pagination-link" aria-label="GARCH Models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">GARCH Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Chapter_Jumps.html" class="pagination-link" aria-label="Jumps">
        <span class="nav-page-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Jumps</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions"><ul><li><a href="https://github.com/math-finance-book/book-code.git/blob/main/Chapter_StochasticVol.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div></div></footer></body></html>