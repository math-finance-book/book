<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Pricing and Hedging Derivative Securities - 6&nbsp; Introduction to Monte Carlo and Binomial Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Chapter7.html" rel="next">
<link href="./Chapter5.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter6.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to Monte Carlo and Binomial Models</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Pricing and Hedging Derivative Securities</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Calls and Puts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Binomial Model and Changes of Measure</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Black-Scholes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Black-Scholes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Estimating and Modelling Volatility</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter6.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to Monte Carlo and Binomial Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Foreign Exchange</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Forward, Futures, and Exchange Options</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Exotic Options</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">More on Monte Carlo and Binomial Valuation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Finite Difference Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Fixed Income Concepts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Introduction to Fixed Income Derivatives</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter14.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Valuing Derivatives in the Extended Vasicek Model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">A Brief Survey of Term Structure Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./AppendixB.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Miscellaneous Facts about Continuous-Time Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Chapter contents</h2>
   
  <ul class="collapse">
  <li><a href="#sec-s_mc_europeans" id="toc-sec-s_mc_europeans" class="nav-link active" data-scroll-target="#sec-s_mc_europeans"><span class="header-section-number">6.1</span> Introduction to Monte Carlo</a></li>
  <li><a href="#sec-s_introbinomial" id="toc-sec-s_introbinomial" class="nav-link" data-scroll-target="#sec-s_introbinomial"><span class="header-section-number">6.2</span> Introduction to Binomial Models</a></li>
  <li><a href="#binomial-models-for-american-options" id="toc-binomial-models-for-american-options" class="nav-link" data-scroll-target="#binomial-models-for-american-options"><span class="header-section-number">6.3</span> Binomial Models for American Options</a></li>
  <li><a href="#sec-s_binomialparameters" id="toc-sec-s_binomialparameters" class="nav-link" data-scroll-target="#sec-s_binomialparameters"><span class="header-section-number">6.4</span> Binomial Parameters</a></li>
  <li><a href="#sec-s_binomial_greeks" id="toc-sec-s_binomial_greeks" class="nav-link" data-scroll-target="#sec-s_binomial_greeks"><span class="header-section-number">6.5</span> Binomial Greeks</a></li>
  <li><a href="#sec-s_montecarlogreeks1" id="toc-sec-s_montecarlogreeks1" class="nav-link" data-scroll-target="#sec-s_montecarlogreeks1"><span class="header-section-number">6.6</span> Monte Carlo Greeks I: Difference Ratios</a></li>
  <li><a href="#sec-s_montecarlogreeks2" id="toc-sec-s_montecarlogreeks2" class="nav-link" data-scroll-target="#sec-s_montecarlogreeks2"><span class="header-section-number">6.7</span> Monte Carlo Greeks II: Pathwise Estimates</a></li>
  <li><a href="#sec-s_introcompvba" id="toc-sec-s_introcompvba" class="nav-link" data-scroll-target="#sec-s_introcompvba"><span class="header-section-number">6.8</span> Calculations in VBA</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">6.9</span> Exercises</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-c_introcomputation" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to Monte Carlo and Binomial Models</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In this chapter, we will introduce two principal numerical methods for valuing derivative securities: Monte Carlo and binomial models. We will consider two applications: valuing European options in the presence of stochastic volatility with Monte Carlo and valuing American options via binomial models. Additional applications of these methods will be presented in <a href="Chapter10.html"><span>Chapter&nbsp;10</span></a>. Throughout the chapter, we will assume there is a constant risk-free rate. The last section, while quite important, could be skimmed on first reading—the rest of the book does not build upon it.</p>
<section id="sec-s_mc_europeans" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="sec-s_mc_europeans"><span class="header-section-number">6.1</span> Introduction to Monte Carlo</h2>
<p>According to our risk-neutral pricing <a href="Chapter2.html#eq-riskneutralformula">Equation&nbsp;<span>2.31</span></a>, the value of a security paying an amount <span class="math inline">\(x\)</span> at date <span class="math inline">\(T\)</span> is <span id="eq-montecarlo1"><span class="math display">\[
\mathrm{e}^{-rT}E^R[x]\;.
\tag{6.1}\]</span></span></p>
<p>To estimate this by Monte-Carlo means to simulate a sample of values for the random variable <span class="math inline">\(x\)</span> and to estimate the expectation by averaging the sample values.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Of course, for this to work, the sample must be generated from a population having a distribution consistent with the risk-neutral probabilities.</p>
<p>The simplest example is valuing a European option under the Black-Scholes assumptions. Of course, for calls and puts, this is redundant, because we already have the Black-Scholes formulas. Nevertheless, we will describe how to do this for the sake of introducing the Monte Carlo method. In the case of a call option, the random variable <span class="math inline">\(x\)</span> in <a href="#eq-montecarlo1">Equation&nbsp;<span>6.1</span></a> is <span class="math inline">\(\max(0,S(T)-K)\)</span>. To simulate a sample of values for this random variable, we need to simulate the terminal stock price <span class="math inline">\(S(T)\)</span>. This is easy to do, because, under the Black-Scholes assumptions, the logarithm of <span class="math inline">\(S(T)\)</span> is normally distributed under the risk-neutral measure with mean <span class="math inline">\(\log S(0)+\mathrm{n}u T\)</span> and variance <span class="math inline">\(\sigma^2T\)</span>, where <span class="math inline">\(\mathrm{n}u=r-q-\sigma^2/2\)</span>. Thus, we can simulate values for <span class="math inline">\(\log S(T)\)</span> as <span class="math inline">\(\log S(0)+\mathrm{n}u T + \sigma\sqrt{T}z\)</span>, where <span class="math inline">\(z\)</span> is a standard normal. We can average the simulated values of <span class="math inline">\(\max(0,S(T)-K)\)</span>, or whatever the payoff of the derivative is, and then discount at the risk-free rate to compute the date–0 value of the derivative. This means that we generate some number <span class="math inline">\(M\)</span> of standard normals <span class="math inline">\(z_i\)</span> and estimate the option value as <span class="math inline">\(\mathrm{e}^{-rT}\bar{x}\)</span>, where <span class="math inline">\(\bar{x}\)</span> is the mean of <span class="math display">\[x_i = \max\left(0,\mathrm{e}^{\log S(0)+\mathrm{n}u T + \sigma\sqrt{T}z_i}-K\right)\; .\]</span> To value options that are path-dependent we need to simulate the path of the underlying asset price. Path-dependent options are discussed in Chaps.~<span class="math inline">\(\ref{c_exotics}\)</span> and~<span class="math inline">\(\ref{c_montecarlo}\)</span>.</p>
<p>There are two main drawbacks to Monte-Carlo methods. First, it is difficult (though not impossible) to value early-exercise features.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> To value early exercise, we need to know the value at each date if not exercised, to compare to the intrinsic value. One could consider performing a simulation at each date to calculate the value if not exercised, but this value depends on the option to exercise early at later dates, which cannot be calculated without knowing the value of being able to exercise early at even later dates, etc. In contrast, the binomial model (and finite difference models discussed in <a href="Chapter11.html"><span>Chapter&nbsp;11</span></a>) can easily handle early exercise but cannot easily handle path dependencies.</p>
<p>The second drawback of Monte Carlo methods is that they can be quite inefficient in terms of computation time (though, as will be explained in <a href="Chapter10.html"><span>Chapter&nbsp;10</span></a>, they may be faster than alternative methods for derivatives written on multiple assets). As in statistics, the standard error of the estimate depends on the sample size. Specifically, we observed in <a href="Chapter5.html#sec-s_statistics"><span>Section&nbsp;5.1</span></a> that, given a random sample <span class="math inline">\(\{x_1,\ldots,x_M\}\)</span> of size <span class="math inline">\(M\)</span> from a population with mean <span class="math inline">\(\mu\)</span> and variance <span class="math inline">\(\sigma^2\)</span>, the best estimate of <span class="math inline">\(\mu\)</span> is the sample mean <span class="math inline">\(\bar{x}\)</span>, and the standard error of <span class="math inline">\(\bar{x}\)</span> (which means the standard deviation of <span class="math inline">\(\bar{x}\)</span> in repeated samples) is best estimated by <span id="eq-standarderror"><span class="math display">\[
\sqrt{\frac{1}{M(M-1)}\left(\sum_{i=1}^{M} x_i^2-M\bar{x}^2\right)}\;.
\tag{6.2}\]</span></span> Recall that <span class="math inline">\(\bar{x}\)</span> plus or minus 1.96 standard errors is a 95% confidence interval for <span class="math inline">\(\mu\)</span> when the <span class="math inline">\(x_i\)</span> are normally distributed. In the context of European option valuation, the expression <a href="#eq-standarderror">Equation&nbsp;<span>6.2</span></a> gives the standard error of the estimated option value at maturity, and multiplication of <a href="#eq-standarderror">Equation&nbsp;<span>6.2</span></a> by <span class="math inline">\(\mathrm{e}^{-rT}\)</span> gives the standard error of the estimated date–0 option value.</p>
<p>To obtain an estimate with an acceptably small standard error may require a large sample size and hence a relatively large amount of computation time. The complexities of Monte Carlo methods arise from trying to reduce the required sample size. In <a href="Chapter10.html"><span>Chapter&nbsp;10</span></a>, we will describe two such methods (antithetic variates and control variates). For those who want to engage in a more detailed study of Monte Carlo methods, the book of Glasserman <span class="citation" data-cites="Glasserman">(<a href="#ref-Glasserman" role="doc-biblioref">Glasserman 2004</a>)</span> is highly recommended. J"ackel <span class="citation" data-cites="Jackel">(<a href="#ref-Jackel" role="doc-biblioref">Jäckel 2002</a>)</span> is useful for more advanced readers, and Clewlow and Strickland <span class="citation" data-cites="CS">(<a href="#ref-CS" role="doc-biblioref">Clewlow and Strickland 1998</a>)</span> and Brandimarte <span class="citation" data-cites="Brandimarte">(<a href="#ref-Brandimarte" role="doc-biblioref">Brandimarte 2002</a>)</span> are useful references that include computer code.</p>
</section>
<section id="sec-s_introbinomial" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="sec-s_introbinomial"><span class="header-section-number">6.2</span> Introduction to Binomial Models</h2>
<p>As in the previous section, we will work with the dynamics of the logarithms of asset prices under the risk-neutral measure. Thus, our starting point is the equation <span id="eq-logstock_riskneutral"><span class="math display">\[
\mathrm{d} \log S = \left(r-q-\frac{\sigma^2}{2}\right)\,\mathrm{d} t + \sigma\,\mathrm{d} B\;,
\tag{6.3}\]</span></span></p>
<p>where <span class="math inline">\(B\)</span> represents a Brownian motion under the risk-neutral measure.</p>
<p>In the binomial model, we assume that if the stock price is <span class="math inline">\(S\)</span> at the beginning of the period, it will be either <span class="math inline">\(uS\)</span> or <span class="math inline">\(dS\)</span> at the end of the period, where the multiplicative factors <span class="math inline">\(u\)</span> and <span class="math inline">\(d\)</span> are constants to be determined. This means that the rate of return is <span class="math inline">\(\Delta S/S = u\!-\!1\)</span> in the up state and <span class="math inline">\(\Delta S/S = d\!-\!1\)</span> in the down state. There are three parameters to the model: <span class="math inline">\(u\)</span>, <span class="math inline">\(d\)</span>, and the probability <span class="math inline">\(p\)</span> of the up state (the probability of the down state being necessarily <span class="math inline">\(1\!-\!p\)</span>). The following illustrates a three-period model.</p>
<p>A tree constructed like this is recombining in the sense that the stock price after an up-down sequence is the same as after a down-up sequence. This is very important for reducing the computation time. For example, the number of nodes at the final date is <span class="math inline">\(N+1\)</span> in a recombining tree, where <span class="math inline">\(N\)</span> is the number of periods, but it is <span class="math inline">\(2^N\)</span> for a non-recombining (sometimes called bushy) tree. Hence, the computation time will increase linearly with <span class="math inline">\(N\)</span> for a recombining tree but exponentially with <span class="math inline">\(N\)</span> for a non-recombining tree. Unfortunately, this computational savings is generally not possible for path-dependent options, because the number of distinct paths through a tree (whether recombining or not) is again <span class="math inline">\(2^N\)</span>.</p>
<p>The value of a European derivative is of course the discounted expectation of its value at maturity, discounting at the risk-free rate and taking the expectation under the risk-neutral measure. The binomial tree allows us to approximate the expectation very easily. We simply sum over the nodes of the tree at the option maturity and weight each node by its binomial probability. In an <span class="math inline">\(N\)</span>-period model, the probability of the top node is <span class="math inline">\(p^N\)</span>, since the stock must go up each time to reach the top node. There are <span class="math inline">\(N\)</span> paths reaching the second node from the top (since the period of the single down move could be any one of the <span class="math inline">\(N\)</span> periods) and each such path has probability <span class="math inline">\(p^{N-1}(1-p)\)</span>; therefore, the probability of reaching the second node from the top is <span class="math inline">\(Np^{N-1}(1-p)\)</span>. More generally, the probability of going up <span class="math inline">\(i\)</span> times and down <span class="math inline">\(N-i\)</span> times is <span class="math display">\[\frac{N!}{i!(N-i)!}p^i(1-p)^{N-i}\; ,\]</span> where as usual <span class="math inline">\(x!\)</span> denotes <span class="math inline">\(x\)</span> factorial. Therefore, the expectation, for a European call option, is the following sum over the <span class="math inline">\(N+1\)</span> nodes at date <span class="math inline">\(N\)</span> (starting with <span class="math inline">\(i=0\)</span> up moves and ending with <span class="math inline">\(i=N\)</span> up moves): <span id="eq-binomialsum"><span class="math display">\[
\sum_{i=0}^N \frac{N!}{i!(N-i)!}p^i(1-p)^{N-i}\max(u^id^{N-i}S-K,0)\;.
\tag{6.4}\]</span></span></p>
<p>Multiplying the expectation by <span class="math inline">\(\mathrm{e}^{-rT}\)</span> yields the option value.</p>
<p>It is worthwhile to emphasize the close connection between this method and the Monte-Carlo method discussed in the previous section. In the Monte-Carlo method for valuing a European call option, we generate <span class="math inline">\(M\)</span> random values for <span class="math inline">\(S(T)\)</span> and estimate the expectation <span class="math inline">\(E^R[\max(0,S(T)-K)]\)</span> by averaging the <span class="math inline">\(M\)</span> values. This amounts to approximating the distribution of <span class="math inline">\(S(T)\)</span> by an <span class="math inline">\(M\)</span>–point distribution, each point being assigned equal probability. In the binomial method, we choose a particular set of points for <span class="math inline">\(S(T)\)</span> and assign the probabilities specified above in order to approximate the distribution of <span class="math inline">\(S(T)\)</span>. Both the Monte-Carlo and the binomial approximations are known to converge to the continuous-time distribution of <span class="math inline">\(S(T)\)</span> as the number of points increases. However, by specifically choosing the points and their probabilities, the binomial method allows us to use a much smaller number of points to obtain the same accuracy; i.e., for a given desired accuracy, we can use many fewer periods <span class="math inline">\(N\)</span> in the binomial model than we would need simulations <span class="math inline">\(M\)</span> in the Monte-Carlo method. Thus, the binomial method will be much faster. Furthermore, as we will discuss in the next section, the binomial method is much better for pricing American options. On the other hand, as mentioned in the previous section, to value a path-dependent option in an <span class="math inline">\(N\)</span>–period binomial tree would require the analysis of <span class="math inline">\(2^N\)</span> separate paths, so Monte Carlo may be faster for path-dependent options. Finally, as we will discuss in <a href="Chapter10.html#sec-s_curse"><span>Section&nbsp;10.2</span></a>, Monte Carlo may be faster for options on multiple assets.</p>
<p>There is an important alternative method for calculating the sum <a href="#eq-binomialsum">Equation&nbsp;<span>6.4</span></a>, which is usually called backward induction. We will describe it here and implement it in the next section to value American options. We begin at the last date, where there are <span class="math inline">\(N+1\)</span> nodes. We calculate the option value at each of these nodes, storing the value at the bottom node as <span class="math inline">\(C(0)\)</span>, the value at the next node up as <span class="math inline">\(C(1)\)</span>, etc. This is illustrated in the diagram on the next page. Then we step back to the penultimate date. At each node at this date, we calculate the option value as the discounted expectation of its value at the last date. From each node, there are two nodes that can be reached at the next date, corresponding to a down move or an up move. So, the option value is calculated as <span id="eq-binomial001"><span class="math display">\[
C = \mathrm{e}^{-r\Delta t}p\,C_{\text{up}} + \mathrm{e}^{-r\Delta t}(1-p)C_{\text{down}}\;.
\tag{6.5}\]</span></span></p>
<p>In terms of the vector notation shown in the diagram on the following page, the down move from node <span class="math inline">\(i\)</span> is also node <span class="math inline">\(i\)</span> and the up move is <span class="math inline">\(i+1\)</span>. So, we write over the elements of the <span class="math inline">\(C\)</span> vector as <span id="eq-binomial002"><span class="math display">\[
C(i) = \mathrm{e}^{-r\Delta t}p\,C(i+1) + \mathrm{e}^{-r\Delta t}(1-p)C(i)\;.
\tag{6.6}\]</span></span></p>
<p>Discounting back through the tree like this, we reach date 0 and return the option value as <span class="math inline">\(C(0)\)</span>. The virtue of this procedure is that it calculates a value for the option at each node in the tree, the value being the discounted expectation of the subsequent values attained by the option. This approach is essential for assessing the value of early exercise.</p>
</section>
<section id="binomial-models-for-american-options" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="binomial-models-for-american-options"><span class="header-section-number">6.3</span> Binomial Models for American Options</h2>
<p>Early exercise features are very simple to handle in a binomial framework. One only has to use the backward induction approach and check the optimality of early exercise at each node. Exercise is optimal when the intrinsic value of the option exceeds the discounted expected value of the option contingent on not exercising. When we back up in the tree, we check whether exercise is optimal, and, when it is, we replace the discounted expected value with the intrinsic value.</p>
<p>Early exercise is more important for puts than for calls (as discussed in <a href="Chapter2.html#sec-s_fundamentalconcepts"><span>Section&nbsp;2.1</span></a>, an American call on a non-dividend-paying stock should not be exercised early) so we will change our symbol for the option value from <span class="math inline">\(C\)</span> to <span class="math inline">\(P\)</span>. For a put option, we would calculate the value at each node at the end of the tree as described in the previous section: <span id="eq-binomial003"><span class="math display">\[
P(i) = \max\left(0,K-u^{i}d^{N-i}S\right)\;,
\tag{6.7}\]</span></span></p>
<p>for <span class="math inline">\(i=0,\ldots,N\)</span>. For a European put, we would also back up in the tree in accord with <a href="#eq-binomial002">Equation&nbsp;<span>6.6</span></a>: <span id="eq-binomial004"><span class="math display">\[
P(i) = \mathrm{e}^{-r\Delta t}p\,P(i+1) + \mathrm{e}^{-r\Delta t}(1-p)P(i)\;.
\tag{6.8}\]</span></span></p>
<p>To accommodate early exercise, we simply need to assign to <span class="math inline">\(P(i)\)</span> the larger of this value and the value of early exercise. At node <span class="math inline">\(i\)</span> at date <span class="math inline">\(n\)</span> the stock price is <span class="math inline">\(u^{i}d^{n-i}S\)</span> and the intrinsic value of a put option is <span class="math inline">\(\max(0,K-u^{i}d^{n-i}S)\)</span>. Therefore we replace <a href="#eq-binomial004">Equation&nbsp;<span>6.8</span></a> with <span id="eq-binomial005"><span class="math display">\[
P(i) = \max\big(K-u^{i}d^{n-i}S, \;\mathrm{e}^{-r\Delta t}p\,P(i+1) + \mathrm{e}^{-r\Delta t}(1-p)P(i)\big)\;.
\tag{6.9}\]</span></span></p>
<p>This will be explained in more detail in <a href="#sec-s_introcompvba"><span>Section&nbsp;6.8</span></a>.</p>
</section>
<section id="sec-s_binomialparameters" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="sec-s_binomialparameters"><span class="header-section-number">6.4</span> Binomial Parameters</h2>
<p>Several different ways have been proposed for matching the binomial model to the continuous-time model. Consider an <span class="math inline">\(N\)</span>–period binomial model for a time period of <span class="math inline">\(T\)</span> years. This means that the length of each period is <span class="math inline">\(\Delta t = T/N\)</span>. In the continuous-time model, over a discrete time period <span class="math inline">\(\Delta t\)</span>, we have <span class="math display">\[\Delta \log S =\mathrm{n}u\,\Delta t + \sigma\,\Delta B\; ,\]</span> where <span class="math inline">\(\mathrm{n}u = r-q-\sigma^2/2\)</span> and <span class="math inline">\(B\)</span> is a Brownian motion under the risk-neutral measure. The mean and variance, under the risk-neutral measure, of <span class="math inline">\(\Delta \log S\)</span> in the continuous-time model are <span class="math display">\[\begin{align*}
E^R[\Delta \log S] &amp;= \mathrm{n}u\,\Delta t\; ,\\
\mathrm{var}^R[\Delta \log S]&amp;=\sigma^2\Delta t\; ,
\end{align*}\]</span> so <span class="math display">\[\begin{align*}
\frac{E^R[\Delta \log S]}{\Delta t} &amp;= \mathrm{n}u\; ,\\
\frac{\mathrm{var}^R[\Delta \log S]}{\Delta t}&amp;=\sigma^2\;.
\end{align*}\]</span> In the binomial model, we have <span class="math display">\[\begin{align*}
\frac{E^R\big[\Delta \log S\big]}{\Delta t} &amp;=\frac{p\,\log u+(1-p)\log d}{\Delta t}\; ,\\
\frac{\mathrm{var}^R\big[\Delta \log S\big] }{\Delta t}&amp;=\frac{p\,(1-p)(\log u-\log d)^2}{\Delta t}\;.
\end{align*}\]</span> In order for the binomial model to converge in the appropriate sense to the continuous-time model as the number of periods <span class="math inline">\(N \rightarrow \infty\)</span> keeping the total amount of time <span class="math inline">\(T\)</span> fixed (equivalently, as <span class="math inline">\(\Delta t \rightarrow 0\)</span>), it is sufficient that <span class="math display">\[\begin{align*}
\frac{p\log u+(1-p)\log d}{\Delta t} &amp;\rightarrow \mathrm{n}u\; ,\\
\frac{p\,(1-p)(\log u-\log d)^2}{\Delta t} &amp;\rightarrow \sigma^2\;.
\end{align*}\]</span></p>
<p>The most popular model is probably that proposed by Cox, Ross and Rubinstein <span class="citation" data-cites="CRR">(<a href="#ref-CRR" role="doc-biblioref">Cox, Ross, and Rubinstein 1979</a>)</span>, who set <span class="math inline">\(d=1/u\)</span> and</p>
<p><span id="eq-crru"><span class="math display">\[
u = \mathrm{e}^{\sigma\sqrt{\Delta t}}\;,
\tag{6.10}\]</span></span></p>
<p><span id="eq-crrp"><span class="math display">\[
p = \frac{\mathrm{e}^{(r-q)\Delta t}-d}{u-d}\;.
\tag{6.11}\]</span></span></p>
<p>Another well-known model is that of Jarrow and Rudd <span class="citation" data-cites="JR">(<a href="#ref-JR" role="doc-biblioref">Jarrow and Rudd 1983</a>)</span>, who take <span class="math inline">\(p=1/2\)</span> and</p>
<p><span id="eq-jru"><span class="math display">\[
u = \exp\left(\left((r-q-\frac{1}{2}\sigma^2\right)\Delta t + \sigma\sqrt{\Delta t}\right)\;,
\tag{6.12}\]</span></span></p>
<p><span id="eq-jrd"><span class="math display">\[
d = \exp\left(\left((r-q-\frac{1}{2}\sigma^2\right)\Delta t - \sigma\sqrt{\Delta t}\right)\;.
\tag{6.13}\]</span></span></p>
<p>Yet another method is proposed by Leisen and Reimer <span class="citation" data-cites="LR">(<a href="#ref-LR" role="doc-biblioref">Leisen and Reimer 1996</a>)</span>, and Jackson and Staunton <span class="citation" data-cites="JS">(<a href="#ref-JS" role="doc-biblioref">Jackson and Staunton 2001</a>)</span> show that it is more efficient for approximating the Black-Scholes value of a European option than are the Cox-Ross-Rubinstein and Jarrow-Rudd trees.</p>
<p>For illustration, the Cox-Ross-Rubinstein tree will be implemented in <a href="#sec-s_introcompvba"><span>Section&nbsp;6.8</span></a>. However, when we consider binomial models for multiple assets in <a href="Chapter10.html"><span>Chapter&nbsp;10</span></a>, we will use the tree proposed by Trigeorgis <span class="citation" data-cites="Trigeorgis">(<a href="#ref-Trigeorgis" role="doc-biblioref">Trigeorgis 1991</a>)</span>, because it is the simplest to explain in that context. Trigeorgis proposes choosing <span class="math inline">\(p\)</span>, <span class="math inline">\(u\)</span> and <span class="math inline">\(d\)</span> so that the mean and variance of <span class="math inline">\(\Delta \log S\)</span> in the binomial model match those in the continuous-time model exactly. This means that</p>
<p><span class="math display">\[\begin{align*}
\frac{p\log u+(1-p)\log d}{\Delta t} &amp;= \mathrm{n}u\; ,\\
\frac{p(1-p)(\log u-\log d)^2}{\Delta t} &amp;= \sigma^2\;.
\end{align*}\]</span></p>
<p>These are two equations in the three unknowns, leaving one degree of freedom, so Trigeorgis takes <span class="math inline">\(d=1/u\)</span>, as do Cox, Ross and Rubinstein. As we will show in the next section, taking <span class="math inline">\(d=1/u\)</span> simplifies the calculations of deltas and gammas. Solving these two equations yields^[Notice that if we were to drop the <span class="math inline">\((\Delta t)^2\)</span> term in <a href="#eq-trig1">Equation&nbsp;<span>6.14</span></a> (which we could do because it becomes increasingly negligible as <span class="math inline">\(\Delta t \rightarrow 0)\)</span>, then <a href="#eq-trig1">Equation&nbsp;<span>6.14</span></a> would be the same as <a href="#eq-crru">Equation&nbsp;<span>6.10</span></a>. The different choices of <span class="math inline">\(p\)</span> in <a href="#eq-crrp">Equation&nbsp;<span>6.11</span></a> and <a href="#eq-trig2">Equation&nbsp;<span>6.15</span></a> can be understood as follows. Equation <a href="#eq-crrp">Equation&nbsp;<span>6.11</span></a> implies that the expected stock price <span class="math inline">\(pS_u + (1-p)S_d\)</span> equals <span class="math inline">\(\mathrm{e]^{(r-q)\Delta t}S\)</span>, so we have average growth at the rate <span class="math inline">\(r-q\)</span> as in the continuous-time model. On the other hand, <a href="#eq-trig2">Equation&nbsp;<span>6.15</span></a> implies that the expected stock price <span class="math inline">\(p \,\log S_u + (1-p) \log S_d\)</span> equals <span class="math inline">\(\log S + \mathrm{n}u \Delta t\)</span>, so the expected change in the logarithm is <span class="math inline">\(\mathrm{n}u\Delta t\)</span>, also as in the continuous-time model. Thus, both match the binomial model to the continuous-time model, the Cox-Ross-Rubinstein method focusing on the expected return (equivalently, the expected change in the price of the underlying) and the Trigeorgis method focusing on the expected continuously-compounded return (the expected change in the logarithm of the price).}</p>
<p><span id="eq-trig1"><span class="math display">\[
\log u=\sqrt{\sigma^2\Delta t + \mathrm{n}u^2(\Delta t)^2}\;,
\tag{6.14}\]</span></span></p>
<p><span id="eq-trig2"><span class="math display">\[
p = \frac{1}{2}+\frac{\mathrm{n}u\Delta t}{2\log u}\;.
\tag{6.15}\]</span></span></p>
</section>
<section id="sec-s_binomial_greeks" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="sec-s_binomial_greeks"><span class="header-section-number">6.5</span> Binomial Greeks</h2>
<p>To estimate Greeks in any valuation model, one can run the valuation program twice, for two different parameter values, and then estimate the Greek as the difference in value divided by the difference in parameters. For example, to estimate vega when the volatility of the underlying is <span class="math inline">\(\sigma\)</span>, we could estimate the derivative value for a volatility of <span class="math inline">\(0.99\sigma\)</span> and for a volatility of <span class="math inline">\(1.01\sigma\)</span>. Denoting the former derivative value by <span class="math inline">\(C_d\)</span> and the latter by <span class="math inline">\(C_u\)</span>, the vega can be estimated by <span class="math display">\[\frac{C_u-C_d}{1.01\sigma-0.99\sigma} = \frac{C_u-C_d}{0.02\sigma}\; .\]</span> We can in principle obtain a more precise estimate of the derivative by making a smaller change in the parameter (e.g., using <span class="math inline">\(0.999\sigma\)</span> and <span class="math inline">\(1.001\sigma\)</span>) but computer round-off errors limit how small a parameter change one should take in practice.</p>
<p>To estimate the gamma when the price of the underlying is <span class="math inline">\(S\)</span>, we need to estimate the derivative value at two other prices for the underlying, which we will call <span class="math inline">\(S_u\)</span> and <span class="math inline">\(S_d\)</span>, with <span class="math inline">\(S_u&gt;S&gt;S_d\)</span>. As just explained, the estimate of the delta (which we continue to denote by <span class="math inline">\(\delta\)</span>) would be <span id="eq-binomialdelta100"><span class="math display">\[
\delta = \frac{C_u-C_d}{S_u-S_d}\;,
\tag{6.16}\]</span></span></p>
<p>where <span class="math inline">\(C_u\)</span> denotes the derivative value when the underlying is equal to <span class="math inline">\(S_u\)</span> and <span class="math inline">\(C_d\)</span> denotes the derivative value when the underlying is equal to <span class="math inline">\(S_d\)</span>. Letting <span class="math inline">\(C\)</span> denote the derivative value when the underlying is equal to <span class="math inline">\(S\)</span>, two other obvious estimates of the delta are <span class="math display">\[\delta_u = \frac{C_u-C}{S_u-S} \qquad \text{and} \qquad \delta_d = \frac{C-C_d}{S-S_d}\; .\]</span> The first of these should be understood as an estimate of the delta when the price of the underlying is at the midpoint of <span class="math inline">\(S_u\)</span> and <span class="math inline">\(S\)</span>, and the second is an estimate of the delta when the price of the underlying is at the midpoint of <span class="math inline">\(S_d\)</span> and <span class="math inline">\(S\)</span>. The distance between these midpoints is <span class="math display">\[\frac{S_u+S}{2} - \frac{S_d+S}{2} = \frac{S_u-S_d}{2}\; ,\]</span> so we obtain an estimate of <span class="math inline">\(\Gamma\)</span> (the derivative of <span class="math inline">\(\delta\)</span>) as <span id="eq-binomialgamma100"><span class="math display">\[
\Gamma = \frac{\delta_u-\delta_d}{(S_u-S_d)/2}\;.
\tag{6.17}\]</span></span></p>
In a binomial model, it is possible to compute the most important Greeks, delta and gamma, more efficiently than by simply running the valuation program several times. Assume we have taken <span class="math inline">\(d=1/u\)</span>, so after an up and a down move (or a down and an up move) the stock price returns to its initial value <span class="math inline">\(S\)</span>. After fixing the length <span class="math inline">\(\Delta t = T/N\)</span> of each time period, we redefine <span class="math inline">\(N=N+2\)</span>. This results in an <span class="math inline">\(N+2\)</span> period tree covering a time period of length <span class="math inline">\(T+2\Delta t\)</span>. Now consider the tree starting two periods from the initial date. At the middle node shown below, the stock price is <span class="math inline">\(udS=S\)</span>. Ignoring the top and bottom nodes and the branches that follow them, the result of adding two periods is that the tree starting from <span class="math inline">\(udS\)</span> is an <span class="math inline">\(N\)</span>–period tree for a time period of length <span class="math inline">\(T\)</span>.<br>

<p>Hence, the derivative price calculated at the middle node will be the price we are trying to estimate. The derivative price at the top node will be the value of a derivative of maturity <span class="math inline">\(T\)</span> when the initial price of the underlying is <span class="math inline">\(u^2S\)</span>. Similarly, the derivative price at the bottom node will be the value of a derivative of maturity <span class="math inline">\(T\)</span> when the initial price of the underlying is <span class="math inline">\(d^2S\)</span>. Thus, when we back up in the tree to this date, we will have all of the information we need to return an estimate of the derivative value and to return estimates of the delta and gamma, taking <span class="math inline">\(S_u=u^2S\)</span> and <span class="math inline">\(S_d = d^2S\)</span> in equations <a href="#eq-binomialdelta100">Equation&nbsp;<span>6.16</span></a> and <a href="#eq-binomialgamma100">Equation&nbsp;<span>6.17</span></a>. We are not interested in the tree to the left of what is shown above.</p>
</section>
<section id="sec-s_montecarlogreeks1" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="sec-s_montecarlogreeks1"><span class="header-section-number">6.6</span> Monte Carlo Greeks I: Difference Ratios</h2>
<p>As with binomial models, Greeks can be calculated by Monte Carlo by running the valuation program twice and computing a difference ratio, for example <span class="math inline">\((C_u-C_d)/(S_u-S_d)\)</span> to estimate a delta. However, to minimize the error, and minimize the number of computations required, one should use the same set of random draws to estimate the derivative value for different values of the parameter. For path-independent options (e.g., European puts and calls) under the Black-Scholes assumptions, we only need to generate <span class="math inline">\(S(T)\)</span> and then we can compute <span class="math inline">\(S_u(T)\)</span> as <span class="math inline">\([S_u(0)/S(0)] \times S(T)\)</span> and <span class="math inline">\(S_d(T)\)</span> as <span class="math inline">\([S_u(0)/S(0)] \times S(T)\)</span>. We can estimate standard errors for the Greeks in the same way that we estimate the standard error of the derivative value.</p>
<p>Actually, there is often a better method available that is just as simple. This is called pathwise calculation. We will explain this in the next section. Here we will describe how to estimate the delta and gamma of a derivative as sample means of difference ratios.</p>
<p>Consider initial prices for the underlying <span class="math inline">\(S_u&gt;S&gt;S_d\)</span>. Denote the underlying price at the option maturity in a given simulation by <span class="math inline">\(S_u(T)\)</span> when the initial underlying price is <span class="math inline">\(S_u\)</span>, by <span class="math inline">\(S(T)\)</span> when the initial underlying price is <span class="math inline">\(S\)</span>, and by <span class="math inline">\(S_d(T)\)</span> when the initial underlying price is <span class="math inline">\(S_d\)</span>. Under the Black-Scholes assumptions, the logarithm of the stock price at date <span class="math inline">\(T\)</span> starting from the three initial prices <span class="math inline">\(S_d\)</span>, <span class="math inline">\(S\)</span> and <span class="math inline">\(S_u\)</span> is <span class="math display">\[\begin{align*}
\log S_d(T) &amp;= \log S_d + \left(r-q-\frac{1}{2}\sigma^2\right)T + \sigma B(T)\; ,\\
\log S(T) &amp;= \log S + \left(r-q-\frac{1}{2}\sigma^2\right)T + \sigma B(T)\; ,\\
\log S_u (T) &amp;= \log S_u + \left(r-q-\frac{1}{2}\sigma^2\right)T + \sigma B(T)\;,
\end{align*}\]</span> so <span class="math display">\[\log S_d(T) = \log S(T) + \log S_d - \log S\Longrightarrow S_d(T) = \left(\frac{S_d}{S}\right) S(T)\; ,\]</span> and <span class="math display">\[\log S_u(T) = \log S(T) + \log S_u - \log S \Longrightarrow S_u(T) = \left(\frac{S_u}{S}\right) S(T)\; .\]</span> Therefore, under the Black-Scholes assumptions, we only need to simulate <span class="math inline">\(S(T)\)</span> and then perform the multiplications indicated above to obtain <span class="math inline">\(S_d(T)\)</span> and <span class="math inline">\(S_u(T)\)</span>.</p>
<p>Consider a particular simulation and let <span class="math inline">\(C_d(T)\)</span> denote the value of the derivative at maturity when the initial asset price is <span class="math inline">\(S_d\)</span>, let <span class="math inline">\(C(T)\)</span> denote the value of the derivative at maturity when the initial asset price is <span class="math inline">\(S\)</span>, and let <span class="math inline">\(C_u(T)\)</span> denote the value of the derivative at maturity when the initial asset price is <span class="math inline">\(S_u\)</span>. For path-independent derivatives under the Black-Scholes assumptions, these can be computed directly from the simulation of <span class="math inline">\(S(T)\)</span> as just described. However, the following applies to general European derivatives under general assumptions about the underlying asset price (for example, it could follow a GARCH process).</p>
<p>The estimates <span class="math inline">\(C_d\)</span>, <span class="math inline">\(C\)</span> and <span class="math inline">\(C_u\)</span> of the date–0 derivative values, for the different initial prices of the underlying, are the discounted sample means of the <span class="math inline">\(C_d(T)\)</span>, <span class="math inline">\(C(T)\)</span> and <span class="math inline">\(C_u(T)\)</span>. One way to estimate the delta is <span class="math inline">\((C_u-C_d)/(S_u-S_d)\)</span>. This is a difference of discounted sample means, multiplied by the reciprocal of <span class="math inline">\(S_u-S_d\)</span>. Equivalently, it is the sample mean of the differences <span class="math inline">\(C_u(T)-C_d(T)\)</span>, multiplied by <span class="math inline">\(\mathrm{e}^{-rT}/(S_u-S_d)\)</span>. As a sample mean, its standard error can be estimated as described in <a href="Chapter5.html"><span>Chapter&nbsp;5</span></a>. The standard error is <span class="math display">\[\frac{\mathrm{e}^{-rT}}{S_u-S_d}\sqrt{\frac{1}{M(M-1)}\left(\sum_{i=1}^M \left[C_{ui}(T)-C_{di}(T)\right]^2 - M\left[\overline{C_{u}(T)}-\overline{C_{d}(T)}\right]^2\right)}\; ,\]</span> where the overline denotes the sample mean and where <span class="math inline">\(C_{ui}(T)\)</span> [respectively, <span class="math inline">\(C_{di}(T)\)</span>] denotes the value of the derivative at maturity in simulation <span class="math inline">\(i\)</span> when the initial asset price is <span class="math inline">\(S_u\)</span> [respectively, <span class="math inline">\(S_d\)</span>].</p>
<p>The corresponding Monte Carlo estimate of the gamma is also a sample mean. Simple algebra shows that <a href="#eq-binomialgamma100">Equation&nbsp;<span>6.17</span></a> is equivalent to <span id="eq-binomialgamma200"><span class="math display">\[
\Gamma = \frac{2}{(S_u-S)(S_u-S_d)}C_u - \frac{2}{(S_u-S)(S-S_d)}C +\frac{2}{(S-S_d)(S_u-S_d)}C_d\;.
\tag{6.18}\]</span></span></p>
<p>Normally one would take <span class="math inline">\(S_u=(1+\alpha)S\)</span> and <span class="math inline">\(S_d = (1-\alpha)S\)</span> for some <span class="math inline">\(\alpha\)</span> (e.g., <span class="math inline">\(\alpha=0.01\)</span>). In this case <a href="#eq-binomialgamma200">Equation&nbsp;<span>6.18</span></a> simplifies to <span id="eq-binomialgamma300"><span class="math display">\[
\Gamma = \frac{C_u - 2C + C_d}{\alpha^2S^2}\;,
\tag{6.19}\]</span></span></p>
<p>and the standard error of the gamma is <span class="math display">\[\begin{multline*}\frac{\mathrm{e}^{-rT}}{\alpha^2S^2}\sqrt{\frac{1}{M(M-1)}}\\
\times \sqrt{\sum_{i=1}^M \left[C_{ui}(T)-2C_i(T)+C_{di}(T)\right]^2 -M\left[\overline{C_{u}(T)}-2\overline{C(T)}+\overline{C_{d}(T)}\right]^2}\; .
\end{multline*}\]</span></p>
</section>
<section id="sec-s_montecarlogreeks2" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="sec-s_montecarlogreeks2"><span class="header-section-number">6.7</span> Monte Carlo Greeks II: Pathwise Estimates</h2>
<p>We will examine the bias in the Monte Carlo delta estimate discussed in the preceding section and explain pathwise estimation of Greeks. By biased, we mean that the expected value of an estimate is different from the true value. It is important to recognize that if a Monte Carlo estimate is biased, then, even if a large number of simulations is used and the standard error is nearly zero, the answer provided by the Monte Carlo method will be incorrect. For simplicity, consider a European call under the Black-Scholes assumptions.</p>
<p>The delta estimate we have considered is the discounted sample mean of <span id="eq-montecarlodelta2"><span class="math display">\[
\frac{C_u(T) - C_d(T)}{S_u-S_d}\;.
\tag{6.20}\]</span></span></p>
<p>This ratio takes on one of three values, depending on <span class="math inline">\(S(T)\)</span>:</p>
<ul>
<li>If <span class="math inline">\(S_u(T) \leq K\)</span> then the option is out of the money in both the up and down cases; i.e., <span class="math display">\[C_u(T) = C_d(T) = 0\; ,\]</span> so the ratio <a href="#eq-montecarlodelta2">Equation&nbsp;<span>6.20</span></a> is zero.</li>
<li>If <span class="math inline">\(S_d(T) \geq K\)</span> then the option is in the money in both the up and down cases; i.e., <span class="math display">\[\begin{align*} C_u(T) &amp;= S_u(T) - K =\left(\frac{S_u}{S}\right)S(T) - K\; ,\\
C_d(T) &amp;= S_d(T) - K = \left(\frac{S_d}{S}\right)S(T) - K\;,
\end{align*}\]</span> so the ratio <a href="#eq-montecarlodelta2">Equation&nbsp;<span>6.20</span></a> equals <span class="math inline">\(S(T)/S\)</span>.</li>
<li>If <span class="math inline">\(S_u(T) &gt; K &gt; S_d(T)\)</span>, then the option is in the money in only the up case; i.e., <span class="math display">\[\begin{align*}
C_u(T) &amp;= S_u(T) - K = \left(\frac{S_u}{S}\right)S(T) - K\; ,\\
C_d(T) &amp;= 0\;,
\end{align*}\]</span> so the ratio <a href="#eq-montecarlodelta2">Equation&nbsp;<span>6.20</span></a> equals <span class="math display">\[\frac{\left(\frac{S_u}{S}\right)S(T) - K}{S_u-S_d} &lt; \frac{S(T)}{S}\; .\]</span></li>
</ul>
<p>The bias is induced by the third case above. We can see this as follows. We are trying to estimate <span id="eq-montecarlodelta4"><span class="math display">\[
\frac{\partial }{\partial S} \mathrm{e}^{-rT}E^R \big[\max(0,S(T)-K)\big] = \mathrm{e}^{-rT}E^R  \left[ \frac{\partial }{\partial S} \max(0,S(T)-K)\right]\;.
\tag{6.21}\]</span></span></p>
<p>The delta estimate <span class="math inline">\((C_u-C_d)/(S_u-S_d)\)</span> replaces the mean <span class="math inline">\(E^R\)</span> with the sample mean and replaces <span id="eq-montecarlodelta3"><span class="math display">\[
\frac{\partial }{\partial S} \max(0,S(T)-K)
\tag{6.22}\]</span></span></p>
<p>with the ratio <a href="#eq-montecarlodelta2">Equation&nbsp;<span>6.20</span></a>. The derivative <a href="#eq-montecarlodelta3">Equation&nbsp;<span>6.22</span></a> takes on two possible values, depending on <span class="math inline">\(S(T)\)</span>—we can ignore the case <span class="math inline">\(S(T)=K\)</span> because it occurs with zero probability:</p>
<ul>
<li>If <span class="math inline">\(S(T) &lt; K\)</span>, then <span class="math inline">\(\max(0,S(T)-K) = 0\)</span> and the derivative is zero.</li>
<li>If <span class="math inline">\(S(T)&gt;K\)</span>, then <span class="math inline">\(\max(0,S(T)-K) = S(T)-K\)</span> and the derivative equals <span class="math display">\[\frac{\partial S(T)}{\partial S}=\mathrm{e}^{(r-q-\sigma^2/2)T + \sigma B(T)} = \frac{S(T)}{S}\; .\]</span></li>
</ul>
<p>Therefore, the true delta—the expectation <a href="#eq-montecarlodelta4">Equation&nbsp;<span>6.21</span></a>—equals<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> <span id="eq-montecarlodelta5"><span class="math display">\[
\mathrm{e}^{-rT}E^R\left[\frac{S(T)}{S} x\right]\;,
\tag{6.23}\]</span></span></p>
<p>where <span class="math inline">\(x\)</span> is the random variable defined as <span class="math display">\[\begin{equation*}
x =  \begin{cases} 1 &amp; \text{if $S(T)&gt;K$}\; ,\\
0 &amp; \text{otherwise}\;.
\end{cases}
\end{equation*}\]</span> On the other hand, our analysis of the ratio <a href="#eq-montecarlodelta2">Equation&nbsp;<span>6.20</span></a> shows that the expected value of the delta estimate <span class="math inline">\((C_u-C_d)/(S_u-S_d)\)</span> is <span id="eq-montecarlodelta6"><span class="math display">\[
\mathrm{e}^{-rT}E^R\left[\frac{S(T)}{S} y\right] + \mathrm{e}^{-rT}E^R\left[\frac{S_uS(T)-SK}{S(S_u-S_d)}z\right]\;,
\tag{6.24}\]</span></span></p>
<p>where <span class="math display">\[\begin{align*}
y &amp;=  \begin{cases} 1 &amp; \text{if $S_d(T)&gt;K$}\; ,\\
0 &amp; \text{otherwise}\;.
\end{cases}
$$
and
$$
z &amp;=  \begin{cases} 1 &amp; \text{if $S_u(T)&gt;K&gt;S_d(T)$}\; ,\\
0 &amp; \text{otherwise}\;.
\end{cases}
\end{align*}\]</span> To contrast <a href="#eq-montecarlodelta5">Equation&nbsp;<span>6.23</span></a> and <a href="#eq-montecarlodelta6">Equation&nbsp;<span>6.24</span></a>, note that if <span class="math inline">\(y=1\)</span> then <span class="math inline">\(x=1\)</span>, so the term <span class="math inline">\(E^R\left[\frac{S(T)}{S} y\right]\)</span> in <a href="#eq-montecarlodelta6">Equation&nbsp;<span>6.24</span></a> is part of <a href="#eq-montecarlodelta5">Equation&nbsp;<span>6.23</span></a>. However, there are two partially offsetting errors in <a href="#eq-montecarlodelta6">Equation&nbsp;<span>6.24</span></a>: <span class="math inline">\(z\)</span> sometimes equals one when <span class="math inline">\(x\)</span> is zero, and when both <span class="math inline">\(z\)</span> and <span class="math inline">\(x\)</span> are one, then the factor multiplying <span class="math inline">\(z\)</span> is smaller than the factor multiplying <span class="math inline">\(x\)</span>. In any case, the expected value <a href="#eq-montecarlodelta6">Equation&nbsp;<span>6.24</span></a> is not the same as the true delta <a href="#eq-montecarlodelta5">Equation&nbsp;<span>6.23</span></a>. As noted before, this implies that the delta estimate will be incorrect even if its standard error is zero. The bias can be made as small as one wishes by taking the magnitude <span class="math inline">\(S_u-S_d\)</span> of the perturbation to be small, but taking the perturbation to be very small will introduce unacceptable roundoff error.</p>
<p>The obvious way to estimate the delta in this situation is simply to compute the discounted sample average of <span class="math inline">\([S(T)/S]x\)</span>. This is called a pathwise estimate of the delta, because it only uses the sample paths of <span class="math inline">\(S(t)\)</span> rather than considering up and down perturbations. This method is due to Broadie and Glasserman <span class="citation" data-cites="bg2">(<a href="#ref-bg2" role="doc-biblioref">Broadie and Glasserman 1996</a>)</span>. Because the pathwise estimate is a sample average, its standard error can be computed in the usual way.</p>
<p>To compute pathwise estimates in other models and for other Greeks, we need the Greek to be an expectation as on the right-hand side of <a href="#eq-montecarlodelta4">Equation&nbsp;<span>6.21</span></a>. Additional examples can be found in Glasserman <span class="citation" data-cites="Glasserman">(<a href="#ref-Glasserman" role="doc-biblioref">Glasserman 2004</a>)</span> and J"ackel <span class="citation" data-cites="Jackel">(<a href="#ref-Jackel" role="doc-biblioref">Jäckel 2002</a>)</span>.</p>
</section>
<section id="sec-s_introcompvba" class="level2" data-number="6.8">
<h2 data-number="6.8" class="anchored" data-anchor-id="sec-s_introcompvba"><span class="header-section-number">6.8</span> Calculations in VBA</h2>
<section id="monte-carlo-valuation-of-a-european-call" class="level3">
<h3 class="anchored" data-anchor-id="monte-carlo-valuation-of-a-european-call">Monte Carlo Valuation of a European Call</h3>
<p>We will illustrate Monte Carlo by valuing a European call under the Black-Scholes assumptions. We will also estimate the delta by each of the methods described in <a href="#sec-s_montecarlogreeks1"><span>Section&nbsp;6.6</span></a> and~<span class="math inline">\(\ref{s_montecarlogreeks2}\)</span>. Of course, we know the call value and its delta from the Black-Scholes formulas, and they can be used to evaluate the accuracy of the Monte Carlo estimates.</p>
<p>In this circumstance, we only need to simulate the price of the underlying at the option maturity rather than the entire path of the price process. To estimate the option delta as a difference ratio <span class="math inline">\((C_u-C_d)/(S_u-S_d)\)</span>, we use the perturbations <span class="math inline">\(S_u = 1.01S\)</span> and <span class="math inline">\(S_d = 0.99S\)</span>. The inputs are the same as for the Black-Scholes formula plus the sample size <span class="math inline">\(M\)</span> (the number of stock prices to be simulated).</p>
</section>
<section id="monte-carlo-valuation-in-a-garch-model" class="level3">
<h3 class="anchored" data-anchor-id="monte-carlo-valuation-in-a-garch-model">Monte Carlo Valuation in a GARCH Model</h3>
<p>For another example of Monte Carlo, we will value a European call option and estimate its standard error in a GARCH model. The underlying asset price is simulated as in <a href="Chapter5.html#sec-s_garch"><span>Section&nbsp;5.4</span></a>. After each path of the underlying is simulated, we compute the date–T value of the option. We sum these as the simulations proceed in order to compute the average value. We also sum the squared date–~T option values in order to compute the standard error of the estimate of the date–0 option value.</p>
In addition to the inputs in the previous function, we input the number <span class="math inline">\(N\)</span> of time periods in the interval <span class="math inline">\([0,T]\)</span>—implying a GARCH model for returns over time intervals of length <span class="math inline">\(\Delta t = T/N\)</span> under the risk-neutral measure—and the GARCH parameters <span class="math inline">\(\kappa\)</span>, <span class="math inline">\(\theta\)</span>, and <span class="math inline">\(\lambda\)</span>. To value a different type of European derivative, we would simply modify the statement
</section>
<section id="binomial-valuation-of-european-options" class="level3">
<h3 class="anchored" data-anchor-id="binomial-valuation-of-european-options">Binomial Valuation of European Options</h3>
The binomial model for path-independent European options can be implemented as follows. We will use the Cox-Ross-Rubinstein parameters. To value a different type of European option in a binomial model, one would only have to change the formula
<p>in the following. We first define the binomial parameters and some useful constants, denoting the probability <span class="math inline">\(p\,\)</span> of an up move as and the probability <span class="math inline">\(1-p\)</span> of a down move as~.</p>
<p>oindent Now we calculate the stock price at the bottom node (the node corresponding to all down moves), the probability of reaching that node, and the first term in the sum <a href="#eq-binomialsum">Equation&nbsp;<span>6.4</span></a>.</p>
<p>To calculate the other <span class="math inline">\(N\)</span> terms in the sum, we note that the stock price when there are <span class="math inline">\(i\)</span> up moves is <span class="math inline">\(u^2\)</span> times the stock price with only <span class="math inline">\(i-1\)</span> up moves (because one more up move also means one fewer down move and adding an up and removing a down produces the factor <span class="math inline">\(u/d = u^2\)</span>). Furthermore, the ratio of the probability of <span class="math inline">\(i\)</span> up moves to <span class="math inline">\(i-1\)</span> up moves is <span class="math display">\[\frac{p^i(1-p)^{N-i}N!/i!(N-i)!}{p^{i-1}(1-p)^{N-i+1}N!/(i-1)!(N-i+1)!} = \frac{(N-i+1)p}{(1-p)i}\; .\]</span> Therefore, as we increase the index <span class="math inline">\(i\)</span> in computing the sum <a href="#eq-binomialsum">Equation&nbsp;<span>6.4</span></a>, we need to multiply the previous stock price by <span class="math inline">\(u^2\)</span> and multiply the previous probability by <span class="math inline">\((N-i+1)p/[(1-p)i]\)</span>. We add the result to each time and, at the end, discount by <span class="math inline">\(\mathrm{e}^{-rT}\)</span>.</p>
</section>
<section id="binomial-valuation-of-american-options" class="level3">
<h3 class="anchored" data-anchor-id="binomial-valuation-of-american-options">Binomial Valuation of American Options</h3>
<p>We will consider an American put. It may also be optimal to exercise an American call early, if there is a positive dividend yield, and the same procedure can be used for American calls. We begin as in the previous subsection by defining the binomial parameters, some useful constants, and the stock price at the bottom node at the last date.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> We also compute the put value <span class="math inline">\(P(0)\)</span> at the bottom node at the last date.</p>
<p>Now we loop over the other nodes at the last date, increasing the stock price by a factor of <span class="math inline">\(u^2\)</span> each time as before, and defining the put value as its intrinsic value at maturity.</p>
<p>Now we do the backward induction. Note that a period is the time period between successive dates. In a one-period model, there are two dates (the beginning and end) and in general there are <span class="math inline">\(N+1\)</span> dates in an <span class="math inline">\(N\)</span>–period model. We index the dates as <span class="math inline">\(i=0,\ldots,N\)</span>. Since we are backing up in the tree, we step backwards from <span class="math inline">\(i=N-1\)</span> to <span class="math inline">\(i=0\)</span>. At each date we start by defining the stock price at the bottom node. At date <span class="math inline">\(i\)</span> there have been <span class="math inline">\(i\)</span> past periods, so the bottom node corresponds to <span class="math inline">\(i\)</span> down moves. The put value at each node is computed as the larger of the discounted expected value and the value of immediate exercise (the intrinsic value). Having already dealt with the bottom node (<span class="math inline">\(j=0\)</span>) we loop over the nodes <span class="math inline">\(j=1,\ldots,i\)</span> at each date <span class="math inline">\(i\)</span>, increasing the stock price by a factor of <span class="math inline">\(u^2\)</span> each time. When we have backed up to date 0, we return the put value <span class="math inline">\(P(0)\)</span>, the value at the bottom node, which is the only node at date~0.</p>
</section>
<section id="binomial-estimation-of-delta-and-gamma" class="level3">
<h3 class="anchored" data-anchor-id="binomial-estimation-of-delta-and-gamma">Binomial Estimation of Delta and Gamma</h3>
<p>We add two periods to the model and then stop the backward induction at date <span class="math inline">\(n=2\)</span>, as described in <a href="#sec-s_binomial_greeks"><span>Section&nbsp;6.5</span></a>.</p>
</section>
</section>
<section id="exercises" class="level2" data-number="6.9">
<h2 data-number="6.9" class="anchored" data-anchor-id="exercises"><span class="header-section-number">6.9</span> Exercises</h2>
<div id="exr-nolabel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 6.1 </strong></span>Consider an at-the-money European call option on a non-dividend-paying stock with six months to maturity. Take the initial stock price to be $50, the interest rate to be 5% and $=$30%. Compute the value in a binomial model with <span class="math inline">\(N=10, 11, \ldots, 20\)</span> and plot the values against <span class="math inline">\(N\)</span>. Is convergence monotone?</p>
</div>
<div id="exr-nolabel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 6.2 </strong></span>Consider the same option as in the previous problem. Roughly what value of <span class="math inline">\(N\)</span> is needed to get penny accuracy? (To evaluate the accuracy, compare the price to the price given by the Black-Scholes formula.)</p>
</div>
<div id="exr-nolabel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 6.3 </strong></span>The early exercise premium is the difference between the value of an American option and the value of a European option with the same parameters. Compute the early exercise premium for an American put and various values for the interest rate, exercise price, and stock parameters. Under what circumstances is the early exercise premium relatively large?</p>
</div>
<div id="exr-e_GARCHimpliedvols" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 6.4 </strong></span>Create an Excel worksheet in which the user inputs <span class="math inline">\(S\)</span>, <span class="math inline">\(r\)</span>, <span class="math inline">\(\sigma\)</span>, <span class="math inline">\(q\)</span>, <span class="math inline">\(T\)</span>, <span class="math inline">\(N\)</span>, <span class="math inline">\(\kappa\)</span>, <span class="math inline">\(\theta\)</span>, and <span class="math inline">\(\lambda\)</span>. Use the function to compute call option prices for exercise prices <span class="math inline">\(K=0.6S\)</span>, <span class="math inline">\(0.7S\)</span>, <span class="math inline">\(0,8S\)</span>, <span class="math inline">\(0.9S\)</span>, <span class="math inline">\(S\)</span>, <span class="math inline">\(1.1S\)</span>, <span class="math inline">\(1.2S\)</span>, <span class="math inline">\(1.3S\)</span> and <span class="math inline">\(1.4S\)</span>, taking <span class="math inline">\(M=500\)</span> in each case. For each computed price, use the function to compute an implied Black-Scholes volatility. Plot the implied volatilities against the exercise prices.</p>
</div>
<div id="exr-e_Hestoncall" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 6.5 </strong></span>Create a VBA function using Monte Carlo to estimate the value of a European call option in the Heston stochastic volatility model. The inputs should be the initial stock price <span class="math inline">\(S\)</span>, the strike price <span class="math inline">\(K\)</span>, the risk-free rate <span class="math inline">\(r\)</span>, the initial volatility <span class="math inline">\(\sigma\)</span>, the dividend yield <span class="math inline">\(q\)</span>, the time to maturity <span class="math inline">\(T\)</span>, the number of time periods <span class="math inline">\(N\)</span>, the parameters <span class="math inline">\(\kappa\)</span>, <span class="math inline">\(\theta\)</span>, <span class="math inline">\(\gamma\)</span>, and <span class="math inline">\(\rho\)</span>, and the number of simulations <span class="math inline">\(M\)</span>. Return the estimated option value and its standard error.</p>
</div>
<div id="exr-nolabel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 6.6 </strong></span>Modify the VBA function in the previous exercise to also return the estimated delta of the option and the standard error of the delta.</p>
</div>
<div id="exr-nolabel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 6.7 </strong></span>Repeat <a href="#exr-e_GARCHimpliedvols">Exercise&nbsp;<span>6.4</span></a> using the Heston model (the function developed in <a href="#exr-e_Hestoncall">Exercise&nbsp;<span>6.5</span></a>) to compute the call option prices, allowing the user to input <span class="math inline">\(\gamma\)</span> and <span class="math inline">\(\rho\)</span> (instead of <span class="math inline">\(\lambda\)</span>).</p>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-boyle" class="csl-entry" role="listitem">
Boyle, P. 1977. <span>“Options: A Monte Carlo Approach.”</span> <em>Journal of Financial Economics</em> 4: 323–38.
</div>
<div id="ref-Brandimarte" class="csl-entry" role="listitem">
Brandimarte, P. 2002. <em>Numerical Methods in Finance: A MATLAB-Based Introduction</em>. Wiley, New York.
</div>
<div id="ref-bg2" class="csl-entry" role="listitem">
Broadie, M., and P. Glasserman. 1996. <span>“Estimating Security Price Derivatives Using Simulation.”</span> <em>Management Science</em> 42: 269–85.
</div>
<div id="ref-BG" class="csl-entry" role="listitem">
———. 1997. <span>“Pricing American-Style Securities Using Simulation.”</span> <em>Journal of Economic Dynamics and Control</em> 21: 1323–52.
</div>
<div id="ref-CS" class="csl-entry" role="listitem">
Clewlow, L., and C. Strickland. 1998. <em>Implementing Derivatives Models</em>. Wiley, New York.
</div>
<div id="ref-CRR" class="csl-entry" role="listitem">
Cox, J., S. Ross, and M. Rubinstein. 1979. <span>“Option Pricing: A Simplified Approach.”</span> <em>Journal of Financial Economics</em> 7: 229–63.
</div>
<div id="ref-Glasserman" class="csl-entry" role="listitem">
Glasserman, P. 2004. <em>Monte Carlo Methods in Financial Engineering</em>. Springer, New York Berlin Heidelberg.
</div>
<div id="ref-Jackel" class="csl-entry" role="listitem">
Jäckel, P. 2002. <em>Monte Carlo Methods in Finance</em>. Wiley, New York.
</div>
<div id="ref-JS" class="csl-entry" role="listitem">
Jackson, M., and M. Staunton. 2001. <em>Advanced Modelling in Finance Using Excel and VBA</em>. Wiley, New York.
</div>
<div id="ref-JR" class="csl-entry" role="listitem">
Jarrow, R., and A. Rudd. 1983. <em>Option Pricing</em>. Dow Jones-Irwin, Homewood, Illinois.
</div>
<div id="ref-LR" class="csl-entry" role="listitem">
Leisen, D. P. J., and M. Reimer. 1996. <span>“Binomial Models for Option Valuation—Examining and Improving Convergence”</span> 3: 319–46.
</div>
<div id="ref-LS01" class="csl-entry" role="listitem">
Longstaff, F., and E. Schwartz. 2001. <span>“Valuing American Options by Simulation: A Simple Least-Squares Approach.”</span> <em>Review of Financial Studies</em> 14: 113–47.
</div>
<div id="ref-Trigeorgis" class="csl-entry" role="listitem">
Trigeorgis, A. 1991. <span>“A Log-Transformed Binomial Analysis Method for Valuing Complex Multi-Option Investments.”</span> <em>Journal of Financial and Quantitative Analysis</em> 26: 309–26.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Boyle~<span class="citation" data-cites="boyle">(<a href="#ref-boyle" role="doc-biblioref">Boyle 1977</a>)</span> introduced Monte-Carlo methods for derivative valuation, including the variance-reduction methods of control variates and antithetic variates to be discussed in <a href="Chapter10.html"><span>Chapter&nbsp;10</span></a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Monte-Carlo methods for valuing early exercise include the stochastic mesh method of Broadie and Glasserman <span class="citation" data-cites="BG">(<a href="#ref-BG" role="doc-biblioref">Broadie and Glasserman 1997</a>)</span> and the regression method of Longstaff and Schwartz <span class="citation" data-cites="LS01">(<a href="#ref-LS01" role="doc-biblioref">Longstaff and Schwartz 2001</a>)</span>. Glasserman <span class="citation" data-cites="Glasserman">(<a href="#ref-Glasserman" role="doc-biblioref">Glasserman 2004</a>)</span> provides a good discussion of these methods and the relation between them.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>By changing numeraires, we can show that <a href="#eq-montecarlodelta5">Equation&nbsp;<span>6.23</span></a> equals <span class="math inline">\(\mathrm{e}^{-qT}E^V[x] = \mathrm{e}^{-qT}\mathrm{N}(d_1)\)</span>, as we know from <a href="Chapter4.html"><span>Chapter&nbsp;4</span></a> is the delta of a European call in the Black-Scholes model (here, as in <a href="Chapter4.html"><span>Chapter&nbsp;4</span></a>, <span class="math inline">\(V(t)=\mathrm{e}^{qt}S(t)\)</span> denotes the value of the non-dividend-paying portfolio created from the stock).<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Note that the variable name <span class="math inline">\(S0\)</span> is assigned to the initial stock price. The variable <span class="math inline">\(S\)</span> is modified as we step up across the nodes at each date. When we back up to the previous date, the initial stock price is still available in the variable <span class="math inline">\(S0\)</span>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Chapter5.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Estimating and Modelling Volatility</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Chapter7.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Foreign Exchange</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>