<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>7&nbsp; Foundations – Pricing and Hedging Derivative Securities: Theory and Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Chapter_Deltas.html" rel="next">
<link href="./Chapter_GBM.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-933f24a0c1e0be8a62c2179459603458.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-217607b4065b1a3128a07792af3f8e33.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>



<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

<style>
div.callout-Exercise.callout {
  border-left-color: #ede29d;
}
div.callout-Exercise.callout-style-default > .callout-header {
  background-color: rgba(237, 226, 157, 0.13);
}
div.callout-Exercise .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Exercise.callout-style-default .callout-icon::before, div.callout-Exercise.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Extra.callout {
  border-left-color: #d5deed;
}
div.callout-Extra.callout-style-default > .callout-header {
  background-color: rgba(213, 222, 237, 0.13);
}
div.callout-Extra .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Extra.callout-style-default .callout-icon::before, div.callout-Extra.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Rule.callout {
  border-left-color: #a1bced;
}
div.callout-Rule.callout-style-default > .callout-header {
  background-color: rgba(161, 188, 237, 0.13);
}
div.callout-Rule .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Rule.callout-style-default .callout-icon::before, div.callout-Rule.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Example.callout {
  border-left-color: #e8cc97;
}
div.callout-Example.callout-style-default > .callout-header {
  background-color: rgba(232, 204, 151, 0.13);
}
div.callout-Example .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Example.callout-style-default .callout-icon::before, div.callout-Example.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Principle.callout {
  border-left-color: #e3aab2;
}
div.callout-Principle.callout-style-default > .callout-header {
  background-color: rgba(227, 170, 178, 0.13);
}
div.callout-Principle .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Principle.callout-style-default .callout-icon::before, div.callout-Principle.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-Done.callout {
  border-left-color: #e8cc97;
}
div.callout-Done.callout-style-default > .callout-header {
  background-color: rgba(232, 204, 151, 0.13);
}
div.callout-Done .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-Done.callout-style-default .callout-icon::before, div.callout-Done.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-WritingToDo.callout {
  border-left-color: #a7f2d8;
}
div.callout-WritingToDo.callout-style-default > .callout-header {
  background-color: rgba(167, 242, 216, 0.13);
}
div.callout-WritingToDo .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-WritingToDo.callout-style-default .callout-icon::before, div.callout-WritingToDo.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-CodeToDo.callout {
  border-left-color: #eb4034;
}
div.callout-CodeToDo.callout-style-default > .callout-header {
  background-color: rgba(235, 64, 52, 0.13);
}
div.callout-CodeToDo .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-CodeToDo.callout-style-default .callout-icon::before, div.callout-CodeToDo.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
div.callout-InProgress.callout {
  border-left-color: #eaacf2;
}
div.callout-InProgress.callout-style-default > .callout-header {
  background-color: rgba(234, 172, 242, 0.13);
}
div.callout-InProgress .callout-toggle::before {  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(33, 37, 41)" class="bi bi-chevron-down" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/></svg>');}
div.callout-InProgress.callout-style-default .callout-icon::before, div.callout-InProgress.callout-titled .callout-icon::before {
  background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="nil" class="bi bi-exclamation-triangle" viewBox="0 0 16 16"><path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/></svg>');
}
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter_Arbitrage.html">Part III: Arbitrage Pricing</a></li><li class="breadcrumb-item"><a href="./Chapter_Arbitrage.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Foundations</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Pricing and Hedging Derivative Securities: Theory and Methods</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/math-finance-book/book-code.git" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I: Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Options.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Options</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Futures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Futures and Swaps</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II: Mathematical Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Intro_Binomial_Tree.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Brownian.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Brownian Motion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Ito.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Ito Processes and Ito’s Formula</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_GBM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Geometric Brownian Motion</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III: Arbitrage Pricing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Arbitrage.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Foundations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Deltas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Delta Hedges, Replication, and PDEs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_DigitalsMeasures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Digitals and Measures</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Part IV: Black-Scholes and Extensions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_BlackScholes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Black-Scholes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Americans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">American Options</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FX.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">FX and Quantos</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Merton.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Merton, Black, and Margrabe</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Asians.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Asians, Baskets, and Spreads</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Exotics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Other Exotics</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Part V: Alternative Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_GARCH.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">GARCH Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_StochasticVol.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Stochastic Volatility</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Jumps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Jumps</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_VarianceSwaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Variance Swaps</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Part VI: Numerical Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_MonteCarlo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Monte Carlo Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Binomial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Binomial and Trinomial Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_PDEs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">PDE Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Fourier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Fourier Transforms</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_MachineLearning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Machine Learning</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Part VII: Fixed Income</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FixedIncome.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Fixed-Income Concepts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_FixedIncomeDerivatives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Fixed-Income Derivatives</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Vasicek.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Vasicek and Extensions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Chapter_Survey.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Term Structure Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendix</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./AppendixA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Miscellaneous Facts about Continuous-Time Models</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Chapter_Arbitrage.html">Part III: Arbitrage Pricing</a></li><li class="breadcrumb-item"><a href="./Chapter_Arbitrage.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Foundations</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-c:arbitrage" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Foundations</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="3cc8f1cd" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display">
        <script type="text/javascript">
        window.PlotlyConfig = {MathJaxConfig: 'local'};
        if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
        </script>
        <script type="module">import "https://cdn.plot.ly/plotly-3.0.0.min"</script>
        
</div>
<div class="cell-output cell-output-display">
<script type="text/javascript" async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_SVG"></script>
</div>
</div>
<p>~setting back to normal</p>
<p>This chapter introduces the change of measure (or change of numeraire or martingale) method for valuing derivative securities. The method is illustrated in a finite state and a two-state model and then extended to more general (continuum of states) models. Computations in the more general model require the continuous-time mathematics developed in Part II of the book.</p>
<p>The pricing and hedging results in this book are not tied to any particular currency. However, for specificity, the discussion will generally be in terms of dollars. Multiple currencies are addressed in <a href="Chapter_FX.html" class="quarto-xref"><span>Chapter 12</span></a>.</p>
<section id="fundamental-ideas" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="fundamental-ideas"><span class="header-section-number">7.1</span> Fundamental Ideas</h2>
<p>The fundamental concept underlying most finance theory, from Miller-Modigliani to the Black Scholes model, is linear pricing. The concept of linear pricing is essentially the same as asking what is the price of five apples and six oranges. Of course, this is the price of one apple times five plus the price of one orange times six. However, instead of pricing bundles of commodities today, we will find prices of dollars in different contigencies at times in the future.</p>
<p>An arbitrage opportunity is a trading strategy that produces nonnegative cash flows at all times in all contingencies with a strictly positive cash flow at some time in some contingency. If such an opportunity were to exist, traders would exploit it until prices adjust to eliminate this possibility. Although simple this has powerful implications.</p>
<p>Consider a world where there are <span class="math inline">\(S\)</span> possible states of the world at timme <span class="math inline">\(t\)</span>. No arbritrage then implies the following properties.</p>
<ol type="1">
<li><p>If <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are time <span class="math inline">\(t\)</span> random cash flows, the time 0 price today of the random cash flow <span class="math inline">\(aX+bY\)</span> is t <span class="math inline">\(a\)</span> times the time 0 price of <span class="math inline">\(X\)</span> plus <span class="math inline">\(b\)</span> times the time zero price of <span class="math inline">\(Y\)</span>. If <span class="math inline">\(P()\)</span> is a pricing function that gives us the price of a random cash flow today, then <span class="math inline">\(P(aA+bB)=aP(A) + bP(B)\)</span>. In other words, the pricing operator is linear. This follows because if this fails to hold, there is an arbitrage assuming an agent can buy and sell any quantities at these prices. Since the pricing operator is linear, it must have the form <span class="math inline">\(P(X) = \sum_{s=1}^S \pi_s X(s)\)</span>. We call <span class="math inline">\(\pi_s\)</span> the price of a dollar at time <span class="math inline">\(t\)</span> in state <span class="math inline">\(s\)</span> or a state price.</p></li>
<li><p>The price of any positive non zero random cash flow at time <span class="math inline">\(t\)</span> is strictly positive. Again, this follows from no arbitrage (think how much of an asset paying a positive dividend you would want if the cost were free or even if you were paid to take the asset). This implies the state prices are strictly positive.</p></li>
<li><p>The pricing operator obeys time value of money: <span class="math inline">\(1=\sum_{s=1}^S \pi_s e^{rt}\)</span>, where <span class="math inline">\(r\)</span> is the continuously compounded yield to maturity of a bond maturing at <span class="math inline">\(t\)</span>. This is the present value rule, in other words, the present value of the future value <span class="math inline">\(e^{rt}\)</span> is one or, equivalently, the present value of a dollar paid at <span class="math inline">\(t\)</span> is <span class="math inline">\(e^{-rt}\)</span>.</p></li>
<li><p>The pricing operator must be consistent with observable prices. The price <span class="math inline">\(S(0)\)</span> of a traded asset with random cash flows at time <span class="math inline">\(t\)</span> is given by <span class="math inline">\(S(0)= \sum_{s=1}^S \pi_s S_s\)</span> where <span class="math inline">\(S_s\)</span> is the random cash flow in state <span class="math inline">\(s\)</span>.</p></li>
</ol>
<div class="callout callout-style-default callout-Principle no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key Principle
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the absence of arbitrage opportunities, there exist positive state prices such that the price of any security is the sum across the states of the world of its payoff multiplied by the state price.</p>
</div>
</div>
<p>This conclusion generalizes to other models, including models in which the stock price takes a continuum of possible values, interpreting “sum” in that case as an integral. We discuss more general models later in this chapter.</p>
<p>We can think of any security as a portfolio of what are called Arrow securities (in recognition of the seminal work of Kenneth Arrow <span class="citation" data-cites="Arrow">(<a href="#ref-Arrow" role="doc-biblioref">Arrow 1964</a>)</span>). An Arrow security’s payoff is tied to a specific state of the world, paying $1 at time t if the state in question occurs and paying nothing otherwise. Since state prices are the prices of these primitive Arrow securities, given these state prices, we can value any security. The state prices can be found by inverting the pricing relationship for prices of traded securities; in other words use traded securities to find the prices of securities that pay off a dollar in each time state contingency. While in general this can be challenging, the procedure is easily illlustrated in the binomial model that we examine next.</p>
<section id="sec-s:oneperiodbinomial" class="level3">
<h3 class="anchored" data-anchor-id="sec-s:oneperiodbinomial">Fundamental Ideas in a Simple Setting</h3>
<p>In this section we consider the following very simple framework. There is a stock with price <span class="math inline">\(S\)</span> today (which we call date <span class="math inline">\(0\)</span>). At the end of some period of time of length <span class="math inline">\(t\)</span>, the stock price will take one of two values: either <span class="math inline">\(S_u\)</span> or <span class="math inline">\(S_d\)</span>, where <span class="math inline">\(S_u &gt; S_d\)</span>. If the stock price equals <span class="math inline">\(S_u\)</span> we say we are in the up state of the world, and if it equals <span class="math inline">\(S_d\)</span> we say we are in the down state. The stock does not pay a dividend prior to <span class="math inline">\(t\)</span>. There is also a risk-free asset earning a continuously compounded rate of interest <span class="math inline">\(r\)</span>.</p>
<p>We can relax the assumption that the stock does not pay a dividend prior to <span class="math inline">\(t\)</span>. We do that by assuming we are enrolled in a dividend-reinvestment program, so we receive additional shares of the asset instead of receiving cash dividends. Of course, if a company does not operate a dividend-reinvestment program, then we can simulate one on our own by buying shares with cash dividends received. In our model, we start with one share at date <span class="math inline">\(0\)</span> with price <span class="math inline">\(S_0\)</span>, and we consider the future value – either <span class="math inline">\(S_u\)</span> or <span class="math inline">\(S_d\)</span> – of owning more than one share at date <span class="math inline">\(t\)</span>, because the number of shares grows through reinvestment of dividends. We call this future value a “dividend-reinvested asset” because of this property and we formulate valuation principles for such assets throughout the book.</p>
<p>Assume <span id="eq-binomialnoarbitrage"><span class="math display">\[
\frac{S_u}{S} &gt; \mathrm{e}^{rt} &gt; \frac{S_d}{S}\;.
\qquad(7.1)\]</span></span> This condition means that the rate of return on the stock in the up state is greater than the risk-free rate, and the rate of return on the stock in the down state is less than the risk-free rate. If it were not true, there would be an arbitrage opportunity: if the rate of return on the stock were greater than the risk-free rate in both states, then one should buy an infinite amount of the stock on margin, and conversely if the rate of return on the stock were less than the risk-free rate in both states, then one should short an infinite amount of stock and put the proceeds in the risk-free asset. So what we are assuming is that there are no arbitrage opportunities in the market for the stock and risk-free asset.</p>
</section>
<section id="state-prices" class="level3">
<h3 class="anchored" data-anchor-id="state-prices">State prices</h3>
<p>It is a simple matter to solve for state prices in this model. We have two equations and two unknowns.<br>
<span class="math display">\[ 1 = \pi_u e^{rt} + \pi_d e^{rt} \]</span> <span class="math display">\[ S = \pi_u S_u + \pi_d S_d \]</span></p>
<p>Solving these equations gives <span class="math inline">\(\pi_u  = \frac{S-e^{-rt}S_d}{S_u - S_d}\)</span> and <span class="math inline">\(\pi_d = \frac{e^{-rt}S_u-S}{S-u - S_d}\)</span>. Notice the requirement that <span class="math inline">\(\pi_s &gt; 0\)</span> is precisely the no arbitrage condition <a href="#eq-binomialnoarbitrage" class="quarto-xref">Equation&nbsp;<span>7.1</span></a> in the previous section.</p>
<p>A somewhat more enlightening description of the state prices is that <span class="math inline">\(\lambda_u\)</span> is the price of an Arrow securtity that pays <span class="math inline">\(1\)</span> if the stock price goes up and nothing if the stock price goes down. We can solve for a portfolio of the stock and the risk-free asset that has these payoffs. Let <span class="math inline">\(A\)</span> be the number of shares of stock and <span class="math inline">\(B\)</span> be the amount borrow or lent at time zero. Then this portfolio will have the desired payoffs if <span class="math display">\[A S_u + B e^{rt} = 1\]</span> and <span class="math display">\[A S_d + B e^{rt} =0\]</span>.</p>
<p>Solving we get <span class="math inline">\(A= \frac{1}{S_u - S_d}\)</span> and <span class="math inline">\(B = -e^{-rt}\frac{S_d}{S_u - S_d}\)</span>. The time zero cost of this portfolio is <span class="math inline">\(AS +B = \frac{S - e^{-rt} S_d}{S_u - S_d} = \pi_u\)</span>. A similar exercise reveals <span class="math inline">\(\pi_d\)</span> is the time 0 price of a portfoio with payofss 0 if the stock price goes up and 1 if the stock price goes down.</p>
<p>Given the state prices, we can value any derivative security whose payoffs depend on the stock price and the risk free asset. For example, consider a European call option on the stock with maturity <span class="math inline">\(t\)</span> and strike <span class="math inline">\(K\)</span>. A call option gives the owner the right (but not the obligation) to buy the stock at the fixed price called the strike. The value of this at the option maturity <span class="math inline">\(t\)</span> is the excess of the stock price over <span class="math inline">\(K\)</span> if the excess is positive and is zero otherwise, which we write as <span class="math inline">\(C_u=\max(0,S_u-K)\)</span> in the up state and <span class="math inline">\(C_d=\max(0,S_d-K)\)</span> in the down state. Therefore, the value of the call option today, <span class="math inline">\(C\)</span>, is given by <span class="math display">\[C = \pi_u C_u + \pi_d C_d = \]</span>.</p>
</section>
<section id="option-deltas-and-replication" class="level3">
<h3 class="anchored" data-anchor-id="option-deltas-and-replication">Option Deltas and Replication</h3>
<p>The more traditional way to derive option prices is by finding a portfolio that replicates the option payoff and then the initial cost of the portfolio must be the option price by no arbitrage. We now show this is consistent with the state price approach. We again consider a European call option on the stock with maturity <span class="math inline">\(t\)</span> and strike <span class="math inline">\(K\)</span>. The value of this at the option maturity <span class="math inline">\(t\)</span> is the excess of the stock price over <span class="math inline">\(K\)</span> if the excess is positive and is zero otherwise, which we write as <span class="math inline">\(C_u=\max(0,S_u-K)\)</span> in the up state and <span class="math inline">\(C_d=\max(0,S_d-K)\)</span> in the down state.</p>
<p>The delta of the call option is defined to be the difference between the call values in the up and down states divided by the difference between the underlying values; that is, <span class="math inline">\(\delta = (C_u-C_d)/(S_u-S_d)\)</span>. Multiplying by <span class="math inline">\(S_u-S_d\)</span> gives us <span class="math inline">\(\delta(S_u-S_d) = C_u-C_d\)</span> and rearranging yields <span class="math inline">\(\delta S_u - C_u = \delta S_d-C_d\)</span>, which is critical to what follows. Consider purchasing <span class="math inline">\(\delta\)</span> shares of the stock at date <span class="math inline">\(0\)</span> and borrowing <span class="math display">\[\mathrm{e}^{-rt}(\delta S_u-C_u) = \mathrm{e}^{-rt}(\delta S_d-C_d)\]</span> dollars at date <span class="math inline">\(0\)</span>. Then you will owe <span class="math display">\[\delta S_u-C_u = \delta S_d-C_d\]</span> dollars at date <span class="math inline">\(t\)</span>, and hence the value of the portfolio at date <span class="math inline">\(t\)</span> in the up state will be <span class="math display">\[\text{value of delta shares} - \text{dollars owed} = \delta S_u - (\delta S_u-C_u) = C_u\; ,\]</span> and the value of the portfolio at date <span class="math inline">\(t\)</span> in the down state will be <span class="math display">\[\text{value of delta shares} - \text{dollars owed} = \delta S_d - (\delta S_d-C_d) = C_d\;\;.\]</span> Thus, this portfolio of buying delta shares and borrowing money (i.e., buying delta shares on margin) <em>replicates</em> the call option. Consequently, the value <span class="math inline">\(C\)</span> of the option at date <span class="math inline">\(0\)</span> must be the date–0 cost of the portfolio; i.e., <span class="math display">\[
C = \text{cost of delta shares} - \text{dollars borrowed}\]</span> <span id="eq-C0"><span class="math display">\[ = \delta S - \mathrm{e}^{-rt}(\delta S_u-C_u)\;.
\qquad(7.2)\]</span></span></p>
<div class="callout callout-style-default callout-Example no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Suppose a stock price today is <span class="math inline">\(S=100\)</span>, and suppose that the price at a future date <span class="math inline">\(t\)</span> will be either <span class="math inline">\(S_u=110\)</span> or <span class="math inline">\(S_u=90\)</span>. The following figure depicts this situation.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.dropbox.com/scl/fi/2hcnid7odp83cmmdpbmwh/binomial_stock_oneperiod.jpg?rlkey=8pj7515da2cg0e2chwo6twu9c&amp;dl=1" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Consider a call option with a strike of <span class="math inline">\(K=105\)</span> that matures at <span class="math inline">\(t\)</span>. The value of being able to buy a stock at <span class="math inline">\(105\)</span> and sell it for <span class="math inline">\(110\)</span> is <span class="math inline">\(5\)</span>, and the value of being able to buy at <span class="math inline">\(105\)</span> and sell at <span class="math inline">\(90\)</span> is zero, so the value of the call option at date <span class="math inline">\(t\)</span> is as shown below. Our goal is to answer the question: What is the call worth at date <span class="math inline">\(0\)</span>?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.dropbox.com/scl/fi/8bepe39y2ebipwezp4etw/binomial_call_oneperiod.jpg?rlkey=nfe9kb0asqk4bs83ye9ws4t59&amp;dl=1" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>We calculate the option <span class="math inline">\(\delta\)</span> as described above: <span class="math display">\[\frac{C_u - C_d}{S_u-S_d} = \frac{5-0}{110-90} = \frac{1}{4}\,.\]</span> The following shows the value of <span class="math inline">\(\delta\)</span> shares at date <span class="math inline">\(0\)</span> and at date <span class="math inline">\(t\)</span>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.dropbox.com/scl/fi/f4kqqysjnt1hgfa4mylsg/binomial_deltashares_oneperiod.jpg?rlkey=fwjftso8kq44zz0b64m49oue1&amp;dl=1" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>The critical feature of this figure is that the difference between the up and down values at date <span class="math inline">\(t\)</span> is the same as the difference between the up and down values of the call; that is, it is <span class="math inline">\(5\)</span> dollars. This is guaranteed by our formula for <span class="math inline">\(\delta\)</span>. The portfolio of <span class="math inline">\(\delta\)</span> shares is worth more than the call at date <span class="math inline">\(t\)</span>, but if we owed <span class="math inline">\(22.50\)</span>, then the value of the portfolio after paying back the loan would match the call value. At an interest rate of 5% (as a rate from date <span class="math inline">\(0\)</span> to date <span class="math inline">\(t\)</span> instead of continuous compounding, for simplicity), we could borrow <span class="math inline">\(21.43\)</span> and then owe <span class="math inline">\(22.50\)</span>. This is depicted in the following.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.dropbox.com/scl/fi/9pmf3yxeyuye6kl2tmumx/binomial_liability_oneperiod.jpg?rlkey=0exisdlr424nd5c8qk0e0dt3d&amp;dl=1" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>If we subtract the previous figure from the figure showing the value of <span class="math inline">\(\delta\)</span> shares, we obtain the figure below. What it means is that if we invest <span class="math inline">\(3.57\)</span> of our own money, and borrow <span class="math inline">\(21.43\)</span>, then we can buy <span class="math inline">\(\delta\)</span> shares, and, after paying back the loan with interest, our portfolio value will match the value of the call option. In other words, we can <em>replicate</em> the call option by buying <span class="math inline">\(\delta\)</span> shares of the stock on margin. Because we can create the call option value at date <span class="math inline">\(t\)</span> by investing <span class="math inline">\(3.57\)</span> of our own money at date <span class="math inline">\(0\)</span>, the price of the call option at date <span class="math inline">\(0\)</span> should be <span class="math inline">\(3.57\)</span>. If the price of the call option were different, then there would be an arbitrage opportunity. This is the calculation that is made in <a href="#eq-C0" class="quarto-xref">Equation&nbsp;<span>7.2</span></a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.dropbox.com/scl/fi/9q8f2499idv7udmmfcon2/binomial_call_complete_oneperiod.jpg?rlkey=1guyoxpkfuq3y7dwuamg9zs02&amp;dl=1" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
</div>
</div>
</div>
</section>
<section id="state-prices-1" class="level3">
<h3 class="anchored" data-anchor-id="state-prices-1">State Prices</h3>
<p>We now rewrite the option pricing <a href="#eq-C0" class="quarto-xref">Equation&nbsp;<span>7.2</span></a> in terms of state prices. By substituting for <span class="math inline">\(\delta\)</span> in <a href="#eq-C0" class="quarto-xref">Equation&nbsp;<span>7.2</span></a>, we can rearrange <a href="#eq-C0" class="quarto-xref">Equation&nbsp;<span>7.2</span></a> as</p>
<p><span id="eq-binomialC1"><span class="math display">\[
C = \frac{S-\mathrm{e}^{-rt}S_d}{S_u-S_d} \times C_u + \frac{\mathrm{e}^{-rt}S_u-S}{S_u-S_d}\times C_d\; .
\qquad(7.3)\]</span></span></p>
<p>A little algebra also shows that <span id="eq-binomialS1"><span class="math display">\[
S = \frac{S-\mathrm{e}^{-rt}S_d}{S_u-S_d} \times
S_u + \frac{\mathrm{e}^{-rt}S_u-S}{S_u-S_d}\times S_d\; ,
\qquad(7.4)\]</span></span></p>
<p>and <span id="eq-binomialR1"><span class="math display">\[
1 = \frac{S-\mathrm{e}^{-rt}S_d}{S_u-S_d} \times \mathrm{e}^{rt}+ \frac{\mathrm{e}^{-rt}S_u-S}{S_u-S_d}\times \mathrm{e}^{rt}\;.
\qquad(7.5)\]</span></span></p>
<p>It is convenient to denote the factors appearing in these equations as <span id="eq-binomialstateprices"><span class="math display">\[
\pi_u = \frac{S-\mathrm{e}^{-rt}S_d}{S_u-S_d} \quad \text{and} \quad \pi_d = \frac{\mathrm{e}^{-rt}S_u-S}{S_u-S_d}\;.
\qquad(7.6)\]</span></span></p>
<p>The numbers <span class="math inline">\(\pi_u\)</span> and <span class="math inline">\(\pi_d\)</span> are called the state prices, for reasons that will be explained below.</p>
<p>With these definitions, we can write <a href="#eq-binomialC1" class="quarto-xref">Equation&nbsp;<span>7.3</span></a>–<a href="#eq-binomialR1" class="quarto-xref">Equation&nbsp;<span>7.5</span></a> as</p>
<p><span id="eq-binomialC2"><span class="math display">\[
C = \pi_uC_u + \pi_dC_d\;,
\qquad(7.7)\]</span></span></p>
<p><span id="eq-binomialS2"><span class="math display">\[
S = \pi_uS_u+\pi_dS_d\;,
\qquad(7.8)\]</span></span></p>
<p><span id="eq-binomialR2"><span class="math display">\[
1 = \pi_u\mathrm{e}^{rt} + \pi_d \mathrm{e}^{rt}\;.
\qquad(7.9)\]</span></span></p>
<p>These equations have the following interpretation: the value of a security today is its value in the up state times <span class="math inline">\(\pi_u\)</span> plus its value in the down state times <span class="math inline">\(\pi_d\)</span>. This applies to <a href="#eq-binomialR2" class="quarto-xref">Equation&nbsp;<span>7.9</span></a> by considering an investment of $1 today in the risk-free asset—it has value 1 today and will have value <span class="math inline">\(\mathrm{e}^{rt}\)</span> in both the up and down states at date <span class="math inline">\(t\)</span>. Moreover, this same equation holds for any other derivative asset – for example, a put option – for the same <span class="math inline">\(\pi_u\)</span> and <span class="math inline">\(\pi_d\)</span> defined in <a href="#eq-binomialstateprices" class="quarto-xref">Equation&nbsp;<span>7.6</span></a>.</p>
<p>We can think of any security as a portfolio of what are called Arrow securities (in recognition of the seminal work of Kenneth Arrow <span class="citation" data-cites="Arrow">(<a href="#ref-Arrow" role="doc-biblioref">Arrow 1964</a>)</span>). In this model, one of the Arrow securities pays $1 at date <span class="math inline">\(t\)</span> if the up state occurs and the other pays $1 at date <span class="math inline">\(t\)</span> if the down state occurs. For example, the stock is equivalent to a portfolio consisting of <span class="math inline">\(S_u\)</span> units of the first Arrow security and <span class="math inline">\(S_d\)</span> units of the second, because the stock is worth <span class="math inline">\(S_u\)</span> dollars in the up state and <span class="math inline">\(S_d\)</span> dollars in the down state. <a href="#eq-binomialC2" class="quarto-xref">Equation&nbsp;<span>7.7</span></a>–<a href="#eq-binomialR2" class="quarto-xref">Equation&nbsp;<span>7.9</span></a> show that <span class="math inline">\(\pi_u\)</span> is the price of the first Arrow security and <span class="math inline">\(\pi_d\)</span> is the price of the second. For example, the right-hand side of <a href="#eq-binomialS2" class="quarto-xref">Equation&nbsp;<span>7.8</span></a> is the value of the stock at date <span class="math inline">\(0\)</span> viewed as a portfolio of Arrow securities when the Arrow securities have prices <span class="math inline">\(\pi_u\)</span> and <span class="math inline">\(\pi_d\)</span>. Because the stock clearly is such a portfolio, its price today must equal the value of that portfolio, which is what <a href="#eq-binomialS2" class="quarto-xref">Equation&nbsp;<span>7.8</span></a> asserts.</p>
<p>As mentioned before, the prices <span class="math inline">\(\pi_u\)</span> and <span class="math inline">\(\pi_d\)</span> of the Arrow securities are called the state prices, because they are the prices of receiving $1 in the two states of the world. The state prices should be positive, because the payoff of each Arrow security is nonnegative in both states and positive in one. A little algebra shows that the conditions <span class="math inline">\(\pi_u&gt;0\)</span> and <span class="math inline">\(\pi_d&gt;0\)</span> are exactly equivalent to our no-arbitrage assumption <a href="#eq-binomialnoarbitrage" class="quarto-xref">Equation&nbsp;<span>7.1</span></a>.</p>
</section>
</section>
<section id="risk-neutral-probability" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="risk-neutral-probability"><span class="header-section-number">7.2</span> Risk-Neutral Probability</h2>
<p>We have our basic pricing formula <span class="math display">\[ P(X)= \sum_{s=1}^S \pi_s X_s \]</span> Let <span class="math inline">\(p_s = \pi_s e^{rt}\)</span>. Then <span class="math inline">\(\sum_{s=1}^S p_s = 1\)</span> and <span class="math inline">\(p_s&gt;0\)</span>. Therefore, we can think of <span class="math inline">\(p_s\)</span> as probabilities. We refer to <span class="math inline">\(p_s\)</span> as risk neutral probabilities. Given this we can write <span class="math display">\[P(X)= \sum_{s=1}^S p_s e^{-rt} X_s \]</span> which can be thought of the expected discounted value of the future cash flows. The risk neutral probabilities are so-called since we discount by the risk-free rate. However, the risk neutral probabilities should not be confused with actual probabilities since they are really prices.</p>
<p>Unlike the Capital Asset Pricing Model, for example, there is no risk premium in the discount rate. This is the calculation we would do to price assets under the actual probabilities if investors were risk neutral (or for zero-beta assets). So, we can act as if investors are risk neutral by adjusting the probabilities.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Of course, we are not really assuming investors are risk neutral. We have simply embedded any risk premia in the probabilities.</p>
<p>Notice the expected return using the risk neutral probabilities for any investement is the risk free rate: <span class="math display">\[\frac{\sum_{s=1}^S p_s X_s}{P(X)} = e^{rt}\]</span>, so it is important to realize that the risk neutral probabilities are distinct from the actual probabilities used in portfolio theory.</p>
<section id="risk-neutral-probability-in-the-binomial-model" class="level3">
<h3 class="anchored" data-anchor-id="risk-neutral-probability-in-the-binomial-model">Risk-Neutral Probability in the Binomial Model</h3>
<p>To apply Key Principle <span class="math inline">\(\ref{principle:stateprices}\)</span> in the most convenient way, we manipulate the state prices so we can interpret the sums on the right-hand sides of <a href="#eq-binomialC2" class="quarto-xref">Equation&nbsp;<span>7.7</span></a>–<a href="#eq-binomialR2" class="quarto-xref">Equation&nbsp;<span>7.9</span></a> in terms of expectations. The expectation (or mean) of a random variable is of course its probability-weighted average value.</p>
<p>Set <span class="math inline">\(p_u = \pi_u\mathrm{e}^{rt}\)</span> for the up state and <span class="math inline">\(p_d = \pi_d\mathrm{e}^{rt}\)</span> for the down state. <a href="#eq-binomialC2" class="quarto-xref">Equation&nbsp;<span>7.7</span></a>–<a href="#eq-binomialR2" class="quarto-xref">Equation&nbsp;<span>7.9</span></a> can be written as</p>
<p><span id="eq-binomialC3"><span class="math display">\[
C = \mathrm{e}^{-rt}[p_uC_u+p_dC_d]\;,
\qquad(7.10)\]</span></span></p>
<p><span id="eq-binomialS3"><span class="math display">\[
S = \mathrm{e}^{-rt}[p_uS_u+p_dS_d]\;,
\qquad(7.11)\]</span></span></p>
<p><span id="eq-binomialR3"><span class="math display">\[
1= p_u+p_d\;.
\qquad(7.12)\]</span></span></p>
<p>The numbers <span class="math inline">\(p_u\)</span> and <span class="math inline">\(p_d\)</span> are called the risk-neutral probabilities of the up and down states. The numbers are both positive (because the state prices are positive under our no-arbitrage assumption) and <a href="#eq-binomialR3" class="quarto-xref">Equation&nbsp;<span>7.12</span></a> states that they sum to one, so it is indeed sensible to consider them as (artificial) probabilities. <a href="#eq-binomialC3" class="quarto-xref">Equation&nbsp;<span>7.10</span></a> and <a href="#eq-binomialS3" class="quarto-xref">Equation&nbsp;<span>7.11</span></a> state that the value of a security today is its expected value at date <span class="math inline">\(t\)</span> discounted at the risk-free rate, when we take the expectation using the risk-neutral probabilities. Thus, these are present value formulas.</p>
<p>It follows from <a href="#eq-binomialS3" class="quarto-xref">Equation&nbsp;<span>7.11</span></a> that the expected return of the stock under the risk-neutral probabilities is the risk-free return; that is, <span class="math display">\[\frac{p_uS_u + p_dS_d}{S} = \mathrm{e}^{rt}\,.\]</span> This is a general fact: expected returns relative to the risk-neutral probabilities equal the risk-free return.</p>
</section>
</section>
<section id="martingale-pricing" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="martingale-pricing"><span class="header-section-number">7.3</span> Martingale Pricing</h2>
<p>A martingale is a stochastic process for which the expected value of tomorrow’s value is today’s value. In the context of our model discounted values of non-dividend paying trading strategies are martingales, that is if <span class="math inline">\(X(0)\)</span> is today’s value of a portfolio with payoffs random <span class="math inline">\(X\)</span> at time <span class="math inline">\(t\)</span>, <span class="math display">\[  \frac{X(0))}{R(0))} = \sum_{s=1}^S p_s \frac{X_s}{e^{r t}} = \mathbb{E}^R\left[\frac{X}{R_t}\right] \]</span> where <span class="math inline">\(R(0) = 1\)</span>, the initial investment in the risk free asset. In this sense, the discounted value today is the expected discounted discounted value in one period, where the expectation uses the risk neutral probabilities.</p>
<p>’’</p>
<section id="martingales" class="level3">
<h3 class="anchored" data-anchor-id="martingales">Martingales</h3>
<p><a href="#eq-binomialC3" class="quarto-xref">Equation&nbsp;<span>7.10</span></a> and <a href="#eq-binomialS3" class="quarto-xref">Equation&nbsp;<span>7.11</span></a> can be written in an equivalent form, which, though somewhat less intuitive, generalizes more readily. First, let’s introduce some notation for the price of the risk-free asset. Considering an investment of $1 today that grows to <span class="math inline">\(\mathrm{e}^{rt}\)</span> at date <span class="math inline">\(t\)</span>, it is sensible to take the price today to be <span class="math inline">\(R=1\)</span> and the price in the up and down states at date <span class="math inline">\(t\)</span> to be <span class="math inline">\(R_u=R_d=\mathrm{e}^{rt}\)</span>.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> In terms of this notation, <a href="#eq-binomialC3" class="quarto-xref">Equation&nbsp;<span>7.10</span></a>–<a href="#eq-binomialR3" class="quarto-xref">Equation&nbsp;<span>7.12</span></a> can be written as:</p>
<p><span id="eq-binomialC4"><span class="math display">\[
\frac{C}{R} = p_u \frac{C_u}{R_u} + p_d \frac{C_d}{R_d}\;,
\qquad(7.13)\]</span></span></p>
<p><span id="eq-binomialS4"><span class="math display">\[
\frac{S}{R} = p_u \frac{S_u}{R_u} + p_d \frac{S_d}{R_d}\;,
\qquad(7.14)\]</span></span></p>
<p><span id="eq-binomialR4"><span class="math display">\[
1=p_u+p_d\;.
\qquad(7.15)\]</span></span></p>
<p><a href="#eq-binomialC4" class="quarto-xref">Equation&nbsp;<span>7.13</span></a> and <a href="#eq-binomialS4" class="quarto-xref">Equation&nbsp;<span>7.14</span></a> each state that the price of a security today divided by the price of the risk-free asset equals the expected future value of the same ratio, when we take expectations using the risk-neutral probabilities. In other words, the mean of the date–<span class="math inline">\(t\)</span> value of the ratio is equal to the ratio today.<br>
A variable that changes randomly over time with the expected future value being always equal to the current value is called a martingale. Thus, we have shown that the ratio of the stock price to the price of the risk-free asset is a martingale when using the risk-neutral probabilities.</p>
<p>The ratio of one price to another is the value of the first (numerator) asset when we are using the second (denominator) asset as the numeraire. The term numeraire means a unit of measurement. For example, the ratio <span class="math inline">\(C/R\)</span> is the value of the call when we use the risk-free asset as the unit of measurement: it is the number of units of the risk-free asset for which one call option can be exchanged (to see this, note that <span class="math inline">\(C/S\)</span> shares is worth <span class="math inline">\(C/R \times R = C\)</span> dollars, so <span class="math inline">\(C/R\)</span> units of the risk-free asset is worth the same as one call). Thus, we have shown that asset prices using the risk-free asset as numeraire are martingales relative to the risk-neutral probabilities.</p>
</section>
</section>
<section id="change-of-numeraire" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="change-of-numeraire"><span class="header-section-number">7.4</span> Change of Numeraire</h2>
<p>Our choice of the risk free asset to derive risk neutral probabilities was somewhat arbitrary. In fact any strictly positive non-dividend paying trading strategy can be used as a numeraire. In other words instead of quoting the price of apples and oranges in dollars, we can quote prices in numbers of oranges. One apple is equal to the price of one apple in dollars divided by the price of oranges in dollars and one dollar is equal to one divided by the price of oranges. In our model, instead of measuring payoffs in units of an investment in the risk free asset, we can measure payoffs in different units. We explain this as follows.</p>
<p>The price of any non dividend paying asset or dividend reinvested trading strategy with strictly positive value is <span class="math display">\[Y(0) = \sum_{s=1}^S \pi_s Y_s \]</span> Rearranging, we can define probabilities <span class="math inline">\(\text{prob}^Y_s = \frac{\pi_s}{Y(0)}\)</span>. Then we have <span class="math inline">\(\sum_{s=1}^S \text{prob}^Y_s =1\)</span> and we can write the price of the risk free asset and any traded security as <span class="math display">\[1 = Y(0) \sum_{s=1}^S \text{prob}^Y_s \frac{e^{rt}}{Y_s} = Y(0) \mathbb{E}^Y\left[\frac{e^{rt}}{Y} \right]\]</span> <span class="math display">\[S(0) = Y(0) \sum_{s=1}^S \text{prob}^Y \frac{S_s}{Y_s}  = Y(0) \mathbb{E}^Y\left[\frac{S}{Y}\right] \]</span> Notice <span class="math inline">\(\frac{S}{Y}\)</span> is a martingale using the probabilities <span class="math inline">\(\text{prob}_s^Y\)</span>. The ratio <span class="math inline">\(\frac{S}{Y}\)</span> is the number of shares of <span class="math inline">\(Y\)</span> that security <span class="math inline">\(S\)</span> is worth. Therefore, using the probabilities <span class="math inline">\(p_s^Y\)</span>, the value of the number of shares of <span class="math inline">\(Y\)</span> an investment is worth follows a martingale.</p>
<div class="callout callout-style-default callout-Principle no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key Principle
</div>
</div>
<div class="callout-body-container callout-body">
<p>If there are no arbitrage opportunities, then for each dividend-reinvested asset, there exists a probability measure such that the ratio of any other dividend-reinvested asset price to the first (numeraire) asset price is a martingale.</p>
</div>
</div>
<p>An assignment of probabilities to events is called a probability measure, or simply a measure (because it measures the events, in a sense). Thus, we have described two different probability measures: one using the risk-free asset as numeraire and one using the stock as numeraire. The probability measure using the risk-free asset as numeraire defined in the previous section is universally called the risk-neutral probability. When we use one of these probabilities, we commonly say that we are changing numeraires.</p>
<p>We have applied this statement to the risk-free asset, which pays dividends (interest). However, the price <span class="math inline">\(R_s=\mathrm{e}^{rt}\)</span> for all <span class="math inline">\(s=1,\dots,S\)</span>, includes the interest, so no interest has been withdrawn—the interest has been reinvested—prior to the maturity <span class="math inline">\(t\)</span> of the option. This is what we mean by a dividend-reinvested asset. In general, we apply the formulas developed in this and the following section to dividend-paying assets by considering the portfolios in which dividends are reinvested.</p>
<section id="other-numeraires-in-the-binomial-model" class="level3">
<h3 class="anchored" data-anchor-id="other-numeraires-in-the-binomial-model">Other Numeraires in the Binomial Model</h3>
<p>Note that the risk-neutral probabilities are the state prices multiplied by the gross return on the risk-free asset. Analogously, define numbers <span class="math inline">\(\text{prob}^S_u = \pi_uS_u/S\)</span> and <span class="math inline">\(\text{prob}^S_d = \pi_dS_d/S\)</span>. Substituting for <span class="math inline">\(\pi_u\)</span> and <span class="math inline">\(\pi_d\)</span> in <a href="#eq-binomialC2" class="quarto-xref">Equation&nbsp;<span>7.7</span></a>–<a href="#eq-binomialR2" class="quarto-xref">Equation&nbsp;<span>7.9</span></a> and continuing to use the notation <span class="math inline">\(R\)</span> for the price of the risk-free asset, we obtain</p>
<p><span id="eq-binomialC5"><span class="math display">\[
\frac{C}{S} = \text{prob}^S_u \frac{C_u}{S_u} + \text{prob}^S_d \frac{C_d}{S_d}\;,
\qquad(7.16)\]</span></span></p>
<p><span id="eq-binomialS5"><span class="math display">\[
1 = \text{prob}^S_u + \text{prob}^S_d\;,
\qquad(7.17)\]</span></span></p>
<p><span id="eq-binomialR5"><span class="math display">\[
\frac{R}{S} = \text{prob}^S_u \frac{R_u}{S_u} + \text{prob}^S_d \frac{R_d}{S_d}\;.
\qquad(7.18)\]</span></span></p>
<p><a href="#eq-binomialS5" class="quarto-xref">Equation&nbsp;<span>7.17</span></a> establishes that we can view the <span class="math inline">\(\text{prob}^S\)</span>’s as probabilities (like the risk-neutral probabilities, they are positive because the state prices are positive). <a href="#eq-binomialC5" class="quarto-xref">Equation&nbsp;<span>7.16</span></a> and <a href="#eq-binomialR5" class="quarto-xref">Equation&nbsp;<span>7.18</span></a> both state that the ratio of a security price to the price of the stock is a martingale when we use the <span class="math inline">\(\text{prob}^S\)</span>’s’ as probabilities. Thus, asset prices using the stock as numeraire are martingales when we use the <span class="math inline">\(\text{prob}^S\)</span> probabilities.</p>
</section>
<section id="practical-implementation" class="level3">
<h3 class="anchored" data-anchor-id="practical-implementation">Practical Implementation</h3>
<p>For this exposition, it was convenient to first calculate the state prices and then calculate the various probabilities. However, that is not the most efficient way to proceed in most applications. In a typical application, we would view the prices of the stock and risk-free asset in the various states of the world as given, and we would be attempting to compute the value of the call option. Note that t <a href="#eq-binomialC2" class="quarto-xref">Equation&nbsp;<span>7.7</span></a>–<a href="#eq-binomialR2" class="quarto-xref">Equation&nbsp;<span>7.9</span></a>, <a href="#eq-binomialC4" class="quarto-xref">Equation&nbsp;<span>7.13</span></a>–<a href="#eq-binomialR4" class="quarto-xref">Equation&nbsp;<span>7.15</span></a>, and <a href="#eq-binomialC5" class="quarto-xref">Equation&nbsp;<span>7.16</span></a>–<a href="#eq-binomialR5" class="quarto-xref">Equation&nbsp;<span>7.18</span></a> are all equivalent. In each case we would consider that there are three unknowns—the value <span class="math inline">\(C\)</span> of the call option and either two state prices or two probabilities. In each case the state prices or probabilities can be computed from the last two equations in the set of three equations and then the call value <span class="math inline">\(C\)</span> can be computed from the first equation in the set. All three sets of equations produce the same call value.</p>
<p>In fact, as we will see, it is not even necessary to calculate the probabilities. The fact that ratios of dividend-reinvested asset prices to the numeraire asset price are martingales tell us enough about the probabilities to calculate derivative values without having to calculate the probabilities themselves.</p>
</section>
</section>
<section id="stochastic-discount-factor" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="stochastic-discount-factor"><span class="header-section-number">7.5</span> Stochastic Discount Factor</h2>
<p>Up until now, no mention of the true proabilities has been made. However, another pricing formula that is commonly encountered is to use a stochastic discount factor. Denote the actual probability of state <span class="math inline">\(s\)</span> as <span class="math inline">\(\text{prob}_s\)</span>.If we define <span class="math inline">\(m_s = \frac{\pi_s}{\text{prob}_s}\)</span>, we can write <span class="math display">\[ P(X) = \sum_{s=1}^S \text{prob}_s m_s X_s = \mathbb{E}\left[m X\right] \]</span>.</p>
<p>We call the random variable <span class="math inline">\(m\)</span> the stochastic discount factor. We can calculate an asset value as the expectation of its future value discounted (multiplied) by the the stochastic factor <span class="math inline">\(m\)</span>.</p>
<p>A further decomposition of <span class="math inline">\(m\)</span> is useful. Notice that <span class="math display">\[ 1 = \mathbb{E}\left[m e^{rt}\right] \]</span> so in a sense to be made precise later, <span class="math inline">\(m e^{rt}\)</span> is a martingale when we identify the time 0 value of <span class="math inline">\(m\)</span> as 1. Therefore, we can write the price of any asset with time <span class="math inline">\(t\)</span> value <span class="math inline">\(X\)</span> as <span class="math display">\[  P(X) = \mathbb{E}\left[m e^{rt} \frac{X}{e^{rt}}\right] = \sum_{s=1}^S \text{prob}_s m_s e^{rt} \frac{X_s}{e^{rt}} =\mathbb{E}^R\left[\frac{X}{e^{rt}}\right]\]</span> Therefore, the risk neutral probabilities are <span class="math display">\[p_s = \text{prob}_s m_s e^{rt} \]</span> and the random variable <span class="math inline">\(m e^{rt}\)</span> changes the probability measure from the true probability measure to the risk neutral measure: for any random variable <span class="math inline">\(Z\)</span>, <span class="math inline">\(\mathbb{E}[m e^{rt} Z] = \mathbb{E}^R[Z]\)</span>.</p>
<section id="stochastic-discount-factor-in-the-binomial-model" class="level3">
<h3 class="anchored" data-anchor-id="stochastic-discount-factor-in-the-binomial-model">Stochastic Discount Factor in the Binomial Model</h3>
<p>We now consider yet another reformulation of the pricing relations <a href="#eq-binomialC2" class="quarto-xref">Equation&nbsp;<span>7.7</span></a>–<a href="#eq-binomialR2" class="quarto-xref">Equation&nbsp;<span>7.9</span></a>. This formulation generalizes more easily to pricing when there are a continuum of states.<br>
Let <span class="math inline">\(\text{prob}_u\)</span> denote the actual probability of the up state and <span class="math inline">\(\text{prob}_d\)</span> denote the probability of the down state. These probabilities are irrelevant for pricing derivatives in the two-state up-and-down model, but we use them to write the pricing relations <a href="#eq-binomialC2" class="quarto-xref">Equation&nbsp;<span>7.7</span></a>–<a href="#eq-binomialR2" class="quarto-xref">Equation&nbsp;<span>7.9</span></a> as expectations with respect to the actual probabilities. To do this, we can define <span class="math display">\[\begin{align*}
m_u &amp;= \frac{\pi_u}{\text{prob}_u}\; ,\\
m_d &amp;= \frac{\pi_d}{\text{prob}_d}\;.
\end{align*}\]</span> Then <a href="#eq-binomialC2" class="quarto-xref">Equation&nbsp;<span>7.7</span></a>–<a href="#eq-binomialR2" class="quarto-xref">Equation&nbsp;<span>7.9</span></a> can be written as</p>
<p><span id="eq-binomialC6"><span class="math display">\[
C = \text{prob}_um_uC_u + \text{prob}_dm_dC_d\;,
\qquad(7.19)\]</span></span></p>
<p><span id="eq-binomialS6"><span class="math display">\[
S = \text{prob}_um_uS_u + \text{prob}_dm_dS_d\;,
\qquad(7.20)\]</span></span></p>
<p><span id="eq-binomialR6"><span class="math display">\[
R = \text{prob}_um_uR_u + \text{prob}_dm_dR_d\;.
\qquad(7.21)\]</span></span></p>
<p>The right-hand sides are expectations with respect to the actual probabilities. For example, the right-hand side of <a href="#eq-binomialC6" class="quarto-xref">Equation&nbsp;<span>7.19</span></a> is the expectation of the random variable that equals <span class="math inline">\(m_uC_u\)</span> in the up state and <span class="math inline">\(m_dC_d\)</span> in the down state. The risk-neutral probabilities can be calculated from <span class="math inline">\(m_u\)</span> and <span class="math inline">\(m_d\)</span> as <span class="math inline">\(p_u=\text{prob}_um_uR_u/R\)</span> and <span class="math inline">\(p_d=\text{prob}_dm_dR_d/R\)</span>. Likewise, the probabilities using the stock as the numeraire can be calculated from <span class="math inline">\(m_u\)</span> and <span class="math inline">\(m_d\)</span> as <span class="math inline">\(\text{prob}^S_u=\text{prob}_um_uS_u/S\)</span> and <span class="math inline">\(\text{prob}^S_d=\text{prob}_dm_dS_d/S\)</span>.</p>
<p>The random variable <span class="math inline">\(m\)</span> the stochastic discount factor. <a href="#eq-binomialS6" class="quarto-xref">Equation&nbsp;<span>7.20</span></a>–<a href="#eq-binomialR6" class="quarto-xref">Equation&nbsp;<span>7.21</span></a> show that we can calculate an asset value as the expectation of its future value discounted (multiplied) by the the stochastic factor <span class="math inline">\(m\)</span>.</p>
</section>
</section>
<section id="more-general-models" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="more-general-models"><span class="header-section-number">7.6</span> More General Models</h2>
<p>Now, we drop the assumption that there are a finite number of possible future prices of the stock and allow a general distribution with potentially a continuum of possible values. Denote the future price as <span class="math inline">\(S_t\)</span>. Our principle regarding the stochastic discount factor developed in the preceding section can in general be expressed as:<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div class="callout callout-style-default callout-Principle no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key Principle
</div>
</div>
<div class="callout-body-container callout-body">
<p>If there are no arbitrage opportunities, then there exists for each date <span class="math inline">\(t\)</span> a strictly positive random variable <span class="math inline">\(m_t\)</span>, called a stochastic discount factor, such that the date–<span class="math inline">\(0\)</span> value of any dividend-reinvested asset with price <span class="math inline">\(P\)</span> is <span id="eq-continuum1"><span class="math display">\[
P_0 = \mathbb{E}[m_tP_t]\;.
\qquad(7.22)\]</span></span></p>
</div>
</div>
<p>Here, <span class="math inline">\(\mathbb{E}[m_tS_t]\)</span> denotes the expectation of the random variable <span class="math inline">\(m_tS_t\)</span>. In a two-state model (or in any model with only a finite number of states of the world), the concept of an expectation is clear: it is just a weighted average of outcomes, the weights being the probabilities. In the two-state model, the right-hand side of <a href="#eq-binomialS6" class="quarto-xref">Equation&nbsp;<span>7.20</span></a> is the same as the right-hand side of <a href="#eq-continuum1" class="quarto-xref">Equation&nbsp;<span>7.22</span></a>.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<p>To convert from state prices to probabilities corresponding to different numeraires, we follow the same procedure as at the end of the previous section: we multiply together (i) the probability of the state, (ii) the value of <span class="math inline">\(m_t\)</span> in the state, and (iii) the gross return of the numeraire in the state. If there is a continuum of states, then the actual probability of any individual state is typically zero, so this multiplication produces a zero probability. However, we can nevertheless add up these probabilities to define the probability of any event <span class="math inline">\(A\)</span>, an event being a set of states of the world. To do this, let <span class="math inline">\(1_A\)</span> denote the random variable that takes the value 1 when <span class="math inline">\(A\)</span> is true and which is zero otherwise. Then the probability of <span class="math inline">\(A\)</span> using <span class="math inline">\(S\)</span> as the numeraire is defined as <span id="eq-probSnumeraire"><span class="math display">\[
\mathbb{E}\left[1_Am_t\frac{S_t}{S_0}\right]\;.
\qquad(7.23)\]</span></span></p>
<p>This makes sense as a probability because it is nonnegative and because, if <span class="math inline">\(A\)</span> is the set of all states of the world, then its probability is <span class="math inline">\(\mathbb{E}[m_tS_t/S_0]\)</span>, which equals one by virtue of <a href="#eq-continuum1" class="quarto-xref">Equation&nbsp;<span>7.22</span></a>. From <a href="#eq-probSnumeraire" class="quarto-xref">Equation&nbsp;<span>7.23</span></a> for the probability of any event <span class="math inline">\(A\)</span>, it can be shown that the expectation of any random variable <span class="math inline">\(X\)</span> using <span class="math inline">\(S\)</span> as the numeraire is <span id="eq-expSnumeraire"><span class="math display">\[
\mathbb{E}\left[Xm_t\frac{S_t}{S_0}\right]\;.
\qquad(7.24)\]</span></span></p>
<p>Different numeraires lead to different probability measures and hence to different expectations. To keep this straight, we use the numeraire as a superscript on the expectation symbol: for example, <span class="math inline">\(\mathbb{E}^S\)</span> denotes expectation with respect to the probability measure that corresponds to <span class="math inline">\(S\)</span> being the numeraire. Also, we use the symbol <span class="math inline">\(\text{prob}^S(A)\)</span> to denote the probability of an event <span class="math inline">\(A\)</span> when we use <span class="math inline">\(S\)</span> as the numeraire. So, <a href="#eq-probSnumeraire" class="quarto-xref">Equation&nbsp;<span>7.23</span></a> and <a href="#eq-expSnumeraire" class="quarto-xref">Equation&nbsp;<span>7.24</span></a> are written as</p>
<p><span id="eq-probSnumeraire2"><span class="math display">\[
\text{prob}^S(A) = \mathbb{E}\left[1_Am_t\frac{S_t}{S_0}\right]\;,
\qquad(7.25)\]</span></span></p>
<p><span id="eq-expSnumeraire2"><span class="math display">\[
\mathbb{E}^S[X] = \mathbb{E}\left[Xm_t\frac{S_t}{S_0}\right]\;.
\qquad(7.26)\]</span></span></p>
<section id="fundamental-pricing-formula" class="level3">
<h3 class="anchored" data-anchor-id="fundamental-pricing-formula">Fundamental Pricing Formula</h3>
<p>Our key result in the two-state up-and-down example considered earlier was that the ratio of the price of any dividend-reinvested asset to the price of the numeraire asset is not expected to change when we use the probability measure corresponding to the numeraire. We now demonstrate the same result in this more general model. Recall that <span class="math inline">\(t\)</span> denotes an arbitrary but fixed date at which we have defined the probabilities using <span class="math inline">\(S\)</span> as the numeraire in <a href="#eq-probSnumeraire" class="quarto-xref">Equation&nbsp;<span>7.23</span></a>. At each date <span class="math inline">\(s&lt;t\)</span>, let <span class="math inline">\(\mathbb{E}^P_s\)</span> denote the expectation given information at time <span class="math inline">\(s\)</span> and using a dividend-reinvested asset price <span class="math inline">\(P\)</span> as the numeraire (we continue to write the expectation at date <span class="math inline">\(0\)</span> without a subscript; i.e., <span class="math inline">\(\mathbb{E}^S\)</span> has the same meaning as <span class="math inline">\(\mathbb{E}^S_0\)</span>). Let <span class="math inline">\(Y\)</span> denote the price of another dividend-reinvested asset. We will show that <span id="eq-preformula"><span class="math display">\[
\frac{Y_s}{P_s} = \mathbb{E}^P_s \left[\frac{Y_t}{P_t}\right]\;.
\qquad(7.27)\]</span></span></p>
<p>Thus, the expected future (date–<span class="math inline">\(t\)</span>) value of the ratio <span class="math inline">\(Y/P\)</span> always equals the current (date–<span class="math inline">\(s\)</span>) value when we change probability measures using <span class="math inline">\(P\)</span> as the numeraire. As discussed in the preceding section, the mathematical term for a random variable whose expected future value always equals its current value is martingale. Thus, we can express <a href="#eq-preformula" class="quarto-xref">Equation&nbsp;<span>7.27</span></a> as stating that the ratio <span class="math inline">\(Y/P\)</span> is a martingale when we compute expectations using the probability measure that corresponds to <span class="math inline">\(S\)</span> being the numeraire.</p>
<p>The usefulness of <a href="#eq-preformula" class="quarto-xref">Equation&nbsp;<span>7.27</span></a> is that it gives us a formula for the asset price <span class="math inline">\(Y_s\)</span> at any time <span class="math inline">\(s\)</span>—and recall that this formula holds for every dividend-reinvested asset. The formula is obtained from <a href="#eq-preformula" class="quarto-xref">Equation&nbsp;<span>7.27</span></a> by multiplying through by <span class="math inline">\(P_s\)</span>:</p>
<div class="callout callout-style-default callout-Principle no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key Principle
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the absence of arbitrage opportunities, prices <span class="math inline">\(P\)</span> and <span class="math inline">\(Y\)</span> of dividend-reinvested assets satisfy, for all <span class="math inline">\(s&lt;t\)</span>, <span id="eq-formula"><span class="math display">\[
Y_s = P_s\mathbb{E}^P_s \left[\frac{Y_t}{P_t}\right]\;.
\qquad(7.28)\]</span></span></p>
</div>
</div>
<p>We call <a href="#eq-formula" class="quarto-xref">Equation&nbsp;<span>7.28</span></a> the fundamental pricing formula. It is at the heart of modern pricing of derivative securities. It is a present value relation: the value at time <span class="math inline">\(s\)</span> of the asset with price <span class="math inline">\(Y\)</span> is the expectation, under the appropriate probability measure, of its value <span class="math inline">\(Y_t\)</span> at time <span class="math inline">\(t\)</span> discounted by the (possibly random) factor <span class="math inline">\(P_s/P_t\)</span>.</p>
<p>For example, assume the risk free rate is constant. Letting <span class="math inline">\(P_s = R_s\)</span> denote the value <span class="math inline">\(\mathrm{e}^{rs}\)</span> of the risk-free asset and using it as the numeraire, <a href="#eq-formula" class="quarto-xref">Equation&nbsp;<span>7.28</span></a> becomes <span id="eq-riskneutralformula"><span class="math display">\[
Y_s = \mathrm{e}^{rs}\\E^R_s\left[\frac{Y_t}{\mathrm{e}^{rt}}\right] = \mathrm{e}^{-r(t-s)}\mathbb{\mathbb{E}}^R_s [Y_t]\;,
\qquad(7.29)\]</span></span></p>
<p>which means that the value <span class="math inline">\(Y_s\)</span> is the expected value of <span class="math inline">\(Y_t\)</span> discounted at the risk-free rate for the remaining time <span class="math inline">\(t-s\)</span>, when the expectation is computed under the risk-neutral probability.</p>
<p>Notice that this implies <span class="math inline">\(m_t e^{rt}\)</span> is a martingale. This tells us how to change probabilities as follows: for any time <span class="math inline">\(t\)</span> random variable<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>, <span class="math inline">\(Z\)</span>, <span class="math display">\[E[m_t e^{rt} Z] = E^R[Z] \]</span> Similar remarks also apply to any dividend reinvested trading strategy, <span class="math inline">\(X\)</span>, <span class="math inline">\(m_t X_t\)</span> is a martingale. Then <span class="math display">\[E[m_t X_t Z] = X(0) E^X[Z]\]</span>.</p>
<p>We end this section with a proof of <a href="#eq-preformula" class="quarto-xref">Equation&nbsp;<span>7.27</span></a>.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<div class="callout callout-style-default callout-Extra no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Theory Extra
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Consider any time <span class="math inline">\(s&lt;t\)</span> and any event <span class="math inline">\(A\)</span> that is distinguishable by time <span class="math inline">\(s\)</span>. Consider the trading strategy of buying one share of the asset with price <span class="math inline">\(Y\)</span> at time <span class="math inline">\(s\)</span> when <span class="math inline">\(A\)</span> has happened and financing this purchase by short selling <span class="math inline">\(Y_s/P_s\)</span> shares of the asset with price <span class="math inline">\(P\)</span>. Each share of this asset that you short brings in <span class="math inline">\(P_s\)</span> dollars, so shorting <span class="math inline">\(Y_s/P_s\)</span> shares brings in <span class="math inline">\(Y_s\)</span> dollars, exactly enough to purchase the desired share of the first asset. Hold this portfolio until time <span class="math inline">\(t\)</span> and then liquidate it. Liquidating it generates <span class="math display">\[1_A\left(Y_t-\frac{Y_s}{P_s}P_t\right)\]</span> dollars. The multiplication by the random variable <span class="math inline">\(1_A\)</span> is because we only implement this strategy when <span class="math inline">\(A\)</span> occurs (i.e., when <span class="math inline">\(1_A=1\)</span>). Consider the security that pays this number of dollars at time <span class="math inline">\(t\)</span>. Because we obtained it with a trading strategy that required no investment at any time, its price at time <span class="math inline">\(0\)</span> must be <span class="math inline">\(0\)</span>. We already observed that we can represent the price in terms of state prices, so we conclude that <span class="math display">\[\mathbb{E}\left[m_t1_A\left(Y_t-\frac{Y_s}{P_s}P_t\right)\right] = 0\;\;.\]</span> When we divide by <span class="math inline">\(P_0\)</span>, this still equals zero. Factoring <span class="math inline">\(P_t\)</span> outside the parentheses gives <span class="math display">\[\mathbb{E}\left[1_A\frac{P_t}{P_0}m_t\left(\frac{Y_t}{P_t}-\frac{Y_s}{P_s}\right)\right] = 0\;\;.\]</span> We see from <a href="#eq-expSnumeraire2" class="quarto-xref">Equation&nbsp;<span>7.26</span></a> for expectations using <span class="math inline">\(P\)</span> as the numeraire that we can write this as <span class="math display">\[\mathbb{E}^P\left[1_A\left(\frac{Y_t}{P_t}-\frac{Y_s}{P_s}\right)\right]=0\;.\]</span> This is true for any event <span class="math inline">\(A\)</span> distinguishable at time <span class="math inline">\(s\)</span>, so the expectation of <span class="math inline">\(Y_t/P_t-Y_s/P_s\)</span> must be zero given any information at time <span class="math inline">\(s\)</span> when we use <span class="math inline">\(P\)</span> as the numeraire; i.e., <span class="math display">\[\mathbb{E}^P_s\left[\frac{Y_t}{P_t}-\frac{Y_s}{P_s}\right]=0\; ,\]</span> or, equivalently <span class="math display">\[\mathbb{E}^P_s\left[\frac{Y_t}{P_t}\right] = \frac{Y_s}{P_s}\;.\]</span></p>
</div>
</div>
</div>
</section>
</section>
<section id="multiple-cash-flows" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="multiple-cash-flows"><span class="header-section-number">7.7</span> Multiple Cash Flows</h2>
<p>Our valuation formulae work for dividend paying assets or trading strategies that make periodic payments. We simply sum up the value of the individual cash flows. If a stock pays dividends <span class="math inline">\(D_t\)</span> up to and including time <span class="math inline">\(T\)</span> and the stock price at time <span class="math inline">\(T\)</span> is <span class="math inline">\(S(T)\)</span> then the stock price is given by <span class="math display">\[S(0)= \mathbb{E}\left[\sum_{t=1}^T m_t D_t + M_T S(T)\right] \]</span></p>
</section>
<section id="further-discussion" class="level2" data-number="7.8">
<h2 data-number="7.8" class="anchored" data-anchor-id="further-discussion"><span class="header-section-number">7.8</span> Further Discussion</h2>
<p>How do the probabilities of different events change when we change probability measures? Which events become more likely and which become less likely? These are natural questions to ask. Let’s consider the risk-neutral probability assuming the risk free rate is constant. <a href="#eq-riskneutralformula" class="quarto-xref">Equation&nbsp;<span>7.29</span></a> can be rearranged as <span class="math display">\[\frac{\mathbb{E}^{R}_s[Y_t]}{Y_s} = \mathrm{e}^{r(t-s)}\,.\]</span> This means that the expected return on on the dividend-reinvested asset with price <span class="math inline">\(Y\)</span> is the risk-free rate. Stocks generally have positive risk premia, meaning they are expected to return more than the risk-free rate. Hence, when we shift from the actual probabilities to the risk-neutral probability, we are decreasing expected returns. How does this happen? It is because we increase the probabilities of bad events (low stock returns) and decrease the probabilities of good events (high stock returns).</p>
<p>In Example <span class="math inline">\(\ref{example:binomial}\)</span>, it is easy to calculate that the risk-neutral probabilities are <span class="math inline">\(p_u=0.75\)</span> and <span class="math inline">\(p_d=0.25\)</span>. To value the call option, we did not need to specifythe actual probabilities, but if the expected return of the stock is higher than the risk-free return – that is, if the stock has a positive risk premium – then it must be the case that <span class="math inline">\(p_u &gt; 0.75\)</span>. For example, if the expected return is 8%, then <span class="math inline">\(p_u=0.9\)</span>. Thus, if the stock has a positive risk premium, then the risk-neutral probability of the stock falling is higher than the actual probability.</p>
<p>The usual way to value risky assets is to discount expected future values at a risk-adjusted rate that is higher than the risk-free rate. What we have shown is that we can instead value risky assets by adjusting the probabilities and discounting at the risk-free rate. Instead of increasing the discount rate relative to the risk-free rate, we increase the probabilities of bad events. These are alternative ways of valuing risky assets.</p>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Create a Python function in which the user inputs <span class="math inline">\(S\)</span>, <span class="math inline">\(S_d\)</span>, <span class="math inline">\(S_u\)</span>, <span class="math inline">\(K\)</span>, <span class="math inline">\(r\)</span> and <span class="math inline">\(t\)</span>. Check that the no-arbitrage condition <a href="#eq-binomialnoarbitrage" class="quarto-xref">Equation&nbsp;<span>7.1</span></a> is satisfied. Compute the value of a call option in each of the following ways:</p>
<ol type="1">
<li>Compute the delta and use <a href="#eq-C0" class="quarto-xref">Equation&nbsp;<span>7.2</span></a>.</li>
<li>Compute the state prices and use <a href="#eq-binomialC2" class="quarto-xref">Equation&nbsp;<span>7.7</span></a>.</li>
<li>Compute the risk-neutral probabilities and use <a href="#eq-binomialC3" class="quarto-xref">Equation&nbsp;<span>7.10</span></a>.</li>
<li>Compute the probabilities using the stock as numeraire and use <a href="#eq-binomialC5" class="quarto-xref">Equation&nbsp;<span>7.16</span></a>.</li>
</ol>
<p>Verify that all of these methods produce the same answer.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In a two-state model, a put option is equivalent to <span class="math inline">\(\delta_p\)</span> shares of the stock, where <span class="math inline">\(\delta_p = (P_u-P_d)/(S_u-S_d)\)</span> (this will be negative, meaning a short position) and some money invested in the risk-free asset. Derive the amount of money <span class="math inline">\(x\)</span> that should be invested in the risk-free asset to replicate the put option. The value of the put at date <span class="math inline">\(0\)</span> must be <span class="math inline">\(x+\delta_pS\)</span>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-Exercise no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Using the result of the previous exercise, repeat Problem~<span class="math inline">\(\ref{e_binomialcall}\)</span> for a put option.</p>
</div>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Arrow" class="csl-entry" role="listitem">
Arrow, K. J. 1964. <span>“The Role of Securities in the Optimal Allocation of Risk Bearing.”</span> <em>Review of Economic Studies</em> 31: 91–96.
</div>
<div id="ref-CR" class="csl-entry" role="listitem">
Cox, J., and S. Ross. 1976. <span>“The Valuation of Options for Alternative Stochastic Processes.”</span> <em>Journal of Financial Economics</em> 3: 145–66.
</div>
<div id="ref-GKR" class="csl-entry" role="listitem">
Geman, H., N. El Karoui, and J.-C. Rochet. 1995. <span>“Changes of Numeraire, Changes of Probability Measure and Option Pricing.”</span> <em>Journal of Applied Probability</em> 32: 443–58.
</div>
<div id="ref-HK" class="csl-entry" role="listitem">
Harrison, J. M., and D. Kreps. 1979. <span>“Martingales and Arbitrage in Multiperiod Securities Markets.”</span> <em>Journal of Economic Theory</em> 20: 381–408.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>This fundamental idea is due to Cox and Ross <span class="citation" data-cites="CR">(<a href="#ref-CR" role="doc-biblioref">Cox and Ross 1976</a>)</span>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>All of the equations appearing below are also true if instead we take <span class="math inline">\(R=\mathrm{e}^{-rt}\)</span> and <span class="math inline">\(R_u=R_d=1\)</span>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>We have proven this in the two-state model, but we will not prove it in general. As is standard in the literature, we simply adopt it as an assumption. A general proof is in fact difficult and requires a definition of no arbitrage that is considerably more complicated than the simple assumption <a href="#eq-binomialnoarbitrage" class="quarto-xref">Equation&nbsp;<span>7.1</span></a> that is sufficient in the two-state up-and-down model.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p> In general the expectation (or mean) of a random variable is an intuitive concept, and an intuitive understanding is sufficient for this book, so we will not give a formal definition. It should be understood that we are assuming implicitly, whenever necessary, that the expectation exists (which is not always the case). In this regard, it is useful to note in passing that a product of two random variables <span class="math inline">\(XY\)</span> has a finite mean whenever <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> have finite variances.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>In other words a random variable whose value is known at time <span class="math inline">\(t\)</span><a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>The proof is due to Harrison and Kreps <span class="citation" data-cites="HK">(<a href="#ref-HK" role="doc-biblioref">Harrison and Kreps 1979</a>)</span>. See also Geman, El Karoui and Rochet <span class="citation" data-cites="GKR">(<a href="#ref-GKR" role="doc-biblioref">Geman, El Karoui, and Rochet 1995</a>)</span>. We omit here technical assumptions regarding the existence of expectations.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Chapter_GBM.html" class="pagination-link" aria-label="Geometric Brownian Motion">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Geometric Brownian Motion</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Chapter_Deltas.html" class="pagination-link" aria-label="Delta Hedges, Replication, and PDEs">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Delta Hedges, Replication, and PDEs</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions"><ul><li><a href="https://github.com/math-finance-book/book-code.git/blob/main/Chapter_Arbitrage.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div></div></footer></body></html>